import{j as e,r as j,a as Gt}from"./react-f1c107a9.js";import{c as Jt}from"./react-dom-8c6b07ed.js";import{G as C,B as Xt,T as qe,C as B,n as H,u as he,M as xe,a as k,A as Yt,b as O,P as Se,c as Qt,r as R,d as w,e as Zt,f as vt,g as St,h as Ct,i as te,j as ce,k as P,l as Le,m as N,U as ze,R as es,o as E,p as Y,q as Oe,s as ot,t as ue,v as Be,w as st,x as ts,y as ss,I as Ue,S as kt,D as Re,z as ne,E as at,F as ls,H as He,J as wt,K as It,L as J,N as Pt,O as x,Q as ns,V as os,W as ee,X as de,Y as V,Z as as,_ as Ce,$ as Ye,a0 as jt,a1 as U,a2 as Q,a3 as rs,a4 as is,a5 as cs,a6 as ds,a7 as zt,a8 as us,a9 as Ee,aa as ps,ab as hs,ac as xs,ad as js,ae as ms,af as gs}from"./@mantine-bd686c02.js";import{a as bs}from"./axios-47b9d439.js";import{I as ge,a as ys,b as $e,c as fs,d as $t,e as Ae,f as Ne,g as vs,h as De,i as rt,j as Ss,k as Cs,l as ks,m as At,n as Nt,o as Dt,p as ws,q as Is,r as it,s as ct,t as Ps,u as zs,v as W,w as we,x as $s,y as Ft,z as _t,A as Ie,B as As,C as Ns,D as Ds,E as Fs,F as _s,G as Ts,H as Rs,J as Fe,K as Es,L as Tt,M as Rt,N as ke,O as mt,P as Os,Q as Et,R as Ls,S as Ot,T as le,U as dt,V as Us,W as oe,X as Vs,Y as je,Z as Ms,_ as qs,$ as Bs,a0 as We,a1 as Hs,a2 as Lt,a3 as Ws,a4 as Ut,a5 as Ks,a6 as Gs,a7 as Vt,a8 as Js,a9 as Xs,aa as Ys,ab as Qs,ac as Zs,ad as el}from"./@tabler-c20e834a.js";import{l as tl}from"./socket.io-client-22a5d2b6.js";import{D as ae,C as re,P as ie}from"./@hello-pangea-490a609e.js";import{c as lt}from"./cronstrue-e5d11c06.js";import"./scheduler-765c72db.js";import"./clsx-1229b3e0.js";import"./react-remove-scroll-f666ceab.js";import"./tslib-89fde298.js";import"./react-remove-scroll-bar-0f7f50fb.js";import"./react-style-singleton-2b32e474.js";import"./get-nonce-1ea010b7.js";import"./use-sidecar-963ab5df.js";import"./use-callback-ref-66b944cb.js";import"./react-textarea-autosize-5c784669.js";import"./@babel-9e53ba6c.js";import"./use-latest-9995ceb4.js";import"./use-isomorphic-layout-effect-172b4ea6.js";import"./use-composed-ref-213e2f2a.js";import"./react-number-format-dc8ba855.js";import"./@floating-ui-38b1b349.js";import"./react-transition-group-a63a6537.js";import"./fast-deep-equal-d299cf6d.js";import"./klona-192252da.js";import"./react-dropzone-esm-4c866d80.js";import"./prop-types-10f50d8b.js";import"./engine.io-client-7d9b57ef.js";import"./engine.io-parser-b13552ae.js";import"./@socket.io-3e1df240.js";import"./socket.io-parser-44417fca.js";import"./redux-8461dc71.js";import"./react-redux-666e0041.js";import"./hoist-non-react-statics-dc04b2fe.js";import"./react-is-e8e5dbb3.js";import"./use-sync-external-store-a07c9c97.js";import"./use-memo-one-37007388.js";import"./css-box-model-5383974c.js";import"./tiny-invariant-dd7d57d2.js";import"./memoize-one-297ddbcb.js";import"./raf-schd-5404ed65.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function l(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(n){if(n.ep)return;n.ep=!0;const i=l(n);fetch(n.href,i)}})();const sl="_navbar_1yx7j_1",ll="_link_1yx7j_33",nl="_links_1yx7j_65",ol="_linkIcon_1yx7j_77",al="_section_1yx7j_87",rl="_header_1yx7j_107",il="_collectionsHeader_1yx7j_117",cl="_user_1yx7j_129",G={navbar:sl,link:ll,links:nl,linkIcon:ol,section:al,header:rl,collectionsHeader:il,user:cl};function Mt({opened:t,toggle:s}){return e.jsxs(C,{h:s?"100%":void 0,px:s?"md":void 0,justify:"space-between",children:[s&&e.jsx(Xt,{opened:t,onClick:s,hiddenFrom:"sm",size:"sm"}),e.jsx(qe,{order:3,children:"CDAP Provisioner"}),e.jsx(B,{fw:700,children:"v0.4.0"})]})}const Ke=j.createContext({changeNav:()=>{}}),Pe=j.createContext({authed:void 0,session:void 0,logout:()=>{},login:()=>{}});function Ve(t={}){const[s,l]=j.useState(t.fetch||!1),[a,n]=j.useState(void 0),[i,o]=j.useState(void 0),[r,c]=j.useState(void 0),[p,u]=j.useState(t.default||void 0),[y,f]=j.useState({}),g={baseURL:`http://${new URL(window.location.href).hostname}:2327/api/v1`,method:"get"},h=bs.create(g),A=j.useCallback(()=>{n(void 0),o(void 0),c(void 0),u(t.default||void 0),f({})},[t]),D=j.useCallback((I={})=>{let m={...t,...I};m.url=(t.url||"")+(m.append_url||"");let F,K;const S=new Promise(function(v,b){F=v,K=b});if(m.preserve||A(),m.before&&m.before({...m,promise:S}),m.furl&&(m.url=m.furl(m)),m.fdata&&(m.data=m.fdata(m)),m.modify&&(m={...m,...m.modify({...m,promise:S})}),!(m.check&&m.check({...m,promise:S}))){if(f(m),l(!0),m.require){for(const v in m.require)if(!m.require[v])return}return h(m).then(v=>{c(v);let b=v.data||v;m.mutate&&(b=m.mutate(b)),b&&u(b),m.then&&m.then(b),F(b)}).catch(v=>{let b="Unknown Error",z;v.message&&(b=v.message),v.response&&v.response.data&&v.response.data.error&&(b=v.response.data.error),v.response&&v.response.data&&v.response.data.message&&(b=v.response.data.message),v.response&&v.response.data&&v.response.data.validation&&(z=v.response.data.validation),z||n(b),z&&o(z),m.catch&&m.catch({error:b,validation:z,status:v.response.status}),K({error:b,validation:z})}).finally(()=>{l(!1),m.finally&&m.finally({...m,promise:S}),m.cleanup&&A()}),S}},[h,t,A]);return j.useEffect(()=>{if(t.require){for(const I in t.require)if(!t.require[I])return}t.fetch&&D()},[]),{fetch:D,post:(I={})=>D({...I,method:"post"}),put:(I={})=>D({...I,method:"put"}),get:(I={})=>D({...I,method:"get"}),del:(I={})=>D({...I,method:"delete"}),reset:A,setData:u,loading:s,request:y,response:r,data:p,error:a,invalid:i}}function fe(t={}){const s=t.validation?Object.values(t.validation):t.error||t.message||JSON.stringify(t);H.show({title:"Error",message:s,color:"red"})}function _({catch:t,modify:s,headers:l={},...a}){const{logout:n}=j.useContext(Pe);return Ve({catch:({status:o,...r})=>{o===401&&n(),t&&t({status:o,...r}),(!r.validation||Object.keys(r.validation).length<=0)&&fe(r)},modify:o=>{const r=s?s(o):o;return{headers:{Authorization:`Bearer ${JSON.parse(JSON.parse(localStorage.getItem("auth")||"")||{}).session}`,...l},...r}},...a})}const M=j.createContext({schema:void 0,loading:!1,connectors:[],rules:[],_rules:{},_connectors:{},headers:{},changeSchema:()=>{},reload:()=>{},mutate:()=>{}});function qt(t){const s=/[<>:"/\\|?*]/g,l=/^(CON|PRN|AUX|NUL|COM[1-9]|LPT[1-9])$/i;return!s.test(t)&&!l.test(t)&&t.length<=260&&t.length>0}function dl({opened:t,close:s,refresh:l}){const{changeSchema:a}=j.useContext(M),n=he({initialValues:{name:""},validate:{name:c=>qt(c)?null:"Invalid schema name"}}),{post:i,loading:o,error:r}=_({url:"/schema",data:n.values,before:()=>n.validate(),check:()=>!n.isValid(),catch:({validation:c})=>n.setErrors(c),then:c=>{a(c.name),s(),l()}});return e.jsxs(xe,{opened:t,onClose:s,title:"New Schema",children:[e.jsx(k,{label:"Schema Name",placeholder:"Schema Name",leftSection:e.jsx(ge,{size:16,style:{display:"block",opacity:.5}}),withAsterisk:!0,...n.getInputProps("name")}),r&&e.jsx(Yt,{mt:"xs",icon:e.jsx(ys,{size:32}),title:"Error",color:"red",children:r}),e.jsx(C,{justify:"right",mt:"md",children:e.jsx(O,{loading:o,onClick:i,type:"submit",children:"Create Schema"})})]})}function Me(t,s={}){const[l,a]=j.useState(s.default);return j.useEffect(()=>{const n=new URL(window.location.href),i=tl(`http://${n.hostname}:2327`);return i.connect(),i.on(t,(o,...r)=>{s.set!==!1&&a(o),s.then&&s.then(o,...r)}),()=>{i.off(t),i.disconnect()}},[]),[l,a]}const ul="_card_11ylv_1",pl="_icon_11ylv_17",hl="_title_11ylv_29",Qe={card:ul,icon:pl,title:hl};function Bt({resultant:t}){const[s]=Me("job_status",{default:"Idle"}),[l]=Me("progress",{default:{eta:"Estimating...",i:0,p:0,m:0}});return e.jsxs(Se,{radius:"md",withBorder:!0,className:Qe.card,mt:32,mb:32,children:[e.jsx(Qt,{className:Qe.icon,size:60,radius:60,children:t?e.jsx($e,{style:{width:R(32),height:R(32)},stroke:1.5}):e.jsx(fs,{style:{width:R(32),height:R(32)},stroke:1.5})}),e.jsx(w,{ta:"center",fw:700,className:Qe.title,children:t?"Running Actions":"Finding Matches"}),e.jsx(w,{c:"dimmed",ta:"center",fz:"sm",children:s}),e.jsxs(C,{justify:"space-between",mt:"xs",children:[e.jsx(w,{fz:"sm",c:"dimmed",children:"Progress"}),e.jsxs(w,{fz:"sm",c:"dimmed",children:[Math.floor(l.p),"%"]})]}),e.jsx(Zt,{mt:5,value:l.p,animated:!0}),e.jsxs(C,{justify:"space-between",mt:"md",children:[e.jsxs(w,{fz:"sm",children:[l.i," / ",l.m]}),e.jsx(vt,{size:"sm",children:l.eta})]})]})}const xl=[{icon:Cs,label:"Dashboard"},{icon:ks,label:"Settings"},{icon:At,label:"Schedules"}],jl=[{icon:Nt,label:"Schema"},{icon:Dt,label:"Connectors"},{icon:ws,label:"Rules"}];function gt({link:t,active:s,onClick:l}){return e.jsx(O,{"data-active":s||void 0,fullWidth:!0,variant:"subtle",size:"xs",leftSection:e.jsx(t.icon,{size:20,stroke:1.5}),styles:{inner:{justifyContent:"start"},label:{fontWeight:400}},classNames:{root:G.link},onClick:l,children:t.label})}function ml({closeNav:t}){const{nav:s,changeNav:l}=j.useContext(Ke),{logout:a,session:n}=j.useContext(Pe),{schema:i,changeSchema:o,loading:r}=j.useContext(M),c=St(`(max-width: ${Ct(750)})`),[p,{open:u,close:y}]=te(!1),[f,{open:d,close:g}]=te(!1),[h,A]=j.useState(""),{data:D=[],loading:T,fetch:L}=_({url:"/schema",default:[],preserve:!0,fetch:!0,mutate:F=>F.map(K=>({label:K.name}))}),{del:X}=_({url:"/auth"}),q=()=>{X(),a()};j.useEffect(()=>{T||r||(i||L(),i&&h!==i.name&&(L(),A(i.name)))},[i]);const $=F=>{l(F),c&&t()},[I]=Me("global_status",{default:{}}),[m]=Me("progress",{default:{p:0}});return j.useEffect(()=>{I.schema||g()},[I.schema]),e.jsxs("nav",{className:G.navbar,children:[I.schema&&e.jsx(xe,{withCloseButton:!1,size:"xl",opened:f,onClose:g,styles:{body:{padding:0},content:{backgroundColor:"transparent"}},children:e.jsx(ce,{children:e.jsx(Bt,{resultant:!1})})}),p&&e.jsx(dl,{opened:p,close:y,refresh:L}),!c&&e.jsx(P,{className:`${G.section} ${G.header}`,children:e.jsx(Mt,{})}),e.jsx(P,{pt:"xs",className:G.section,children:e.jsx(P,{className:G.links,children:xl.map(F=>e.jsx(gt,{onClick:()=>$(F.label),active:s===F.label,link:F},F.label))})}),i&&e.jsx(P,{pt:"xs",className:G.section,children:e.jsx(P,{className:G.links,children:jl.map(F=>e.jsx(gt,{onClick:()=>$(F.label),active:s===F.label,link:F},F.label))})}),e.jsxs(P,{style:{flex:1},className:G.section,children:[e.jsxs(C,{className:G.collectionsHeader,justify:"space-between",children:[e.jsx(w,{size:"xs",fw:500,c:"dimmed",children:"Schemas"}),e.jsx(Le,{label:"Create schema",withArrow:!0,position:"right",children:e.jsx(N,{onClick:u,loading:T,variant:"default",size:18,children:e.jsx($t,{style:{width:R(12),height:R(12)},stroke:1.5})})})]}),e.jsx(P,{className:G.links,children:D.map(F=>{const K=(i&&i.name)===F.label;return e.jsx(O,{fullWidth:!0,variant:"subtle",size:"xs",styles:{inner:{justifyContent:"space-between"},label:{fontWeight:400}},classNames:{root:G.link},onClick:()=>K?void 0:o(F.label),loading:r===F.label,disabled:!!r,rightSection:K?e.jsx(Ae,{onClick:()=>o(void 0),style:{width:R(12),height:R(12),cursor:"pointer"},stroke:1.5}):void 0,"data-active":K?!0:void 0,children:F.label},F.label)})})]}),e.jsx(P,{children:e.jsx(Se,{withBorder:!0,radius:"md",mb:"xs",pb:0,children:e.jsx(ze,{style:{cursor:I.schema?"pointer":"auto"},disabled:!I.schema,onClick:d,className:G.user,p:"xs",children:e.jsxs(C,{children:[I.schema?e.jsx(es,{size:50,roundCaps:!0,thickness:3,sections:[{value:m.p,color:"blue"}],label:e.jsx(ce,{children:I.running?e.jsx($e,{style:{width:R(20),height:R(20)},stroke:1.5}):e.jsx(Ne,{style:{width:R(20),height:R(20)},stroke:1.5})})}):e.jsx(vs,{style:{width:R(50),height:R(50)},stroke:.5}),e.jsxs("div",{children:[e.jsx(w,{size:"sm",tt:"uppercase",children:"Status:"}),I.schema?e.jsxs(e.Fragment,{children:[e.jsx(w,{c:"dimmed",size:"xs",children:I.running?"Running Actions...":"Finding Matches..."}),e.jsxs(w,{c:"dimmed",size:"xs",children:["Schema: ",I.schema]}),e.jsxs(w,{c:"dimmed",size:"xs",children:["Rule: ",I.rule]})]}):e.jsx(w,{c:"dimmed",size:"xs",children:"Idle"})]})]})})})}),e.jsx(P,{children:e.jsx(Se,{radius:"md",withBorder:!0,p:0,bg:"var(--mantine-color-body)",children:e.jsxs(E,{position:"top-start",width:"target",children:[e.jsx(E.Target,{children:e.jsx(ze,{className:G.user,children:e.jsxs(C,{children:[e.jsx(De,{style:{width:R(20),height:R(20)},stroke:1.5}),e.jsxs("div",{style:{flex:1},children:[e.jsx(w,{size:"sm",fw:500,children:n==null?void 0:n.username}),e.jsx(w,{c:"dimmed",size:"xs",children:"administrator"})]}),e.jsx(rt,{style:{width:R(14),height:R(14)},stroke:1.5})]})})}),e.jsx(E.Dropdown,{children:e.jsx(E.Item,{onClick:q,leftSection:e.jsx(Ss,{style:{width:R(14),height:R(14)}}),children:"Logout"})})]})})})]})}const gl="_box_xo72w_1",bl="_input_xo72w_7",ve={box:gl,input:bl};function yl({completeSetup:t}){const{login:s}=j.useContext(Pe),l=he({initialValues:{username:"",password:"",collection:!1},validate:{username:Y("Username can not be empty."),password:Oe({min:5},"Password must be at least 5 characters long.")}}),{post:a,loading:n}=Ve({url:"/setup",data:l.values,then:r=>{t(),s(JSON.stringify(r))},catch:({validation:r})=>l.setErrors(r)}),i=()=>{l.validate(),l.isValid()&&a()},o=r=>r.key==="Enter"&&i();return e.jsxs(ot,{size:420,my:40,children:[e.jsx(qe,{ta:"center",children:"New Installation"}),e.jsx(w,{c:"dimmed",size:"sm",ta:"center",mt:5,children:"Please create the initial administrative user."}),e.jsxs(Se,{className:ve.box,withBorder:!0,shadow:"md",p:30,mt:30,radius:"md",children:[e.jsx(k,{classNames:{input:ve.input},onKeyUp:o,...l.getInputProps("username"),label:"Username",placeholder:"Your Username",required:!0}),e.jsx(ue,{classNames:{input:ve.input},onKeyUp:o,...l.getInputProps("password"),label:"Password",placeholder:"Your password",required:!0,mt:"md"}),e.jsx(C,{justify:"space-between",mt:"lg",children:e.jsx(Be,{...l.getInputProps("collection",{type:"checkbox"}),label:"Allow collection of anonymous statistics"})}),e.jsx(O,{onClick:()=>i(),loading:n,fullWidth:!0,mt:"xl",children:"Create User"})]})]})}function fl(){const[t,s,l]=st({key:"setup",defaultValue:"false"}),[a,n,i]=st({key:"lastLogin",defaultValue:""}),o=()=>s("true"),{login:r}=j.useContext(Pe),c=he({initialValues:{username:"",password:"",checked:!1},validate:{username:Y("Username can not be empty."),password:Y("Password can not be empty.")}});j.useEffect(()=>{c.setFieldValue("username",a||""),c.setFieldValue("checked",a!=="")},[a]);const{post:p,loading:u}=Ve({url:"/auth",data:c.values,then:d=>{c.values.checked?n(d.username):i(),r(JSON.stringify(d))},catch:({validation:d})=>c.setErrors(d)});Ve({url:"/setup",fetch:!0,then:({status:d})=>d?o():l()});const y=()=>{c.validate(),c.isValid()&&p()},f=d=>d.key==="Enter"&&y();return!t||t=="false"?e.jsx(yl,{completeSetup:o}):e.jsxs(ot,{size:420,my:40,children:[e.jsx(qe,{ta:"center",children:"CDAPP Login"}),e.jsxs(Se,{className:ve.box,withBorder:!0,shadow:"md",p:30,mt:30,radius:"md",children:[e.jsx(k,{classNames:{input:ve.input},onKeyUp:f,...c.getInputProps("username"),label:"Username",placeholder:"Your Username",required:!0,rightSection:a&&e.jsx(N,{variant:"subtle",size:"sm",onClick:()=>i(),children:e.jsx(Ae,{size:16,style:{display:"block",opacity:.5}})})}),e.jsx(ue,{classNames:{input:ve.input},onKeyUp:f,...c.getInputProps("password"),label:"Password",placeholder:"Your password",required:!0,mt:"md"}),e.jsxs(C,{justify:"space-between",mt:"lg",children:[e.jsx(Be,{label:"Remember me",...c.getInputProps("checked",{type:"checkbox"})}),e.jsx(ts,{component:"button",size:"sm",children:"Forgot password?"})]}),e.jsx(O,{onClick:()=>y(),loading:u,fullWidth:!0,mt:"xl",children:"Sign in"})]})]})}function be({children:t,leftSection:s,rightSection:l,...a}){return e.jsxs(C,{justify:"space-between",mb:"xs",children:[e.jsxs(P,{children:[e.jsx(qe,{order:2,...a,children:t}),s]}),e.jsx(P,{}),e.jsx(P,{children:l})]})}const vl="_container_1im94_1",Sl="_item_1im94_13",Cl="_input_1im94_25",kl="_overflow_1im94_33",Z={container:vl,item:Sl,input:Cl,overflow:kl};function ye({children:t,label:s,size:l,...a}){return e.jsxs(ot,{size:l||"lg",children:[typeof s=="string"?e.jsx(be,{...a,children:s}):s,e.jsx(Se,{className:Z.container,p:"xl",children:t})]})}function wl(){const{setColorScheme:t,clearColorScheme:s}=ss(),{changeSchema:l}=j.useContext(M),{get:a,loading:n}=_({url:"/fix",then:()=>{l(void 0),H.show({title:"Success",message:"Cache Purged.",color:"lime"}),setTimeout(()=>location.reload(),1e3)}});return e.jsxs(ye,{label:"Application Settings",children:[e.jsx(Ue.Wrapper,{label:"Theme",description:"Change colours of the application",children:e.jsx(kt,{mt:"xs",fullWidth:!0,maw:300,onChange:i=>i==="auto"?s():t(i),data:[{label:"Light",value:"light"},{label:"Dark",value:"dark"},{label:"Auto",value:"auto"}]})}),e.jsx(Ue.Wrapper,{label:"Clear Cache",description:"Purges the server cache to fix schema inconsistencies, etc.",children:e.jsx(O,{loading:!!n,onClick:()=>a(),mt:5,children:"Fix"})})]})}function Il(t){const[s,{close:l,open:a}]=te(!1);return{Modal:({children:i,...o})=>e.jsx(xe,{size:"lg",opened:s,onClose:l,title:t,...o,children:i}),opened:s,open:a,close:l}}function Pl({close:t}){const{schema:s,reload:l}=j.useContext(M),{post:a,loading:n,error:i}=_({url:`/schema/${s==null?void 0:s.name}/import`,headers:{"Content-Type":"multipart/form-data"},modify:r=>(console.log(r),r),then:()=>{t(),l()}}),o=r=>{const c=new FormData;c.append("file",r[0]),a({data:c})};return e.jsx(Re,{loading:n,onDrop:o,accept:["application/zip","application/x-zip-compressed"],children:e.jsxs(C,{justify:"center",gap:"xl",mih:200,style:{pointerEvents:"none"},children:[e.jsx(Re.Accept,{children:e.jsx(Is,{size:50,stroke:1.5})}),e.jsx(Re.Reject,{children:e.jsx(Ae,{size:50,stroke:1.5})}),e.jsx(Re.Idle,{children:e.jsx(it,{size:50,stroke:1.5})}),e.jsxs("div",{children:[e.jsx(w,{size:"xl",inline:!0,children:"Drag schema here or click to select file"}),e.jsx(w,{size:"sm",c:"dimmed",inline:!0,mt:7,children:"Import files must be generated by the schema export function"}),i&&e.jsx(w,{c:"red",inline:!0,mt:7,children:i})]})]})})}const zl="_button_1jnqc_1",$l="_menuControl_1jnqc_11",bt={button:zl,menuControl:$l};function ut({children:t,options:s=[],onClick:l,loading:a,menu:n,...i}){return e.jsxs(C,{wrap:"nowrap",gap:0,children:[e.jsx(O,{loading:a,onClick:l,...i,className:bt.button,children:t}),e.jsxs(E,{disabled:a,transitionProps:{transition:"pop"},position:"bottom-end",...n,withinPortal:!0,children:[e.jsx(E.Target,{children:e.jsx(N,{...i,size:36,className:bt.menuControl,children:e.jsx(ct,{style:{width:R(16),height:R(16)},stroke:1.5})})}),e.jsx(E.Dropdown,{children:s.map(({label:o,onClick:r,...c},p)=>e.jsx(E.Item,{onClick:r?()=>{r(o)}:void 0,...c,children:o},p))})]})]})}function Al({save:t,saving:s}){const l=ne(),{schema:a,changeSchema:n}=j.useContext(M),{Modal:i,opened:o,open:r,close:c}=Il("Import Schema"),{del:p,loading:u}=_({url:`/schema/${a==null?void 0:a.name}`,then:()=>n(void 0)}),y=()=>at.openConfirmModal({title:"Delete Schema",centered:!0,children:e.jsx(w,{size:"sm",children:"Are you sure you want to delete this schema? This action is destructive and cannot be reversed."}),labels:{confirm:"Delete schema",cancel:"No don't delete it"},confirmProps:{color:"red"},onConfirm:()=>p()}),f=JSON.parse(JSON.parse(localStorage.getItem("auth")||"")||{}),d=new URL(window.location.href);return e.jsxs(e.Fragment,{children:[o&&e.jsx(i,{children:e.jsx(Pl,{close:c})}),e.jsx(ut,{loading:s||u,variant:"light",onClick:t,options:[{component:"a",href:`http://${d.hostname}:2327/api/v1/schema/${a==null?void 0:a.name}/export/${f.session}`,label:"Export",leftSection:e.jsx(Ps,{size:16,color:l.colors.green[5]})},{onClick:()=>r(),label:"Import",leftSection:e.jsx(zs,{size:16,color:l.colors.orange[5]})},{onClick:()=>y(),label:"Delete",leftSection:e.jsx(W,{size:16,color:l.colors.red[5]})}],children:"Save"})]})}function Nl(){const{schema:t,mutate:s}=j.useContext(M),l=he({initialValues:t,validate:{name:i=>qt(i)?null:"Invalid schema name"}}),{put:a,loading:n}=_({url:`/schema/${t==null?void 0:t.name}`,data:l.values,before:()=>l.validate(),check:()=>!l.isValid(),catch:({validation:i})=>l.setErrors(i),then:()=>{s(l.values),H.show({title:"Success",message:"Settings Saved.",color:"lime"})}});return e.jsx(ye,{label:e.jsx(be,{rightSection:e.jsx(Al,{saving:n,save:a}),children:"Schema Settings"}),children:e.jsx(k,{label:"Schema Name",placeholder:"Schema Name",leftSection:e.jsx(ge,{size:16,style:{display:"block",opacity:.5}}),withAsterisk:!0,...l.getInputProps("name")})})}const me={ldap:{id:"ldap",name:"Lightweight Directory Access Protocol (LDAP)",icon:we,color:"blue"},csv:{id:"csv",name:"Comma-Separated Values (CSV)",icon:$s,color:"teal"},stmc:{id:"stmc",name:"eduSTAR Management Centre (STMC)",icon:Ft,color:"red"},proxy:{id:"proxy",name:"Corporate Proxy Server",icon:_t,color:"orange"}},Dl="_card_1ybk5_1",Fl="_title_1ybk5_9",_l="_item_1ybk5_19",Ze={card:Dl,title:Fl,item:_l};function Tl({opened:t,close:s,add:l}){const a=ne();return e.jsx(xe,{size:"lg",styles:{content:{backgroundColor:"transparent"},body:{padding:0,margin:0}},opened:t,onClose:s,withCloseButton:!1,children:e.jsxs(ls,{mih:300,withBorder:!0,radius:"md",className:Ze.card,children:[e.jsx(C,{justify:"space-between",children:e.jsx(w,{className:Ze.title,children:"Select a provider"})}),e.jsx(He,{cols:2,mt:"md",children:Object.values(me).map(n=>e.jsxs(ze,{onClick:()=>l(n.id),className:Ze.item,children:[e.jsx(n.icon,{color:a.colors[n.color][6],size:"2rem"}),e.jsx(w,{size:"xs",mt:7,children:n.name})]},n.id))})]})})}const Rl={csv:{name:"My CSV",path:""},proxy:{name:"Proxy Server",url:"",username:"",password:""},ldap:{name:"Active Directory",url:"",username:"",password:"",base:"",attributes:[]},stmc:{name:"",username:"",password:"",school:"",cache:1440}},El={csv:{name:Y("Name can not be empty."),path:Oe({min:2},"Path must be at least 2 characters long.")},proxy:{name:Y("Name can not be empty."),url:Oe({min:3},"URL must be at least 3 characters long.")},ldap:{name:Y("Name can not be empty."),url:Oe({min:3},"URL must be at least 3 characters long."),username:Y("Username can not be empty."),password:Y("Password can not be empty.")},stmc:{name:Y("Name can not be empty."),username:Y("Username can not be empty."),password:Y("Password can not be empty."),school:Y("School ID can not be empty.")}};function Ol({form:t}){return e.jsxs(e.Fragment,{children:[e.jsx(k,{label:"Connector Name",leftSection:e.jsx(ge,{size:16,style:{display:"block",opacity:.5}}),placeholder:"File Name",withAsterisk:!0,...t.getInputProps("name")}),e.jsx(k,{label:"File Path",leftSection:e.jsx(Ie,{size:16,style:{display:"block",opacity:.5}}),placeholder:"C:/folder/input.csv",withAsterisk:!0,...t.getInputProps("path"),mt:"md"})]})}function se({children:t,label:s="Advanced",rightSection:l,open:a=!1,Icon:n=rt,...i}){const[o,{toggle:r}]=te(a);return e.jsxs(P,{children:[e.jsxs(C,{justify:"space-between",grow:!0,children:[e.jsx(ze,{mt:10,onClick:r,children:e.jsxs(C,{gap:2,children:[e.jsx(w,{...i,children:s}),e.jsx(n,{size:14,style:{transform:o?"rotate(90deg)":"none"}})]})}),l]}),e.jsx(wt,{in:o,children:t})]})}function pt({selectable:t=[],value:s="",onChange:l,createLabel:a}){const n=It({onDropdownClose:()=>n.resetSelectedOption()}),i=s?[...t,s].filter(function(h,A,D){return D.indexOf(h)==A}):t,[o,r]=j.useState(i),[c,p]=j.useState(s||null),[u,y]=j.useState(s||"");j.useEffect(()=>{y(s)},[s]);const f=o.some(h=>h===u),g=(f?o:o.filter(h=>h.toLowerCase().includes(u.toLowerCase().trim()))).map(h=>e.jsx(J.Option,{value:h,children:h},h));return e.jsxs(J,{store:n,withinPortal:!1,onOptionSubmit:h=>{h==="$create"?(r(A=>[...A,u]),p(u),l&&l(u)):(p(h),l&&l(h)),n.closeDropdown()},children:[e.jsx(J.Target,{children:e.jsx(Pt,{rightSection:e.jsx(J.Chevron,{}),value:u,onChange:h=>{n.openDropdown(),n.updateSelectedOptionIndex(),y(h.currentTarget.value)},onClick:()=>n.openDropdown(),onFocus:()=>n.openDropdown(),onBlur:()=>{n.closeDropdown(),y(s||c||"")},placeholder:"Search value",rightSectionPointerEvents:"none"})}),(o.length>0||u.length>0)&&e.jsx(J.Dropdown,{children:e.jsxs(J.Options,{children:[g,!f&&u.trim().length>0&&e.jsx(J.Option,{value:"$create",children:a?a(u):` + Create ${u}`})]})})]})}const ht=["name","displayName","givenName","SN","description","title","mail","company","department","manager","postalCode","pager","mobile","homephone","telephoneNumber","facsimileTelephoneNumber","wWWHomePage","ipPhone"],Ll=[{label:"== Equal To",value:"=="},{label:"!= Not Equal To",value:"!="},{label:">< Contains",value:"><"},{label:"<> Does Not Contain",value:"<>"},{label:">* Starts With",value:">*"},{label:"*< Ends With",value:"*<"},{label:"// Matches Regex",value:"//"}],Ul=[{label:"== Equal To",value:"==="},{label:"!= Not Equal To",value:"!=="},{label:">  Greater Than",value:">"},{label:"<  Lesser Than",value:"<"},{label:">= Greater Than, Or Equal To",value:">="},{label:"<= Lesser Than, Or Equal To",value:"<="}],et=[{label:"String Constraint",id:"string",Icon:As,color:"blue"},{label:"Math Constraint",id:"math",Icon:Ns,color:"pink"},{label:"Status",id:"status",connector:"ldap",Icon:Ds,color:"yellow"},{label:"Security Group",id:"group",connector:"ldap",Icon:Fs,color:"cyan"},{label:"Organisational Unit",id:"ou",connector:"ldap",Icon:Ie,color:"violet"}],Vl=[{label:"Directory Operations",id:"directory",Icon:we,color:"blue"},{label:"Document Operations",id:"document",Icon:Tt,color:"red"},{label:"File Operations",id:"file",Icon:it,color:"green"},{label:"Folder Operations",id:"folder",Icon:Ie,color:"orange"},{label:"System Operations",id:"system",Icon:Ls}],Ge={"Create User":{id:"Create User",catagory:"directory",Icon:_s,color:"blue"},"Enable User":{id:"Enable User",catagory:"directory",Icon:Ts,color:"green"},"Disable User":{id:"Disable User",catagory:"directory",Icon:Rs,color:"pink"},"Delete User":{id:"Delete User",catagory:"directory",Icon:W,color:"red"},"Update Attributes":{id:"Update Attributes",catagory:"directory",Icon:Fe,color:"orange"},"Move Organisational Unit":{id:"Move Organisational Unit",catagory:"directory",Icon:Es,color:"grape"},"Write PDF":{id:"Write PDF",catagory:"document",Icon:Tt,color:"red"},"Send To Printer":{id:"Send To Printer",catagory:"document",Icon:Rt,color:"lime"},"Copy File":{id:"Copy File",catagory:"file",Icon:ke,color:"blue"},"Move File":{id:"Move File",catagory:"file",Icon:mt,color:"orange"},"Delete File":{id:"Delete File",catagory:"file",Icon:W,color:"red"},"Copy Folder":{id:"Copy Folder",catagory:"folder",Icon:ke,color:"blue"},"Move Folder":{id:"Move Folder",catagory:"folder",Icon:mt,color:"orange"},"Delete Folder":{id:"Delete Folder",catagory:"folder",Icon:W,color:"red"},"Upload Student Passwords":{id:"Upload Student Passwords",catagory:"edustar",Icon:Os,color:"yellow"},Template:{label:"Build Data Template",id:"Template",catagory:"system",Icon:Et}};function Ml({form:t}){const s=t.values.attributes||[];return e.jsxs(e.Fragment,{children:[s.length===0&&e.jsx(ce,{c:"dimmed",fz:"xs",children:"No attributes configured."}),e.jsx(ae,{onDragEnd:({destination:l,source:a})=>t.reorderListItem("attributes",{from:a.index,to:l?l.index:0}),children:e.jsx(re,{droppableId:"dnd-list",direction:"vertical",children:l=>e.jsxs("div",{...l.droppableProps,style:{top:"auto",left:"auto"},ref:l.innerRef,children:[s.map((a,n)=>e.jsx(ie,{index:n,draggableId:n.toString(),children:i=>e.jsxs(x,{gutter:"xs",align:"center",ref:i.innerRef,mt:"xs",...i.draggableProps,style:{...i.draggableProps.style,left:"auto !important",top:"auto !important"},children:[e.jsx(x.Col,{span:"content",style:{cursor:"grab"},...i.dragHandleProps,children:e.jsx(C,{children:e.jsx(oe,{size:"1.2rem"})})}),e.jsx(x.Col,{span:"auto",children:e.jsx(pt,{selectable:ht,...t.getInputProps(`attributes.${n}`),createLabel:o=>`Add Custom Attribute: ${o}`})}),e.jsx(x.Col,{span:"content",children:e.jsx(C,{gap:0,justify:"flex-end",children:e.jsx(N,{onClick:()=>t.removeListItem("attributes",n),variant:"subtle",color:"red",children:e.jsx(W,{size:"1.2rem",stroke:1.5})})})})]})},n)),l.placeholder]})})})]})}function ql({form:t,editing:s}){const l=()=>t.setFieldValue("password",""),a=()=>t.insertListItem("attributes","");return e.jsxs(e.Fragment,{children:[e.jsx(k,{label:"Connector Name",leftSection:e.jsx(ge,{size:16,style:{display:"block",opacity:.5}}),placeholder:"Domain Name",withAsterisk:!0,...t.getInputProps("name")}),e.jsx(k,{label:"Target URL",leftSection:e.jsx(Ot,{size:16,style:{display:"block",opacity:.5}}),placeholder:"ldaps://10.10.1.1:636",withAsterisk:!0,...t.getInputProps("url"),mt:"md"}),e.jsxs(He,{mt:"md",cols:{base:1,sm:2},children:[e.jsx(k,{label:"Username",placeholder:"domain\\administrator",withAsterisk:!0,leftSection:e.jsx(De,{size:16,style:{display:"block",opacity:.5}}),...t.getInputProps("username")}),typeof t.values.password=="string"||!s?e.jsx(ue,{label:"Password",placeholder:"password",withAsterisk:!0,leftSection:e.jsx(le,{size:16,style:{display:"block",opacity:.5}}),...t.getInputProps("password")}):e.jsx(ue,{label:"Password",readOnly:!0,placeholder:"Password",value:"**************",leftSection:e.jsx(le,{size:16,style:{display:"block",opacity:.5}}),rightSection:e.jsx(N,{variant:"subtle",children:e.jsx(dt,{onClick:()=>l(),size:16,style:{display:"block",opacity:.5}})})})]}),e.jsx(se,{open:!0,label:"Attributes",rightSection:e.jsx(O,{onClick:()=>a(),maw:50,variant:"light",size:"compact-xs",mt:10,children:"Add"}),children:e.jsx(Ml,{form:t})}),e.jsxs(se,{children:[e.jsx(Be,{mt:"md",label:"Specify Root DSE",onChange:n=>t.setFieldValue("dse",n.currentTarget.checked?"":void 0),checked:!!t.values.dse||t.values.dse===""}),(t.values.dse||t.values.dse==="")&&e.jsx(k,{label:"Root DSE",description:"All distinguished names, including the Base Organizational Unit, will be appended by this path.",placeholder:"dc=sub,dc=domain,dc=com",withAsterisk:!0,leftSection:e.jsx(Us,{size:16,style:{display:"block",opacity:.5}}),...t.getInputProps("dse")}),e.jsx(k,{mt:"md",label:"Base Organizational Unit",description:"All distinguished names will be appended by this path.",placeholder:"ou=child,ou=parent",leftSection:e.jsx(Ie,{size:16,style:{display:"block",opacity:.5}}),...t.getInputProps("base"),rightSection:e.jsx(N,{variant:"subtle",children:e.jsx(Ne,{size:16,style:{display:"block",opacity:.5}})})})]})]})}function Bl({form:t,editing:s}){const l=()=>t.setFieldValue("password","");return e.jsxs(e.Fragment,{children:[e.jsx(k,{label:"Connector Name",leftSection:e.jsx(ge,{size:16,style:{display:"block",opacity:.5}}),placeholder:"Proxy Name",withAsterisk:!0,...t.getInputProps("name")}),e.jsx(k,{label:"Target URL",leftSection:e.jsx(Ot,{size:16,style:{display:"block",opacity:.5}}),placeholder:"http://proxy.server:8080",withAsterisk:!0,...t.getInputProps("url"),mt:"md"}),e.jsxs(He,{mt:"md",cols:{base:1,sm:2},children:[e.jsx(k,{label:"Username",placeholder:"username",...t.getInputProps("username"),leftSection:e.jsx(De,{size:16,style:{display:"block",opacity:.5}})}),typeof t.values.password=="string"||!s?e.jsx(ue,{label:"Password",placeholder:"password",leftSection:e.jsx(le,{size:16,style:{display:"block",opacity:.5}}),...t.getInputProps("password")}):e.jsx(ue,{label:"Password",readOnly:!0,placeholder:"Password",value:"**************",leftSection:e.jsx(le,{size:16,style:{display:"block",opacity:.5}}),rightSection:e.jsx(N,{variant:"subtle",children:e.jsx(dt,{onClick:()=>l(),size:16,style:{display:"block",opacity:.5}})})})]})]})}function pe({onChange:t,value:s="",...l}){const{connectors:a,_connectors:n}=j.useContext(M),i=ne(),o=It({onDropdownClose:()=>o.resetSelectedOption()}),[r,c]=j.useState(s||null);j.useEffect(()=>c(s),[s]);const p=s in n&&me[n[s].id],u=p&&e.jsx(p.icon,{color:i.colors[p.color][6],size:20,stroke:1.5}),y=a||[];l.type&&(l.filter=g=>g.filter(h=>h.id===l.type));const f=(l.filter?l.filter(y):y).map(g=>{const h=me[g.id];return{component:e.jsxs(C,{children:[e.jsx(h.icon,{color:i.colors[h.color][6],size:20,stroke:1.5})," ",g.name]}),value:g.name}}),d=(l.data||f).map(g=>{const h=typeof g=="string";return e.jsx(J.Option,{value:h?g:g.value,children:h?g:g.component},h?g:g.value)});return e.jsx(Ue.Wrapper,{...l,children:e.jsxs(J,{store:o,withinPortal:!1,onOptionSubmit:g=>{c(g),t&&t(g),o.closeDropdown()},children:[e.jsx(J.Target,{children:e.jsx(Pt,{component:"button",type:"button",pointer:!0,leftSection:l.leftSection===!1?void 0:l.leftSection?l.leftSection:u||e.jsx(Dt,{size:16,style:{display:"block",opacity:.5}}),mt:l.label?5:void 0,rightSection:l.clearable&&r!==null?e.jsx(ns,{size:"sm",onMouseDown:g=>g.preventDefault(),onClick:()=>{c(null),t&&t(void 0)},"aria-label":"Clear value"}):e.jsx(J.Chevron,{}),onClick:()=>o.toggleDropdown(),rightSectionPointerEvents:!l.clearable||r===null?"none":"all",children:r||e.jsx(Ue.Placeholder,{children:"Select Connector"})})}),e.jsx(J.Dropdown,{children:e.jsx(J.Options,{children:d})})]})})}function Hl({form:t,editing:s}){const l=()=>t.setFieldValue("password","");return e.jsxs(e.Fragment,{children:[e.jsx(k,{label:"Connector Name",leftSection:e.jsx(ge,{size:16,style:{display:"block",opacity:.5}}),placeholder:"School Name",withAsterisk:!0,...t.getInputProps("name")}),e.jsxs(He,{mt:"md",cols:{base:1,sm:2},children:[e.jsx(k,{label:"Username",placeholder:"ST01235",withAsterisk:!0,leftSection:e.jsx(De,{size:16,style:{display:"block",opacity:.5}}),...t.getInputProps("username")}),typeof t.values.password=="string"||!s?e.jsx(ue,{label:"Password",placeholder:"password",withAsterisk:!0,leftSection:e.jsx(le,{size:16,style:{display:"block",opacity:.5}}),...t.getInputProps("password")}):e.jsx(ue,{label:"Password",readOnly:!0,placeholder:"Password",value:"**************",leftSection:e.jsx(le,{size:16,style:{display:"block",opacity:.5}}),rightSection:e.jsx(N,{variant:"subtle",children:e.jsx(dt,{onClick:()=>l(),size:16,style:{display:"block",opacity:.5}})})})]}),e.jsx(k,{label:"School Identification Number",leftSection:e.jsx(Ft,{size:16,style:{display:"block",opacity:.5}}),placeholder:"1234",withAsterisk:!0,...t.getInputProps("school"),mt:"md"}),e.jsxs(se,{children:[e.jsx(os,{label:"Caching Policy",description:"Minutes until downloaded cache is purged.",leftSection:e.jsx(At,{size:16,style:{display:"block",opacity:.5}}),placeholder:"1440 (1 day)",...t.getInputProps("cache"),mt:"md"}),e.jsx(pe,{label:"Proxy Connector",placeholder:"Corporate Proxy Server",clearable:!0,...t.getInputProps("proxy"),filter:a=>a.filter(n=>n.id==="proxy"),leftSection:e.jsx(_t,{size:16,style:{display:"block",opacity:.5}}),mt:"md"})]})]})}function Wl({provider:t,form:s,editing:l}){switch(t){case"csv":return e.jsx(Ol,{form:s});case"ldap":return e.jsx(ql,{form:s,editing:l});case"proxy":return e.jsx(Bl,{form:s,editing:l});case"stmc":return e.jsx(Hl,{form:s,editing:l});default:return e.jsx(e.Fragment,{children:"Invalid Provider."})}}function Kl({editing:t,adding:s,close:l}){const{schema:a,mutate:n}=j.useContext(M),i=s?me[s]:t?me[t.id]:{id:"",name:""},o=Rl[i.id]||{},r=El[i.id]||{},c=he({initialValues:o,validate:r});j.useEffect(()=>{c.reset(),t?c.setValues(t):c.setValues(o),c.setInitialValues(o)},[t,s]);const{post:p,loading:u}=_({url:`/schema/${a==null?void 0:a.name}/connector`,data:{...c.values,id:i.id},before:()=>c.validate(),check:()=>!c.isValid(),catch:({validation:h})=>c.setErrors(h),then:({connectors:h,_connectors:A,headers:D})=>{n({connectors:h,_connectors:A,headers:D}),l(),H.show({title:"Success",message:"Connector Added.",color:"lime"})}}),{put:y,loading:f}=_({url:`/schema/${a==null?void 0:a.name}/connector`,data:{...c.values,id:i.id},before:()=>c.validate(),check:()=>!c.isValid(),catch:({validation:h})=>c.setErrors(h),then:({connectors:h,_connectors:A,headers:D})=>{n({connectors:h,_connectors:A,headers:D}),l(),H.show({title:"Success",message:"Connector Saved.",color:"lime"})}}),d=()=>y({append_url:`/${t==null?void 0:t.name}`}),g=u||f;return e.jsxs(xe,{size:"lg",opened:!!t||!!s,onClose:l,title:i.name,children:[e.jsx(Wl,{provider:i.id,form:c,editing:t}),e.jsx(C,{justify:"right",mt:"md",children:e.jsx(O,{loading:g,onClick:t?d:p,variant:"light",type:"submit",children:t?"Save":"Add"})})]})}function Gl(){const{schema:t,connectors:s,mutate:l}=j.useContext(M),a=ne(),[n,{open:i,close:o}]=te(!1),[r,c]=j.useState(void 0),[p,u]=j.useState(void 0),y=$=>{u(void 0),c($)},f=$=>{o(),c(void 0),u($)},{del:d,request:g,loading:h}=_({url:`/schema/${t==null?void 0:t.name}/connector`,catch:$=>fe($),then:({connectors:$,_connectors:I,headers:m})=>{l({connectors:$,_connectors:I,headers:m}),H.show({title:"Success",message:"Connector Removed.",color:"lime"})}}),{post:A,request:D,loading:T}=_({url:`/schema/${t==null?void 0:t.name}/connector`,catch:$=>fe($),then:({connectors:$,_connectors:I,headers:m})=>{l({connectors:$,_connectors:I,headers:m}),H.show({title:"Success",message:"Connector Copied.",color:"lime"})}}),L=$=>at.openConfirmModal({title:"Permanently Delete Connector",centered:!0,children:e.jsxs(w,{size:"sm",children:["Are you sure you want to delete ",$,"? This action is destructive and cannot be reversed."]}),labels:{confirm:"Delete connector",cancel:"No don't delete it"},confirmProps:{color:"red"},onConfirm:()=>d({append_url:`/${$}`,loading:$})}),q=h||T?(g||D).loading:!1;if(t)return e.jsxs(ye,{label:e.jsx(be,{rightSection:e.jsx(O,{onClick:()=>i(),variant:"light",children:"Add"}),children:"Connectors"}),children:[e.jsx(Tl,{add:f,opened:n,close:o}),e.jsx(Kl,{editing:r,adding:p,close:()=>{c(void 0),u(void 0)}}),e.jsxs(ee,{verticalSpacing:"sm",children:[e.jsx(ee.Thead,{children:e.jsxs(ee.Tr,{children:[e.jsx(ee.Th,{children:"Name"}),e.jsx(ee.Th,{children:"Provider"}),e.jsx(ee.Th,{})]})}),e.jsx(ee.Tbody,{children:s.map($=>{const I=me[$.id];return e.jsxs(ee.Tr,{children:[e.jsx(ee.Td,{children:e.jsxs(C,{miw:100,gap:"sm",children:[e.jsx(I.icon,{color:a.colors[I.color][6],size:20,stroke:1.5}),e.jsx(w,{fz:"sm",children:$.name})]})}),e.jsx(ee.Td,{children:e.jsx(vt,{color:a.colors[I.color][6],variant:"light",children:I.name})}),e.jsx(ee.Td,{miw:80,children:e.jsxs(C,{gap:0,justify:"flex-end",children:[e.jsx(N,{onClick:()=>y($),variant:"subtle",color:"orange",children:e.jsx(Fe,{style:{width:R(16),height:R(16)},stroke:1.5})}),e.jsx(N,{onClick:()=>A({append_url:`/${$.name}/copy`,loading:$.name}),loading:q===$.name,variant:"subtle",color:"indigo",children:e.jsx(ke,{style:{width:R(16),height:R(16)},stroke:1.5})}),e.jsx(N,{onClick:()=>L($.name),loading:q===$.name,variant:"subtle",color:"red",children:e.jsx(W,{style:{width:R(16),height:R(16)},stroke:1.5})})]})})]},$.name)})})]})]})}const Je=j.createContext({explorer:e.jsx(e.Fragment,{}),explore:()=>{},close:()=>{}});function Jl({form:t}){const{connectors:s}=j.useContext(M),{explorer:l,explore:a}=j.useContext(Je),n=s.filter(u=>u.id!=="proxy").length-1,{headers:i}=j.useContext(M),o=()=>t.insertListItem("secondaries",{primary:"",secondaryKey:"",primaryKey:""}),r=u=>t.removeListItem("secondaries",u),c=(t.values.secondaries||[]).map(u=>u.primary),p=()=>u=>t.setFieldValue("display",`${t.values.display||""}{{${u}}}`);return e.jsxs(P,{children:[l,e.jsx(k,{label:"Rule Name",leftSection:e.jsx(ge,{size:16,style:{display:"block",opacity:.5}}),placeholder:"Rule Name",withAsterisk:!0,mb:"xs",...t.getInputProps("name")}),e.jsxs(x,{children:[e.jsx(x.Col,{span:8,children:e.jsx(pe,{label:"Primary Data Source",withAsterisk:!0,description:"Rule conditions will be evaluated for each entry in this connector. For each row, each user, etc.",clearable:!0,...t.getInputProps("primary"),filter:u=>u.filter(y=>y.id!=="proxy")})}),e.jsx(x.Col,{span:4,children:e.jsx(de,{label:"Primary Key",withAsterisk:!0,description:"Unique identifier for each row.",placeholder:"id",data:t.values.primary in i?i[t.values.primary]:[],disabled:!t.values.primary,clearable:!0,searchable:!0,leftSection:e.jsx(le,{size:"1rem"}),...t.getInputProps("primaryKey")})})]}),e.jsxs(C,{grow:!0,justify:"apart",mb:"xs",gap:"xs",children:[e.jsx(w,{size:"sm",children:"Secondary Data Sources"}),e.jsx(C,{justify:"right",gap:"xs",pt:"xs",children:e.jsx(N,{size:"lg",variant:"default",disabled:!t.values.primary||c.length>=n,onClick:o,children:e.jsx($t,{size:15,stroke:1.5})})})]}),e.jsx(ae,{onDragEnd:({destination:u,source:y})=>t.reorderListItem("secondaries",{from:y.index,to:u?u.index:0}),children:e.jsx(re,{droppableId:"dnd-list",direction:"vertical",children:u=>e.jsx("div",{...u.droppableProps,style:{top:"auto",left:"auto"},ref:u.innerRef,children:(t.values.secondaries||[]).map(({primary:y},f)=>e.jsx(ie,{index:f,draggableId:f.toString(),children:d=>e.jsxs(x,{align:"center",ref:d.innerRef,mt:"xs",...d.draggableProps,gutter:"xs",style:{...d.draggableProps.style,left:"auto !important",top:"auto !important"},children:[e.jsx(x.Col,{span:"content",style:{cursor:"grab"},...d.dragHandleProps,children:e.jsx(C,{children:e.jsx(oe,{size:"1.2rem"})})}),e.jsx(x.Col,{span:"auto",children:e.jsx(pe,{clearable:!0,...t.getInputProps(`secondaries.${f}.primary`),filter:g=>g.filter(h=>h.id!=="proxy"&&h.name!==t.values.primary&&!c.includes(h.name))})}),e.jsx(x.Col,{span:"auto",children:e.jsx(de,{clearable:!0,searchable:!0,placeholder:"Foreign Key",leftSection:e.jsx(le,{size:"1rem"}),disabled:!y,data:y in i?i[y]:[],...t.getInputProps(`secondaries.${f}.secondaryKey`)})}),e.jsx(x.Col,{span:"auto",children:e.jsx(de,{clearable:!0,searchable:!0,placeholder:"Primary Key",leftSection:e.jsx(le,{size:"1rem"}),disabled:!y,data:t.values.primary in i?i[t.values.primary]:[],...t.getInputProps(`secondaries.${f}.primaryKey`)})}),e.jsx(x.Col,{span:"content",children:e.jsx(C,{justify:"right",gap:"xs",children:e.jsx(N,{color:"red",onClick:()=>r(f),variant:"default",size:"lg",children:e.jsx(W,{size:15})})})})]})},f))})})}),e.jsx(k,{label:"Entry Display Name",description:"Displayed on each result row to identify each entry.",leftSection:e.jsx(Vs,{size:16,style:{display:"block",opacity:.5}}),placeholder:"{{username}}",mt:"xs",mb:"xs",rightSection:e.jsx(N,{onClick:()=>a(p),variant:"subtle",children:e.jsx(je,{size:16,style:{display:"block",opacity:.8}})}),...t.getInputProps("display")}),e.jsx(V,{...t.getInputProps("enabled",{type:"checkbox"}),label:"Rule Enabled"}),e.jsx(as,{label:"Rule Description",placeholder:"Describe what this rule does",mt:"xs",...t.getInputProps("description")})]})}const Xl=[{label:"Member of group",value:"member"},{label:"Not member of group",value:"notmember"}],Yl=[{label:"Child of organisational unit",value:"child"},{label:"Not child of organisational unit",value:"notchild"}],Ql=[{label:"Exists on",value:"exists"},{label:"Does not exist on",value:"notexists"},{label:"Enabled on ",value:"enabled"},{label:"Disabled on",value:"disabled"}],Zl=["status"],yt=[];function en({form:t,index:s,modifyCondition:l,delimit:a,delimited:n}){const i=n(s,"")?e.jsx(Ms,{size:16,style:{display:"block",opacity:.8}}):e.jsx(qs,{size:16,style:{display:"block",opacity:.8}});return e.jsx(k,{placeholder:"Value",...t.getInputProps(`conditions.${s}.value`),rightSection:e.jsxs(O.Group,{style:{marginRight:30},children:[e.jsxs(E,{position:"bottom-end",children:[e.jsx(E.Target,{children:e.jsx(N,{variant:"subtle",children:i})}),e.jsxs(E.Dropdown,{children:[e.jsx(E.Item,{onClick:a(s,""),disabled:n(s,""),children:"No Delimiter"}),e.jsx(E.Item,{onClick:a(s,","),disabled:n(s,","),children:"Comma ,"}),e.jsx(E.Item,{onClick:a(s,";"),disabled:n(s,";"),children:"Semicolon ;"}),e.jsx(E.Item,{onClick:a(s,"|"),disabled:n(s,"|"),children:"Bar |"}),e.jsx(E.Item,{onClick:a(s,"tab"),disabled:n(s,"tab"),children:"Tab"}),e.jsx(E.Item,{onClick:a(s," "),disabled:n(s," "),children:"Space"})]})]}),e.jsx(N,{variant:"subtle",children:e.jsx(je,{onClick:l("value",s),size:16,style:{display:"block",opacity:.8}})})]})})}function Ht({form:t,label:s}){const l=ne(),{explorer:a,explore:n}=j.useContext(Je),{_connectors:i}=j.useContext(M),o=(d,g)=>()=>t.insertListItem("conditions",{type:d,key:"",operator:g||(d=="string"||d=="math"?"==":""),value:"",delimiter:""}),r=d=>()=>t.insertListItem("conditions",{...d}),c=d=>()=>t.removeListItem("conditions",d),p=(d,g)=>()=>n(()=>h=>t.setFieldValue(`conditions.${g}.${d}`,`${t.values.conditions[g][d]||""}{{${h}}}`)),u=(d,g)=>()=>t.setFieldValue(`conditions.${d}.delimiter`,g),y=(d,g)=>t.values.conditions[d].delimiter===g,f=t.values.primary in i&&i[t.values.primary].id==="ldap"||(t.values.secondaries||[]).filter(d=>d.primary in i&&i[d.primary].id==="ldap").length>0;return e.jsxs(P,{children:[a,e.jsxs(C,{grow:!0,justify:"apart",mb:"xs",mt:"xs",gap:"xs",children:[e.jsx(w,{c:"dimmed",size:"sm",children:s||"All conditions here will be evaluated and must be true for actions to be executed."}),e.jsx(C,{justify:"right",gap:"xs",children:e.jsxs(E,{position:"bottom-end",children:[e.jsx(E.Target,{children:e.jsx(O,{variant:"light",rightSection:e.jsx(ct,{size:"1.05rem",stroke:1.5}),pr:12,children:"Add condition"})}),e.jsxs(E.Dropdown,{children:[e.jsx(E.Label,{children:"Data Sources"}),et.filter(d=>!d.connector).map(d=>e.jsx(E.Item,{onClick:o(d.id),leftSection:e.jsx(d.Icon,{color:l.colors[d.color][6],size:"1rem",stroke:1.5}),children:d.label})),f&&e.jsxs(e.Fragment,{children:[e.jsx(E.Label,{children:"Directory"}),et.filter(d=>d.connector==="ldap").map(d=>e.jsx(E.Item,{onClick:o(d.id,d.id),leftSection:e.jsx(d.Icon,{color:l.colors[d.color][6],size:"1rem",stroke:1.5}),children:d.label}))]})]})]})})]}),(t.values.conditions||[]).length===0&&e.jsx(w,{c:"lighter",size:"sm",children:"No conditions in effect. Rules must have at least one condition to evaluate."}),e.jsx(ae,{onDragEnd:({destination:d,source:g})=>t.reorderListItem("conditions",{from:g.index,to:d?d.index:0}),children:e.jsx(re,{droppableId:"dnd-list",direction:"vertical",children:d=>e.jsxs("div",{...d.droppableProps,style:{top:"auto",left:"auto"},ref:d.innerRef,children:[(t.values.conditions||[]).map((g,h)=>{const A=et.filter(D=>D.id===g.type)[0];return e.jsx(ie,{index:h,draggableId:h.toString(),children:D=>e.jsxs(x,{align:"center",ref:D.innerRef,mt:"xs",...D.draggableProps,gutter:"xs",style:{...D.draggableProps.style,left:"auto !important",top:"auto !important"},children:[e.jsx(x.Col,{span:"content",style:{cursor:"grab"},...D.dragHandleProps,children:e.jsx(C,{children:e.jsx(oe,{size:"1.2rem"})})}),e.jsx(x.Col,{span:"content",children:e.jsx(C,{children:e.jsx(Le,{label:A.label,children:e.jsx(A.Icon,{color:l.colors[A.color][6],size:"1.2rem"})})})}),yt.includes(g.type)&&e.jsx(x.Col,{c:"dimmed",span:"content",children:A.label}),g.type==="string"||g.type==="math"?e.jsx(x.Col,{span:"auto",children:e.jsx(k,{placeholder:"Key",...t.getInputProps(`conditions.${h}.key`),rightSection:e.jsx(N,{onClick:p("key",h),variant:"subtle",children:e.jsx(je,{size:16,style:{display:"block",opacity:.8}})})})}):e.jsx(x.Col,{span:"auto",children:e.jsx(pe,{clearable:!0,...t.getInputProps(`conditions.${h}.key`),filter:T=>T.filter(L=>L.id==="ldap")})}),!yt.includes(g.type)&&e.jsx(x.Col,{span:"content",children:e.jsx(de,{placeholder:"Operator",checkIconPosition:"right",data:{string:Ll,math:Ul,group:Xl,ou:Yl,status:Ql}[g.type],maxDropdownHeight:300,...t.getInputProps(`conditions.${h}.operator`)})}),!Zl.includes(g.type)&&e.jsx(x.Col,{span:"auto",children:e.jsx(en,{form:t,index:h,delimit:u,delimited:y,modifyCondition:p})}),e.jsx(x.Col,{span:"content",children:e.jsxs(C,{justify:"right",gap:"xs",children:[e.jsx(N,{onClick:c(h),variant:"default",size:"lg",children:e.jsx(W,{size:15})}),e.jsx(N,{onClick:r(g),variant:"default",size:"lg",children:e.jsx(ke,{size:15})})]})})]})},h)}),d.placeholder]})})})]})}const tn="_control_d0u7x_1",ft={control:tn};function sn({form:t,index:s,explorer:l}){return e.jsxs(P,{p:"xs",pt:0,children:[e.jsx(k,{label:"Source File",withAsterisk:!0,description:"Path of file to use as template.",placeholder:"D:/templates/input/user_template.pdf",leftSection:e.jsx(Et,{size:16,style:{display:"block",opacity:.8}}),...t.getInputProps(`actions.${s}.source`),rightSection:l("source")}),e.jsx(k,{label:"Target File",withAsterisk:!0,description:"Path of file to be written.",placeholder:"D:/templates/ouput/{{username}}.pdf",...t.getInputProps(`actions.${s}.target`),leftSection:e.jsx(Bs,{size:16,style:{display:"block",opacity:.8}}),rightSection:l("target")})]})}function tt({form:t,index:s,explorer:l}){return e.jsxs(P,{p:"xs",pt:0,children:[e.jsx(pe,{label:"Target Directory",withAsterisk:!0,clearable:!0,leftSection:e.jsx(we,{size:"1rem"}),...t.getInputProps(`actions.${s}.target`),type:"ldap"}),e.jsx(k,{label:"User Principal Name",withAsterisk:!0,leftSection:e.jsx(We,{size:16,style:{display:"block",opacity:.8}}),placeholder:"{{username}}@domain.com",...t.getInputProps(`actions.${s}.upn`),rightSection:l("upn")})]})}function ln({form:t,index:s,explorer:l}){const{data:a,loading:n}=_({url:"/printers",fetch:!0,default:[],mutate:c=>c.map(p=>p.name)}),i=t.values.actions[s].target,r=(i?[...a,i]:a).filter((c,p,u)=>p===u.findIndex(y=>y===c));return e.jsxs(P,{p:"xs",pt:0,children:[e.jsx(k,{label:"Source File",withAsterisk:!0,description:"Path of file to print",placeholder:"D:/templates/ouput/{{username}}.pdf",leftSection:e.jsx(it,{size:16,style:{display:"block",opacity:.8}}),...t.getInputProps(`actions.${s}.source`),rightSection:l("source")}),e.jsx(V,{label:"Validate Source Path",mt:"xs",...t.getInputProps(`actions.${s}.validate`,{type:"checkbox"})}),e.jsx(de,{label:"Target Printer",withAsterisk:!0,clearable:!0,description:"Leave blank to use the systemsdefault printer.",leftSection:n?e.jsx(Ce,{size:"xs"}):e.jsx(Rt,{size:16,style:{display:"block",opacity:.8}}),placeholder:"Select Printer",...t.getInputProps(`actions.${s}.target`),data:r})]})}function nn({form:t,index:s,explore:l}){const a=t.values.actions[s].groups||[],n=o=>()=>l(()=>r=>t.setFieldValue(`actions.${s}.groups.${o}`,`${t.values.actions[s].groups[o]||""}{{${r}}}`)),i=o=>e.jsx(N,{onClick:n(o),variant:"subtle",children:e.jsx(je,{size:16,style:{display:"block",opacity:.8}})});return e.jsxs(e.Fragment,{children:[a.length===0&&e.jsx(ce,{c:"dimmed",fz:"xs",children:"No security groups configured."}),e.jsx(ae,{onDragEnd:({destination:o,source:r})=>t.reorderListItem(`actions.${s}.groups`,{from:r.index,to:o?o.index:0}),children:e.jsx(re,{droppableId:"dnd-list",direction:"vertical",children:o=>e.jsxs("div",{...o.droppableProps,style:{top:"auto",left:"auto"},ref:o.innerRef,children:[a.map((r,c)=>e.jsx(ie,{index:c,draggableId:c.toString(),children:p=>e.jsxs(x,{gutter:"xs",align:"center",ref:p.innerRef,mt:"xs",...p.draggableProps,style:{...p.draggableProps.style,left:"auto !important",top:"auto !important"},children:[e.jsx(x.Col,{span:"content",style:{cursor:"grab"},...p.dragHandleProps,children:e.jsx(C,{children:e.jsx(oe,{size:"1.2rem"})})}),e.jsx(x.Col,{span:"auto",children:e.jsx(k,{placeholder:"CN={{faculty}},OU={{faculty}},OU=Child,OU=Parent",...t.getInputProps(`actions.${s}.groups.${c}`),rightSection:i(c)})}),e.jsx(x.Col,{span:"content",children:e.jsx(C,{gap:0,justify:"flex-end",children:e.jsx(N,{onClick:()=>t.removeListItem(`actions.${s}.groups`,c),variant:"subtle",color:"red",children:e.jsx(W,{size:"1.2rem",stroke:1.5})})})})]})},c)),o.placeholder]})})})]})}function on({form:t,index:s,explore:l}){const a=t.values.actions[s].attributes||[],n=(o,r)=>()=>l(()=>c=>t.setFieldValue(`actions.${s}.attributes.${r}.${o}`,`${t.values.actions[s].attributes[r][o]||""}{{${c}}}`)),i=(o,r)=>e.jsx(N,{onClick:n(o,r),variant:"subtle",children:e.jsx(je,{size:16,style:{display:"block",opacity:.8}})});return e.jsxs(e.Fragment,{children:[a.length===0&&e.jsx(ce,{c:"dimmed",fz:"xs",children:"No attributes configured."}),e.jsx(ae,{onDragEnd:({destination:o,source:r})=>t.reorderListItem(`actions.${s}.attributes`,{from:r.index,to:o?o.index:0}),children:e.jsx(re,{droppableId:"dnd-list",direction:"vertical",children:o=>e.jsxs("div",{...o.droppableProps,style:{top:"auto",left:"auto"},ref:o.innerRef,children:[a.map((r,c)=>e.jsx(ie,{index:c,draggableId:c.toString(),children:p=>e.jsxs(x,{gutter:"xs",align:"center",ref:p.innerRef,mt:"xs",...p.draggableProps,style:{...p.draggableProps.style,left:"auto !important",top:"auto !important"},children:[e.jsx(x.Col,{span:"content",style:{cursor:"grab"},...p.dragHandleProps,children:e.jsx(C,{children:e.jsx(oe,{size:"1.2rem"})})}),e.jsx(x.Col,{span:"auto",children:e.jsx(pt,{selectable:ht,...t.getInputProps(`actions.${s}.attributes.${c}.name`),createLabel:u=>`Add Custom Attribute: ${u}`})}),e.jsx(x.Col,{span:"auto",children:e.jsx(k,{placeholder:"Value",...t.getInputProps(`actions.${s}.attributes.${c}.value`),rightSection:i("value",c)})}),e.jsx(x.Col,{span:"content",children:e.jsx(C,{gap:0,justify:"flex-end",children:e.jsx(N,{onClick:()=>t.removeListItem(`actions.${s}.attributes`,c),variant:"subtle",color:"red",children:e.jsx(W,{size:"1.2rem",stroke:1.5})})})})]})},c)),o.placeholder]})})})]})}function an({form:t,index:s,explorer:l,explore:a}){t.values.actions[s].attributes||t.setFieldValue(`actions.${s}.attributes`,[]),t.values.actions[s].groups||t.setFieldValue(`actions.${s}.groups`,[]);const n=()=>t.insertListItem(`actions.${s}.attributes`,{name:"",value:""}),i=()=>t.insertListItem(`actions.${s}.groups`,"");return e.jsxs(P,{p:"xs",pt:0,children:[e.jsx(pe,{label:"Target Directory",withAsterisk:!0,clearable:!0,leftSection:e.jsx(we,{size:"1rem"}),...t.getInputProps(`actions.${s}.target`),type:"ldap"}),e.jsx(k,{label:"Canonical Name",withAsterisk:!0,leftSection:e.jsx(De,{size:16,style:{display:"block",opacity:.8}}),placeholder:"{{username}}",...t.getInputProps(`actions.${s}.cn`),rightSection:l("cn")}),e.jsx(k,{label:"User Principal Name",withAsterisk:!0,leftSection:e.jsx(We,{size:16,style:{display:"block",opacity:.8}}),placeholder:"{{username}}@domain.com",...t.getInputProps(`actions.${s}.upn`),rightSection:l("upn")}),e.jsx(k,{label:"SAM Account Name",withAsterisk:!0,leftSection:e.jsx(Hs,{size:16,style:{display:"block",opacity:.8}}),placeholder:"{{username}}",...t.getInputProps(`actions.${s}.sam`),rightSection:l("sam")}),e.jsx(k,{label:"Organizational Unit",withAsterisk:!0,leftSection:e.jsx(Ie,{size:16,style:{display:"block",opacity:.8}}),placeholder:"ou={{faculty}},ou=child,ou=parent",...t.getInputProps(`actions.${s}.ou`),rightSection:l("ou")}),e.jsx(k,{label:"Password",leftSection:e.jsx(le,{size:16,style:{display:"block",opacity:.8}}),placeholder:"{{word}}{{rand 1 9}}{{cap (word)}}{{special}}",...t.getInputProps(`actions.${s}.password`),rightSection:l("password")}),e.jsx(V,{label:"User Enabled",disabled:t.values.actions[s].password==="",mt:"xs",...t.getInputProps(`actions.${s}.enable`,{type:"checkbox"})}),e.jsx(se,{open:!0,label:"Attributes",rightSection:e.jsx(O,{onClick:()=>n(),maw:50,variant:"light",size:"compact-xs",mt:10,children:"Add"}),children:e.jsx(on,{form:t,index:s,explore:a})}),e.jsx(se,{open:!0,label:"Security Groups",rightSection:e.jsx(O,{onClick:()=>i(),maw:50,variant:"light",size:"compact-xs",mt:10,children:"Add"}),children:e.jsx(nn,{form:t,index:s,explore:a})})]})}function rn({form:t,index:s,explore:l}){t.values.actions[s].templates||t.setFieldValue(`actions.${s}.templates`,[]);const a=()=>t.insertListItem(`actions.${s}.templates`,{name:"",value:""}),n=t.values.actions[s].templates||[],i=(r,c)=>()=>l(()=>p=>t.setFieldValue(`actions.${s}.templates.${c}.${r}`,`${t.values.actions[s].templates[c][r]||""}{{${p}}}`)),o=(r,c)=>e.jsx(N,{onClick:i(r,c),variant:"subtle",children:e.jsx(je,{size:16,style:{display:"block",opacity:.8}})});return e.jsxs(P,{pt:5,children:[e.jsx(C,{justify:"end",children:e.jsx(O,{onClick:a,variant:"light",size:"compact-xs",children:"Add"})}),e.jsxs(P,{p:"xs",pt:0,children:[n.length===0&&e.jsx(ce,{c:"dimmed",fz:"xs",children:"No templates configured."}),e.jsx(ae,{onDragEnd:({destination:r,source:c})=>t.reorderListItem(`actions.${s}.templates`,{from:c.index,to:r?r.index:0}),children:e.jsx(re,{droppableId:"dnd-list",direction:"vertical",children:r=>e.jsxs("div",{...r.droppableProps,style:{top:"auto",left:"auto"},ref:r.innerRef,children:[n.map((c,p)=>e.jsx(ie,{index:p,draggableId:p.toString(),children:u=>e.jsxs(x,{gutter:"xs",align:"center",ref:u.innerRef,mt:"xs",...u.draggableProps,style:{...u.draggableProps.style,left:"auto !important",top:"auto !important"},children:[e.jsx(x.Col,{span:"content",style:{cursor:"grab"},...u.dragHandleProps,children:e.jsx(C,{children:e.jsx(oe,{size:"1.2rem"})})}),e.jsx(x.Col,{span:"auto",children:e.jsx(k,{placeholder:"Name",...t.getInputProps(`actions.${s}.templates.${p}.name`),rightSection:o("name",p)})}),e.jsx(x.Col,{span:"auto",children:e.jsx(k,{placeholder:"Value",...t.getInputProps(`actions.${s}.templates.${p}.value`),rightSection:o("value",p)})}),e.jsx(x.Col,{span:"content",children:e.jsx(C,{gap:0,justify:"flex-end",children:e.jsx(N,{onClick:()=>t.removeListItem(`actions.${s}.templates`,p),variant:"subtle",color:"red",children:e.jsx(W,{size:"1.2rem",stroke:1.5})})})})]})},p)),r.placeholder]})})})]})]})}function cn({form:t,index:s,explorer:l}){return e.jsxs(P,{p:"xs",pt:0,children:[e.jsx(k,{label:"Target File",withAsterisk:!0,description:"Path of file to be deleted.",placeholder:"D:/templates/ouput/{{username}}.pdf",...t.getInputProps(`actions.${s}.target`),leftSection:e.jsx(Lt,{size:16,style:{display:"block",opacity:.8}}),rightSection:l("target")}),e.jsx(V,{label:"Validate Path",mt:"xs",...t.getInputProps(`actions.${s}.validate`,{type:"checkbox"})})]})}function dn({form:t,index:s,explorer:l}){return e.jsxs(P,{p:"xs",pt:0,children:[e.jsx(k,{label:"Source File",withAsterisk:!0,description:"Path of file to be moved.",placeholder:"D:/source/{{username}}.txt",...t.getInputProps(`actions.${s}.source`),leftSection:e.jsx(Ws,{size:16,style:{display:"block",opacity:.8}}),rightSection:l("source")}),e.jsx(V,{label:"Validate Path",mt:"xs",...t.getInputProps(`actions.${s}.validate`,{type:"checkbox"})}),e.jsx(k,{label:"Target File",withAsterisk:!0,description:"Destination path where file will be placed.",placeholder:"E:/destination/{{username}}.txt",...t.getInputProps(`actions.${s}.target`),leftSection:e.jsx(Ut,{size:16,style:{display:"block",opacity:.8}}),rightSection:l("target")}),e.jsx(V,{label:"Should Overwrite",mt:"xs",...t.getInputProps(`actions.${s}.overwrite`,{type:"checkbox"})})]})}function un({form:t,index:s,explorer:l}){return e.jsxs(P,{p:"xs",pt:0,children:[e.jsx(k,{label:"Source File",withAsterisk:!0,description:"Path of original file to be copied.",placeholder:"D:/source/{{username}}.txt",...t.getInputProps(`actions.${s}.source`),leftSection:e.jsx(Ks,{size:16,style:{display:"block",opacity:.8}}),rightSection:l("source")}),e.jsx(V,{label:"Validate Path",mt:"xs",...t.getInputProps(`actions.${s}.validate`,{type:"checkbox"})}),e.jsx(k,{label:"Target File",withAsterisk:!0,description:"Destination path where copy will be placed.",placeholder:"E:/destination/{{username}}.txt",...t.getInputProps(`actions.${s}.target`),leftSection:e.jsx(Ut,{size:16,style:{display:"block",opacity:.8}}),rightSection:l("target")}),e.jsx(V,{label:"Should Overwrite",mt:"xs",...t.getInputProps(`actions.${s}.overwrite`,{type:"checkbox"})})]})}function pn({form:t,index:s,explorer:l}){return e.jsxs(P,{p:"xs",pt:0,children:[e.jsx(k,{label:"Source Folder",withAsterisk:!0,description:"Path of original folder to be copied.",placeholder:"D:/source/public/",...t.getInputProps(`actions.${s}.source`),leftSection:e.jsx(Gs,{size:16,style:{display:"block",opacity:.8}}),rightSection:l("source")}),e.jsx(V,{label:"Validate Path",mt:"xs",...t.getInputProps(`actions.${s}.validate`,{type:"checkbox"})}),e.jsx(k,{label:"Target Folder",withAsterisk:!0,description:"Destination path where copy will be placed.",placeholder:"E:/destination/{{username}}/",...t.getInputProps(`actions.${s}.target`),leftSection:e.jsx(Vt,{size:16,style:{display:"block",opacity:.8}}),rightSection:l("target")}),e.jsx(V,{label:"Should Overwrite",mt:"xs",...t.getInputProps(`actions.${s}.overwrite`,{type:"checkbox"})})]})}function hn({form:t,index:s,explorer:l}){return e.jsxs(P,{p:"xs",pt:0,children:[e.jsx(k,{label:"Source Folder",withAsterisk:!0,description:"Path of folder to be moved.",placeholder:"D:/source/{{username}}/",...t.getInputProps(`actions.${s}.source`),leftSection:e.jsx(Js,{size:16,style:{display:"block",opacity:.8}}),rightSection:l("source")}),e.jsx(V,{label:"Validate Path",mt:"xs",...t.getInputProps(`actions.${s}.validate`,{type:"checkbox"})}),e.jsx(k,{label:"Target Folder",withAsterisk:!0,description:"Destination path where copy will be placed.",placeholder:"E:/destination/{{username}}/",...t.getInputProps(`actions.${s}.target`),leftSection:e.jsx(Vt,{size:16,style:{display:"block",opacity:.8}}),rightSection:l("target")}),e.jsx(V,{label:"Should Overwrite",mt:"xs",...t.getInputProps(`actions.${s}.overwrite`,{type:"checkbox"})})]})}function xn({form:t,index:s,explorer:l}){return e.jsxs(P,{p:"xs",pt:0,children:[e.jsx(k,{label:"Target Folder",withAsterisk:!0,description:"Path of folder to be deleted.",placeholder:"D:/temp/{{username}}/",...t.getInputProps(`actions.${s}.target`),leftSection:e.jsx(Lt,{size:16,style:{display:"block",opacity:.8}}),rightSection:l("target")}),e.jsx(V,{label:"Validate Path",mt:"xs",...t.getInputProps(`actions.${s}.validate`,{type:"checkbox"})})]})}function jn({form:t,index:s,explorer:l}){return e.jsxs(P,{p:"xs",pt:0,children:[e.jsx(pe,{label:"Target Directory",withAsterisk:!0,clearable:!0,leftSection:e.jsx(we,{size:"1rem"}),...t.getInputProps(`actions.${s}.target`),type:"ldap"}),e.jsx(k,{label:"User Principal Name",withAsterisk:!0,leftSection:e.jsx(We,{size:16,style:{display:"block",opacity:.8}}),placeholder:"{{username}}@domain.com",...t.getInputProps(`actions.${s}.upn`),rightSection:l("upn")}),e.jsx(k,{label:"Organizational Unit",withAsterisk:!0,leftSection:e.jsx(Ie,{size:16,style:{display:"block",opacity:.8}}),placeholder:"ou={{faculty}},ou=child,ou=parent",...t.getInputProps(`actions.${s}.ou`),rightSection:l("ou")})]})}function mn({form:t,index:s,explore:l}){const a=t.values.actions[s].attributes||[],n=(o,r)=>()=>l(()=>c=>t.setFieldValue(`actions.${s}.attributes.${r}.${o}`,`${t.values.actions[s].attributes[r][o]||""}{{${c}}}`)),i=(o,r)=>e.jsx(N,{onClick:n(o,r),variant:"subtle",children:e.jsx(je,{size:16,style:{display:"block",opacity:.8}})});return e.jsxs(e.Fragment,{children:[a.length===0&&e.jsx(ce,{c:"dimmed",fz:"xs",children:"No attributes configured."}),e.jsx(ae,{onDragEnd:({destination:o,source:r})=>t.reorderListItem(`actions.${s}.attributes`,{from:r.index,to:o?o.index:0}),children:e.jsx(re,{droppableId:"dnd-list",direction:"vertical",children:o=>e.jsxs("div",{...o.droppableProps,style:{top:"auto",left:"auto"},ref:o.innerRef,children:[a.map((r,c)=>e.jsx(ie,{index:c,draggableId:c.toString(),children:p=>e.jsxs(x,{gutter:"xs",align:"center",ref:p.innerRef,mt:"xs",...p.draggableProps,style:{...p.draggableProps.style,left:"auto !important",top:"auto !important"},children:[e.jsx(x.Col,{span:"content",style:{cursor:"grab"},...p.dragHandleProps,children:e.jsx(C,{children:e.jsx(oe,{size:"1.2rem"})})}),e.jsx(x.Col,{span:2,children:e.jsx(de,{defaultValue:"Replace",data:["Add","Replace","Delete"],...t.getInputProps(`actions.${s}.attributes.${c}.type`)})}),e.jsx(x.Col,{span:"auto",children:e.jsx(pt,{selectable:ht,...t.getInputProps(`actions.${s}.attributes.${c}.name`),createLabel:u=>`Add Custom Attribute: ${u}`})}),t.values.actions[s].attributes[c].type!=="Delete"&&e.jsx(x.Col,{span:"auto",children:e.jsx(k,{placeholder:"Value",...t.getInputProps(`actions.${s}.attributes.${c}.value`),rightSection:i("value",c)})}),e.jsx(x.Col,{span:"content",children:e.jsx(C,{gap:0,justify:"flex-end",children:e.jsx(N,{onClick:()=>t.removeListItem(`actions.${s}.attributes`,c),variant:"subtle",color:"red",children:e.jsx(W,{size:"1.2rem",stroke:1.5})})})})]})},c)),o.placeholder]})})})]})}function gn({form:t,index:s,explore:l,explorer:a}){t.values.actions[s].attributes||t.setFieldValue(`actions.${s}.attributes`,[]),t.values.actions[s].groups||t.setFieldValue(`actions.${s}.groups`,[]);const n=()=>t.insertListItem(`actions.${s}.attributes`,{name:"",value:"",type:"Replace"});return e.jsxs(P,{p:"xs",pt:0,children:[e.jsx(pe,{label:"Target Directory",withAsterisk:!0,clearable:!0,leftSection:e.jsx(we,{size:"1rem"}),...t.getInputProps(`actions.${s}.target`),type:"ldap"}),e.jsx(k,{label:"User Principal Name",withAsterisk:!0,leftSection:e.jsx(We,{size:16,style:{display:"block",opacity:.8}}),placeholder:"{{username}}@domain.com",...t.getInputProps(`actions.${s}.upn`),rightSection:a("upn")}),e.jsx(se,{open:!0,label:"Attributes",rightSection:e.jsx(O,{onClick:()=>n(),maw:50,variant:"light",size:"compact-xs",mt:10,children:"Add"}),children:e.jsx(mn,{form:t,index:s,explore:l})})]})}function bn({add:t}){const[s,{close:l,open:a}]=te(!1),n=ne(),i=Object.values(Ge),o=r=>()=>{t(r),l()};return e.jsx(C,{justify:"right",gap:"xs",children:e.jsxs(Ye,{width:300,position:"left-start",shadow:"md",opened:s,children:[e.jsx(Ye.Target,{children:e.jsx(O,{variant:"light",onClick:s?l:a,rightSection:e.jsx(ct,{size:"1.05rem",stroke:1.5}),pr:12,children:"Add Action"})}),e.jsx(Ye.Dropdown,{children:Vl.map(r=>e.jsx(jt,{label:r.label,className:ft.control,leftSection:e.jsx(r.Icon,{color:r.color?n.colors[r.color][6]:void 0,size:"1rem",stroke:1.5}),childrenOffset:28,children:i.filter(c=>c.catagory===r.id).map(c=>e.jsx(jt,{label:c.label||c.id,className:ft.control,onClick:o(c.id),leftSection:e.jsx(c.Icon,{color:c.color?n.colors[c.color][6]:void 0,size:"1rem",stroke:1.5})},c.id))},r.id))})]})})}function yn({form:t,index:s,a:l,explore:a}){const[n,{toggle:i}]=te(!1),o=ne(),{Icon:r,color:c}=Ge[l.name],p=d=>()=>t.insertListItem("actions",{...d}),u=d=>()=>t.removeListItem("actions",d),y=d=>()=>a(()=>g=>t.setFieldValue(`actions.${s}.${d}`,`${t.values.actions[s][d]||""}{{${g}}}`)),f=d=>e.jsx(N,{onClick:y(d),variant:"subtle",children:e.jsx(je,{size:16,style:{display:"block",opacity:.8}})});return e.jsxs(e.Fragment,{children:[e.jsxs(x.Col,{span:"auto",children:[s+1,". ",e.jsx(r,{color:c?o.colors[c][6]:void 0,size:18,stroke:1.5})," ",l.name]}),e.jsx(x.Col,{span:"content",children:e.jsxs(C,{justify:"right",gap:"xs",children:[e.jsx(N,{onClick:()=>i(),variant:n?"filled":"default",size:"lg",children:e.jsx(Fe,{size:15})}),e.jsx(N,{onClick:u(s),variant:"default",size:"lg",children:e.jsx(W,{size:15})}),e.jsx(N,{onClick:p(l),variant:"default",size:"lg",children:e.jsx(ke,{size:15})})]})}),e.jsx(x.Col,{span:12,pt:0,pb:0,children:e.jsx(wt,{in:n,children:{"Send To Printer":e.jsx(ln,{form:t,index:s,explorer:f}),"Write PDF":e.jsx(sn,{form:t,index:s,explorer:f}),"Enable User":e.jsx(tt,{form:t,index:s,explorer:f}),"Disable User":e.jsx(tt,{form:t,index:s,explorer:f}),"Delete User":e.jsx(tt,{form:t,index:s,explorer:f}),"Move Organisational Unit":e.jsx(jn,{form:t,index:s,explorer:f}),"Create User":e.jsx(an,{form:t,index:s,explorer:f,explore:a}),"Update Attributes":e.jsx(gn,{form:t,index:s,explorer:f,explore:a}),"Delete File":e.jsx(cn,{form:t,index:s,explorer:f}),"Move File":e.jsx(dn,{form:t,index:s,explorer:f}),"Copy File":e.jsx(un,{form:t,index:s,explorer:f}),"Copy Folder":e.jsx(pn,{form:t,index:s,explorer:f}),"Move Folder":e.jsx(hn,{form:t,index:s,explorer:f}),"Delete Folder":e.jsx(xn,{form:t,index:s,explorer:f}),Template:e.jsx(rn,{form:t,index:s,explore:a})}[l.name]})})]})}function fn({form:t}){const{explorer:s,explore:l}=j.useContext(Je),a=n=>t.insertListItem("actions",{name:n});return e.jsxs(P,{children:[s,e.jsxs(C,{grow:!0,justify:"apart",mb:"xs",mt:"xs",gap:"xs",children:[e.jsx(w,{c:"dimmed",size:"sm",children:"Actions will be executed sequentially if all conditions evaluated successfully."}),e.jsx(bn,{add:a})]}),(t.values.actions||[]).length===0&&e.jsx(w,{c:"lighter",size:"sm",children:"No actions to perform."}),e.jsx(ae,{onDragEnd:({destination:n,source:i})=>t.reorderListItem("actions",{from:i.index,to:n?n.index:0}),children:e.jsx(re,{droppableId:"dnd-list",direction:"vertical",children:n=>e.jsxs("div",{...n.droppableProps,style:{top:"auto",left:"auto"},ref:n.innerRef,children:[(t.values.actions||[]).map((i,o)=>e.jsx(ie,{index:o,draggableId:o.toString(),children:r=>e.jsxs(x,{align:"center",ref:r.innerRef,mt:"xs",...r.draggableProps,gutter:"xs",style:{...r.draggableProps.style,left:"auto !important",top:"auto !important"},children:[e.jsx(x.Col,{span:"content",style:{cursor:"grab"},...r.dragHandleProps,children:e.jsx(C,{children:e.jsx(oe,{size:"1.2rem"})})}),e.jsx(yn,{form:t,index:o,a:i,explore:l})]})},o)),n.placeholder]})})})]})}function vn({editing:t,close:s}){const{schema:l,mutate:a}=j.useContext(M),[n,i]=j.useState("settings"),o={secondaries:[],conditions:[],actions:[]},r=he({initialValues:o,validate:{}});j.useEffect(()=>{r.reset(),t?r.setValues(t):r.setValues(o),r.setInitialValues(o)},[t]);const{post:c,loading:p}=_({url:`/schema/${l==null?void 0:l.name}/rule`,data:{...r.values},catch:({validation:h})=>r.setErrors(h),then:({rules:h,_rules:A})=>{a({rules:h,_rules:A}),s(),H.show({title:"Success",message:"Rule Added.",color:"lime"})}}),{put:u,loading:y}=_({url:`/schema/${l==null?void 0:l.name}/rule/${t==null?void 0:t.name}`,data:{...r.values},catch:({validation:h})=>r.setErrors(h),then:({rules:h,_rules:A})=>{a({rules:h,_rules:A}),s(),H.show({title:"Success",message:"Rule Saved.",color:"lime"})}}),f=p||y,d=!r.values.primary||!r.values.primaryKey,g=d||(r.values.conditions||[]).length<=0;return e.jsx(P,{children:e.jsx(ye,{label:e.jsxs(be,{rightSection:e.jsx(ut,{loading:f,variant:"light",onClick:t?u:c,options:[{onClick:()=>s(),label:"Cancel",leftSection:e.jsx(Ae,{size:16})}],children:t?"Save":"Create"}),children:["Rule",t?" - Edit":" - New"]}),children:e.jsxs(U,{value:n,onChange:i,children:[e.jsxs(U.List,{children:[e.jsx(U.Tab,{value:"settings",leftSection:e.jsx(Nt,{size:"0.8rem"}),children:"Settings"}),e.jsx(U.Tab,{value:"conditions",disabled:d,leftSection:e.jsx(Xs,{size:"0.8rem"}),children:"Conditions"}),e.jsx(U.Tab,{value:"actions",disabled:g,leftSection:e.jsx($e,{size:"0.8rem"}),children:"Actions"})]}),e.jsx(U.Panel,{value:"settings",p:"xs",children:n==="settings"&&e.jsx(Jl,{form:r})}),e.jsx(U.Panel,{value:"conditions",children:e.jsx(Ht,{form:r})}),e.jsx(U.Panel,{value:"actions",children:e.jsx(fn,{form:r})})]})})})}function Sn({action:t,resultant:s}){if(!t.result.data)return e.jsx(e.Fragment,{});const l=t.result.data;return e.jsxs(P,{children:[e.jsxs(w,{fz:"sm",children:["Canonical Name: ",e.jsx(B,{children:l.cn||""})]}),e.jsxs(w,{fz:"sm",children:["User Principal Name: ",e.jsx(B,{children:l.upn||""})]}),e.jsxs(w,{fz:"sm",children:["SAM Account Name: ",e.jsx(B,{children:l.sam||""})]}),e.jsx(P,{className:Z.overflow,children:e.jsxs(w,{fz:"sm",children:["Organizational Unit: ",e.jsxs(B,{children:[l.ou||"",",",l.base||""]})]})}),e.jsx(P,{className:Z.overflow,children:e.jsxs(w,{fz:"sm",children:["Organizational Unit: ",e.jsx(B,{children:l.dn||""})]})}),e.jsxs(w,{fz:"sm",children:[s?"":"Sample ","Password: ",e.jsx(B,{children:l.password||""})]}),e.jsxs(w,{fz:"xs",pt:"xs",children:["Account will be ",l.enable?"enabled":"disabled"," on creation."]}),e.jsx(se,{fz:"sm",label:"Attributes",children:e.jsx(Q,{size:"xs",icon:e.jsx(e.Fragment,{children:"-"}),children:(l.attributes||[]).map(({name:a,value:n})=>e.jsxs(Q.Item,{children:[a,": ",e.jsx(B,{children:n})]},a))})}),e.jsx(se,{fz:"sm",label:"Security Groups",children:e.jsx(Q,{size:"xs",icon:e.jsx(e.Fragment,{children:"-"}),children:(l.groups||[]).map((a,n)=>e.jsx(Q.Item,{className:Z.overflow,children:e.jsx(P,{style:{whiteSpace:"nowrap"},children:a})},n))})})]})}function Cn({action:t}){if(!t.result.data)return e.jsx(e.Fragment,{});const s=t.result.data;return e.jsx(P,{children:e.jsx(Q,{size:"sm",icon:e.jsx(e.Fragment,{children:"-"}),children:Object.keys(s||[]).map((l,a)=>e.jsx(Q.Item,{className:Z.overflow,children:e.jsxs(P,{style:{whiteSpace:"nowrap"},children:[l,": ",e.jsx(B,{children:JSON.stringify(s[l])})]})},a))})})}function kn({change:t,r:s}){switch(t.type){case"Replace":return e.jsxs(Q.Item,{className:Z.overflow,children:[t.name,": ",e.jsxs(B,{children:["Replace",s&&"d"," ",t.currentValue||"<undefined>"," with '",t.value,"'"]})]},t.name);case"Add":return e.jsxs(Q.Item,{className:Z.overflow,children:[t.name,": ",e.jsxs(B,{children:["Set to '",t.value,"'"]})]},t.name);case"Delete":return e.jsxs(Q.Item,{className:Z.overflow,children:["delete",s&&"d",": ",e.jsx(B,{children:t.name})]},t.name)}}function wn({action:t,resultant:s}){if(!t.result.data)return e.jsx(e.Fragment,{});const l=t.result.data,a=(l.changes||[]).filter(n=>n.error);return e.jsxs(P,{children:[e.jsxs(w,{fz:"sm",children:["Directory: ",e.jsx(B,{children:l.directory||""})]}),e.jsxs(w,{fz:"sm",children:["User Principal Name: ",e.jsx(B,{children:l.upn||""})]}),e.jsx(se,{fz:"sm",label:"Changes",open:!0,children:e.jsx(Q,{size:"xs",icon:e.jsx(e.Fragment,{children:"-"}),children:(l.changes||[]).map(n=>e.jsx(kn,{change:n,r:s}))})}),a.length>0&&e.jsx(se,{fz:"sm",label:"Errors",open:!0,children:e.jsx(Q,{size:"xs",icon:e.jsx(e.Fragment,{children:"-"}),children:a.map(n=>e.jsxs(Q.Item,{className:Z.overflow,children:[n.name,": ",e.jsx(B,{children:n.error})]},n.name))})})]})}function In(t,s){return!!(s.id.includes(t)||s.display.includes(t))}function Pn({match:t,toggle:s,setAction:l,resultant:a=!1,dash:n}){const i=ne();return e.jsxs(x,{align:"center",children:[e.jsx(x.Col,{pl:"lg",span:1,children:!a&&e.jsx(V,{disabled:!t.actionable,onChange:s(t.id),checked:!!t.checked})}),n&&e.jsx(x.Col,{span:1,children:t.schema}),n&&e.jsx(x.Col,{span:1,children:t.rule}),e.jsx(x.Col,{span:2,children:t.id}),e.jsx(x.Col,{span:n?5:7,children:t.display}),e.jsx(x.Col,{span:2,children:t.actions.map((o,r)=>{const{Icon:c,color:p}=Ge[o.name];return o.result.warning?e.jsx(c,{onClick:()=>l(o),style:{cursor:"pointer"},color:i.colors.gray[8],size:16,stroke:2},r):o.result.error?e.jsx(ds,{size:6,offset:3,color:"red",inline:!0,children:e.jsx(c,{onClick:()=>l(o),style:{cursor:"pointer"},color:p?i.colors[p][6]:void 0,size:16,stroke:2})},r):e.jsx(c,{onClick:()=>l(o),style:{cursor:"pointer"},color:p?i.colors[p][6]:void 0,size:16,stroke:2},r)})})]},t.id)}function zn({action:t,resultant:s=!1}){switch(t.name){case"Create User":return e.jsx(Sn,{action:t,resultant:s});case"Update Attributes":return e.jsx(wn,{action:t,resultant:s});default:return e.jsx(Cn,{action:t,resultant:s})}}function nt({id:t,matches:s,loading:l,setData:a,run:n,resultant:i=!1,dash:o=!1}){const[r,c]=j.useState(!0),[p,u]=j.useState(""),[y,f]=j.useState("15"),d=s.filter(m=>r?!0:!!m.actionable),g=m=>()=>a((d||[]).map(F=>F.id!==m?F:{...F,checked:!F.checked})),h=(d||[]).filter(m=>m.checked),A=h.length>0,D=()=>()=>a(A?(d||[]).map(m=>({...m,checked:!1})):(d||[]).map(m=>m.actionable?{...m,checked:!0}:m)),[T,L]=j.useState(void 0),X=p===""?d||[]:(d||[]).filter(m=>In(p,m)),q=Math.ceil(X.length/Number(y)),$=rs({total:q,initialPage:1}),I=X.slice(($.active-1)*Number(y),$.active*Number(y));return e.jsxs(P,{pb:"xs",children:[!l&&e.jsxs(e.Fragment,{children:[e.jsx(xe,{title:`${T==null?void 0:T.name} ${i?"Result":"Preview"}`,opened:!!T,onClose:()=>L(void 0),styles:{header:{paddingBottom:0}},children:T&&e.jsxs(e.Fragment,{children:[T.result.warning&&e.jsx(w,{c:"orange",children:T.result.warning}),T.result.error&&e.jsx(w,{c:"red",children:T.result.error}),e.jsx(zn,{action:T,resultant:i}),e.jsx(se,{fz:"xs",label:"Raw Output",children:e.jsx("pre",{style:{margin:0},children:e.jsx(B,{fz:"xs",children:JSON.stringify(T,null,2)})})})]})}),e.jsxs(x,{justify:"center",children:[e.jsx(x.Col,{span:2,children:e.jsx(k,{mt:"xs",variant:"filled",placeholder:`Search ${(d||[]).length} entries...`,leftSection:e.jsx(Ne,{size:15}),value:p,onChange:m=>u(m.currentTarget.value)})}),!o&&e.jsx(x.Col,{span:2,children:!i&&e.jsx(C,{justify:"right",children:e.jsx(Be,{labelPosition:"left",mt:17,label:"Display Actionless",checked:r,onChange:()=>c(!r)})})}),e.jsx(x.Col,{span:2,children:e.jsx(de,{mt:"xs",variant:"filled",placeholder:"Pick one",onChange:m=>f(m),value:y,data:[{value:"5",label:"5 Per Page"},{value:"15",label:"15 Per Page"},{value:"25",label:"25 Per Page"},{value:"50",label:"50 Per Page"},{value:"100",label:"100 Per Page"}]})}),e.jsx(x.Col,{span:"auto",children:e.jsx(is,{mt:12,onChange:m=>$.setPage(m),value:$.active,total:q})}),e.jsx(x.Col,{span:2,children:!i&&e.jsxs(O,{onClick:n,leftSection:e.jsx($e,{}),disabled:!A,mt:"xs",children:["Run ",h.length," Actions"]})})]}),e.jsx(cs,{mt:"xs"})]}),l&&e.jsx(C,{justify:"center",children:e.jsx(Bt,{resultant:i})}),d&&!l&&e.jsxs(e.Fragment,{children:[e.jsxs(x,{pt:"xs",align:"center",children:[e.jsx(x.Col,{pl:"lg",span:1,children:!i&&e.jsx(V,{onChange:D(),checked:A})}),o&&e.jsx(x.Col,{span:1,fw:"bold",children:"Schema"}),o&&e.jsx(x.Col,{span:1,fw:"bold",children:"Rule"}),e.jsx(x.Col,{span:2,fw:"bold",children:t||"ID"}),e.jsx(x.Col,{span:o?5:7,fw:"bold",children:"Display"}),e.jsx(x.Col,{span:2,fw:"bold",children:"Actions"})]}),I.map(m=>e.jsx(Pn,{match:m,toggle:g,setAction:F=>L(F),resultant:i,dash:o},m.id))]})]})}function $n({rule:t,close:s}){const{schema:l}=j.useContext(M),[a,n]=j.useState("conditions"),o=he({initialValues:{secondaries:[],conditions:[],actions:[]},validate:{}});j.useEffect(()=>{o.reset(),t&&o.setValues(t)},[t]);const r=o.values.conditions.length>0,{data:c,post:p,loading:u,reset:y,setData:f}=_({url:`/schema/${l==null?void 0:l.name}/rules/match`,data:{...t,conditions:o.values.conditions}}),{data:d,post:g,loading:h,reset:A,setData:D}=_({url:`/schema/${l==null?void 0:l.name}/rules/run`,data:{...t,conditions:o.values.conditions,matches:(c||[]).filter(q=>q.checked).map(q=>q.id)}}),T=()=>{y(),A()},L=()=>{T(),s(),n("conditions")},X=()=>{n("results"),g()};return e.jsx(xe,{withCloseButton:!1,size:"80%",opened:!!t,closeOnClickOutside:!1,onClose:L,styles:{body:{padding:0}},children:t&&e.jsxs(U,{p:0,value:a,onChange:n,children:[e.jsxs(U.List,{children:[e.jsx(U.Tab,{disabled:u,onClick:T,value:"conditions",children:"Conditions"}),e.jsx(U.Tab,{disabled:u||!r,leftSection:u?e.jsx(Ce,{size:15}):e.jsx(Ne,{size:15}),value:"matches",onClick:p,children:"Find Matches"}),e.jsx(U.Tab,{disabled:!0,leftSection:h?e.jsx(Ce,{size:15}):e.jsx($e,{size:15}),value:"results",children:"Results"}),e.jsx(U.Tab,{ml:"auto",disabled:!0,value:"log",children:"Log"}),e.jsx(U.Tab,{leftSection:e.jsx(Ae,{size:"0.8rem"}),value:"close","aria-label":"close",onClick:L})]}),e.jsx(U.Panel,{mih:300,p:"xs",pt:0,value:"conditions",children:e.jsx(Ht,{form:o,label:"Add single-run modifications here."})}),e.jsx(U.Panel,{value:"matches",children:e.jsx(nt,{id:t==null?void 0:t.primaryKey,matches:c||[],loading:u,setData:f,run:X})}),e.jsx(U.Panel,{value:"results",children:e.jsx(nt,{id:t==null?void 0:t.primaryKey,matches:d||[],loading:h,setData:D,resultant:!0})})]})})}function An(){const{schema:t,rules:s,mutate:l}=j.useContext(M),a=ne(),[n,{open:i,close:o}]=te(!1),[r,c]=j.useState(void 0),[p,u]=j.useState(void 0),y=b=>{u(b),i()},f=b=>{c(b)},{del:d,request:g,loading:h}=_({cleanup:!0,furl:({name:b})=>`/schema/${t==null?void 0:t.name}/rule/${b}`,fdata:({name:b})=>({name:b}),catch:b=>fe(b),then:({rules:b,_rules:z})=>{l({rules:b,_rules:z}),H.show({title:"Success",message:"Rule Removed.",color:"lime"})}}),{post:A,request:D,loading:T}=_({cleanup:!0,furl:({name:b})=>`/schema/${t==null?void 0:t.name}/rule/${b}/copy`,fdata:({name:b})=>({name:b}),catch:b=>fe(b),then:({rules:b,_rules:z})=>{l({rules:b,_rules:z}),H.show({title:"Success",message:"Rule Copied.",color:"lime"})}}),{put:L,loading:X}=_({cleanup:!0,furl:({name:b})=>`/schema/${t==null?void 0:t.name}/rule/${b}/toggle`,fdata:({name:b})=>({name:b}),catch:b=>fe(b),then:({rules:b,_rules:z})=>{l({rules:b,_rules:z})}}),{put:q,loading:$}=_({cleanup:!0,url:`/schema/${t==null?void 0:t.name}/rules/reorder`,then:({rules:b})=>{l({rules:b})}}),I=b=>at.openConfirmModal({title:"Permanently Delete Rule",centered:!0,children:e.jsxs(w,{size:"sm",children:["Are you sure you want to delete ",b,"? This action is destructive and cannot be reversed."]}),labels:{confirm:"Delete rule",cancel:"No don't delete it"},confirmProps:{color:"red"},onConfirm:()=>d({name:b})}),m=h||T||$||X,[F,K]=zt(s);j.useEffect(()=>K.setState(s),[s]);const S=(b,z)=>{K.reorder({from:b,to:z}),q({data:{from:b,to:z}})},v=b=>{K.setState(s.map(z=>z.name!==b.name?z:{...z,enabled:!b.enabled})),L({name:b.name})};if(t)return n?e.jsx(vn,{editing:p,close:()=>{o(),u(void 0)}}):e.jsxs(ye,{label:e.jsx(be,{rightSection:e.jsx(O,{onClick:()=>i(),variant:"light",children:"Add"}),children:"Rules"}),children:[e.jsx($n,{rule:r,close:()=>c(void 0)}),F.length===0&&e.jsx(w,{c:"lighter",size:"sm",children:"No Rules in effect."}),e.jsx(ae,{onDragEnd:({destination:b,source:z})=>S(z.index,(b==null?void 0:b.index)||0),children:e.jsx(re,{droppableId:"dnd-list",direction:"vertical",children:b=>e.jsxs("div",{...b.droppableProps,style:{top:"auto",left:"auto"},ref:b.innerRef,children:[F.map((z,Xe)=>e.jsx(ie,{index:Xe,draggableId:Xe.toString(),children:_e=>e.jsxs(x,{align:"center",ref:_e.innerRef,mt:"xs",..._e.draggableProps,className:Z.item,style:{..._e.draggableProps.style,left:"auto !important",top:"auto !important"},children:[e.jsx(x.Col,{span:"content",style:{cursor:"grab"},..._e.dragHandleProps,children:e.jsx(C,{children:e.jsx(oe,{size:"1.2rem"})})}),e.jsx(x.Col,{span:"auto",children:e.jsxs(C,{gap:5,children:[z.name,z.description&&z.description!==""&&e.jsx(Le,{position:"right",label:z.description,children:e.jsx(Ys,{size:16})})]})}),e.jsx(x.Col,{span:"auto",children:e.jsx(C,{children:z.actions.map((xt,Wt)=>{const{Icon:Kt,color:Te}=Ge[xt.name];return e.jsx(Le,{fz:"xs",withArrow:!0,color:Te?a.colors[Te][6]:void 0,label:xt.name,children:e.jsx(Kt,{color:Te?a.colors[Te][6]:void 0,size:16,stroke:2})},Wt)})})}),e.jsx(x.Col,{span:"content",children:e.jsxs(C,{justify:"right",gap:"xs",children:[e.jsx(V,{disabled:m,onClick:()=>v(z),checked:z.enabled,color:"teal"}),e.jsx(N,{disabled:m,loading:g.name===z.name,onClick:()=>I(z.name),variant:"subtle",color:"red",children:e.jsx(W,{size:16,stroke:1.5})}),e.jsx(N,{disabled:m,loading:D.name===z.name,onClick:()=>A({name:z.name}),variant:"subtle",color:"indigo",children:e.jsx(ke,{size:16,stroke:1.5})}),e.jsx(N,{disabled:m,onClick:()=>y(z),variant:"subtle",color:"orange",children:e.jsx(Fe,{size:16,stroke:1.5})}),e.jsx(N,{disabled:m,onClick:()=>f(z),variant:"subtle",color:"green",children:e.jsx(Qs,{size:16,stroke:1.5})})]})})]})},Xe)),b.placeholder]})})})]})}function Nn({opened:t,close:s,editing:l,loading:a=!1,add:n,save:i,form:o}){const{data:r=[],loading:c}=_({url:"/schema",default:[],fetch:!0,mutate:D=>D.map(T=>T.name)}),{data:p=[],loading:u,get:y,error:f}=_({url:`/schema/${o.values.schema}/rules/`,default:[],mutate:D=>D.map(T=>T.name)});j.useEffect(()=>{o.values.schema&&y()},[o.values.schema]);const d=lt.toString(o.values.cron,{throwExceptionOnParseError:!1}),g=d.includes("An error occured when generating the expression description"),h=!o.values.schema,A=()=>{if(l)return i({id:l.id});n()};return e.jsxs(xe,{size:"lg",opened:t,onClose:s,title:"Add Schedule",children:[e.jsx(de,{label:"Target Schema",required:!0,placeholder:"Pick schema",data:r,rightSection:c?e.jsx(Ce,{size:"xs"}):void 0,...o.getInputProps("schema")}),o.values.schema&&e.jsxs(e.Fragment,{children:[e.jsx(us,{label:"Rules",clearable:!0,description:"Specify which rules will be run on the schema. Leave blank to run all.",placeholder:o.values.rules.length<=0?"All rules":"Pick rules",disabled:p.length<=0,data:p,rightSection:u?e.jsx(Ce,{size:"xs"}):void 0,...o.getInputProps("rules"),error:f}),e.jsx(w,{fz:"xs",c:"dimmed",children:"Note: Disabled rules will be skipped regardless."}),e.jsx(kt,{mt:5,fullWidth:!0,...o.getInputProps("type"),data:[{label:e.jsxs(ce,{children:[e.jsx(Zs,{size:20,stroke:1.5}),e.jsx(P,{ml:5,children:"Schedule"})]}),value:"Schedule"},{label:e.jsxs(ce,{children:[e.jsx(el,{size:20,stroke:1.5}),e.jsx(P,{ml:5,children:"Monitor"})]}),value:"Monitor"}]}),o.values.type==="Schedule"&&e.jsx(k,{label:"CRON Expression",placeholder:"0 * * * MON-FRI",required:!0,description:g?"Invalid Syntax":d,...o.getInputProps("cron"),error:g&&d}),o.values.type==="Monitor"&&e.jsx(k,{label:"File Path",placeholder:"D:/watchme.csv",required:!0,description:"This file path will be monitored, and the schedule run when a file change is detected.",...o.getInputProps("monitor")})]}),e.jsx(C,{justify:"right",mt:"md",children:e.jsx(O,{loading:a,disabled:h,onClick:A,variant:"light",type:"submit",children:l?"Save":"Add"})})]})}function Dn(){const t=S=>S.map(v=>({...v,rules:v.rules?JSON.parse(v.rules):[],type:v.monitor?"Monitor":"Schedule"})).sort((v,b)=>v.index-b.index),[s,l]=zt([]),{loading:a}=_({url:"/schedule",default:[],preserve:!0,fetch:!0,mutate:t,then:S=>l.setState(S)}),[n,{open:i,close:o}]=te(!1),[r,c]=j.useState(void 0),p={schema:"",type:"",rules:[],cron:"",monitor:""},u=he({initialValues:p,validate:{cron:S=>{if(u.values.type==="Monitor")return!1;const v=lt.toString(S,{throwExceptionOnParseError:!1});return v.includes("An error occured when generating the expression description")?v:null},monitor:S=>u.values.type==="Schedule"?!1:S.trim()===""&&"Path required."}});j.useEffect(()=>{u.reset(),r?u.setValues(r):u.setValues(p),u.setInitialValues(p)},[r]);const{post:y,loading:f}=_({url:"/schedule",data:u.values,before:()=>u.validate(),check:()=>!u.isValid(),catch:({validation:S})=>u.setErrors(S),mutate:t,then:S=>{l.setState(S),o(),H.show({title:"Success",message:"Schedule Added.",color:"lime"})}}),{put:d,loading:g}=_({url:"/schedule/reorder",fdata:({from:S,to:v})=>({from:S,to:v}),mutate:t,then:S=>l.setState(S)}),h=(S,v)=>{l.reorder({from:S,to:v}),d({from:S,to:v})},{put:A,loading:D}=_({url:"/schedule",data:u.values,before:()=>u.validate(),check:()=>!u.isValid(),catch:({validation:S})=>u.setErrors(S),furl:({id:S})=>`/schedule/${S}`,mutate:t,then:S=>{l.setState(S),o(),H.show({title:"Success",message:"Schedule Modified.",color:"lime"})}}),{put:T,loading:L}=_({url:"/schedule",data:u.values,furl:({id:S})=>`/schedule/${S}/toggle`,mutate:t,then:S=>l.setState(S)}),{del:X,request:q,loading:$}=_({cleanup:!0,furl:({id:S})=>`/schedule/${S}`,mutate:t,then:S=>{l.setState(S),H.show({title:"Success",message:"Schedule Removed.",color:"lime"})}}),I=a||f||D||L||$||g,m=S=>{c(S),i()},F=S=>{l.setState(s.map(v=>v.id!==S.id?v:{...v,enabled:!S.enabled})),T({id:S.id})},K=()=>{c(void 0),o()};return e.jsxs(ye,{label:e.jsx(be,{rightSection:e.jsxs(C,{children:[a&&e.jsx(Ce,{size:"sm"}),e.jsx(O,{onClick:i,variant:"light",children:"Add"})]}),children:"Schedules"}),children:[e.jsx(Nn,{opened:n,close:K,form:u,add:y,save:A,editing:r,loading:I}),s.length===0&&e.jsx(w,{c:"lighter",size:"sm",children:I?"Loading...":"No Schedules in effect."}),e.jsx(ae,{onDragEnd:({destination:S,source:v})=>h(v.index,(S==null?void 0:S.index)||0),children:e.jsx(re,{droppableId:"dnd-list",direction:"vertical",children:S=>e.jsxs("div",{...S.droppableProps,style:{top:"auto",left:"auto"},ref:S.innerRef,children:[s.map(v=>{const b=v.cron?lt.toString(v.cron,{throwExceptionOnParseError:!1}):`Watch: ${v.monitor}`;return e.jsx(ie,{index:v.index,draggableId:v.id,children:z=>e.jsxs(x,{align:"center",ref:z.innerRef,mt:"xs",...z.draggableProps,className:Z.item,style:{...z.draggableProps.style,left:"auto !important",top:"auto !important"},children:[e.jsx(x.Col,{span:"content",style:{cursor:"grab"},...z.dragHandleProps,children:e.jsx(C,{children:e.jsx(oe,{size:"1.2rem"})})}),e.jsx(x.Col,{span:"auto",children:e.jsx(w,{size:"xs",lineClamp:1,children:b})}),e.jsx(x.Col,{span:"auto",children:e.jsxs(w,{size:"xs",lineClamp:1,children:["Schema: ",v.schema," ",v.rules.length>0&&` | Rules: ${v.rules}`]})}),e.jsx(x.Col,{span:"content",children:e.jsxs(C,{justify:"right",gap:"xs",children:[e.jsx(V,{disabled:I,onClick:()=>F(v),checked:v.enabled,color:"teal"}),e.jsx(N,{disabled:I,loading:q.id===v.id,onClick:()=>X({id:v.id}),variant:"subtle",color:"red",children:e.jsx(W,{size:16,stroke:1.5})}),e.jsx(N,{disabled:I,onClick:()=>m(v),variant:"subtle",color:"orange",children:e.jsx(Fe,{size:16,stroke:1.5})})]})})]})},v.id)}),S.placeholder]})})})]})}function Fn({schema:t,schemas:s,check:l,loading:a,getSchemas:n}){return e.jsx(e.Fragment,{children:e.jsxs(ut,{menu:{onOpen:()=>n()},loading:a,variant:"light",onClick:l,options:s,children:["Check ",t]})})}function _n(){const{get:t,data:s,loading:l}=_({url:"/schema",default:[{onClick:()=>f("all schemas"),label:"All Schemas"}],fetch:!0,mutate:d=>{const g=d.map(h=>({onClick:()=>f(h.name),label:h.name}));return[{onClick:()=>f("all schemas"),label:"All Schemas"},...g]}}),[a,n]=j.useState("all schemas"),{data:i,post:o,loading:r,reset:c,setData:p}=_({url:"/match",data:{schema_name:a},mutate:d=>d.filter(g=>g.actionable)}),u=r||l,y=s.length>1,f=d=>{n(d),c()};return e.jsx(ye,{size:"responsive",label:e.jsx(be,{rightSection:y?e.jsx(Fn,{schema:a,schemas:s,setSchema:f,getSchemas:t,check:o,loading:u}):e.jsx(e.Fragment,{}),children:"Dashboard"}),children:y?e.jsxs(e.Fragment,{children:[e.jsx(nt,{matches:i||[],loading:r,setData:p,run:()=>{},dash:!0}),!i&&!r&&e.jsxs(w,{fz:"sm",c:"dimmed",children:["Run a ",e.jsx("a",{href:"#",onClick:o,children:"check"})," to find actions to take."]})]}):e.jsx(w,{fz:"sm",c:"dimmed",children:"Create a schema to begin."})})}function Tn(){const{nav:t}=j.useContext(Ke);switch(t){case"Settings":return e.jsx(wl,{});case"Schedules":return e.jsx(Dn,{});case"Schema":return e.jsx(Nl,{});case"Connectors":return e.jsx(Gl,{});case"Rules":return e.jsx(An,{});default:return e.jsx(_n,{})}}function Rn(){const[t,{toggle:s,close:l}]=te(),a=St(`(max-width: ${Ct(750)})`),{authed:n}=j.useContext(Pe);return n?e.jsxs(Ee,{header:{height:64,collapsed:!a},navbar:{width:300,breakpoint:"sm",collapsed:{mobile:!t}},padding:"md",children:[e.jsx(Ee.Header,{children:e.jsx(Mt,{opened:t,toggle:s})}),e.jsx(Ee.Navbar,{children:e.jsx(ml,{closeNav:l})}),e.jsx(Ee.Main,{children:e.jsx(Tn,{})})]}):e.jsx(fl,{})}function En({children:t}){const[s,l]=j.useState("Dashboard"),a=n=>l(n);return e.jsx(Ke.Provider,{value:{nav:s,changeNav:a},children:t})}function On({children:t}){const[s,l,a]=st({key:"auth",defaultValue:"{}"}),n=JSON.parse(s||"{}")||{},i=n.session||void 0,o=()=>{a()};return e.jsx(Pe.Provider,{value:{authed:i,session:n,logout:o,login:l},children:t})}function Ln({children:t}){const{changeNav:s}=j.useContext(Ke),[l,a]=j.useState(void 0),{data:n,setData:i,loading:o,request:r,fetch:c,reset:p}=_({url:`/schema/${l}`,loading:l,preserve:!0,before:()=>s("Dashboard"),then:d=>{s("Schema"),!(!d.errors||d.errors.length<=0)&&H.show({title:"Errors Detected",message:JSON.stringify(d.errors),color:"red",autoClose:!1})}}),u=o?r.loading:!1;j.useEffect(()=>{l?c():(p(),s("Dashboard"))},[l]);const y=d=>a(d),f=(d={})=>i({...n,...d});return e.jsx(M.Provider,{value:{schema:n,loading:u,connectors:n?n.connectors:[],_connectors:n?n._connectors:{},rules:n?n.rules:[],_rules:n?n._rules:{},headers:n?n.headers:{},changeSchema:y,reload:c,mutate:f},children:t})}const Un="_connector_sxciz_1",Vn={connector:Un};function Mn(t){const s=[];for(const l in t)if(Object.prototype.hasOwnProperty.call(t,l)){const a=t[l];for(const n of a)s.push(`${l}.${n}`)}return s}function qn({opened:t,close:s,click:l}){const a=ne(),{_connectors:n,headers:i}=j.useContext(M),[o,r]=j.useState(""),c=y=>r(y.target.value),u=Mn(i).filter(y=>y.toLowerCase().includes(o.toLowerCase()));return e.jsxs(ps,{position:"right",size:"xs",opened:t,onClose:s,title:"Template Explorer",overlayProps:{opacity:.2},children:[e.jsx(k,{pb:"xs",leftSection:e.jsx(Ne,{size:16,style:{display:"block",opacity:.5}}),placeholder:"Search",onChange:c,value:o}),o===""?Object.keys(i).map(y=>{const{id:f}=n[y],d=me[f];return e.jsx(ze,{onClick:()=>r(`${y}.`),className:Vn.connector,p:"xs",mt:"xs",children:e.jsxs(C,{children:[e.jsx(P,{style:{display:"flex",alignItems:"center"},children:e.jsx(d.icon,{size:17,color:a.colors[d.color][6]})}),e.jsx("div",{style:{flex:1},children:e.jsx(w,{size:"sm",children:y})}),e.jsx(rt,{size:17,stroke:1.5})]})},y)}):e.jsx(hs,{style:{justifyContent:"center"},gap:"sm",justify:"flex-start",align:"center",direction:"row",wrap:"wrap",children:u.map(y=>e.jsx(O,{onClick:()=>l(y),variant:"default",radius:"xl",size:"compact-xs",children:y},y))})]})}function Bn({children:t}){const[s,{open:l,close:a}]=te(!1),[n,i]=j.useState(()=>c=>{console.log(c)}),o=e.jsx(qn,{click:n,opened:s,close:a}),r=c=>{l(),i(c)};return e.jsx(Je.Provider,{value:{explorer:o,explore:r,close:a},children:t})}const Hn=xs({fontFamily:"Roboto, sans-serif",components:{TextInput:k.extend({classNames:{input:Z.input}})}});function Wn({children:t}){return e.jsxs(js,{defaultColorScheme:"auto",theme:Hn,children:[e.jsx(ms,{}),e.jsx(gs,{children:e.jsx(En,{children:e.jsx(On,{children:e.jsx(Ln,{children:e.jsx(Bn,{children:t})})})})})]})}Jt.createRoot(document.getElementById("root")).render(e.jsx(Gt.StrictMode,{children:e.jsx(Wn,{children:e.jsx(Rn,{})})}));
