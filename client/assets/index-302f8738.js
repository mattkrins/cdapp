import{j as e,r as f,a as Qt}from"./react-8db41b9c.js";import{c as Zt}from"./react-dom-44ec3eea.js";import{G as k,B as es,T as qe,C as B,n as T,u as pe,M as xe,a as C,A as ts,b as E,P as ke,c as ss,r as F,d as P,e as ls,f as Pt,g as $t,h as zt,i as le,j as de,k as I,l as Be,m as A,U as Ae,R as ns,o as R,p as Q,q as Le,s as ct,t as ue,v as Te,w as rt,x as rs,y as os,I as Ue,S as At,D as Ee,z as oe,E as dt,F as as,H as He,J as Dt,K as Nt,L as J,N as Ft,O as is,Q as O,V as b,W as he,X as we,Y as ut,Z as _t,_ as se,$ as me,a0 as Ye,a1 as yt,a2 as q,a3 as Z,a4 as cs,a5 as ds,a6 as us,a7 as Rt,a8 as hs,a9 as Oe,aa as ps,ab as xs,ac as js,ad as ms,ae as gs,af as bs}from"./@mantine-fa9f7f5b.js";import{a as fs}from"./axios-c24e582b.js";import{I as ye,a as ys,b as De,c as vs,d as ht,e as Ne,f as Fe,g as Ss,h as _e,i as pt,j as Cs,k as ks,l as ws,m as Et,n as Ot,o as Lt,p as Is,q as Ps,r as xt,s as jt,t as $s,u as zs,v as W,w as Pe,x as As,y as We,z as ot,A as $e,B as Ke,C as Ds,D as ee,E as ae,F as je,G as Ut,H as Ns,J as Vt,K as Fs,L as Mt,M as _s,N as qt,O as Rs,P as Bt,Q as Es,R as Os,S as Ls,T as be,U as Tt,V as Us,W as Vs,X as Ms,Y as qs,Z as Bs,_ as Ts,$ as Ht,a0 as Hs,a1 as Ws,a2 as Ks,a3 as Gs,a4 as Ie,a5 as vt,a6 as Js,a7 as Wt,a8 as mt,a9 as Xs,aa as Ys,ab as Qs,ac as Zs,ad as el,ae as tl,af as sl,ag as ll,ah as nl,ai as rl}from"./@tabler-51d7c120.js";import{l as ol}from"./socket.io-client-651ff694.js";import{D as X,C as ie,P as ce}from"./@hello-pangea-5bc59746.js";import{c as at}from"./cronstrue-622c2a2f.js";import"./scheduler-765c72db.js";import"./clsx-1229b3e0.js";import"./react-remove-scroll-9afccdf7.js";import"./tslib-89fde298.js";import"./react-remove-scroll-bar-e444174b.js";import"./react-style-singleton-be5d6081.js";import"./get-nonce-1ea010b7.js";import"./use-sidecar-d2c656b2.js";import"./use-callback-ref-7e77d833.js";import"./react-textarea-autosize-2ec0dff4.js";import"./@babel-eb6c5c4b.js";import"./use-latest-7fcc6944.js";import"./use-isomorphic-layout-effect-9b4327c8.js";import"./use-composed-ref-6e052041.js";import"./react-number-format-42d6efe4.js";import"./@floating-ui-4b554218.js";import"./react-transition-group-811f49ec.js";import"./fast-deep-equal-a91537b9.js";import"./klona-192252da.js";import"./react-dropzone-esm-c3e2e9b8.js";import"./prop-types-f78d4ff5.js";import"./engine.io-client-86cec14e.js";import"./engine.io-parser-b13552ae.js";import"./@socket.io-3e1df240.js";import"./socket.io-parser-44417fca.js";import"./redux-118a19e7.js";import"./react-redux-4d05ee04.js";import"./hoist-non-react-statics-5f650e67.js";import"./react-is-e8e5dbb3.js";import"./use-sync-external-store-7a1dc470.js";import"./use-memo-one-4c5b4d08.js";import"./css-box-model-5383974c.js";import"./tiny-invariant-dd7d57d2.js";import"./memoize-one-297ddbcb.js";import"./raf-schd-5404ed65.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function l(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(r){if(r.ep)return;r.ep=!0;const a=l(r);fetch(r.href,a)}})();const al="_navbar_1yx7j_1",il="_link_1yx7j_33",cl="_links_1yx7j_65",dl="_linkIcon_1yx7j_77",ul="_section_1yx7j_87",hl="_header_1yx7j_107",pl="_collectionsHeader_1yx7j_117",xl="_user_1yx7j_129",G={navbar:al,link:il,links:cl,linkIcon:dl,section:ul,header:hl,collectionsHeader:pl,user:xl};function Kt({opened:t,toggle:s}){return e.jsxs(k,{h:s?"100%":void 0,px:s?"md":void 0,justify:"space-between",children:[s&&e.jsx(es,{opened:t,onClick:s,hiddenFrom:"sm",size:"sm"}),e.jsx(qe,{order:3,children:"CDAP Provisioner"}),e.jsx(B,{fw:700,children:"v0.4.0"})]})}const Ge=f.createContext({changeNav:()=>{}}),ze=f.createContext({authed:void 0,session:void 0,logout:()=>{},login:()=>{}});function Ve(t={}){const[s,l]=f.useState(t.fetch||!1),[n,r]=f.useState(void 0),[a,o]=f.useState(void 0),[d,i]=f.useState(void 0),[x,c]=f.useState(t.default||void 0),[p,y]=f.useState({}),S={baseURL:`http://${new URL(window.location.href).hostname}:2327/api/v1`,method:"get"},j=fs.create(S),v=f.useCallback(()=>{r(void 0),o(void 0),i(void 0),c(t.default||void 0),y({})},[t]),D=f.useCallback((z={})=>{let m={...t,...z};m.url=(t.url||"")+(m.append_url||"");let $,V;const g=new Promise(function(h,w){$=h,V=w});if(m.preserve||v(),m.before&&m.before({...m,promise:g}),m.furl&&(m.url=m.furl(m)),m.fdata&&(m.data=m.fdata(m)),m.modify&&(m={...m,...m.modify({...m,promise:g})}),!(m.check&&m.check({...m,promise:g}))){if(y(m),l(!0),m.require){for(const h in m.require)if(!m.require[h])return}return j(m).then(h=>{i(h);let w=h.data||h;m.mutate&&(w=m.mutate(w)),w&&c(w),m.then&&m.then(w),$(w)}).catch(h=>{let w="Unknown Error",H;h.message&&(w=h.message),h.response&&h.response.data&&h.response.data.error&&(w=h.response.data.error),h.response&&h.response.data&&h.response.data.message&&(w=h.response.data.message),h.response&&h.response.data&&h.response.data.validation&&(H=h.response.data.validation),H||r(w),H&&o(H),m.catch&&m.catch({error:w,validation:H,status:h.response.status}),V({error:w,validation:H})}).finally(()=>{l(!1),m.finally&&m.finally({...m,promise:g}),m.cleanup&&v()}),g}},[j,t,v]);return f.useEffect(()=>{if(t.require){for(const z in t.require)if(!t.require[z])return}t.fetch&&D()},[]),{fetch:D,post:(z={})=>D({...z,method:"post"}),put:(z={})=>D({...z,method:"put"}),get:(z={})=>D({...z,method:"get"}),del:(z={})=>D({...z,method:"delete"}),reset:v,setData:c,loading:s,request:p,response:d,data:x,error:n,invalid:a}}function ge(t={}){const s=t.validation?Object.values(t.validation):t.error||t.message||JSON.stringify(t);T.show({title:"Error",message:s,color:"red"})}function N({catch:t,modify:s,headers:l={},...n}){const{logout:r}=f.useContext(ze);return Ve({catch:({status:o,...d})=>{o===401&&r(),t&&t({status:o,...d}),(!d.validation||Object.keys(d.validation).length<=0)&&ge(d)},modify:o=>{const d=s?s(o):o;return{headers:{Authorization:`Bearer ${JSON.parse(JSON.parse(localStorage.getItem("auth")||"")||{}).session}`,...l},...d}},...n})}const M=f.createContext({schema:void 0,loading:!1,connectors:[],rules:[],_rules:{},_connectors:{},headers:{},changeSchema:()=>{},reload:()=>{},mutate:()=>{}});function Gt(t){const s=/[<>:"/\\|?*]/g,l=/^(CON|PRN|AUX|NUL|COM[1-9]|LPT[1-9])$/i;return!s.test(t)&&!l.test(t)&&t.length<=260&&t.length>0}function jl({opened:t,close:s,refresh:l}){const{changeSchema:n}=f.useContext(M),r=pe({initialValues:{name:""},validate:{name:i=>Gt(i)?null:"Invalid schema name"}}),{post:a,loading:o,error:d}=N({url:"/schema",data:r.values,before:()=>r.validate(),check:()=>!r.isValid(),catch:({validation:i})=>r.setErrors(i),then:i=>{n(i.name),s(),l()}});return e.jsxs(xe,{opened:t,onClose:s,title:"New Schema",children:[e.jsx(C,{label:"Schema Name",placeholder:"Schema Name",leftSection:e.jsx(ye,{size:16,style:{display:"block",opacity:.5}}),withAsterisk:!0,...r.getInputProps("name")}),d&&e.jsx(ts,{mt:"xs",icon:e.jsx(ys,{size:32}),title:"Error",color:"red",children:d}),e.jsx(k,{justify:"right",mt:"md",children:e.jsx(E,{loading:o,onClick:a,type:"submit",children:"Create Schema"})})]})}function Me(t,s={}){const[l,n]=f.useState(s.default);return f.useEffect(()=>{const r=new URL(window.location.href),a=ol(`http://${r.hostname}:2327`);return a.connect(),a.on(t,(o,...d)=>{s.set!==!1&&n(o),s.then&&s.then(o,...d)}),()=>{a.off(t),a.disconnect()}},[]),[l,n]}const ml="_card_11ylv_1",gl="_icon_11ylv_17",bl="_title_11ylv_29",Qe={card:ml,icon:gl,title:bl};function Jt({resultant:t}){const[s]=Me("job_status",{default:"Idle"}),[l]=Me("progress",{default:{eta:"Estimating...",i:0,p:0,m:0}});return e.jsxs(ke,{radius:"md",withBorder:!0,className:Qe.card,mt:32,mb:32,children:[e.jsx(ss,{className:Qe.icon,size:60,radius:60,children:t?e.jsx(De,{style:{width:F(32),height:F(32)},stroke:1.5}):e.jsx(vs,{style:{width:F(32),height:F(32)},stroke:1.5})}),e.jsx(P,{ta:"center",fw:700,className:Qe.title,children:t?"Running Actions":"Finding Matches"}),e.jsx(P,{c:"dimmed",ta:"center",fz:"sm",children:s}),e.jsxs(k,{justify:"space-between",mt:"xs",children:[e.jsx(P,{fz:"sm",c:"dimmed",children:"Progress"}),e.jsxs(P,{fz:"sm",c:"dimmed",children:[Math.floor(l.p),"%"]})]}),e.jsx(ls,{mt:5,value:l.p,animated:!0}),e.jsxs(k,{justify:"space-between",mt:"md",children:[e.jsxs(P,{fz:"sm",children:[l.i," / ",l.m]}),e.jsx(Pt,{size:"sm",children:l.eta})]})]})}const fl=[{icon:ks,label:"Dashboard"},{icon:ws,label:"Settings"},{icon:Et,label:"Schedules"}],yl=[{icon:Ot,label:"Schema"},{icon:Lt,label:"Connectors"},{icon:Is,label:"Rules"}];function St({link:t,active:s,onClick:l}){return e.jsx(E,{"data-active":s||void 0,fullWidth:!0,variant:"subtle",size:"xs",leftSection:e.jsx(t.icon,{size:20,stroke:1.5}),styles:{inner:{justifyContent:"start"},label:{fontWeight:400}},classNames:{root:G.link},onClick:l,children:t.label})}function vl({closeNav:t}){const{nav:s,changeNav:l}=f.useContext(Ge),{logout:n,session:r}=f.useContext(ze),{schema:a,changeSchema:o,loading:d}=f.useContext(M),i=$t(`(max-width: ${zt(750)})`),[x,{open:c,close:p}]=le(!1),[y,{open:u,close:S}]=le(!1),[j,v]=f.useState(""),{data:D=[],loading:L,fetch:U}=N({url:"/schema",default:[],preserve:!0,fetch:!0,mutate:$=>$.map(V=>({label:V.name}))}),{del:Y}=N({url:"/auth"}),_=()=>{Y(),n()};f.useEffect(()=>{L||d||(a||U(),a&&j!==a.name&&(U(),v(a.name)))},[a]);const K=$=>{l($),i&&t()},[z]=Me("global_status",{default:{}}),[m]=Me("progress",{default:{p:0}});return f.useEffect(()=>{z.schema||S()},[z.schema]),e.jsxs("nav",{className:G.navbar,children:[z.schema&&e.jsx(xe,{withCloseButton:!1,size:"xl",opened:y,onClose:S,styles:{body:{padding:0},content:{backgroundColor:"transparent"}},children:e.jsx(de,{children:e.jsx(Jt,{resultant:!1})})}),x&&e.jsx(jl,{opened:x,close:p,refresh:U}),!i&&e.jsx(I,{className:`${G.section} ${G.header}`,children:e.jsx(Kt,{})}),e.jsx(I,{pt:"xs",className:G.section,children:e.jsx(I,{className:G.links,children:fl.map($=>e.jsx(St,{onClick:()=>K($.label),active:s===$.label,link:$},$.label))})}),a&&e.jsx(I,{pt:"xs",className:G.section,children:e.jsx(I,{className:G.links,children:yl.map($=>e.jsx(St,{onClick:()=>K($.label),active:s===$.label,link:$},$.label))})}),e.jsxs(I,{style:{flex:1},className:G.section,children:[e.jsxs(k,{className:G.collectionsHeader,justify:"space-between",children:[e.jsx(P,{size:"xs",fw:500,c:"dimmed",children:"Schemas"}),e.jsx(Be,{label:"Create schema",withArrow:!0,position:"right",children:e.jsx(A,{onClick:c,loading:L,variant:"default",size:18,children:e.jsx(ht,{style:{width:F(12),height:F(12)},stroke:1.5})})})]}),e.jsx(I,{className:G.links,children:D.map($=>{const V=(a&&a.name)===$.label;return e.jsx(E,{fullWidth:!0,variant:"subtle",size:"xs",styles:{inner:{justifyContent:"space-between"},label:{fontWeight:400}},classNames:{root:G.link},onClick:()=>V?void 0:o($.label),loading:d===$.label,disabled:!!d,rightSection:V?e.jsx(Ne,{onClick:()=>o(void 0),style:{width:F(12),height:F(12),cursor:"pointer"},stroke:1.5}):void 0,"data-active":V?!0:void 0,children:$.label},$.label)})})]}),e.jsx(I,{children:e.jsx(ke,{withBorder:!0,radius:"md",mb:"xs",pb:0,children:e.jsx(Ae,{style:{cursor:z.schema?"pointer":"auto"},disabled:!z.schema,onClick:u,className:G.user,p:"xs",children:e.jsxs(k,{children:[z.schema?e.jsx(ns,{size:50,roundCaps:!0,thickness:3,sections:[{value:m.p,color:"blue"}],label:e.jsx(de,{children:z.running?e.jsx(De,{style:{width:F(20),height:F(20)},stroke:1.5}):e.jsx(Fe,{style:{width:F(20),height:F(20)},stroke:1.5})})}):e.jsx(Ss,{style:{width:F(50),height:F(50)},stroke:.5}),e.jsxs("div",{children:[e.jsx(P,{size:"sm",tt:"uppercase",children:"Status:"}),z.schema?e.jsxs(e.Fragment,{children:[e.jsx(P,{c:"dimmed",size:"xs",children:z.running?"Running Actions...":"Finding Matches..."}),e.jsxs(P,{c:"dimmed",size:"xs",children:["Schema: ",z.schema]}),e.jsxs(P,{c:"dimmed",size:"xs",children:["Rule: ",z.rule]})]}):e.jsx(P,{c:"dimmed",size:"xs",children:"Idle"})]})]})})})}),e.jsx(I,{children:e.jsx(ke,{radius:"md",withBorder:!0,p:0,bg:"var(--mantine-color-body)",children:e.jsxs(R,{position:"top-start",width:"target",children:[e.jsx(R.Target,{children:e.jsx(Ae,{className:G.user,children:e.jsxs(k,{children:[e.jsx(_e,{style:{width:F(20),height:F(20)},stroke:1.5}),e.jsxs("div",{style:{flex:1},children:[e.jsx(P,{size:"sm",fw:500,children:r==null?void 0:r.username}),e.jsx(P,{c:"dimmed",size:"xs",children:"administrator"})]}),e.jsx(pt,{style:{width:F(14),height:F(14)},stroke:1.5})]})})}),e.jsx(R.Dropdown,{children:e.jsx(R.Item,{onClick:_,leftSection:e.jsx(Cs,{style:{width:F(14),height:F(14)}}),children:"Logout"})})]})})})]})}const Sl="_box_xo72w_1",Cl="_input_xo72w_7",Ce={box:Sl,input:Cl};function kl({completeSetup:t}){const{login:s}=f.useContext(ze),l=pe({initialValues:{username:"",password:"",collection:!1},validate:{username:Q("Username can not be empty."),password:Le({min:5},"Password must be at least 5 characters long.")}}),{post:n,loading:r}=Ve({url:"/setup",data:l.values,then:d=>{t(),s(JSON.stringify(d))},catch:({validation:d})=>l.setErrors(d)}),a=()=>{l.validate(),l.isValid()&&n()},o=d=>d.key==="Enter"&&a();return e.jsxs(ct,{size:420,my:40,children:[e.jsx(qe,{ta:"center",children:"New Installation"}),e.jsx(P,{c:"dimmed",size:"sm",ta:"center",mt:5,children:"Please create the initial administrative user."}),e.jsxs(ke,{className:Ce.box,withBorder:!0,shadow:"md",p:30,mt:30,radius:"md",children:[e.jsx(C,{classNames:{input:Ce.input},onKeyUp:o,...l.getInputProps("username"),label:"Username",placeholder:"Your Username",required:!0}),e.jsx(ue,{classNames:{input:Ce.input},onKeyUp:o,...l.getInputProps("password"),label:"Password",placeholder:"Your password",required:!0,mt:"md"}),e.jsx(k,{justify:"space-between",mt:"lg",children:e.jsx(Te,{...l.getInputProps("collection",{type:"checkbox"}),label:"Allow collection of anonymous statistics"})}),e.jsx(E,{onClick:()=>a(),loading:r,fullWidth:!0,mt:"xl",children:"Create User"})]})]})}function wl(){const[t,s,l]=rt({key:"setup",defaultValue:"false"}),[n,r,a]=rt({key:"lastLogin",defaultValue:""}),o=()=>s("true"),{login:d}=f.useContext(ze),i=pe({initialValues:{username:"",password:"",checked:!1},validate:{username:Q("Username can not be empty."),password:Q("Password can not be empty.")}});f.useEffect(()=>{i.setFieldValue("username",n||""),i.setFieldValue("checked",n!=="")},[n]);const{post:x,loading:c}=Ve({url:"/auth",data:i.values,then:u=>{i.values.checked?r(u.username):a(),d(JSON.stringify(u))},catch:({validation:u})=>i.setErrors(u)});Ve({url:"/setup",fetch:!0,then:({status:u})=>u?o():l()});const p=()=>{i.validate(),i.isValid()&&x()},y=u=>u.key==="Enter"&&p();return!t||t=="false"?e.jsx(kl,{completeSetup:o}):e.jsxs(ct,{size:420,my:40,children:[e.jsx(qe,{ta:"center",children:"CDAPP Login"}),e.jsxs(ke,{className:Ce.box,withBorder:!0,shadow:"md",p:30,mt:30,radius:"md",children:[e.jsx(C,{classNames:{input:Ce.input},onKeyUp:y,...i.getInputProps("username"),label:"Username",placeholder:"Your Username",required:!0,rightSection:n&&e.jsx(A,{variant:"subtle",size:"sm",onClick:()=>a(),children:e.jsx(Ne,{size:16,style:{display:"block",opacity:.5}})})}),e.jsx(ue,{classNames:{input:Ce.input},onKeyUp:y,...i.getInputProps("password"),label:"Password",placeholder:"Your password",required:!0,mt:"md"}),e.jsxs(k,{justify:"space-between",mt:"lg",children:[e.jsx(Te,{label:"Remember me",...i.getInputProps("checked",{type:"checkbox"})}),e.jsx(rs,{component:"button",size:"sm",children:"Forgot password?"})]}),e.jsx(E,{onClick:()=>p(),loading:c,fullWidth:!0,mt:"xl",children:"Sign in"})]})]})}function ve({children:t,leftSection:s,rightSection:l,...n}){return e.jsxs(k,{justify:"space-between",mb:"xs",children:[e.jsxs(I,{children:[e.jsx(qe,{order:2,...n,children:t}),s]}),e.jsx(I,{}),e.jsx(I,{children:l})]})}const Il="_container_1im94_1",Pl="_item_1im94_13",$l="_input_1im94_25",zl="_overflow_1im94_33",te={container:Il,item:Pl,input:$l,overflow:zl};function Se({children:t,label:s,size:l,...n}){return e.jsxs(ct,{size:l||"lg",children:[typeof s=="string"?e.jsx(ve,{...n,children:s}):s,e.jsx(ke,{className:te.container,p:"xl",children:t})]})}function Al(){const{setColorScheme:t,clearColorScheme:s}=os(),{changeSchema:l}=f.useContext(M),{get:n,loading:r}=N({url:"/fix",then:()=>{l(void 0),T.show({title:"Success",message:"Cache Purged.",color:"lime"}),setTimeout(()=>location.reload(),1e3)}});return e.jsxs(Se,{label:"Application Settings",children:[e.jsx(Ue.Wrapper,{label:"Theme",description:"Change colours of the application",children:e.jsx(At,{mt:"xs",fullWidth:!0,maw:300,onChange:a=>a==="auto"?s():t(a),data:[{label:"Light",value:"light"},{label:"Dark",value:"dark"},{label:"Auto",value:"auto"}]})}),e.jsx(Ue.Wrapper,{label:"Clear Cache",description:"Purges the server cache to fix schema inconsistencies, etc.",children:e.jsx(E,{loading:!!r,onClick:()=>n(),mt:5,children:"Fix"})})]})}function Dl(t){const[s,{close:l,open:n}]=le(!1);return{Modal:({children:a,...o})=>e.jsx(xe,{size:"lg",opened:s,onClose:l,title:t,...o,children:a}),opened:s,open:n,close:l}}function Nl({close:t}){const{schema:s,reload:l}=f.useContext(M),{post:n,loading:r,error:a}=N({url:`/schema/${s==null?void 0:s.name}/import`,headers:{"Content-Type":"multipart/form-data"},modify:d=>(console.log(d),d),then:()=>{t(),l()}}),o=d=>{const i=new FormData;i.append("file",d[0]),n({data:i})};return e.jsx(Ee,{loading:r,onDrop:o,accept:["application/zip","application/x-zip-compressed"],children:e.jsxs(k,{justify:"center",gap:"xl",mih:200,style:{pointerEvents:"none"},children:[e.jsx(Ee.Accept,{children:e.jsx(Ps,{size:50,stroke:1.5})}),e.jsx(Ee.Reject,{children:e.jsx(Ne,{size:50,stroke:1.5})}),e.jsx(Ee.Idle,{children:e.jsx(xt,{size:50,stroke:1.5})}),e.jsxs("div",{children:[e.jsx(P,{size:"xl",inline:!0,children:"Drag schema here or click to select file"}),e.jsx(P,{size:"sm",c:"dimmed",inline:!0,mt:7,children:"Import files must be generated by the schema export function"}),a&&e.jsx(P,{c:"red",inline:!0,mt:7,children:a})]})]})})}const Fl="_button_1jnqc_1",_l="_menuControl_1jnqc_11",Ct={button:Fl,menuControl:_l};function gt({children:t,options:s=[],onClick:l,loading:n,menu:r,...a}){return e.jsxs(k,{wrap:"nowrap",gap:0,children:[e.jsx(E,{loading:n,onClick:l,...a,className:Ct.button,children:t}),e.jsxs(R,{disabled:n,transitionProps:{transition:"pop"},position:"bottom-end",...r,withinPortal:!0,children:[e.jsx(R.Target,{children:e.jsx(A,{...a,size:36,className:Ct.menuControl,children:e.jsx(jt,{style:{width:F(16),height:F(16)},stroke:1.5})})}),e.jsx(R.Dropdown,{children:s.map(({label:o,onClick:d,...i},x)=>e.jsx(R.Item,{onClick:d?()=>{d(o)}:void 0,...i,children:o},x))})]})]})}function Rl({save:t,saving:s}){const l=oe(),{schema:n,changeSchema:r}=f.useContext(M),{Modal:a,opened:o,open:d,close:i}=Dl("Import Schema"),{del:x,loading:c}=N({url:`/schema/${n==null?void 0:n.name}`,then:()=>r(void 0)}),p=()=>dt.openConfirmModal({title:"Delete Schema",centered:!0,children:e.jsx(P,{size:"sm",children:"Are you sure you want to delete this schema? This action is destructive and cannot be reversed."}),labels:{confirm:"Delete schema",cancel:"No don't delete it"},confirmProps:{color:"red"},onConfirm:()=>x()}),y=JSON.parse(JSON.parse(localStorage.getItem("auth")||"")||{}),u=new URL(window.location.href);return e.jsxs(e.Fragment,{children:[o&&e.jsx(a,{children:e.jsx(Nl,{close:i})}),e.jsx(gt,{loading:s||c,variant:"light",onClick:t,options:[{component:"a",href:`http://${u.hostname}:2327/api/v1/schema/${n==null?void 0:n.name}/export/${y.session}`,label:"Export",leftSection:e.jsx($s,{size:16,color:l.colors.green[5]})},{onClick:()=>d(),label:"Import",leftSection:e.jsx(zs,{size:16,color:l.colors.orange[5]})},{onClick:()=>p(),label:"Delete",leftSection:e.jsx(W,{size:16,color:l.colors.red[5]})}],children:"Save"})]})}function El(){const{schema:t,mutate:s}=f.useContext(M),l=pe({initialValues:t,validate:{name:a=>Gt(a)?null:"Invalid schema name"}}),{put:n,loading:r}=N({url:`/schema/${t==null?void 0:t.name}`,data:l.values,before:()=>l.validate(),check:()=>!l.isValid(),catch:({validation:a})=>l.setErrors(a),then:()=>{s(l.values),T.show({title:"Success",message:"Settings Saved.",color:"lime"})}});return e.jsx(Se,{label:e.jsx(ve,{rightSection:e.jsx(Rl,{saving:r,save:n}),children:"Schema Settings"}),children:e.jsx(C,{label:"Schema Name",placeholder:"Schema Name",leftSection:e.jsx(ye,{size:16,style:{display:"block",opacity:.5}}),withAsterisk:!0,...l.getInputProps("name")})})}const fe={ldap:{id:"ldap",name:"Lightweight Directory Access Protocol (LDAP)",icon:Pe,color:"blue"},csv:{id:"csv",name:"Comma-Separated Values (CSV)",icon:As,color:"teal"},stmc:{id:"stmc",name:"eduSTAR Management Centre (STMC)",icon:We,color:"red"},proxy:{id:"proxy",name:"Corporate Proxy Server",icon:ot,color:"orange"}},Ol="_card_1ybk5_1",Ll="_title_1ybk5_9",Ul="_item_1ybk5_19",Ze={card:Ol,title:Ll,item:Ul};function Vl({opened:t,close:s,add:l}){const n=oe();return e.jsx(xe,{size:"lg",styles:{content:{backgroundColor:"transparent"},body:{padding:0,margin:0}},opened:t,onClose:s,withCloseButton:!1,children:e.jsxs(as,{mih:300,withBorder:!0,radius:"md",className:Ze.card,children:[e.jsx(k,{justify:"space-between",children:e.jsx(P,{className:Ze.title,children:"Select a provider"})}),e.jsx(He,{cols:2,mt:"md",children:Object.values(fe).map(r=>e.jsxs(Ae,{onClick:()=>l(r.id),className:Ze.item,children:[e.jsx(r.icon,{color:n.colors[r.color][6],size:"2rem"}),e.jsx(P,{size:"xs",mt:7,children:r.name})]},r.id))})]})})}const Ml={csv:{name:"MyCSV",path:""},proxy:{name:"ProxyServer",url:"",username:"",password:""},ldap:{name:"ActiveDirectory",url:"",username:"",password:"",base:"",attributes:[]},stmc:{name:"",username:"",password:"",school:"",cache:1440}},ql={csv:{name:Q("Name can not be empty."),path:Le({min:2},"Path must be at least 2 characters long.")},proxy:{name:Q("Name can not be empty."),url:Le({min:3},"URL must be at least 3 characters long.")},ldap:{name:Q("Name can not be empty."),url:Le({min:3},"URL must be at least 3 characters long."),username:Q("Username can not be empty."),password:Q("Password can not be empty.")},stmc:{name:Q("Name can not be empty."),username:Q("Username can not be empty."),password:Q("Password can not be empty."),school:Q("School ID can not be empty.")}};function Bl({form:t}){return e.jsxs(e.Fragment,{children:[e.jsx(C,{label:"Connector Name",leftSection:e.jsx(ye,{size:16,style:{display:"block",opacity:.5}}),placeholder:"File Name",withAsterisk:!0,...t.getInputProps("name")}),e.jsx(C,{label:"File Path",leftSection:e.jsx($e,{size:16,style:{display:"block",opacity:.5}}),placeholder:"C:/folder/input.csv",withAsterisk:!0,...t.getInputProps("path"),mt:"md"})]})}function ne({children:t,label:s="Advanced",rightSection:l,open:n=!1,Icon:r=pt,...a}){const[o,{toggle:d}]=le(n);return e.jsxs(I,{children:[e.jsxs(k,{justify:"space-between",grow:!0,children:[e.jsx(Ae,{mt:10,onClick:d,children:e.jsxs(k,{gap:2,children:[e.jsx(P,{...a,children:s}),e.jsx(r,{size:14,style:{transform:o?"rotate(90deg)":"none"}})]})}),l]}),e.jsx(Dt,{in:o,children:t})]})}function bt({selectable:t=[],value:s="",onChange:l,createLabel:n}){const r=Nt({onDropdownClose:()=>r.resetSelectedOption()}),a=s?[...t,s].filter(function(j,v,D){return D.indexOf(j)==v}):t,[o,d]=f.useState(a),[i,x]=f.useState(s||null),[c,p]=f.useState(s||"");f.useEffect(()=>{p(s)},[s]);const y=o.some(j=>j===c),S=(y?o:o.filter(j=>j.toLowerCase().includes(c.toLowerCase().trim()))).map(j=>e.jsx(J.Option,{value:j,children:j},j));return e.jsxs(J,{store:r,withinPortal:!1,onOptionSubmit:j=>{j==="$create"?(d(v=>[...v,c]),x(c),l&&l(c)):(x(j),l&&l(j)),r.closeDropdown()},children:[e.jsx(J.Target,{children:e.jsx(Ft,{rightSection:e.jsx(J.Chevron,{}),value:c,onChange:j=>{r.openDropdown(),r.updateSelectedOptionIndex(),p(j.currentTarget.value)},onClick:()=>r.openDropdown(),onFocus:()=>r.openDropdown(),onBlur:()=>{r.closeDropdown(),p(s||i||"")},placeholder:"Search value",rightSectionPointerEvents:"none"})}),(o.length>0||c.length>0)&&e.jsx(J.Dropdown,{children:e.jsxs(J.Options,{children:[S,!y&&c.trim().length>0&&e.jsx(J.Option,{value:"$create",children:n?n(c):` + Create ${c}`})]})})]})}function re({onChange:t,value:s="",placeholder:l,...n}){const{connectors:r,_connectors:a}=f.useContext(M),o=oe(),d=Nt({onDropdownClose:()=>d.resetSelectedOption()}),[i,x]=f.useState(s||null);f.useEffect(()=>x(s),[s]);const c=s in a&&fe[a[s].id],p=c&&e.jsx(c.icon,{color:o.colors[c.color][6],size:20,stroke:1.5}),y=r||[];n.type&&(n.filter=j=>j.filter(v=>v.id===n.type));const u=(n.filter?n.filter(y):y).map(j=>{const v=fe[j.id];return{component:e.jsxs(k,{children:[e.jsx(v.icon,{color:o.colors[v.color][6],size:20,stroke:1.5})," ",j.name]}),value:j.name}}),S=(n.data||u).map(j=>{const v=typeof j=="string";return e.jsx(J.Option,{value:v?j:j.value,children:v?j:j.component},v?j:j.value)});return e.jsx(Ue.Wrapper,{...n,children:e.jsxs(J,{store:d,withinPortal:!1,onOptionSubmit:j=>{x(j),t&&t(j),d.closeDropdown()},children:[e.jsx(J.Target,{children:e.jsx(Ft,{component:"button",type:"button",pointer:!0,leftSection:n.leftSection===!1?void 0:n.leftSection?n.leftSection:p||e.jsx(Lt,{size:16,style:{display:"block",opacity:.5}}),mt:n.label?5:void 0,rightSection:n.clearable&&i!==null?e.jsx(is,{size:"sm",onMouseDown:j=>j.preventDefault(),onClick:()=>{x(null),t&&t(void 0)},"aria-label":"Clear value"}):e.jsx(J.Chevron,{}),onClick:()=>d.toggleDropdown(),rightSectionPointerEvents:!n.clearable||i===null?"none":"all",children:i||e.jsx(Ue.Placeholder,{children:l||"Select Connector"})})}),e.jsx(J.Dropdown,{children:e.jsx(J.Options,{children:S})})]})})}function et({form:t,index:s,explorer:l,actionType:n}){return e.jsxs(I,{p:"xs",pt:0,children:[e.jsx(re,{label:"Target Directory",withAsterisk:!0,clearable:!0,leftSection:e.jsx(Pe,{size:"1rem"}),...t.getInputProps(`${n}.${s}.target`),type:"ldap"}),e.jsx(C,{label:"User Principal Name",withAsterisk:!0,leftSection:e.jsx(Ke,{size:16,style:{display:"block",opacity:.8}}),placeholder:"{{username}}@domain.com",...t.getInputProps(`${n}.${s}.upn`),rightSection:l("upn")})]})}function Tl({form:t,index:s,explore:l,actionType:n}){const r=t.values[n],a=r[s].groups||[],o=i=>()=>l(()=>x=>t.setFieldValue(`${n}.${s}.groups.${i}`,`${r[s].groups[i]||""}{{${x}}}`)),d=i=>e.jsx(A,{onClick:o(i),variant:"subtle",children:e.jsx(je,{size:16,style:{display:"block",opacity:.8}})});return e.jsxs(e.Fragment,{children:[a.length===0&&e.jsx(de,{c:"dimmed",fz:"xs",children:"No security groups configured."}),e.jsx(X,{onDragEnd:({destination:i,source:x})=>t.reorderListItem(`${n}.${s}.groups`,{from:x.index,to:i?i.index:0}),children:e.jsx(ie,{droppableId:"dnd-list",direction:"vertical",children:i=>e.jsxs("div",{...i.droppableProps,style:{top:"auto",left:"auto"},ref:i.innerRef,children:[a.map((x,c)=>e.jsx(ce,{index:c,draggableId:c.toString(),children:p=>e.jsxs(b,{gutter:"xs",align:"center",ref:p.innerRef,mt:"xs",...p.draggableProps,style:{...p.draggableProps.style,left:"auto !important",top:"auto !important"},children:[e.jsx(b.Col,{span:"content",style:{cursor:"grab"},...p.dragHandleProps,children:e.jsx(k,{children:e.jsx(ae,{size:"1.2rem"})})}),e.jsx(b.Col,{span:"auto",children:e.jsx(C,{placeholder:"CN={{faculty}},OU={{faculty}},OU=Child,OU=Parent",...t.getInputProps(`${n}.${s}.groups.${c}`),rightSection:d(c)})}),e.jsx(b.Col,{span:"content",children:e.jsx(k,{gap:0,justify:"flex-end",children:e.jsx(A,{onClick:()=>t.removeListItem(`${n}.${s}.groups`,c),variant:"subtle",color:"red",children:e.jsx(W,{size:"1.2rem",stroke:1.5})})})})]})},c)),i.placeholder]})})})]})}function Hl({form:t,index:s,explore:l,actionType:n}){const r=t.values[n],a=r[s].attributes||[],o=(i,x)=>()=>l(()=>c=>t.setFieldValue(`${n}.${s}.attributes.${x}.${i}`,`${r[s].attributes[x][i]||""}{{${c}}}`)),d=(i,x)=>e.jsx(A,{onClick:o(i,x),variant:"subtle",children:e.jsx(je,{size:16,style:{display:"block",opacity:.8}})});return e.jsxs(e.Fragment,{children:[a.length===0&&e.jsx(de,{c:"dimmed",fz:"xs",children:"No attributes configured."}),e.jsx(X,{onDragEnd:({destination:i,source:x})=>t.reorderListItem(`${n}.${s}.attributes`,{from:x.index,to:i?i.index:0}),children:e.jsx(ie,{droppableId:"dnd-list",direction:"vertical",children:i=>e.jsxs("div",{...i.droppableProps,style:{top:"auto",left:"auto"},ref:i.innerRef,children:[a.map((x,c)=>e.jsx(ce,{index:c,draggableId:c.toString(),children:p=>e.jsxs(b,{gutter:"xs",align:"center",ref:p.innerRef,mt:"xs",...p.draggableProps,style:{...p.draggableProps.style,left:"auto !important",top:"auto !important"},children:[e.jsx(b.Col,{span:"content",style:{cursor:"grab"},...p.dragHandleProps,children:e.jsx(k,{children:e.jsx(ae,{size:"1.2rem"})})}),e.jsx(b.Col,{span:"auto",children:e.jsx(bt,{selectable:ft,...t.getInputProps(`${n}.${s}.attributes.${c}.name`),createLabel:y=>`Add Custom Attribute: ${y}`})}),e.jsx(b.Col,{span:"auto",children:e.jsx(C,{placeholder:"Value",...t.getInputProps(`${n}.${s}.attributes.${c}.value`),rightSection:d("value",c)})}),e.jsx(b.Col,{span:"content",children:e.jsx(k,{gap:0,justify:"flex-end",children:e.jsx(A,{onClick:()=>t.removeListItem(`${n}.${s}.attributes`,c),variant:"subtle",color:"red",children:e.jsx(W,{size:"1.2rem",stroke:1.5})})})})]})},c)),i.placeholder]})})})]})}function Wl({form:t,index:s,explorer:l,explore:n,actionType:r}){const a=t.values[r];a[s].attributes||t.setFieldValue(`${r}.${s}.attributes`,[]),a[s].groups||t.setFieldValue(`${r}.${s}.groups`,[]);const o=()=>t.insertListItem(`${r}.${s}.attributes`,{name:"",value:""}),d=()=>t.insertListItem(`${r}.${s}.groups`,"");return e.jsxs(I,{p:"xs",pt:0,children:[e.jsx(re,{label:"Target Directory",withAsterisk:!0,clearable:!0,leftSection:e.jsx(Pe,{size:"1rem"}),...t.getInputProps(`${r}.${s}.target`),type:"ldap"}),e.jsx(C,{label:"Canonical Name",withAsterisk:!0,leftSection:e.jsx(_e,{size:16,style:{display:"block",opacity:.8}}),placeholder:"{{username}}",...t.getInputProps(`${r}.${s}.cn`),rightSection:l("cn")}),e.jsx(C,{label:"User Principal Name",withAsterisk:!0,leftSection:e.jsx(Ke,{size:16,style:{display:"block",opacity:.8}}),placeholder:"{{username}}@domain.com",...t.getInputProps(`${r}.${s}.upn`),rightSection:l("upn")}),e.jsx(C,{label:"SAM Account Name",withAsterisk:!0,leftSection:e.jsx(Ds,{size:16,style:{display:"block",opacity:.8}}),placeholder:"{{username}}",...t.getInputProps(`${r}.${s}.sam`),rightSection:l("sam")}),e.jsx(C,{label:"Organizational Unit",withAsterisk:!0,leftSection:e.jsx($e,{size:16,style:{display:"block",opacity:.8}}),placeholder:"ou={{faculty}},ou=child,ou=parent",...t.getInputProps(`${r}.${s}.ou`),rightSection:l("ou")}),e.jsx(C,{label:"Password",leftSection:e.jsx(ee,{size:16,style:{display:"block",opacity:.8}}),placeholder:"{{word}}{{rand 1 9}}{{cap (word)}}{{special}}",...t.getInputProps(`${r}.${s}.password`),rightSection:l("password")}),e.jsx(O,{label:"User Enabled",disabled:a[s].password==="",mt:"xs",...t.getInputProps(`${r}.${s}.enable`,{type:"checkbox"})}),e.jsx(ne,{open:!0,label:"Attributes",rightSection:e.jsx(E,{onClick:()=>o(),maw:50,variant:"light",size:"compact-xs",mt:10,children:"Add"}),children:e.jsx(Hl,{form:t,index:s,explore:n,actionType:r})}),e.jsx(ne,{open:!0,label:"Security Groups",rightSection:e.jsx(E,{onClick:()=>d(),maw:50,variant:"light",size:"compact-xs",mt:10,children:"Add"}),children:e.jsx(Tl,{form:t,index:s,explore:n,actionType:r})})]})}function Kl({form:t,index:s,explore:l,actionType:n}){const r=t.values[n],a=r[s].attributes||[],o=(i,x)=>()=>l(()=>c=>t.setFieldValue(`${n}.${s}.attributes.${x}.${i}`,`${r[s].attributes[x][i]||""}{{${c}}}`)),d=(i,x)=>e.jsx(A,{onClick:o(i,x),variant:"subtle",children:e.jsx(je,{size:16,style:{display:"block",opacity:.8}})});return e.jsxs(e.Fragment,{children:[a.length===0&&e.jsx(de,{c:"dimmed",fz:"xs",children:"No attributes configured."}),e.jsx(X,{onDragEnd:({destination:i,source:x})=>t.reorderListItem(`${n}.${s}.attributes`,{from:x.index,to:i?i.index:0}),children:e.jsx(ie,{droppableId:"dnd-list",direction:"vertical",children:i=>e.jsxs("div",{...i.droppableProps,style:{top:"auto",left:"auto"},ref:i.innerRef,children:[a.map((x,c)=>e.jsx(ce,{index:c,draggableId:c.toString(),children:p=>e.jsxs(b,{gutter:"xs",align:"center",ref:p.innerRef,mt:"xs",...p.draggableProps,style:{...p.draggableProps.style,left:"auto !important",top:"auto !important"},children:[e.jsx(b.Col,{span:"content",style:{cursor:"grab"},...p.dragHandleProps,children:e.jsx(k,{children:e.jsx(ae,{size:"1.2rem"})})}),e.jsx(b.Col,{span:2,children:e.jsx(he,{defaultValue:"Replace",data:["Add","Replace","Delete"],...t.getInputProps(`${n}.${s}.attributes.${c}.type`)})}),e.jsx(b.Col,{span:"auto",children:e.jsx(bt,{selectable:ft,...t.getInputProps(`${n}.${s}.attributes.${c}.name`),createLabel:y=>`Add Custom Attribute: ${y}`})}),r[s].attributes[c].type!=="Delete"&&e.jsx(b.Col,{span:"auto",children:e.jsx(C,{placeholder:"Value",...t.getInputProps(`${n}.${s}.attributes.${c}.value`),rightSection:d("value",c)})}),e.jsx(b.Col,{span:"content",children:e.jsx(k,{gap:0,justify:"flex-end",children:e.jsx(A,{onClick:()=>t.removeListItem(`${n}.${s}.attributes`,c),variant:"subtle",color:"red",children:e.jsx(W,{size:"1.2rem",stroke:1.5})})})})]})},c)),i.placeholder]})})})]})}function Gl({form:t,index:s,explore:l,explorer:n,actionType:r}){const a=t.values[r];a[s].attributes||t.setFieldValue(`${r}.${s}.attributes`,[]),a[s].groups||t.setFieldValue(`${r}.${s}.groups`,[]);const o=()=>t.insertListItem(`${r}.${s}.attributes`,{name:"",value:"",type:"Replace"});return e.jsxs(I,{p:"xs",pt:0,children:[e.jsx(re,{label:"Target Directory",withAsterisk:!0,clearable:!0,leftSection:e.jsx(Pe,{size:"1rem"}),...t.getInputProps(`${r}.${s}.target`),type:"ldap"}),e.jsx(C,{label:"User Principal Name",withAsterisk:!0,leftSection:e.jsx(Ke,{size:16,style:{display:"block",opacity:.8}}),placeholder:"{{username}}@domain.com",...t.getInputProps(`${r}.${s}.upn`),rightSection:n("upn")}),e.jsx(ne,{open:!0,label:"Attributes",rightSection:e.jsx(E,{onClick:()=>o(),maw:50,variant:"light",size:"compact-xs",mt:10,children:"Add"}),children:e.jsx(Kl,{form:t,index:s,explore:l,actionType:r})})]})}function Jl({form:t,index:s,explorer:l,actionType:n}){return e.jsxs(I,{p:"xs",pt:0,children:[e.jsx(re,{label:"Target Directory",withAsterisk:!0,clearable:!0,leftSection:e.jsx(Pe,{size:"1rem"}),...t.getInputProps(`${n}.${s}.target`),type:"ldap"}),e.jsx(C,{label:"User Principal Name",withAsterisk:!0,leftSection:e.jsx(Ke,{size:16,style:{display:"block",opacity:.8}}),placeholder:"{{username}}@domain.com",...t.getInputProps(`${n}.${s}.upn`),rightSection:l("upn")}),e.jsx(C,{label:"Organizational Unit",withAsterisk:!0,leftSection:e.jsx($e,{size:16,style:{display:"block",opacity:.8}}),placeholder:"ou={{faculty}},ou=child,ou=parent",...t.getInputProps(`${n}.${s}.ou`),rightSection:l("ou")})]})}function Xl({form:t,index:s,explorer:l,actionType:n}){return e.jsxs(I,{p:"xs",pt:0,children:[e.jsx(C,{label:"Source File",withAsterisk:!0,description:"Path of file to use as template.",placeholder:"D:/templates/input/user_template.pdf",leftSection:e.jsx(Ut,{size:16,style:{display:"block",opacity:.8}}),...t.getInputProps(`${n}.${s}.source`),rightSection:l("source")}),e.jsx(C,{label:"Target File",withAsterisk:!0,description:"Path of file to be written.",placeholder:"D:/templates/ouput/{{username}}.pdf",...t.getInputProps(`${n}.${s}.target`),leftSection:e.jsx(Ns,{size:16,style:{display:"block",opacity:.8}}),rightSection:l("target")})]})}function Yl({form:t,index:s,explorer:l,actionType:n}){const{data:r,loading:a}=N({url:"/printers",fetch:!0,default:[],mutate:c=>c.map(p=>p.name)}),d=t.values[n][s].target,x=(d?[...r,d]:r).filter((c,p,y)=>p===y.findIndex(u=>u===c));return e.jsxs(I,{p:"xs",pt:0,children:[e.jsx(C,{label:"Source File",withAsterisk:!0,description:"Path of file to print",placeholder:"D:/templates/ouput/{{username}}.pdf",leftSection:e.jsx(xt,{size:16,style:{display:"block",opacity:.8}}),...t.getInputProps(`${n}.${s}.source`),rightSection:l("source")}),e.jsx(O,{label:"Validate Source Path",mt:"xs",...t.getInputProps(`${n}.${s}.validate`,{type:"checkbox"})}),e.jsx(he,{label:"Target Printer",withAsterisk:!0,clearable:!0,description:"Leave blank to use the systemsdefault printer.",leftSection:a?e.jsx(we,{size:"xs"}):e.jsx(Vt,{size:16,style:{display:"block",opacity:.8}}),placeholder:"Select Printer",...t.getInputProps(`${n}.${s}.target`),data:x})]})}function Ql({form:t,index:s,explorer:l,actionType:n}){return e.jsxs(I,{p:"xs",pt:0,children:[e.jsx(C,{label:"Source File",withAsterisk:!0,description:"Path of original file to be copied.",placeholder:"D:/source/{{username}}.txt",...t.getInputProps(`${n}.${s}.source`),leftSection:e.jsx(Fs,{size:16,style:{display:"block",opacity:.8}}),rightSection:l("source")}),e.jsx(O,{label:"Validate Path",mt:"xs",...t.getInputProps(`${n}.${s}.validate`,{type:"checkbox"})}),e.jsx(C,{label:"Target File",withAsterisk:!0,description:"Destination path where copy will be placed.",placeholder:"E:/destination/{{username}}.txt",...t.getInputProps(`${n}.${s}.target`),leftSection:e.jsx(Mt,{size:16,style:{display:"block",opacity:.8}}),rightSection:l("target")}),e.jsx(O,{label:"Should Overwrite",mt:"xs",...t.getInputProps(`${n}.${s}.overwrite`,{type:"checkbox"})})]})}function Zl({form:t,index:s,explorer:l,actionType:n}){return e.jsxs(I,{p:"xs",pt:0,children:[e.jsx(C,{label:"Source File",withAsterisk:!0,description:"Path of file to be moved.",placeholder:"D:/source/{{username}}.txt",...t.getInputProps(`${n}.${s}.source`),leftSection:e.jsx(_s,{size:16,style:{display:"block",opacity:.8}}),rightSection:l("source")}),e.jsx(O,{label:"Validate Path",mt:"xs",...t.getInputProps(`${n}.${s}.validate`,{type:"checkbox"})}),e.jsx(C,{label:"Target File",withAsterisk:!0,description:"Destination path where file will be placed.",placeholder:"E:/destination/{{username}}.txt",...t.getInputProps(`${n}.${s}.target`),leftSection:e.jsx(Mt,{size:16,style:{display:"block",opacity:.8}}),rightSection:l("target")}),e.jsx(O,{label:"Should Overwrite",mt:"xs",...t.getInputProps(`${n}.${s}.overwrite`,{type:"checkbox"})})]})}function en({form:t,index:s,explorer:l,actionType:n}){return e.jsxs(I,{p:"xs",pt:0,children:[e.jsx(C,{label:"Target File",withAsterisk:!0,description:"Path of file to be deleted.",placeholder:"D:/templates/ouput/{{username}}.pdf",...t.getInputProps(`${n}.${s}.target`),leftSection:e.jsx(qt,{size:16,style:{display:"block",opacity:.8}}),rightSection:l("target")}),e.jsx(O,{label:"Validate Path",mt:"xs",...t.getInputProps(`${n}.${s}.validate`,{type:"checkbox"})})]})}function tn({form:t,index:s,explorer:l,actionType:n}){return e.jsxs(I,{p:"xs",pt:0,children:[e.jsx(C,{label:"Source Folder",withAsterisk:!0,description:"Path of original folder to be copied.",placeholder:"D:/source/public/",...t.getInputProps(`${n}.${s}.source`),leftSection:e.jsx(Rs,{size:16,style:{display:"block",opacity:.8}}),rightSection:l("source")}),e.jsx(O,{label:"Validate Path",mt:"xs",...t.getInputProps(`${n}.${s}.validate`,{type:"checkbox"})}),e.jsx(C,{label:"Target Folder",withAsterisk:!0,description:"Destination path where copy will be placed.",placeholder:"E:/destination/{{username}}/",...t.getInputProps(`${n}.${s}.target`),leftSection:e.jsx(Bt,{size:16,style:{display:"block",opacity:.8}}),rightSection:l("target")}),e.jsx(O,{label:"Should Overwrite",mt:"xs",...t.getInputProps(`${n}.${s}.overwrite`,{type:"checkbox"})})]})}function sn({form:t,index:s,explorer:l,actionType:n}){return e.jsxs(I,{p:"xs",pt:0,children:[e.jsx(C,{label:"Source Folder",withAsterisk:!0,description:"Path of folder to be moved.",placeholder:"D:/source/{{username}}/",...t.getInputProps(`${n}.${s}.source`),leftSection:e.jsx(Es,{size:16,style:{display:"block",opacity:.8}}),rightSection:l("source")}),e.jsx(O,{label:"Validate Path",mt:"xs",...t.getInputProps(`${n}.${s}.validate`,{type:"checkbox"})}),e.jsx(C,{label:"Target Folder",withAsterisk:!0,description:"Destination path where copy will be placed.",placeholder:"E:/destination/{{username}}/",...t.getInputProps(`${n}.${s}.target`),leftSection:e.jsx(Bt,{size:16,style:{display:"block",opacity:.8}}),rightSection:l("target")}),e.jsx(O,{label:"Should Overwrite",mt:"xs",...t.getInputProps(`${n}.${s}.overwrite`,{type:"checkbox"})})]})}function ln({form:t,index:s,explorer:l,actionType:n}){return e.jsxs(I,{p:"xs",pt:0,children:[e.jsx(C,{label:"Target Folder",withAsterisk:!0,description:"Path of folder to be deleted.",placeholder:"D:/temp/{{username}}/",...t.getInputProps(`${n}.${s}.target`),leftSection:e.jsx(qt,{size:16,style:{display:"block",opacity:.8}}),rightSection:l("target")}),e.jsx(O,{label:"Validate Path",mt:"xs",...t.getInputProps(`${n}.${s}.validate`,{type:"checkbox"})})]})}function nn({form:t,index:s,explore:l,actionType:n}){const r=t.values[n];r[s].templates||t.setFieldValue(`${n}.${s}.templates`,[]);const a=()=>t.insertListItem(`${n}.${s}.templates`,{name:"",value:""}),o=r[s].templates||[],d=(x,c)=>()=>l(()=>p=>t.setFieldValue(`${n}.${s}.templates.${c}.${x}`,`${r[s].templates[c][x]||""}{{${p}}}`)),i=(x,c)=>e.jsx(A,{onClick:d(x,c),variant:"subtle",children:e.jsx(je,{size:16,style:{display:"block",opacity:.8}})});return e.jsxs(I,{pt:5,children:[e.jsx(k,{justify:"end",children:e.jsx(E,{onClick:a,variant:"light",size:"compact-xs",children:"Add"})}),e.jsxs(I,{p:"xs",pt:0,children:[o.length===0&&e.jsx(de,{c:"dimmed",fz:"xs",children:"No templates configured."}),e.jsx(X,{onDragEnd:({destination:x,source:c})=>t.reorderListItem(`${n}.${s}.templates`,{from:c.index,to:x?x.index:0}),children:e.jsx(ie,{droppableId:"dnd-list",direction:"vertical",children:x=>e.jsxs("div",{...x.droppableProps,style:{top:"auto",left:"auto"},ref:x.innerRef,children:[o.map((c,p)=>e.jsx(ce,{index:p,draggableId:p.toString(),children:y=>e.jsxs(b,{gutter:"xs",align:"center",ref:y.innerRef,mt:"xs",...y.draggableProps,style:{...y.draggableProps.style,left:"auto !important",top:"auto !important"},children:[e.jsx(b.Col,{span:"content",style:{cursor:"grab"},...y.dragHandleProps,children:e.jsx(k,{children:e.jsx(ae,{size:"1.2rem"})})}),e.jsx(b.Col,{span:"content",children:e.jsx(C,{placeholder:"Name",...t.getInputProps(`${n}.${s}.templates.${p}.name`),rightSection:i("name",p)})}),e.jsx(b.Col,{span:"auto",children:e.jsx(ut,{placeholder:"Value",autosize:!0,maxRows:4,...t.getInputProps(`${n}.${s}.templates.${p}.value`),rightSection:i("value",p)})}),e.jsx(b.Col,{span:"content",children:e.jsx(k,{gap:0,justify:"flex-end",children:e.jsx(A,{onClick:()=>t.removeListItem(`${n}.${s}.templates`,p),variant:"subtle",color:"red",children:e.jsx(W,{size:"1.2rem",stroke:1.5})})})})]})},p)),x.placeholder]})})})]})]})}function rn({form:t,index:s,explorer:l,actionType:n}){return e.jsxs(I,{p:"xs",pt:0,children:[e.jsx(C,{label:"Target File",withAsterisk:!0,description:"Path of file to append text to.",placeholder:"D:/{{group}}/rows.csv",...t.getInputProps(`${n}.${s}.target`),leftSection:e.jsx(Os,{size:16,style:{display:"block",opacity:.8}}),rightSection:l("target")}),e.jsx(O,{label:"Validate Path",mt:"xs",...t.getInputProps(`${n}.${s}.validate`,{type:"checkbox"})}),e.jsx(ut,{mt:"xs",label:"Data",withAsterisk:!0,description:"Text to append to target file.",placeholder:"{{id}},false,0",...t.getInputProps(`${n}.${s}.data`),rightSection:l("data")}),e.jsx(O,{label:"Append New Line",mt:"xs",...t.getInputProps(`${n}.${s}.newline`,{type:"checkbox"})})]})}function on({form:t,index:s,explorer:l,actionType:n}){return e.jsxs(I,{p:"xs",pt:0,children:[e.jsx(C,{label:"Source CSV",withAsterisk:!0,description:"Path of student_bulk_password_reset.csv",placeholder:"D:/passwords/{{username}}/student_bulk_password_reset.csv",...t.getInputProps(`${n}.${s}.source`),leftSection:e.jsx(Ls,{size:16,style:{display:"block",opacity:.8}}),rightSection:l("source")}),e.jsx(O,{label:"Validate Path",mt:"xs",...t.getInputProps(`${n}.${s}.validate`,{type:"checkbox"})}),e.jsx(O,{label:"No headers",mt:"xs",...t.getInputProps(`${n}.${s}.nohead`,{type:"checkbox"})}),e.jsx(re,{label:"Target Endpoint",withAsterisk:!0,clearable:!0,mt:"xs",leftSection:e.jsx(We,{size:"1rem"}),...t.getInputProps(`${n}.${s}.target`),type:"stmc"})]})}function an({form:t,index:s,explorer:l,actionType:n}){return e.jsxs(I,{p:"xs",pt:0,children:[e.jsx(C,{label:"Secret",withAsterisk:!0,description:"String to be encrypted.",placeholder:"My very important secret",...t.getInputProps(`${n}.${s}.source`),leftSection:e.jsx(be,{size:16,style:{display:"block",opacity:.8}}),rightSection:l("source")}),e.jsx(ue,{label:"Encryption Key",withAsterisk:!0,mt:"xs",description:e.jsxs(e.Fragment,{children:["String to encrypt the secret with. ",e.jsx("b",{children:"Warning: this is stored in clear text"})]}),placeholder:"password",...t.getInputProps(`${n}.${s}.password`),leftSection:e.jsx(ee,{size:16,style:{display:"block",opacity:.8}}),rightSection:l("password")}),e.jsx(_t,{mt:"xs",withAsterisk:!0,label:"Encryption Strength",description:e.jsxs(e.Fragment,{children:["How many ",e.jsx("a",{href:"https://en.wikipedia.org/wiki/PBKDF2",target:"_blank",children:"C"})," iterations to use. Direct trade-off between speed and stength of security. "]}),placeholder:"1000",leftSection:e.jsx(Tt,{size:16,style:{display:"block",opacity:.8}}),min:100,defaultValue:100,...t.getInputProps(`${n}.${s}.value`)}),e.jsx(C,{label:"Template Key",withAsterisk:!0,mt:"xs",description:"Encrypted string will be stored in this template key.",placeholder:"encrypted",...t.getInputProps(`${n}.${s}.target`),leftSection:e.jsx(Us,{size:16,style:{display:"block",opacity:.8}}),rightSection:l("target")})]})}function cn({form:t,index:s,explorer:l,actionType:n}){return e.jsxs(I,{p:"xs",pt:0,children:[e.jsx(C,{label:"Target Folder",withAsterisk:!0,description:"Path of folder to be created.",placeholder:"D:/source/{{username}}/",...t.getInputProps(`${n}.${s}.target`),leftSection:e.jsx(Vs,{size:16,style:{display:"block",opacity:.8}}),rightSection:l("target")}),e.jsx(O,{label:"Recursive",description:"All parent folders in the path will be created if they do not already exist.",mt:"xs",...t.getInputProps(`${n}.${s}.recursive`,{type:"checkbox"})})]})}const ft=["name","displayName","givenName","SN","description","title","mail","company","department","manager","postalCode","pager","mobile","homephone","telephoneNumber","facsimileTelephoneNumber","wWWHomePage","ipPhone"],dn=[{label:"== Equal To",value:"=="},{label:"!= Not Equal To",value:"!="},{label:">< Contains",value:"><"},{label:"<> Does Not Contain",value:"<>"},{label:">* Starts With",value:">*"},{label:"*< Ends With",value:"*<"},{label:"// Matches Regex",value:"//"}],un=[{label:"== Equal To",value:"==="},{label:"!= Not Equal To",value:"!=="},{label:">  Greater Than",value:">"},{label:"<  Lesser Than",value:"<"},{label:">= Greater Than, Or Equal To",value:">="},{label:"<= Lesser Than, Or Equal To",value:"<="}],tt=[{label:"String Constraint",id:"string",Icon:Ms,color:"blue"},{label:"Math Constraint",id:"math",Icon:qs,color:"pink"},{label:"Status",id:"status",connector:"ldap",Icon:Bs,color:"yellow"},{label:"Security Group",id:"group",connector:"ldap",Icon:Ts,color:"cyan"},{label:"Organisational Unit",id:"ou",connector:"ldap",Icon:$e,color:"violet"}],hn=[{label:"Directory Operations",id:"directory",requires:["ldap"],Icon:Pe,color:"blue"},{label:"eduSTAR Operations",id:"edustar",Icon:We,requires:["stmc"],color:"yellow"},{label:"Document Operations",id:"document",Icon:Ht,color:"red"},{label:"File Operations",id:"file",Icon:xt,color:"green"},{label:"Folder Operations",id:"folder",Icon:$e,color:"orange"},{label:"System Operations",id:"system",Icon:Hs}],Je={"Create User":{id:"Create User",catagory:"directory",Icon:Ws,color:"blue",Component:Wl},"Enable User":{id:"Enable User",catagory:"directory",Icon:Ks,color:"green",Component:et},"Disable User":{id:"Disable User",catagory:"directory",Icon:Tt,color:"pink",Component:et},"Delete User":{id:"Delete User",catagory:"directory",Icon:W,color:"red",Component:et},"Update Attributes":{id:"Update Attributes",catagory:"directory",Icon:be,color:"orange",Component:Gl},"Move Organisational Unit":{id:"Move Organisational Unit",catagory:"directory",Icon:Gs,color:"grape",Component:Jl},"Write PDF":{id:"Write PDF",catagory:"document",Icon:Ht,color:"red",Component:Xl},"Send To Printer":{id:"Send To Printer",catagory:"document",Icon:Vt,color:"lime",Component:Yl},"Copy File":{id:"Copy File",catagory:"file",Icon:Ie,color:"blue",Component:Ql},"Move File":{id:"Move File",catagory:"file",Icon:vt,color:"orange",Component:Zl},"Delete File":{id:"Delete File",catagory:"file",Icon:W,color:"red",Component:en},"Write To File":{id:"Write To File",catagory:"file",Icon:be,color:"lime",Component:rn},"Copy Folder":{id:"Copy Folder",catagory:"folder",Icon:Ie,color:"blue",Component:tn},"Move Folder":{id:"Move Folder",catagory:"folder",Icon:vt,color:"orange",Component:sn},"Delete Folder":{id:"Delete Folder",catagory:"folder",Icon:W,color:"red",Component:ln},"Create Folder":{id:"Create Folder",catagory:"folder",Icon:ht,color:"lime",Component:cn},Template:{label:"Build Data Template",id:"Template",catagory:"system",Icon:Ut,Component:nn},"Encrypt String":{id:"Encrypt String",catagory:"system",Icon:ee,Component:an},"Upload Student Passwords":{id:"Upload Student Passwords",catagory:"edustar",Icon:Js,color:"yellow",Component:on}};function pn({form:t}){const s=t.values.attributes||[];return e.jsxs(e.Fragment,{children:[s.length===0&&e.jsx(de,{c:"dimmed",fz:"xs",children:"No attributes configured."}),e.jsx(X,{onDragEnd:({destination:l,source:n})=>t.reorderListItem("attributes",{from:n.index,to:l?l.index:0}),children:e.jsx(ie,{droppableId:"dnd-list",direction:"vertical",children:l=>e.jsxs("div",{...l.droppableProps,style:{top:"auto",left:"auto"},ref:l.innerRef,children:[s.map((n,r)=>e.jsx(ce,{index:r,draggableId:r.toString(),children:a=>e.jsxs(b,{gutter:"xs",align:"center",ref:a.innerRef,mt:"xs",...a.draggableProps,style:{...a.draggableProps.style,left:"auto !important",top:"auto !important"},children:[e.jsx(b.Col,{span:"content",style:{cursor:"grab"},...a.dragHandleProps,children:e.jsx(k,{children:e.jsx(ae,{size:"1.2rem"})})}),e.jsx(b.Col,{span:"auto",children:e.jsx(bt,{selectable:ft,...t.getInputProps(`attributes.${r}`),createLabel:o=>`Add Custom Attribute: ${o}`})}),e.jsx(b.Col,{span:"content",children:e.jsx(k,{gap:0,justify:"flex-end",children:e.jsx(A,{onClick:()=>t.removeListItem("attributes",r),variant:"subtle",color:"red",children:e.jsx(W,{size:"1.2rem",stroke:1.5})})})})]})},r)),l.placeholder]})})})]})}function xn({form:t,editing:s}){const l=()=>t.setFieldValue("password",""),n=()=>t.insertListItem("attributes","");return e.jsxs(e.Fragment,{children:[e.jsx(C,{label:"Connector Name",leftSection:e.jsx(ye,{size:16,style:{display:"block",opacity:.5}}),placeholder:"Domain Name",withAsterisk:!0,...t.getInputProps("name")}),e.jsx(C,{label:"Target URL",leftSection:e.jsx(Wt,{size:16,style:{display:"block",opacity:.5}}),placeholder:"ldaps://10.10.1.1:636",withAsterisk:!0,...t.getInputProps("url"),mt:"md"}),e.jsxs(He,{mt:"md",cols:{base:1,sm:2},children:[e.jsx(C,{label:"Username",placeholder:"domain\\administrator",withAsterisk:!0,leftSection:e.jsx(_e,{size:16,style:{display:"block",opacity:.5}}),...t.getInputProps("username")}),typeof t.values.password=="string"||!s?e.jsx(ue,{label:"Password",placeholder:"password",withAsterisk:!0,leftSection:e.jsx(ee,{size:16,style:{display:"block",opacity:.5}}),...t.getInputProps("password")}):e.jsx(ue,{label:"Password",readOnly:!0,placeholder:"Password",value:"**************",leftSection:e.jsx(ee,{size:16,style:{display:"block",opacity:.5}}),rightSection:e.jsx(A,{variant:"subtle",children:e.jsx(mt,{onClick:()=>l(),size:16,style:{display:"block",opacity:.5}})})})]}),e.jsx(ne,{open:!0,label:"Attributes",rightSection:e.jsx(E,{onClick:()=>n(),maw:50,variant:"light",size:"compact-xs",mt:10,children:"Add"}),children:e.jsx(pn,{form:t})}),e.jsxs(ne,{children:[e.jsx(Te,{mt:"md",label:"Specify Root DSE",onChange:r=>t.setFieldValue("dse",r.currentTarget.checked?"":void 0),checked:!!t.values.dse||t.values.dse===""}),(t.values.dse||t.values.dse==="")&&e.jsx(C,{label:"Root DSE",description:"All distinguished names, including the Base Organizational Unit, will be appended by this path.",placeholder:"dc=sub,dc=domain,dc=com",withAsterisk:!0,leftSection:e.jsx(Xs,{size:16,style:{display:"block",opacity:.5}}),...t.getInputProps("dse")}),e.jsx(C,{mt:"md",label:"Base Organizational Unit",description:"All distinguished names will be appended by this path.",placeholder:"ou=child,ou=parent",leftSection:e.jsx($e,{size:16,style:{display:"block",opacity:.5}}),...t.getInputProps("base"),rightSection:e.jsx(A,{variant:"subtle",children:e.jsx(Fe,{size:16,style:{display:"block",opacity:.5}})})})]})]})}function jn({form:t,editing:s}){const l=()=>t.setFieldValue("password","");return e.jsxs(e.Fragment,{children:[e.jsx(C,{label:"Connector Name",leftSection:e.jsx(ye,{size:16,style:{display:"block",opacity:.5}}),placeholder:"Proxy Name",withAsterisk:!0,...t.getInputProps("name")}),e.jsx(C,{label:"Target URL",leftSection:e.jsx(Wt,{size:16,style:{display:"block",opacity:.5}}),placeholder:"http://proxy.server:8080",withAsterisk:!0,...t.getInputProps("url"),mt:"md"}),e.jsxs(He,{mt:"md",cols:{base:1,sm:2},children:[e.jsx(C,{label:"Username",placeholder:"username",...t.getInputProps("username"),leftSection:e.jsx(_e,{size:16,style:{display:"block",opacity:.5}})}),typeof t.values.password=="string"||!s?e.jsx(ue,{label:"Password",placeholder:"password",leftSection:e.jsx(ee,{size:16,style:{display:"block",opacity:.5}}),...t.getInputProps("password")}):e.jsx(ue,{label:"Password",readOnly:!0,placeholder:"Password",value:"**************",leftSection:e.jsx(ee,{size:16,style:{display:"block",opacity:.5}}),rightSection:e.jsx(A,{variant:"subtle",children:e.jsx(mt,{onClick:()=>l(),size:16,style:{display:"block",opacity:.5}})})})]})]})}function mn({form:t,editing:s}){const l=()=>t.setFieldValue("password","");return e.jsxs(e.Fragment,{children:[e.jsx(C,{label:"Connector Name",leftSection:e.jsx(ye,{size:16,style:{display:"block",opacity:.5}}),placeholder:"School Name",withAsterisk:!0,...t.getInputProps("name")}),e.jsxs(He,{mt:"md",cols:{base:1,sm:2},children:[e.jsx(C,{label:"Username",placeholder:"ST01235",withAsterisk:!0,leftSection:e.jsx(_e,{size:16,style:{display:"block",opacity:.5}}),...t.getInputProps("username")}),typeof t.values.password=="string"||!s?e.jsx(ue,{label:"Password",placeholder:"password",withAsterisk:!0,leftSection:e.jsx(ee,{size:16,style:{display:"block",opacity:.5}}),...t.getInputProps("password")}):e.jsx(ue,{label:"Password",readOnly:!0,placeholder:"Password",value:"**************",leftSection:e.jsx(ee,{size:16,style:{display:"block",opacity:.5}}),rightSection:e.jsx(A,{variant:"subtle",children:e.jsx(mt,{onClick:()=>l(),size:16,style:{display:"block",opacity:.5}})})})]}),e.jsx(C,{label:"School Identification Number",leftSection:e.jsx(We,{size:16,style:{display:"block",opacity:.5}}),placeholder:"1234",withAsterisk:!0,...t.getInputProps("school"),mt:"md"}),e.jsxs(ne,{children:[e.jsx(_t,{label:"Caching Policy",description:"Minutes until downloaded cache is purged.",leftSection:e.jsx(Et,{size:16,style:{display:"block",opacity:.5}}),placeholder:"1440 (1 day)",...t.getInputProps("cache"),mt:"md"}),e.jsx(re,{label:"Proxy Connector",placeholder:"Corporate Proxy Server",clearable:!0,...t.getInputProps("proxy"),filter:n=>n.filter(r=>r.id==="proxy"),leftSection:e.jsx(ot,{size:16,style:{display:"block",opacity:.5}}),mt:"md"}),e.jsx(re,{label:"eduHUB Connector",description:"Matches eduHUB usernames to eduSTAR usernames.",placeholder:"ST_8827.csv",clearable:!0,...t.getInputProps("eduhub"),filter:n=>n.filter(r=>r.id==="csv"),leftSection:e.jsx(ot,{size:16,style:{display:"block",opacity:.5}}),mt:"md"})]})]})}function gn({provider:t,form:s,editing:l}){switch(t){case"csv":return e.jsx(Bl,{form:s});case"ldap":return e.jsx(xn,{form:s,editing:l});case"proxy":return e.jsx(jn,{form:s,editing:l});case"stmc":return e.jsx(mn,{form:s,editing:l});default:return e.jsx(e.Fragment,{children:"Invalid Provider."})}}function bn({editing:t,adding:s,close:l}){const{schema:n,mutate:r}=f.useContext(M),a=s?fe[s]:t?fe[t.id]:{id:"",name:""},o=Ml[a.id]||{},d=ql[a.id]||{},i=pe({initialValues:o,validate:d});f.useEffect(()=>{i.reset(),t?i.setValues(t):i.setValues(o),i.setInitialValues(o)},[t,s]);const{post:x,loading:c}=N({url:`/schema/${n==null?void 0:n.name}/connector`,data:{...i.values,id:a.id},before:()=>i.validate(),check:()=>!i.isValid(),catch:({validation:j})=>i.setErrors(j),then:({connectors:j,_connectors:v,headers:D})=>{r({connectors:j,_connectors:v,headers:D}),l(),T.show({title:"Success",message:"Connector Added.",color:"lime"})}}),{put:p,loading:y}=N({url:`/schema/${n==null?void 0:n.name}/connector`,data:{...i.values,id:a.id},before:()=>i.validate(),check:()=>!i.isValid(),catch:({validation:j})=>i.setErrors(j),then:({connectors:j,_connectors:v,headers:D})=>{r({connectors:j,_connectors:v,headers:D}),l(),T.show({title:"Success",message:"Connector Saved.",color:"lime"})}}),u=()=>p({append_url:`/${t==null?void 0:t.name}`}),S=c||y;return e.jsxs(xe,{size:"lg",opened:!!t||!!s,onClose:l,title:a.name,children:[e.jsx(gn,{provider:a.id,form:i,editing:t}),e.jsx(k,{justify:"right",mt:"md",children:e.jsx(E,{loading:S,onClick:t?u:x,variant:"light",type:"submit",children:t?"Save":"Add"})})]})}function fn(){const{schema:t,connectors:s,mutate:l}=f.useContext(M),n=oe(),[r,{open:a,close:o}]=le(!1),[d,i]=f.useState(void 0),[x,c]=f.useState(void 0),p=m=>{c(void 0),i(m)},y=m=>{o(),i(void 0),c(m)},{del:u,request:S}=N({url:`/schema/${t==null?void 0:t.name}/connector`,catch:m=>ge(m),cleanup:!0,then:({connectors:m,_connectors:$,headers:V})=>{l({connectors:m,_connectors:$,headers:V}),T.show({title:"Success",message:"Connector Removed.",color:"lime"})}}),{post:j,request:v}=N({url:`/schema/${t==null?void 0:t.name}/connector`,catch:m=>ge(m),cleanup:!0,then:({connectors:m,_connectors:$,headers:V})=>{l({connectors:m,_connectors:$,headers:V}),T.show({title:"Success",message:"Connector Copied.",color:"lime"})}}),{post:D,request:L}=N({url:`/schema/${t==null?void 0:t.name}/connector`,catch:m=>ge(m),cleanup:!0,then:m=>{T.show({title:"Success",message:`${m} connected successfully.`,color:"lime"})}}),U=m=>D({append_url:`/${m}/test`,loading:m}),Y=m=>dt.openConfirmModal({title:"Permanently Delete Connector",centered:!0,children:e.jsxs(P,{size:"sm",children:["Are you sure you want to delete ",m,"? This action is destructive and cannot be reversed."]}),labels:{confirm:"Delete connector",cancel:"No don't delete it"},confirmProps:{color:"red"},onConfirm:()=>u({append_url:`/${m}`,loading:m})}),_=m=>S.loading===m,K=m=>v.loading===m,z=m=>L.loading===m;if(t)return e.jsxs(Se,{label:e.jsx(ve,{rightSection:e.jsx(E,{onClick:()=>a(),variant:"light",children:"Add"}),children:"Connectors"}),children:[e.jsx(Vl,{add:y,opened:r,close:o}),e.jsx(bn,{editing:d,adding:x,close:()=>{i(void 0),c(void 0)}}),e.jsxs(se,{verticalSpacing:"sm",children:[e.jsx(se.Thead,{children:e.jsxs(se.Tr,{children:[e.jsx(se.Th,{children:"Name"}),e.jsx(se.Th,{children:"Provider"}),e.jsx(se.Th,{})]})}),e.jsx(se.Tbody,{children:s.map(m=>{const $=fe[m.id];return e.jsxs(se.Tr,{children:[e.jsx(se.Td,{children:e.jsxs(k,{miw:100,gap:"sm",children:[e.jsx($.icon,{color:n.colors[$.color][6],size:20,stroke:1.5}),e.jsx(P,{fz:"sm",children:m.name})]})}),e.jsx(se.Td,{children:e.jsx(Pt,{color:n.colors[$.color][6],variant:"light",children:$.name})}),e.jsx(se.Td,{miw:80,children:e.jsxs(k,{gap:0,justify:"flex-end",children:[e.jsx(A,{onClick:()=>U(m.name),loading:z(m.name),variant:"subtle",color:"lime",children:e.jsx(Ys,{style:{width:F(16),height:F(16)},stroke:1.5})}),e.jsx(A,{onClick:()=>p(m),variant:"subtle",color:"orange",children:e.jsx(be,{style:{width:F(16),height:F(16)},stroke:1.5})}),e.jsx(A,{onClick:()=>j({append_url:`/${m.name}/copy`,loading:m.name}),loading:K(m.name),variant:"subtle",color:"indigo",children:e.jsx(Ie,{style:{width:F(16),height:F(16)},stroke:1.5})}),e.jsx(A,{onClick:()=>Y(m.name),loading:_(m.name),variant:"subtle",color:"red",children:e.jsx(W,{style:{width:F(16),height:F(16)},stroke:1.5})})]})})]},m.name)})})]})]})}const Xe=f.createContext({explorer:e.jsx(e.Fragment,{}),explore:()=>{},close:()=>{}});function yn({form:t}){const{connectors:s}=f.useContext(M),{explorer:l,explore:n}=f.useContext(Xe),r=s.filter(c=>c.id!=="proxy").length-1,{headers:a}=f.useContext(M),o=()=>t.insertListItem("secondaries",{primary:"",secondaryKey:"",primaryKey:""}),d=c=>t.removeListItem("secondaries",c),i=(t.values.secondaries||[]).map(c=>c.primary),x=()=>c=>t.setFieldValue("display",`${t.values.display||""}{{${c}}}`);return e.jsxs(I,{children:[l,e.jsx(C,{label:"Rule Name",leftSection:e.jsx(ye,{size:16,style:{display:"block",opacity:.5}}),placeholder:"Rule Name",withAsterisk:!0,mb:"xs",...t.getInputProps("name")}),e.jsxs(b,{children:[e.jsx(b.Col,{span:8,children:e.jsx(re,{label:"Primary Data Source",withAsterisk:!0,description:"Rule conditions will be evaluated for each entry in this connector. For each row, each user, etc.",clearable:!0,...t.getInputProps("primary"),filter:c=>c.filter(p=>p.id!=="proxy")})}),e.jsx(b.Col,{span:4,children:e.jsx(he,{label:"Primary Key",withAsterisk:!0,description:"Unique identifier for each row.",placeholder:"id",data:t.values.primary in a?a[t.values.primary]:[],disabled:!t.values.primary,clearable:!0,searchable:!0,leftSection:e.jsx(ee,{size:"1rem"}),...t.getInputProps("primaryKey")})})]}),e.jsxs(k,{grow:!0,justify:"apart",mb:"xs",gap:"xs",children:[e.jsx(P,{size:"sm",children:"Secondary Data Sources"}),e.jsx(k,{justify:"right",gap:"xs",pt:"xs",children:e.jsx(A,{size:"lg",variant:"default",disabled:!t.values.primary||i.length>=r,onClick:o,children:e.jsx(ht,{size:15,stroke:1.5})})})]}),e.jsx(X,{onDragEnd:({destination:c,source:p})=>t.reorderListItem("secondaries",{from:p.index,to:c?c.index:0}),children:e.jsx(ie,{droppableId:"dnd-list",direction:"vertical",children:c=>e.jsx("div",{...c.droppableProps,style:{top:"auto",left:"auto"},ref:c.innerRef,children:(t.values.secondaries||[]).map(({primary:p},y)=>e.jsx(ce,{index:y,draggableId:y.toString(),children:u=>e.jsxs(b,{align:"center",ref:u.innerRef,mt:"xs",...u.draggableProps,gutter:"xs",style:{...u.draggableProps.style,left:"auto !important",top:"auto !important"},children:[e.jsx(b.Col,{span:"content",style:{cursor:"grab"},...u.dragHandleProps,children:e.jsx(k,{children:e.jsx(ae,{size:"1.2rem"})})}),e.jsx(b.Col,{span:"auto",children:e.jsx(re,{clearable:!0,...t.getInputProps(`secondaries.${y}.primary`),filter:S=>S.filter(j=>j.id!=="proxy"&&j.name!==t.values.primary&&!i.includes(j.name))})}),e.jsx(b.Col,{span:"auto",children:e.jsx(he,{clearable:!0,searchable:!0,placeholder:"Foreign Key",leftSection:e.jsx(ee,{size:"1rem"}),disabled:!p,data:p in a?a[p]:[],...t.getInputProps(`secondaries.${y}.secondaryKey`)})}),e.jsx(b.Col,{span:"auto",children:e.jsx(he,{clearable:!0,searchable:!0,placeholder:"Primary Key",leftSection:e.jsx(ee,{size:"1rem"}),disabled:!p,data:t.values.primary in a?a[t.values.primary]:[],...t.getInputProps(`secondaries.${y}.primaryKey`)})}),e.jsx(b.Col,{span:"content",children:e.jsx(k,{justify:"right",gap:"xs",children:e.jsx(A,{color:"red",onClick:()=>d(y),variant:"default",size:"lg",children:e.jsx(W,{size:15})})})})]})},y))})})}),e.jsx(C,{label:"Entry Display Name",description:"Displayed on each result row to identify each entry.",leftSection:e.jsx(Qs,{size:16,style:{display:"block",opacity:.5}}),placeholder:"{{username}}",mt:"xs",mb:"xs",rightSection:e.jsx(A,{onClick:()=>n(x),variant:"subtle",children:e.jsx(je,{size:16,style:{display:"block",opacity:.8}})}),...t.getInputProps("display")}),e.jsx(O,{...t.getInputProps("enabled",{type:"checkbox"}),label:"Rule Enabled"}),e.jsx(ut,{label:"Rule Description",placeholder:"Describe what this rule does",mt:"xs",...t.getInputProps("description")})]})}const vn=[{label:"Member of group",value:"member"},{label:"Not member of group",value:"notmember"}],Sn=[{label:"Child of organisational unit",value:"child"},{label:"Not child of organisational unit",value:"notchild"}],Cn=[{label:"Exists on",value:"exists"},{label:"Does not exist on",value:"notexists"},{label:"Enabled on ",value:"enabled"},{label:"Disabled on",value:"disabled"}],kn=["status"],kt=[];function wn({form:t,index:s,modifyCondition:l,delimit:n,delimited:r}){const a=r(s,"")?e.jsx(Zs,{size:16,style:{display:"block",opacity:.8}}):e.jsx(el,{size:16,style:{display:"block",opacity:.8}});return e.jsx(C,{placeholder:"Value",...t.getInputProps(`conditions.${s}.value`),rightSection:e.jsxs(E.Group,{style:{marginRight:30},children:[e.jsxs(R,{position:"bottom-end",children:[e.jsx(R.Target,{children:e.jsx(A,{variant:"subtle",children:a})}),e.jsxs(R.Dropdown,{children:[e.jsx(R.Item,{onClick:n(s,""),disabled:r(s,""),children:"No Delimiter"}),e.jsx(R.Item,{onClick:n(s,","),disabled:r(s,","),children:"Comma ,"}),e.jsx(R.Item,{onClick:n(s,";"),disabled:r(s,";"),children:"Semicolon ;"}),e.jsx(R.Item,{onClick:n(s,"|"),disabled:r(s,"|"),children:"Bar |"}),e.jsx(R.Item,{onClick:n(s,"tab"),disabled:r(s,"tab"),children:"Tab"}),e.jsx(R.Item,{onClick:n(s," "),disabled:r(s," "),children:"Space"})]})]}),e.jsx(A,{variant:"subtle",children:e.jsx(je,{onClick:l("value",s),size:16,style:{display:"block",opacity:.8}})})]})})}function Xt({form:t,label:s}){const l=oe(),{explorer:n,explore:r}=f.useContext(Xe),{_connectors:a}=f.useContext(M),o=(u,S)=>()=>t.insertListItem("conditions",{type:u,key:"",operator:S||(u=="string"||u=="math"?"==":""),value:"",delimiter:""}),d=u=>()=>t.insertListItem("conditions",{...u}),i=u=>()=>t.removeListItem("conditions",u),x=(u,S)=>()=>r(()=>j=>t.setFieldValue(`conditions.${S}.${u}`,`${t.values.conditions[S][u]||""}{{${j}}}`)),c=(u,S)=>()=>t.setFieldValue(`conditions.${u}.delimiter`,S),p=(u,S)=>t.values.conditions[u].delimiter===S,y=t.values.primary in a&&a[t.values.primary].id==="ldap"||(t.values.secondaries||[]).filter(u=>u.primary in a&&a[u.primary].id==="ldap").length>0;return e.jsxs(I,{children:[n,e.jsxs(k,{grow:!0,justify:"apart",mb:"xs",mt:"xs",gap:"xs",children:[e.jsx(P,{c:"dimmed",size:"sm",children:s||"All conditions here will be evaluated and must be true for actions to be executed."}),e.jsx(k,{justify:"right",gap:"xs",children:e.jsxs(R,{position:"bottom-end",children:[e.jsx(R.Target,{children:e.jsx(E,{variant:"light",rightSection:e.jsx(jt,{size:"1.05rem",stroke:1.5}),pr:12,children:"Add condition"})}),e.jsxs(R.Dropdown,{children:[e.jsx(R.Label,{children:"Data Sources"}),tt.filter(u=>!u.connector).map(u=>e.jsx(R.Item,{onClick:o(u.id),leftSection:e.jsx(u.Icon,{color:l.colors[u.color][6],size:"1rem",stroke:1.5}),children:u.label},u.id)),y&&e.jsxs(e.Fragment,{children:[e.jsx(R.Label,{children:"Directory"}),tt.filter(u=>u.connector==="ldap").map(u=>e.jsx(R.Item,{onClick:o(u.id,u.id),leftSection:e.jsx(u.Icon,{color:l.colors[u.color][6],size:"1rem",stroke:1.5}),children:u.label},u.id))]})]})]})})]}),(t.values.conditions||[]).length===0&&e.jsx(P,{c:"lighter",size:"sm",children:"No conditions in effect. Rules must have at least one condition to evaluate."}),e.jsx(X,{onDragEnd:({destination:u,source:S})=>t.reorderListItem("conditions",{from:S.index,to:u?u.index:0}),children:e.jsx(ie,{droppableId:"dnd-list",direction:"vertical",children:u=>e.jsxs("div",{...u.droppableProps,style:{top:"auto",left:"auto"},ref:u.innerRef,children:[(t.values.conditions||[]).map((S,j)=>{const v=tt.filter(D=>D.id===S.type)[0];return e.jsx(ce,{index:j,draggableId:j.toString(),children:D=>e.jsxs(b,{align:"center",ref:D.innerRef,mt:"xs",...D.draggableProps,gutter:"xs",style:{...D.draggableProps.style,left:"auto !important",top:"auto !important"},children:[e.jsx(b.Col,{span:"content",style:{cursor:"grab"},...D.dragHandleProps,children:e.jsx(k,{children:e.jsx(ae,{size:"1.2rem"})})}),e.jsx(b.Col,{span:"content",children:e.jsx(k,{children:e.jsx(Be,{label:v.label,children:e.jsx(v.Icon,{color:l.colors[v.color][6],size:"1.2rem"})})})}),kt.includes(S.type)&&e.jsx(b.Col,{c:"dimmed",span:"content",children:v.label}),S.type==="string"||S.type==="math"?e.jsx(b.Col,{span:"auto",children:e.jsx(C,{placeholder:"Key",...t.getInputProps(`conditions.${j}.key`),rightSection:e.jsx(A,{onClick:x("key",j),variant:"subtle",children:e.jsx(je,{size:16,style:{display:"block",opacity:.8}})})})}):e.jsx(b.Col,{span:"auto",children:e.jsx(re,{clearable:!0,...t.getInputProps(`conditions.${j}.key`),filter:L=>L.filter(U=>U.id==="ldap")})}),!kt.includes(S.type)&&e.jsx(b.Col,{span:"content",children:e.jsx(he,{placeholder:"Operator",checkIconPosition:"right",data:{string:dn,math:un,group:vn,ou:Sn,status:Cn}[S.type],maxDropdownHeight:300,...t.getInputProps(`conditions.${j}.operator`)})}),!kn.includes(S.type)&&e.jsx(b.Col,{span:"auto",children:e.jsx(wn,{form:t,index:j,delimit:c,delimited:p,modifyCondition:x})}),e.jsx(b.Col,{span:"content",children:e.jsxs(k,{justify:"right",gap:"xs",children:[e.jsx(A,{onClick:i(j),variant:"default",size:"lg",children:e.jsx(W,{size:15})}),e.jsx(A,{onClick:d(S),variant:"default",size:"lg",children:e.jsx(Ie,{size:15})})]})})]})},j)}),u.placeholder]})})})]})}const In="_control_d0u7x_1",wt={control:In};function st({add:t,perRule:s,label:l,connectors:n=[]}){const[r,{close:a,open:o}]=le(!1),d=oe(),i=Object.values(Je),x=p=>()=>{t(p),a()},c=hn.filter(p=>(p.requires||[]).filter(y=>!n.includes(y)).length<=0);return e.jsx(k,{justify:"right",gap:"xs",children:e.jsxs(Ye,{width:300,position:"left-start",shadow:"md",opened:r,children:[e.jsx(Ye.Target,{children:e.jsx(E,{variant:"light",onClick:r?a:o,rightSection:e.jsx(jt,{size:"1.05rem",stroke:1.5}),pr:12,children:l})}),e.jsx(Ye.Dropdown,{children:c.map(p=>{const y=i.filter(u=>s?u.perRule!==!1&&u.catagory===p.id:u.catagory===p.id).filter(u=>(u.requires||[]).filter(S=>!n.includes(S)).length<=0);if(!(y.length<=0))return e.jsx(yt,{label:p.label,className:wt.control,leftSection:e.jsx(p.Icon,{color:p.color?d.colors[p.color][6]:void 0,size:"1rem",stroke:1.5}),childrenOffset:28,children:y.map(u=>e.jsx(yt,{label:u.label||u.id,className:wt.control,onClick:x(u.id),leftSection:e.jsx(u.Icon,{color:u.color?d.colors[u.color][6]:void 0,size:"1rem",stroke:1.5})},u.id))},p.id)})})]})})}function Pn({form:t,index:s,a:l,explore:n,actionType:r}){const[a,{toggle:o}]=le(!1),d=oe(),{Icon:i,color:x,Component:c}=Je[l.name],p=v=>()=>t.insertListItem(r,{...v}),y=v=>()=>t.removeListItem(r,v),u=t.values[r],S=v=>()=>n(()=>D=>t.setFieldValue(`${r}.${s}.${v}`,`${u[s][v]||""}{{${D}}}`)),j=v=>e.jsx(A,{onClick:S(v),variant:"subtle",children:e.jsx(je,{size:16,style:{display:"block",opacity:.8}})});return e.jsxs(e.Fragment,{children:[e.jsxs(b.Col,{span:"auto",children:[s+1,". ",e.jsx(i,{color:x?d.colors[x][6]:void 0,size:18,stroke:1.5})," ",l.name]}),e.jsx(b.Col,{span:"content",children:e.jsxs(k,{justify:"right",gap:"xs",children:[e.jsx(A,{onClick:()=>o(),variant:a?"filled":"default",size:"lg",children:e.jsx(be,{size:15})}),e.jsx(A,{onClick:y(s),variant:"default",size:"lg",children:e.jsx(W,{size:15})}),e.jsx(A,{onClick:p(l),variant:"default",size:"lg",children:e.jsx(Ie,{size:15})})]})}),e.jsx(b.Col,{span:12,pt:0,pb:0,children:e.jsx(Dt,{in:a,children:e.jsx(c,{form:t,index:s,explorer:j,explore:n,actionType:r})})})]})}function lt({form:t,actionType:s}){const{explorer:l,explore:n}=f.useContext(Xe),r=o=>o,a=t.values[s];return e.jsxs(I,{children:[l,e.jsx(X,{onDragEnd:({destination:o,source:d})=>t.reorderListItem(s,{from:d.index,to:o?o.index:0}),children:e.jsx(ie,{droppableId:"dnd-list",direction:"vertical",children:o=>e.jsxs("div",{...o.droppableProps,style:{top:"auto",left:"auto"},ref:o.innerRef,children:[a.map((d,i)=>e.jsx(ce,{index:i,draggableId:i.toString(),children:x=>e.jsxs(b,{align:"center",ref:x.innerRef,mt:"xs",...x.draggableProps,gutter:"xs",style:{...x.draggableProps.style,left:"auto !important",top:"auto !important"},children:[e.jsx(b.Col,{span:"content",style:{cursor:"grab"},...x.dragHandleProps,children:e.jsx(k,{children:e.jsx(ae,{size:"1.2rem"})})}),e.jsx(Pn,{form:t,index:i,a:d,actionType:s,explore:s!=="actions"?r:n})]})},i)),o.placeholder]})})})]})}function $n({form:t}){const s=o=>t.insertListItem("actions",{name:o}),l=o=>t.insertListItem("before_actions",{name:o}),n=o=>t.insertListItem("after_actions",{name:o}),{_connectors:r}=f.useContext(M),a=[t.values.primary,...t.values.secondaries.map(o=>o.primary)].filter(o=>o in r).map(o=>r[o].id);return e.jsxs(I,{children:[e.jsx(P,{c:"dimmed",size:"sm",mt:"md",children:"Actions on this tab are executed sequentially if all conditions evaluated successfully."}),e.jsx(me,{label:e.jsx(st,{add:l,label:"Initial Action",connectors:a,perRule:!0}),labelPosition:"right"}),e.jsx(X,{onDragEnd:({destination:o,source:d})=>t.reorderListItem("before_actions",{from:d.index,to:o?o.index:0}),children:e.jsx(lt,{form:t,actionType:"before_actions"})}),e.jsx(me,{my:"xs",label:e.jsx(st,{add:s,label:"Row Action",connectors:a}),labelPosition:"right"}),e.jsx(X,{onDragEnd:({destination:o,source:d})=>t.reorderListItem("actions",{from:d.index,to:o?o.index:0}),children:e.jsx(lt,{form:t,actionType:"actions"})}),e.jsx(me,{my:"xs",label:e.jsx(st,{add:n,label:"Final Action",connectors:a,perRule:!0}),labelPosition:"right"}),e.jsx(X,{onDragEnd:({destination:o,source:d})=>t.reorderListItem("after_actions",{from:d.index,to:o?o.index:0}),children:e.jsx(lt,{form:t,actionType:"after_actions"})})]})}function zn({editing:t,close:s}){const{schema:l,mutate:n}=f.useContext(M),[r,a]=f.useState("settings"),o={secondaries:[],conditions:[],actions:[],before_actions:[],after_actions:[]},d=pe({initialValues:o,validate:{}});f.useEffect(()=>{d.reset(),t?d.setValues(t):d.setValues(o),d.setInitialValues(o)},[t]);const{post:i,loading:x}=N({url:`/schema/${l==null?void 0:l.name}/rule`,data:{...d.values},catch:({validation:j})=>d.setErrors(j),then:({rules:j,_rules:v})=>{n({rules:j,_rules:v}),s(),T.show({title:"Success",message:"Rule Added.",color:"lime"})}}),{put:c,loading:p}=N({url:`/schema/${l==null?void 0:l.name}/rule/${t==null?void 0:t.name}`,data:{...d.values},catch:({validation:j})=>d.setErrors(j),then:({rules:j,_rules:v})=>{n({rules:j,_rules:v}),s(),T.show({title:"Success",message:"Rule Saved.",color:"lime"})}}),y=x||p,u=!d.values.primary||!d.values.primaryKey,S=u||(d.values.conditions||[]).length<=0;return e.jsx(I,{children:e.jsx(Se,{label:e.jsxs(ve,{rightSection:e.jsx(gt,{loading:y,variant:"light",onClick:t?c:i,options:[{onClick:()=>s(),label:"Cancel",leftSection:e.jsx(Ne,{size:16})}],children:t?"Save":"Create"}),children:["Rule",t?" - Edit":" - New"]}),children:e.jsxs(q,{value:r,onChange:a,children:[e.jsxs(q.List,{children:[e.jsx(q.Tab,{value:"settings",leftSection:e.jsx(Ot,{size:"0.8rem"}),children:"Settings"}),e.jsx(q.Tab,{value:"conditions",disabled:u,leftSection:e.jsx(tl,{size:"0.8rem"}),children:"Conditions"}),e.jsx(q.Tab,{value:"actions",disabled:S,leftSection:e.jsx(De,{size:"0.8rem"}),children:"Actions"})]}),e.jsx(q.Panel,{value:"settings",p:"xs",children:r==="settings"&&e.jsx(yn,{form:d})}),e.jsx(q.Panel,{value:"conditions",children:e.jsx(Xt,{form:d})}),e.jsx(q.Panel,{value:"actions",children:e.jsx($n,{form:d})})]})})})}function An({action:t,resultant:s}){if(!t.result.data)return e.jsx(e.Fragment,{});const l=t.result.data;return e.jsxs(I,{children:[e.jsxs(P,{fz:"sm",children:["Canonical Name: ",e.jsx(B,{children:l.cn||""})]}),e.jsxs(P,{fz:"sm",children:["User Principal Name: ",e.jsx(B,{children:l.upn||""})]}),e.jsxs(P,{fz:"sm",children:["SAM Account Name: ",e.jsx(B,{children:l.sam||""})]}),e.jsx(I,{className:te.overflow,children:e.jsxs(P,{fz:"sm",children:["Organizational Unit: ",e.jsxs(B,{children:[l.ou||"",",",l.base||""]})]})}),e.jsx(I,{className:te.overflow,children:e.jsxs(P,{fz:"sm",children:["Organizational Unit: ",e.jsx(B,{children:l.dn||""})]})}),e.jsxs(P,{fz:"sm",children:[s?"":"Sample ","Password: ",e.jsx(B,{children:l.password||""})]}),e.jsxs(P,{fz:"xs",pt:"xs",children:["Account will be ",l.enable?"enabled":"disabled"," on creation."]}),e.jsx(ne,{fz:"sm",label:"Attributes",children:e.jsx(Z,{size:"xs",icon:e.jsx(e.Fragment,{children:"-"}),children:(l.attributes||[]).map(({name:n,value:r})=>e.jsxs(Z.Item,{children:[n,": ",e.jsx(B,{children:r})]},n))})}),e.jsx(ne,{fz:"sm",label:"Security Groups",children:e.jsx(Z,{size:"xs",icon:e.jsx(e.Fragment,{children:"-"}),children:(l.groups||[]).map((n,r)=>e.jsx(Z.Item,{className:te.overflow,children:e.jsx(I,{style:{whiteSpace:"nowrap"},children:n})},r))})})]})}function Dn({action:t}){if(!t.result.data)return e.jsx(e.Fragment,{});const s=t.result.data;return e.jsx(I,{children:e.jsx(Z,{size:"sm",icon:e.jsx(e.Fragment,{children:"-"}),children:Object.keys(s||[]).map((l,n)=>e.jsx(Z.Item,{className:te.overflow,children:e.jsxs(I,{style:{whiteSpace:"nowrap"},children:[l,": ",e.jsx(B,{children:JSON.stringify(s[l])})]})},n))})})}function Nn({change:t,r:s}){switch(t.type){case"Replace":return e.jsxs(Z.Item,{className:te.overflow,children:[t.name,": ",e.jsxs(B,{children:["Replace",s&&"d"," ",t.currentValue||"<undefined>"," with '",t.value,"'"]})]},t.name);case"Add":return e.jsxs(Z.Item,{className:te.overflow,children:[t.name,": ",e.jsxs(B,{children:["Set to '",t.value,"'"]})]},t.name);case"Delete":return e.jsxs(Z.Item,{className:te.overflow,children:["delete",s&&"d",": ",e.jsx(B,{children:t.name})]},t.name)}}function Fn({action:t,resultant:s}){if(!t.result.data)return e.jsx(e.Fragment,{});const l=t.result.data,n=(l.changes||[]).filter(r=>r.error);return e.jsxs(I,{children:[e.jsxs(P,{fz:"sm",children:["Directory: ",e.jsx(B,{children:l.directory||""})]}),e.jsxs(P,{fz:"sm",children:["User Principal Name: ",e.jsx(B,{children:l.upn||""})]}),e.jsx(ne,{fz:"sm",label:"Changes",open:!0,children:e.jsx(Z,{size:"xs",icon:e.jsx(e.Fragment,{children:"-"}),children:(l.changes||[]).map(r=>e.jsx(Nn,{change:r,r:s}))})}),n.length>0&&e.jsx(ne,{fz:"sm",label:"Errors",open:!0,children:e.jsx(Z,{size:"xs",icon:e.jsx(e.Fragment,{children:"-"}),children:n.map(r=>e.jsxs(Z.Item,{className:te.overflow,children:[r.name,": ",e.jsx(B,{children:r.error})]},r.name))})})]})}function _n(t,s){return!!(s.id.includes(t)||s.display.includes(t))}function Yt({actions:t,setAction:s,size:l=16}){const n=oe();return t.map((r,a)=>{const{Icon:o,color:d}=Je[r.name],i=r.result.error||r.result.warning,x=i?n.colors.gray[8]:d?n.colors[d][6]:void 0;return e.jsx(us,{disabled:!i,size:l/3,offset:3,color:r.result.warning?"orange":"red",inline:!0,children:e.jsx(o,{onClick:()=>s(r),style:{cursor:"pointer"},color:x,size:l,stroke:2})},a)})}function Rn({match:t,toggle:s,setAction:l,resultant:n=!1,dash:r}){return e.jsxs(b,{align:"center",children:[e.jsx(b.Col,{pl:"lg",span:1,children:!n&&e.jsx(O,{disabled:!t.actionable,onChange:s(t.id),checked:!!t.checked})}),r&&e.jsx(b.Col,{span:1,children:t.schema}),r&&e.jsx(b.Col,{span:1,children:t.rule}),e.jsx(b.Col,{span:2,children:t.id}),e.jsx(b.Col,{span:r?5:7,children:t.display}),e.jsx(b.Col,{span:2,children:e.jsx(Yt,{actions:t.actions,setAction:l,size:16})})]},t.id)}function It({actions:t,setAction:s}){return t.length<=0?e.jsx(me,{mt:"xs"}):e.jsx(me,{mt:"xs",label:e.jsx(k,{children:e.jsx(Yt,{actions:t,setAction:s,size:22})})})}function En({action:t,resultant:s=!1}){switch(t.name){case"Create User":return e.jsx(An,{action:t,resultant:s});case"Update Attributes":return e.jsx(Fn,{action:t,resultant:s});default:return e.jsx(Dn,{action:t,resultant:s})}}function it({id:t,matches:s,loading:l,setData:n,run:r,resultant:a=!1,dash:o=!1,initActions:d=[],finalActions:i=[]}){const x=g=>n(h=>({...h,matches:g})),[c,p]=f.useState(!0),[y,u]=f.useState(""),[S,j]=f.useState("15"),v=s.filter(g=>c?!0:!!g.actionable),D=g=>()=>x((v||[]).map(h=>h.id!==g?h:{...h,checked:!h.checked})),L=(v||[]).filter(g=>g.checked),U=L.length>0,Y=()=>()=>x(U?(v||[]).map(g=>({...g,checked:!1})):(v||[]).map(g=>g.actionable?{...g,checked:!0}:g)),[_,K]=f.useState(void 0),z=y===""?v||[]:(v||[]).filter(g=>_n(y,g)),m=Math.ceil(z.length/Number(S)),$=cs({total:m,initialPage:1}),V=z.slice(($.active-1)*Number(S),$.active*Number(S));return e.jsxs(I,{pb:"xs",children:[!l&&e.jsxs(e.Fragment,{children:[e.jsx(xe,{title:`${_==null?void 0:_.name} ${a?"Result":"Preview"}`,opened:!!_,onClose:()=>K(void 0),styles:{header:{paddingBottom:0}},children:_&&e.jsxs(e.Fragment,{children:[_.result.warning&&e.jsx(P,{c:"orange",children:_.result.warning}),_.result.error&&e.jsx(P,{c:"red",children:_.result.error}),e.jsx(En,{action:_,resultant:a}),e.jsx(ne,{fz:"xs",label:"Raw Output",children:e.jsx("pre",{style:{margin:0},children:e.jsx(B,{fz:"xs",children:JSON.stringify(_,null,2)})})})]})}),e.jsxs(b,{justify:"center",children:[e.jsx(b.Col,{span:2,children:e.jsx(C,{mt:"xs",variant:"filled",placeholder:`Search ${(v||[]).length} entries...`,leftSection:e.jsx(Fe,{size:15}),value:y,onChange:g=>u(g.currentTarget.value)})}),!o&&e.jsx(b.Col,{span:2,children:!a&&e.jsx(k,{justify:"right",children:e.jsx(Te,{labelPosition:"left",mt:17,label:"Display Actionless",checked:c,onChange:()=>p(!c)})})}),e.jsx(b.Col,{span:2,children:e.jsx(he,{mt:"xs",variant:"filled",placeholder:"Pick one",onChange:g=>j(g),value:S,data:[{value:"5",label:"5 Per Page"},{value:"15",label:"15 Per Page"},{value:"25",label:"25 Per Page"},{value:"50",label:"50 Per Page"},{value:"100",label:"100 Per Page"}]})}),e.jsx(b.Col,{span:"auto",children:e.jsx(ds,{mt:12,onChange:g=>$.setPage(g),value:$.active,total:m})}),e.jsx(b.Col,{span:2,children:!a&&e.jsxs(E,{onClick:r,leftSection:e.jsx(De,{}),disabled:!U,mt:"xs",children:["Run ",L.length," Actions"]})})]}),e.jsx(It,{actions:d,setAction:K})]}),l&&e.jsx(k,{justify:"center",children:e.jsx(Jt,{resultant:a})}),v&&!l&&e.jsxs(e.Fragment,{children:[e.jsxs(b,{pt:"xs",align:"center",children:[e.jsx(b.Col,{pl:"lg",span:1,children:!a&&e.jsx(O,{onChange:Y(),checked:U})}),o&&e.jsx(b.Col,{span:1,fw:"bold",children:"Schema"}),o&&e.jsx(b.Col,{span:1,fw:"bold",children:"Rule"}),e.jsx(b.Col,{span:2,fw:"bold",children:t||"ID"}),e.jsx(b.Col,{span:o?5:7,fw:"bold",children:"Display"}),e.jsx(b.Col,{span:2,fw:"bold",children:"Actions"})]}),V.map(g=>e.jsx(Rn,{match:g,toggle:D,setAction:h=>K(h),resultant:a,dash:o},g.id))]}),!l&&e.jsx(It,{actions:i,setAction:K})]})}function On({rule:t,close:s}){const{schema:l}=f.useContext(M),[n,r]=f.useState("conditions"),o=pe({initialValues:{secondaries:[],conditions:[],actions:[]},validate:{}});f.useEffect(()=>{o.reset(),t&&o.setValues(t)},[t]);const d=o.values.conditions.length>0,{data:i,post:x,loading:c,reset:p,setData:y}=N({url:`/schema/${l==null?void 0:l.name}/rules/match`,default:{matches:[]},data:{...t,conditions:o.values.conditions}}),{data:u,post:S,loading:j,reset:v,setData:D}=N({url:`/schema/${l==null?void 0:l.name}/rules/run`,default:{matches:[]},data:{...t,conditions:o.values.conditions,matches:i.matches.filter(_=>_.checked).map(_=>_.id)}}),L=()=>{p(),v()},U=()=>{L(),s(),r("conditions")},Y=()=>{r("results"),S()};return e.jsx(xe,{withCloseButton:!1,size:"80%",opened:!!t,closeOnClickOutside:!1,onClose:U,styles:{body:{padding:0}},children:t&&e.jsxs(q,{p:0,value:n,onChange:r,children:[e.jsxs(q.List,{children:[e.jsx(q.Tab,{disabled:c,onClick:L,value:"conditions",children:"Conditions"}),e.jsx(q.Tab,{disabled:c||!d,leftSection:c?e.jsx(we,{size:15}):e.jsx(Fe,{size:15}),value:"matches",onClick:x,children:"Find Matches"}),e.jsx(q.Tab,{disabled:!0,leftSection:j?e.jsx(we,{size:15}):e.jsx(De,{size:15}),value:"results",children:"Results"}),e.jsx(q.Tab,{ml:"auto",leftSection:e.jsx(Ne,{size:"0.8rem"}),value:"close","aria-label":"close",onClick:U})]}),e.jsx(q.Panel,{mih:300,p:"xs",pt:0,value:"conditions",children:e.jsx(Xt,{form:o,label:"Add single-run modifications here."})}),e.jsx(q.Panel,{value:"matches",children:e.jsx(it,{id:t==null?void 0:t.primaryKey,loading:c,initActions:i.initActions||[],finalActions:i.finalActions||[],matches:i.matches||[],setData:y,run:Y})}),e.jsx(q.Panel,{value:"results",children:e.jsx(it,{id:t==null?void 0:t.primaryKey,loading:j,resultant:!0,initActions:u.initActions||[],finalActions:u.finalActions||[],matches:u.matches||[],setData:D})})]})})}function nt({actions:t}){const s=oe();return(t||[]).map((l,n)=>{const{Icon:r,color:a}=Je[l.name];return e.jsx(Be,{fz:"xs",withArrow:!0,color:a?s.colors[a][6]:void 0,label:l.name,children:e.jsx(r,{color:a?s.colors[a][6]:void 0,size:16,stroke:2})},n)})}function Ln(){const{schema:t,rules:s,mutate:l}=f.useContext(M),[n,{open:r,close:a}]=le(!1),[o,d]=f.useState(void 0),[i,x]=f.useState(void 0),c=h=>{x(h),r()},p=h=>{d(h)},{del:y,request:u,loading:S}=N({cleanup:!0,furl:({name:h})=>`/schema/${t==null?void 0:t.name}/rule/${h}`,fdata:({name:h})=>({name:h}),catch:h=>ge(h),then:({rules:h,_rules:w})=>{l({rules:h,_rules:w}),T.show({title:"Success",message:"Rule Removed.",color:"lime"})}}),{post:j,request:v,loading:D}=N({cleanup:!0,furl:({name:h})=>`/schema/${t==null?void 0:t.name}/rule/${h}/copy`,fdata:({name:h})=>({name:h}),catch:h=>ge(h),then:({rules:h,_rules:w})=>{l({rules:h,_rules:w}),T.show({title:"Success",message:"Rule Copied.",color:"lime"})}}),{put:L,loading:U}=N({cleanup:!0,furl:({name:h})=>`/schema/${t==null?void 0:t.name}/rule/${h}/toggle`,fdata:({name:h})=>({name:h}),catch:h=>ge(h),then:({rules:h,_rules:w})=>{l({rules:h,_rules:w})}}),{put:Y,loading:_}=N({cleanup:!0,url:`/schema/${t==null?void 0:t.name}/rules/reorder`,then:({rules:h})=>{l({rules:h})}}),K=h=>dt.openConfirmModal({title:"Permanently Delete Rule",centered:!0,children:e.jsxs(P,{size:"sm",children:["Are you sure you want to delete ",h,"? This action is destructive and cannot be reversed."]}),labels:{confirm:"Delete rule",cancel:"No don't delete it"},confirmProps:{color:"red"},onConfirm:()=>y({name:h})}),z=S||D||_||U,[m,$]=Rt(s);f.useEffect(()=>$.setState(s),[s]);const V=(h,w)=>{$.reorder({from:h,to:w}),Y({data:{from:h,to:w}})},g=h=>{$.setState(s.map(w=>w.name!==h.name?w:{...w,enabled:!h.enabled})),L({name:h.name})};if(t)return n?e.jsx(zn,{editing:i,close:()=>{a(),x(void 0)}}):e.jsxs(Se,{label:e.jsx(ve,{rightSection:e.jsx(E,{onClick:()=>r(),variant:"light",children:"Add"}),children:"Rules"}),children:[e.jsx(On,{rule:o,close:()=>d(void 0)}),m.length===0&&e.jsx(P,{c:"lighter",size:"sm",children:"No Rules in effect."}),e.jsx(X,{onDragEnd:({destination:h,source:w})=>V(w.index,(h==null?void 0:h.index)||0),children:e.jsx(ie,{droppableId:"dnd-list",direction:"vertical",children:h=>e.jsxs("div",{...h.droppableProps,style:{top:"auto",left:"auto"},ref:h.innerRef,children:[m.map((w,H)=>e.jsx(ce,{index:H,draggableId:H.toString(),children:Re=>e.jsxs(b,{align:"center",ref:Re.innerRef,mt:"xs",...Re.draggableProps,className:te.item,style:{...Re.draggableProps.style,left:"auto !important",top:"auto !important"},children:[e.jsx(b.Col,{span:"content",style:{cursor:"grab"},...Re.dragHandleProps,children:e.jsx(k,{children:e.jsx(ae,{size:"1.2rem"})})}),e.jsx(b.Col,{span:"auto",children:e.jsxs(k,{gap:5,children:[w.name,w.description&&w.description!==""&&e.jsx(Be,{position:"right",label:w.description,children:e.jsx(sl,{size:16})})]})}),e.jsx(b.Col,{span:"auto",children:e.jsxs(k,{children:[e.jsx(nt,{actions:w.before_actions}),(w.before_actions||[]).length>0&&e.jsx(me,{orientation:"vertical"}),e.jsx(nt,{actions:w.actions}),(w.after_actions||[]).length>0&&e.jsx(me,{orientation:"vertical"}),e.jsx(nt,{actions:w.after_actions})]})}),e.jsx(b.Col,{span:"content",children:e.jsxs(k,{justify:"right",gap:"xs",children:[e.jsx(O,{disabled:z,onClick:()=>g(w),checked:w.enabled,color:"teal"}),e.jsx(A,{disabled:z,loading:u.name===w.name,onClick:()=>K(w.name),variant:"subtle",color:"red",children:e.jsx(W,{size:16,stroke:1.5})}),e.jsx(A,{disabled:z,loading:v.name===w.name,onClick:()=>j({name:w.name}),variant:"subtle",color:"indigo",children:e.jsx(Ie,{size:16,stroke:1.5})}),e.jsx(A,{disabled:z,onClick:()=>c(w),variant:"subtle",color:"orange",children:e.jsx(be,{size:16,stroke:1.5})}),e.jsx(A,{disabled:z,onClick:()=>p(w),variant:"subtle",color:"green",children:e.jsx(ll,{size:16,stroke:1.5})})]})})]})},H)),h.placeholder]})})})]})}function Un({opened:t,close:s,editing:l,loading:n=!1,add:r,save:a,form:o}){const{data:d=[],loading:i}=N({url:"/schema",default:[],fetch:!0,mutate:D=>D.map(L=>L.name)}),{data:x=[],loading:c,get:p,error:y}=N({url:`/schema/${o.values.schema}/rules/`,default:[],mutate:D=>D.map(L=>L.name)});f.useEffect(()=>{o.values.schema&&p()},[o.values.schema]);const u=at.toString(o.values.cron,{throwExceptionOnParseError:!1}),S=u.includes("An error occured when generating the expression description"),j=!o.values.schema,v=()=>{if(l)return a({id:l.id});r()};return e.jsxs(xe,{size:"lg",opened:t,onClose:s,title:"Add Schedule",children:[e.jsx(he,{label:"Target Schema",required:!0,placeholder:"Pick schema",data:d,rightSection:i?e.jsx(we,{size:"xs"}):void 0,...o.getInputProps("schema")}),o.values.schema&&e.jsxs(e.Fragment,{children:[e.jsx(hs,{label:"Rules",clearable:!0,description:"Specify which rules will be run on the schema. Leave blank to run all.",placeholder:o.values.rules.length<=0?"All rules":"Pick rules",disabled:x.length<=0,data:x,rightSection:c?e.jsx(we,{size:"xs"}):void 0,...o.getInputProps("rules"),error:y}),e.jsx(P,{fz:"xs",c:"dimmed",children:"Note: Disabled rules will be skipped regardless."}),e.jsx(At,{mt:5,fullWidth:!0,...o.getInputProps("type"),data:[{label:e.jsxs(de,{children:[e.jsx(nl,{size:20,stroke:1.5}),e.jsx(I,{ml:5,children:"Schedule"})]}),value:"Schedule"},{label:e.jsxs(de,{children:[e.jsx(rl,{size:20,stroke:1.5}),e.jsx(I,{ml:5,children:"Monitor"})]}),value:"Monitor"}]}),o.values.type==="Schedule"&&e.jsx(C,{label:"CRON Expression",placeholder:"0 * * * MON-FRI",required:!0,description:S?"Invalid Syntax":u,...o.getInputProps("cron"),error:S&&u}),o.values.type==="Monitor"&&e.jsx(C,{label:"File Path",placeholder:"D:/watchme.csv",required:!0,description:"This file path will be monitored, and the schedule run when a file change is detected.",...o.getInputProps("monitor")})]}),e.jsx(k,{justify:"right",mt:"md",children:e.jsx(E,{loading:n,disabled:j,onClick:v,variant:"light",type:"submit",children:l?"Save":"Add"})})]})}function Vn(){const t=g=>g.map(h=>({...h,rules:h.rules?JSON.parse(h.rules):[],type:h.monitor?"Monitor":"Schedule"})).sort((h,w)=>h.index-w.index),[s,l]=Rt([]),{loading:n}=N({url:"/schedule",default:[],preserve:!0,fetch:!0,mutate:t,then:g=>l.setState(g)}),[r,{open:a,close:o}]=le(!1),[d,i]=f.useState(void 0),x={schema:"",type:"",rules:[],cron:"",monitor:""},c=pe({initialValues:x,validate:{cron:g=>{if(c.values.type==="Monitor")return!1;const h=at.toString(g,{throwExceptionOnParseError:!1});return h.includes("An error occured when generating the expression description")?h:null},monitor:g=>c.values.type==="Schedule"?!1:g.trim()===""&&"Path required."}});f.useEffect(()=>{c.reset(),d?c.setValues(d):c.setValues(x),c.setInitialValues(x)},[d]);const{post:p,loading:y}=N({url:"/schedule",data:c.values,before:()=>c.validate(),check:()=>!c.isValid(),catch:({validation:g})=>c.setErrors(g),mutate:t,then:g=>{l.setState(g),o(),T.show({title:"Success",message:"Schedule Added.",color:"lime"})}}),{put:u,loading:S}=N({url:"/schedule/reorder",fdata:({from:g,to:h})=>({from:g,to:h}),mutate:t,then:g=>l.setState(g)}),j=(g,h)=>{l.reorder({from:g,to:h}),u({from:g,to:h})},{put:v,loading:D}=N({url:"/schedule",data:c.values,before:()=>c.validate(),check:()=>!c.isValid(),catch:({validation:g})=>c.setErrors(g),furl:({id:g})=>`/schedule/${g}`,mutate:t,then:g=>{l.setState(g),o(),T.show({title:"Success",message:"Schedule Modified.",color:"lime"})}}),{put:L,loading:U}=N({url:"/schedule",data:c.values,furl:({id:g})=>`/schedule/${g}/toggle`,mutate:t,then:g=>l.setState(g)}),{del:Y,request:_,loading:K}=N({cleanup:!0,furl:({id:g})=>`/schedule/${g}`,mutate:t,then:g=>{l.setState(g),T.show({title:"Success",message:"Schedule Removed.",color:"lime"})}}),z=n||y||D||U||K||S,m=g=>{i(g),a()},$=g=>{l.setState(s.map(h=>h.id!==g.id?h:{...h,enabled:!g.enabled})),L({id:g.id})},V=()=>{i(void 0),o()};return e.jsxs(Se,{label:e.jsx(ve,{rightSection:e.jsxs(k,{children:[n&&e.jsx(we,{size:"sm"}),e.jsx(E,{onClick:a,variant:"light",children:"Add"})]}),children:"Schedules"}),children:[e.jsx(Un,{opened:r,close:V,form:c,add:p,save:v,editing:d,loading:z}),s.length===0&&e.jsx(P,{c:"lighter",size:"sm",children:z?"Loading...":"No Schedules in effect."}),e.jsx(X,{onDragEnd:({destination:g,source:h})=>j(h.index,(g==null?void 0:g.index)||0),children:e.jsx(ie,{droppableId:"dnd-list",direction:"vertical",children:g=>e.jsxs("div",{...g.droppableProps,style:{top:"auto",left:"auto"},ref:g.innerRef,children:[s.map(h=>{const w=h.cron?at.toString(h.cron,{throwExceptionOnParseError:!1}):`Watch: ${h.monitor}`;return e.jsx(ce,{index:h.index,draggableId:h.id,children:H=>e.jsxs(b,{align:"center",ref:H.innerRef,mt:"xs",...H.draggableProps,className:te.item,style:{...H.draggableProps.style,left:"auto !important",top:"auto !important"},children:[e.jsx(b.Col,{span:"content",style:{cursor:"grab"},...H.dragHandleProps,children:e.jsx(k,{children:e.jsx(ae,{size:"1.2rem"})})}),e.jsx(b.Col,{span:"auto",children:e.jsx(P,{size:"xs",lineClamp:1,children:w})}),e.jsx(b.Col,{span:"auto",children:e.jsxs(P,{size:"xs",lineClamp:1,children:["Schema: ",h.schema," ",h.rules.length>0&&` | Rules: ${h.rules}`]})}),e.jsx(b.Col,{span:"content",children:e.jsxs(k,{justify:"right",gap:"xs",children:[e.jsx(O,{disabled:z,onClick:()=>$(h),checked:h.enabled,color:"teal"}),e.jsx(A,{disabled:z,loading:_.id===h.id,onClick:()=>Y({id:h.id}),variant:"subtle",color:"red",children:e.jsx(W,{size:16,stroke:1.5})}),e.jsx(A,{disabled:z,onClick:()=>m(h),variant:"subtle",color:"orange",children:e.jsx(be,{size:16,stroke:1.5})})]})})]})},h.id)}),g.placeholder]})})})]})}function Mn({schema:t,schemas:s,check:l,loading:n,getSchemas:r}){return e.jsx(e.Fragment,{children:e.jsxs(gt,{menu:{onOpen:()=>r()},loading:n,variant:"light",onClick:l,options:s,children:["Check ",t]})})}function qn(){const{get:t,data:s,loading:l}=N({url:"/schema",default:[{onClick:()=>y("all schemas"),label:"All Schemas"}],fetch:!0,mutate:u=>{const S=u.map(j=>({onClick:()=>y(j.name),label:j.name}));return[{onClick:()=>y("all schemas"),label:"All Schemas"},...S]}}),[n,r]=f.useState("all schemas"),{data:a,post:o,loading:d,reset:i,setData:x}=N({url:"/match",data:{schema_name:n},mutate:u=>u.filter(S=>S.actionable)}),c=d||l,p=s.length>1,y=u=>{r(u),i()};return e.jsx(Se,{size:"responsive",label:e.jsx(ve,{rightSection:p?e.jsx(Mn,{schema:n,schemas:s,setSchema:y,getSchemas:t,check:o,loading:c}):e.jsx(e.Fragment,{}),children:"Dashboard"}),children:p?e.jsxs(e.Fragment,{children:[e.jsx(it,{initActions:[],finalActions:[],matches:a||[],loading:d,setData:x,run:()=>{},dash:!0}),!a&&!d&&e.jsxs(P,{fz:"sm",c:"dimmed",children:["Run a ",e.jsx("a",{href:"#",onClick:o,children:"check"})," to find actions to take."]})]}):e.jsx(P,{fz:"sm",c:"dimmed",children:"Create a schema to begin."})})}function Bn(){const{nav:t}=f.useContext(Ge);switch(t){case"Settings":return e.jsx(Al,{});case"Schedules":return e.jsx(Vn,{});case"Schema":return e.jsx(El,{});case"Connectors":return e.jsx(fn,{});case"Rules":return e.jsx(Ln,{});default:return e.jsx(qn,{})}}function Tn(){const[t,{toggle:s,close:l}]=le(),n=$t(`(max-width: ${zt(750)})`),{authed:r}=f.useContext(ze);return r?e.jsxs(Oe,{header:{height:64,collapsed:!n},navbar:{width:300,breakpoint:"sm",collapsed:{mobile:!t}},padding:"md",children:[e.jsx(Oe.Header,{children:e.jsx(Kt,{opened:t,toggle:s})}),e.jsx(Oe.Navbar,{children:e.jsx(vl,{closeNav:l})}),e.jsx(Oe.Main,{children:e.jsx(Bn,{})})]}):e.jsx(wl,{})}function Hn({children:t}){const[s,l]=f.useState("Dashboard"),n=r=>l(r);return e.jsx(Ge.Provider,{value:{nav:s,changeNav:n},children:t})}function Wn({children:t}){const[s,l,n]=rt({key:"auth",defaultValue:"{}"}),r=JSON.parse(s||"{}")||{},a=r.session||void 0,o=()=>{n()};return e.jsx(ze.Provider,{value:{authed:a,session:r,logout:o,login:l},children:t})}function Kn({children:t}){const{changeNav:s}=f.useContext(Ge),[l,n]=f.useState(void 0),{data:r,setData:a,loading:o,request:d,fetch:i,reset:x}=N({url:`/schema/${l}`,loading:l,preserve:!0,before:()=>s("Dashboard"),then:u=>{s("Schema"),!(!u.errors||u.errors.length<=0)&&T.show({title:"Errors Detected",message:JSON.stringify(u.errors),color:"red",autoClose:!1})}}),c=o?d.loading:!1;f.useEffect(()=>{l?i():(x(),s("Dashboard"))},[l]);const p=u=>n(u),y=(u={})=>a({...r,...u});return e.jsx(M.Provider,{value:{schema:r,loading:c,connectors:r?r.connectors:[],_connectors:r?r._connectors:{},rules:r?r.rules:[],_rules:r?r._rules:{},headers:r?r.headers:{},changeSchema:p,reload:i,mutate:y},children:t})}const Gn="_connector_sxciz_1",Jn={connector:Gn};function Xn(t){const s=[];for(const l in t)if(Object.prototype.hasOwnProperty.call(t,l)){const n=t[l];for(const r of n)s.push(`${l}.${r}`)}return s}function Yn({opened:t,close:s,click:l}){const n=oe(),{_connectors:r,headers:a}=f.useContext(M),[o,d]=f.useState(""),i=p=>d(p.target.value),c=Xn(a).filter(p=>p.toLowerCase().includes(o.toLowerCase()));return e.jsxs(ps,{position:"right",size:"xs",opened:t,onClose:s,title:"Template Explorer",overlayProps:{opacity:.2},children:[e.jsx(C,{pb:"xs",leftSection:e.jsx(Fe,{size:16,style:{display:"block",opacity:.5}}),placeholder:"Search",onChange:i,value:o}),o===""?Object.keys(a).map(p=>{if(!(p in r))return e.jsxs(e.Fragment,{children:[p," ERROR"]});const{id:y}=r[p],u=fe[y];return e.jsx(Ae,{onClick:()=>d(`${p}.`),className:Jn.connector,p:"xs",mt:"xs",children:e.jsxs(k,{children:[e.jsx(I,{style:{display:"flex",alignItems:"center"},children:e.jsx(u.icon,{size:17,color:n.colors[u.color][6]})}),e.jsx("div",{style:{flex:1},children:e.jsx(P,{size:"sm",children:p})}),e.jsx(pt,{size:17,stroke:1.5})]})},p)}):e.jsx(xs,{style:{justifyContent:"center"},gap:"sm",justify:"flex-start",align:"center",direction:"row",wrap:"wrap",children:c.map(p=>e.jsx(E,{onClick:()=>l(p),variant:"default",radius:"xl",size:"compact-xs",children:p},p))})]})}function Qn({children:t}){const[s,{open:l,close:n}]=le(!1),[r,a]=f.useState(()=>i=>{console.log(i)}),o=e.jsx(Yn,{click:r,opened:s,close:n}),d=i=>{l(),a(i)};return e.jsx(Xe.Provider,{value:{explorer:o,explore:d,close:n},children:t})}const Zn=js({fontFamily:"Roboto, sans-serif",components:{TextInput:C.extend({classNames:{input:te.input}})}});function er({children:t}){return e.jsxs(ms,{defaultColorScheme:"auto",theme:Zn,children:[e.jsx(gs,{}),e.jsx(bs,{children:e.jsx(Hn,{children:e.jsx(Wn,{children:e.jsx(Kn,{children:e.jsx(Qn,{children:t})})})})})]})}Zt.createRoot(document.getElementById("root")).render(e.jsx(Qt.StrictMode,{children:e.jsx(er,{children:e.jsx(Tn,{})})}));
