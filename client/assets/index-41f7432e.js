import{j as e,r as j,a as Kt}from"./react-f1c107a9.js";import{c as Gt}from"./react-dom-8c6b07ed.js";import{G as S,B as Jt,T as Me,C as M,n as W,u as he,M as xe,a as k,A as Xt,b as O,P as ve,c as Yt,r as T,d as w,e as Qt,f as ft,g as vt,h as Ct,i as te,j as ce,k as P,l as Oe,m as A,U as Ie,R as Zt,o as R,p as Y,q as Ee,s as lt,t as ue,v as nt,w as et,x as es,y as ts,I as Le,S as St,D as Te,z as ne,E as ot,F as ss,H as qe,J as kt,K as wt,L as J,N as It,O as h,Q as ls,V as ns,W as ee,X as de,Y as U,Z as os,_ as Ce,$ as Je,a0 as xt,a1 as L,a2 as Q,a3 as as,a4 as rs,a5 as is,a6 as cs,a7 as Pt,a8 as ds,a9 as Re,aa as us,ab as ps,ac as hs,ad as xs,ae as js,af as ms}from"./@mantine-bd686c02.js";import{a as gs}from"./axios-47b9d439.js";import{I as ge,a as bs,b as ze,c as ys,d as zt,e as $e,f as Ae,g as fs,h as Ne,i as at,j as vs,k as Cs,l as Ss,m as $t,n as At,o as Nt,p as ks,q as ws,r as rt,s as it,t as Is,u as Ps,v as q,w as Se,x as zs,y as Dt,z as Ft,A as ke,B as $s,C as As,D as Ns,E as Ds,F as Fs,G as _s,H as Ts,J as De,K as Rs,L as _t,M as Tt,N as Pe,O as jt,P as Es,Q as Rt,R as Os,S as Et,T as le,U as ct,V as oe,W as Ls,X as je,Y as Us,Z as Vs,_ as Ms,$ as Be,a0 as qs,a1 as Ot,a2 as Bs,a3 as Lt,a4 as Hs,a5 as Ws,a6 as Ut,a7 as Ks,a8 as Gs,a9 as Js,aa as Xs,ab as Ys,ac as Qs}from"./@tabler-552fb1f8.js";import{l as Zs}from"./socket.io-client-22a5d2b6.js";import{D as ae,C as re,P as ie}from"./@hello-pangea-490a609e.js";import{c as tt}from"./cronstrue-e5d11c06.js";import"./scheduler-765c72db.js";import"./clsx-1229b3e0.js";import"./react-remove-scroll-f666ceab.js";import"./tslib-89fde298.js";import"./react-remove-scroll-bar-0f7f50fb.js";import"./react-style-singleton-2b32e474.js";import"./get-nonce-1ea010b7.js";import"./use-sidecar-963ab5df.js";import"./use-callback-ref-66b944cb.js";import"./react-textarea-autosize-5c784669.js";import"./@babel-9e53ba6c.js";import"./use-latest-9995ceb4.js";import"./use-isomorphic-layout-effect-172b4ea6.js";import"./use-composed-ref-213e2f2a.js";import"./react-number-format-dc8ba855.js";import"./@floating-ui-38b1b349.js";import"./react-transition-group-a63a6537.js";import"./fast-deep-equal-d299cf6d.js";import"./klona-192252da.js";import"./react-dropzone-esm-4c866d80.js";import"./prop-types-10f50d8b.js";import"./engine.io-client-7d9b57ef.js";import"./engine.io-parser-b13552ae.js";import"./@socket.io-3e1df240.js";import"./socket.io-parser-44417fca.js";import"./redux-8461dc71.js";import"./react-redux-666e0041.js";import"./hoist-non-react-statics-dc04b2fe.js";import"./react-is-e8e5dbb3.js";import"./use-sync-external-store-a07c9c97.js";import"./use-memo-one-37007388.js";import"./css-box-model-5383974c.js";import"./tiny-invariant-dd7d57d2.js";import"./memoize-one-297ddbcb.js";import"./raf-schd-5404ed65.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function l(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(n){if(n.ep)return;n.ep=!0;const i=l(n);fetch(n.href,i)}})();const el="_navbar_1yx7j_1",tl="_link_1yx7j_33",sl="_links_1yx7j_65",ll="_linkIcon_1yx7j_77",nl="_section_1yx7j_87",ol="_header_1yx7j_107",al="_collectionsHeader_1yx7j_117",rl="_user_1yx7j_129",H={navbar:el,link:tl,links:sl,linkIcon:ll,section:nl,header:ol,collectionsHeader:al,user:rl};function Vt({opened:t,toggle:s}){return e.jsxs(S,{h:s?"100%":void 0,px:s?"md":void 0,justify:"space-between",children:[s&&e.jsx(Jt,{opened:t,onClick:s,hiddenFrom:"sm",size:"sm"}),e.jsx(Me,{order:3,children:"CDAP Provisioner"}),e.jsx(M,{fw:700,children:"v0.4.0"})]})}const He=j.createContext({changeNav:()=>{}}),we=j.createContext({authed:void 0,session:void 0,logout:()=>{},login:()=>{}});function Ue(t={}){const[s,l]=j.useState(t.fetch||!1),[a,n]=j.useState(void 0),[i,o]=j.useState(void 0),[c,r]=j.useState(void 0),[p,u]=j.useState(t.default||void 0),[b,v]=j.useState({}),g={baseURL:`http://${new URL(window.location.href).hostname}:2327/api/v1`,method:"get"},x=gs.create(g),$=j.useCallback(()=>{n(void 0),o(void 0),r(void 0),u(t.default||void 0),v({})},[t]),N=j.useCallback((F={})=>{let m={...t,...F};m.url=(t.url||"")+(m.append_url||"");let D,B;const C=new Promise(function(f,y){D=f,B=y});if(m.preserve||$(),m.before&&m.before({...m,promise:C}),m.furl&&(m.url=m.furl(m)),m.fdata&&(m.data=m.fdata(m)),m.modify&&(m={...m,...m.modify({...m,promise:C})}),!(m.check&&m.check({...m,promise:C}))){if(v(m),l(!0),m.require){for(const f in m.require)if(!m.require[f])return}return x(m).then(f=>{r(f);let y=f.data||f;m.mutate&&(y=m.mutate(y)),y&&u(y),m.then&&m.then(y),D(y)}).catch(f=>{let y="Unknown Error",z;f.message&&(y=f.message),f.response&&f.response.data&&f.response.data.error&&(y=f.response.data.error),f.response&&f.response.data&&f.response.data.message&&(y=f.response.data.message),f.response&&f.response.data&&f.response.data.validation&&(z=f.response.data.validation),z||n(y),z&&o(z),m.catch&&m.catch({error:y,validation:z,status:f.response.status}),B({error:y,validation:z})}).finally(()=>{l(!1),m.finally&&m.finally({...m,promise:C}),m.cleanup&&$()}),C}},[x,t,$]);return j.useEffect(()=>{if(t.require){for(const F in t.require)if(!t.require[F])return}t.fetch&&N()},[]),{fetch:N,post:(F={})=>N({...F,method:"post"}),put:(F={})=>N({...F,method:"put"}),get:(F={})=>N({...F,method:"get"}),del:(F={})=>N({...F,method:"delete"}),reset:$,setData:u,loading:s,request:b,response:c,data:p,error:a,invalid:i}}function il(t={}){if(t.validation&&Object.keys(t.validation).length>0)return;const s=t.error||t.message||JSON.stringify(t);W.show({title:"Error",message:s,color:"red"})}function _({catch:t,modify:s,headers:l={},...a}){const{logout:n}=j.useContext(we);return Ue({catch:({status:o,...c})=>{o===401&&n(),t&&t({status:o,...c}),il(c)},modify:o=>{const c=s?s(o):o;return{headers:{Authorization:`Bearer ${JSON.parse(JSON.parse(localStorage.getItem("auth")||"")||{}).session}`,...l},...c}},...a})}const V=j.createContext({schema:void 0,loading:!1,connectors:[],rules:[],_rules:{},_connectors:{},headers:{},changeSchema:()=>{},reload:()=>{},mutate:()=>{}});function Mt(t){const s=/[<>:"/\\|?*]/g,l=/^(CON|PRN|AUX|NUL|COM[1-9]|LPT[1-9])$/i;return!s.test(t)&&!l.test(t)&&t.length<=260&&t.length>0}function cl({opened:t,close:s,refresh:l}){const{changeSchema:a}=j.useContext(V),n=he({initialValues:{name:""},validate:{name:r=>Mt(r)?null:"Invalid schema name"}}),{post:i,loading:o,error:c}=_({url:"/schema",data:n.values,before:()=>n.validate(),check:()=>!n.isValid(),catch:({validation:r})=>n.setErrors(r),then:r=>{a(r.name),s(),l()}});return e.jsxs(xe,{opened:t,onClose:s,title:"New Schema",children:[e.jsx(k,{label:"Schema Name",placeholder:"Schema Name",leftSection:e.jsx(ge,{size:16,style:{display:"block",opacity:.5}}),withAsterisk:!0,...n.getInputProps("name")}),c&&e.jsx(Xt,{mt:"xs",icon:e.jsx(bs,{size:32}),title:"Error",color:"red",children:c}),e.jsx(S,{justify:"right",mt:"md",children:e.jsx(O,{loading:o,onClick:i,type:"submit",children:"Create Schema"})})]})}function Ve(t,s={}){const[l,a]=j.useState(s.default);return j.useEffect(()=>{const n=new URL(window.location.href),i=Zs(`http://${n.hostname}:2327`);return i.connect(),i.on(t,(o,...c)=>{s.set!==!1&&a(o),s.then&&s.then(o,...c)}),()=>{i.off(t),i.disconnect()}},[]),[l,a]}const dl="_card_11ylv_1",ul="_icon_11ylv_17",pl="_title_11ylv_29",Xe={card:dl,icon:ul,title:pl};function qt({resultant:t}){const[s]=Ve("job_status",{default:"Idle"}),[l]=Ve("progress",{default:{eta:"Estimating...",i:0,p:0,m:0}});return e.jsxs(ve,{radius:"md",withBorder:!0,className:Xe.card,mt:32,mb:32,children:[e.jsx(Yt,{className:Xe.icon,size:60,radius:60,children:t?e.jsx(ze,{style:{width:T(32),height:T(32)},stroke:1.5}):e.jsx(ys,{style:{width:T(32),height:T(32)},stroke:1.5})}),e.jsx(w,{ta:"center",fw:700,className:Xe.title,children:t?"Running Actions":"Finding Matches"}),e.jsx(w,{c:"dimmed",ta:"center",fz:"sm",children:s}),e.jsxs(S,{justify:"space-between",mt:"xs",children:[e.jsx(w,{fz:"sm",c:"dimmed",children:"Progress"}),e.jsxs(w,{fz:"sm",c:"dimmed",children:[Math.floor(l.p),"%"]})]}),e.jsx(Qt,{mt:5,value:l.p,animated:!0}),e.jsxs(S,{justify:"space-between",mt:"md",children:[e.jsxs(w,{fz:"sm",children:[l.i," / ",l.m]}),e.jsx(ft,{size:"sm",children:l.eta})]})]})}const hl=[{icon:Cs,label:"Dashboard"},{icon:Ss,label:"Settings"},{icon:$t,label:"Schedules"}],xl=[{icon:At,label:"Schema"},{icon:Nt,label:"Connectors"},{icon:ks,label:"Rules"}];function mt({link:t,active:s,onClick:l}){return e.jsx(O,{"data-active":s||void 0,fullWidth:!0,variant:"subtle",size:"xs",leftSection:e.jsx(t.icon,{size:20,stroke:1.5}),styles:{inner:{justifyContent:"start"},label:{fontWeight:400}},classNames:{root:H.link},onClick:l,children:t.label})}function jl({closeNav:t}){const{nav:s,changeNav:l}=j.useContext(He),{logout:a,session:n}=j.useContext(we),{schema:i,changeSchema:o,loading:c}=j.useContext(V),r=vt(`(max-width: ${Ct(750)})`),[p,{open:u,close:b}]=te(!1),[v,{open:d,close:g}]=te(!1),[x,$]=j.useState(""),{data:N=[],loading:I,fetch:E}=_({url:"/schema",default:[],preserve:!0,fetch:!0,mutate:D=>D.map(B=>({label:B.name}))}),{del:K}=_({url:"/auth"}),G=()=>{K(),a()};j.useEffect(()=>{I||c||(i||E(),i&&x!==i.name&&(E(),$(i.name)))},[i]);const X=D=>{l(D),r&&t()},[F]=Ve("global_status",{default:{}}),[m]=Ve("progress",{default:{p:0}});return j.useEffect(()=>{F.schema||g()},[F.schema]),e.jsxs("nav",{className:H.navbar,children:[F.schema&&e.jsx(xe,{withCloseButton:!1,size:"xl",opened:v,onClose:g,styles:{body:{padding:0},content:{backgroundColor:"transparent"}},children:e.jsx(ce,{children:e.jsx(qt,{resultant:!1})})}),p&&e.jsx(cl,{opened:p,close:b,refresh:E}),!r&&e.jsx(P,{className:`${H.section} ${H.header}`,children:e.jsx(Vt,{})}),e.jsx(P,{pt:"xs",className:H.section,children:e.jsx(P,{className:H.links,children:hl.map(D=>e.jsx(mt,{onClick:()=>X(D.label),active:s===D.label,link:D},D.label))})}),i&&e.jsx(P,{pt:"xs",className:H.section,children:e.jsx(P,{className:H.links,children:xl.map(D=>e.jsx(mt,{onClick:()=>X(D.label),active:s===D.label,link:D},D.label))})}),e.jsxs(P,{style:{flex:1},className:H.section,children:[e.jsxs(S,{className:H.collectionsHeader,justify:"space-between",children:[e.jsx(w,{size:"xs",fw:500,c:"dimmed",children:"Schemas"}),e.jsx(Oe,{label:"Create schema",withArrow:!0,position:"right",children:e.jsx(A,{onClick:u,loading:I,variant:"default",size:18,children:e.jsx(zt,{style:{width:T(12),height:T(12)},stroke:1.5})})})]}),e.jsx(P,{className:H.links,children:N.map(D=>{const B=(i&&i.name)===D.label;return e.jsx(O,{fullWidth:!0,variant:"subtle",size:"xs",styles:{inner:{justifyContent:"space-between"},label:{fontWeight:400}},classNames:{root:H.link},onClick:()=>B?void 0:o(D.label),loading:c===D.label,disabled:!!c,rightSection:B?e.jsx($e,{onClick:()=>o(void 0),style:{width:T(12),height:T(12),cursor:"pointer"},stroke:1.5}):void 0,"data-active":B?!0:void 0,children:D.label},D.label)})})]}),e.jsx(P,{children:e.jsx(ve,{withBorder:!0,radius:"md",mb:"xs",pb:0,children:e.jsx(Ie,{style:{cursor:F.schema?"pointer":"auto"},disabled:!F.schema,onClick:d,className:H.user,p:"xs",children:e.jsxs(S,{children:[F.schema?e.jsx(Zt,{size:50,roundCaps:!0,thickness:3,sections:[{value:m.p,color:"blue"}],label:e.jsx(ce,{children:F.running?e.jsx(ze,{style:{width:T(20),height:T(20)},stroke:1.5}):e.jsx(Ae,{style:{width:T(20),height:T(20)},stroke:1.5})})}):e.jsx(fs,{style:{width:T(50),height:T(50)},stroke:.5}),e.jsxs("div",{children:[e.jsx(w,{size:"sm",tt:"uppercase",children:"Status:"}),F.schema?e.jsxs(e.Fragment,{children:[e.jsx(w,{c:"dimmed",size:"xs",children:F.running?"Running Actions...":"Finding Matches..."}),e.jsxs(w,{c:"dimmed",size:"xs",children:["Schema: ",F.schema]}),e.jsxs(w,{c:"dimmed",size:"xs",children:["Rule: ",F.rule]})]}):e.jsx(w,{c:"dimmed",size:"xs",children:"Idle"})]})]})})})}),e.jsx(P,{children:e.jsx(ve,{radius:"md",withBorder:!0,p:0,bg:"var(--mantine-color-body)",children:e.jsxs(R,{position:"top-start",width:"target",children:[e.jsx(R.Target,{children:e.jsx(Ie,{className:H.user,children:e.jsxs(S,{children:[e.jsx(Ne,{style:{width:T(20),height:T(20)},stroke:1.5}),e.jsxs("div",{style:{flex:1},children:[e.jsx(w,{size:"sm",fw:500,children:n==null?void 0:n.username}),e.jsx(w,{c:"dimmed",size:"xs",children:"administrator"})]}),e.jsx(at,{style:{width:T(14),height:T(14)},stroke:1.5})]})})}),e.jsx(R.Dropdown,{children:e.jsx(R.Item,{onClick:G,leftSection:e.jsx(vs,{style:{width:T(14),height:T(14)}}),children:"Logout"})})]})})})]})}const ml="_box_xo72w_1",gl="_input_xo72w_7",fe={box:ml,input:gl};function bl({completeSetup:t}){const{login:s}=j.useContext(we),l=he({initialValues:{username:"",password:"",collection:!1},validate:{username:Y("Username can not be empty."),password:Ee({min:5},"Password must be at least 5 characters long.")}}),{post:a,loading:n}=Ue({url:"/setup",data:l.values,then:c=>{t(),s(JSON.stringify(c))},catch:({validation:c})=>l.setErrors(c)}),i=()=>{l.validate(),l.isValid()&&a()},o=c=>c.key==="Enter"&&i();return e.jsxs(lt,{size:420,my:40,children:[e.jsx(Me,{ta:"center",children:"New Installation"}),e.jsx(w,{c:"dimmed",size:"sm",ta:"center",mt:5,children:"Please create the initial administrative user."}),e.jsxs(ve,{className:fe.box,withBorder:!0,shadow:"md",p:30,mt:30,radius:"md",children:[e.jsx(k,{classNames:{input:fe.input},onKeyUp:o,...l.getInputProps("username"),label:"Username",placeholder:"Your Username",required:!0}),e.jsx(ue,{classNames:{input:fe.input},onKeyUp:o,...l.getInputProps("password"),label:"Password",placeholder:"Your password",required:!0,mt:"md"}),e.jsx(S,{justify:"space-between",mt:"lg",children:e.jsx(nt,{...l.getInputProps("collection",{type:"checkbox"}),label:"Allow collection of anonymous statistics"})}),e.jsx(O,{onClick:()=>i(),loading:n,fullWidth:!0,mt:"xl",children:"Create User"})]})]})}function yl(){const[t,s,l]=et({key:"setup",defaultValue:"false"}),[a,n,i]=et({key:"lastLogin",defaultValue:""}),o=()=>s("true"),{login:c}=j.useContext(we),r=he({initialValues:{username:"",password:"",checked:!1},validate:{username:Y("Username can not be empty."),password:Y("Password can not be empty.")}});j.useEffect(()=>{r.setFieldValue("username",a||""),r.setFieldValue("checked",a!=="")},[a]);const{post:p,loading:u}=Ue({url:"/auth",data:r.values,then:d=>{r.values.checked?n(d.username):i(),c(JSON.stringify(d))},catch:({validation:d})=>r.setErrors(d)});Ue({url:"/setup",fetch:!0,then:({status:d})=>d?o():l()});const b=()=>{r.validate(),r.isValid()&&p()},v=d=>d.key==="Enter"&&b();return!t||t=="false"?e.jsx(bl,{completeSetup:o}):e.jsxs(lt,{size:420,my:40,children:[e.jsx(Me,{ta:"center",children:"CDAPP Login"}),e.jsxs(ve,{className:fe.box,withBorder:!0,shadow:"md",p:30,mt:30,radius:"md",children:[e.jsx(k,{classNames:{input:fe.input},onKeyUp:v,...r.getInputProps("username"),label:"Username",placeholder:"Your Username",required:!0,rightSection:a&&e.jsx(A,{variant:"subtle",size:"sm",onClick:()=>i(),children:e.jsx($e,{size:16,style:{display:"block",opacity:.5}})})}),e.jsx(ue,{classNames:{input:fe.input},onKeyUp:v,...r.getInputProps("password"),label:"Password",placeholder:"Your password",required:!0,mt:"md"}),e.jsxs(S,{justify:"space-between",mt:"lg",children:[e.jsx(nt,{label:"Remember me",...r.getInputProps("checked",{type:"checkbox"})}),e.jsx(es,{component:"button",size:"sm",children:"Forgot password?"})]}),e.jsx(O,{onClick:()=>b(),loading:u,fullWidth:!0,mt:"xl",children:"Sign in"})]})]})}function be({children:t,leftSection:s,rightSection:l,...a}){return e.jsxs(S,{justify:"space-between",mb:"xs",children:[e.jsxs(P,{children:[e.jsx(Me,{order:2,...a,children:t}),s]}),e.jsx(P,{}),e.jsx(P,{children:l})]})}const fl="_container_1im94_1",vl="_item_1im94_13",Cl="_input_1im94_25",Sl="_overflow_1im94_33",Z={container:fl,item:vl,input:Cl,overflow:Sl};function ye({children:t,label:s,size:l,...a}){return e.jsxs(lt,{size:l||"lg",children:[typeof s=="string"?e.jsx(be,{...a,children:s}):s,e.jsx(ve,{className:Z.container,p:"xl",children:t})]})}function kl(){const{setColorScheme:t,clearColorScheme:s}=ts(),{changeSchema:l}=j.useContext(V),{get:a,loading:n}=_({url:"/fix",then:()=>{l(void 0),W.show({title:"Success",message:"Cache Purged.",color:"lime"}),setTimeout(()=>location.reload(),1e3)}});return e.jsxs(ye,{label:"Application Settings",children:[e.jsx(Le.Wrapper,{label:"Theme",description:"Change colours of the application",children:e.jsx(St,{mt:"xs",fullWidth:!0,maw:300,onChange:i=>i==="auto"?s():t(i),data:[{label:"Light",value:"light"},{label:"Dark",value:"dark"},{label:"Auto",value:"auto"}]})}),e.jsx(Le.Wrapper,{label:"Clear Cache",description:"Purges the server cache to fix schema inconsistencies, etc.",children:e.jsx(O,{loading:!!n,onClick:()=>a(),mt:5,children:"Fix"})})]})}function wl(t){const[s,{close:l,open:a}]=te(!1);return{Modal:({children:i,...o})=>e.jsx(xe,{size:"lg",opened:s,onClose:l,title:t,...o,children:i}),opened:s,open:a,close:l}}function Il({close:t}){const{schema:s,reload:l}=j.useContext(V),{post:a,loading:n,error:i}=_({url:`/schema/${s==null?void 0:s.name}/import`,headers:{"Content-Type":"multipart/form-data"},modify:c=>(console.log(c),c),then:()=>{t(),l()}}),o=c=>{const r=new FormData;r.append("file",c[0]),a({data:r})};return e.jsx(Te,{loading:n,onDrop:o,accept:["application/zip","application/x-zip-compressed"],children:e.jsxs(S,{justify:"center",gap:"xl",mih:200,style:{pointerEvents:"none"},children:[e.jsx(Te.Accept,{children:e.jsx(ws,{size:50,stroke:1.5})}),e.jsx(Te.Reject,{children:e.jsx($e,{size:50,stroke:1.5})}),e.jsx(Te.Idle,{children:e.jsx(rt,{size:50,stroke:1.5})}),e.jsxs("div",{children:[e.jsx(w,{size:"xl",inline:!0,children:"Drag schema here or click to select file"}),e.jsx(w,{size:"sm",c:"dimmed",inline:!0,mt:7,children:"Import files must be generated by the schema export function"}),i&&e.jsx(w,{c:"red",inline:!0,mt:7,children:i})]})]})})}const Pl="_button_1jnqc_1",zl="_menuControl_1jnqc_11",gt={button:Pl,menuControl:zl};function dt({children:t,options:s=[],onClick:l,loading:a,...n}){return e.jsxs(S,{wrap:"nowrap",gap:0,children:[e.jsx(O,{loading:a,onClick:l,...n,className:gt.button,children:t}),e.jsxs(R,{disabled:a,transitionProps:{transition:"pop"},position:"bottom-end",withinPortal:!0,children:[e.jsx(R.Target,{children:e.jsx(A,{...n,size:36,className:gt.menuControl,children:e.jsx(it,{style:{width:T(16),height:T(16)},stroke:1.5})})}),e.jsx(R.Dropdown,{children:s.map(({label:i,onClick:o,...c},r)=>e.jsx(R.Item,{onClick:o?()=>{o(i)}:void 0,...c,children:i},r))})]})]})}function $l({save:t,saving:s}){const l=ne(),{schema:a,changeSchema:n}=j.useContext(V),{Modal:i,opened:o,open:c,close:r}=wl("Import Schema"),{del:p,loading:u}=_({url:`/schema/${a==null?void 0:a.name}`,then:()=>n(void 0)}),b=()=>ot.openConfirmModal({title:"Delete Schema",centered:!0,children:e.jsx(w,{size:"sm",children:"Are you sure you want to delete this schema? This action is destructive and cannot be reversed."}),labels:{confirm:"Delete schema",cancel:"No don't delete it"},confirmProps:{color:"red"},onConfirm:()=>p()}),v=JSON.parse(JSON.parse(localStorage.getItem("auth")||"")||{}),d=new URL(window.location.href);return e.jsxs(e.Fragment,{children:[o&&e.jsx(i,{children:e.jsx(Il,{close:r})}),e.jsx(dt,{loading:s||u,variant:"light",onClick:t,options:[{component:"a",href:`http://${d.hostname}:2327/api/v1/schema/${a==null?void 0:a.name}/export/${v.session}`,label:"Export",leftSection:e.jsx(Is,{size:16,color:l.colors.green[5]})},{onClick:()=>c(),label:"Import",leftSection:e.jsx(Ps,{size:16,color:l.colors.orange[5]})},{onClick:()=>b(),label:"Delete",leftSection:e.jsx(q,{size:16,color:l.colors.red[5]})}],children:"Save"})]})}function Al(){const{schema:t,mutate:s}=j.useContext(V),l=he({initialValues:t,validate:{name:i=>Mt(i)?null:"Invalid schema name"}}),{put:a,loading:n}=_({url:`/schema/${t==null?void 0:t.name}`,data:l.values,before:()=>l.validate(),check:()=>!l.isValid(),catch:({validation:i})=>l.setErrors(i),then:()=>{s(l.values),W.show({title:"Success",message:"Settings Saved.",color:"lime"})}});return e.jsx(ye,{label:e.jsx(be,{rightSection:e.jsx($l,{saving:n,save:a}),children:"Schema Settings"}),children:e.jsx(k,{label:"Schema Name",placeholder:"Schema Name",leftSection:e.jsx(ge,{size:16,style:{display:"block",opacity:.5}}),withAsterisk:!0,...l.getInputProps("name")})})}const me={ldap:{id:"ldap",name:"Lightweight Directory Access Protocol (LDAP)",icon:Se,color:"blue"},csv:{id:"csv",name:"Comma-Separated Values (CSV)",icon:zs,color:"teal"},stmc:{id:"stmc",name:"eduSTAR Management Centre (STMC)",icon:Dt,color:"red"},proxy:{id:"proxy",name:"Corporate Proxy Server",icon:Ft,color:"orange"}},Nl="_card_1ybk5_1",Dl="_title_1ybk5_9",Fl="_item_1ybk5_19",Ye={card:Nl,title:Dl,item:Fl};function _l({opened:t,close:s,add:l}){const a=ne();return e.jsx(xe,{size:"lg",styles:{content:{backgroundColor:"transparent"},body:{padding:0,margin:0}},opened:t,onClose:s,withCloseButton:!1,children:e.jsxs(ss,{mih:300,withBorder:!0,radius:"md",className:Ye.card,children:[e.jsx(S,{justify:"space-between",children:e.jsx(w,{className:Ye.title,children:"Select a provider"})}),e.jsx(qe,{cols:2,mt:"md",children:Object.values(me).map(n=>e.jsxs(Ie,{onClick:()=>l(n.id),className:Ye.item,children:[e.jsx(n.icon,{color:a.colors[n.color][6],size:"2rem"}),e.jsx(w,{size:"xs",mt:7,children:n.name})]},n.id))})]})})}const Tl={csv:{name:"My CSV",path:""},proxy:{name:"Proxy Server",url:"",username:"",password:""},ldap:{name:"Active Directory",url:"",username:"",password:"",base:"",attributes:[]},stmc:{name:"",username:"",password:"",school:"",cache:1440}},Rl={csv:{name:Y("Name can not be empty."),path:Ee({min:2},"Path must be at least 2 characters long.")},proxy:{name:Y("Name can not be empty."),url:Ee({min:3},"URL must be at least 3 characters long.")},ldap:{name:Y("Name can not be empty."),url:Ee({min:3},"URL must be at least 3 characters long."),username:Y("Username can not be empty."),password:Y("Password can not be empty.")},stmc:{name:Y("Name can not be empty."),username:Y("Username can not be empty."),password:Y("Password can not be empty."),school:Y("School ID can not be empty.")}};function El({form:t}){return e.jsxs(e.Fragment,{children:[e.jsx(k,{label:"Connector Name",leftSection:e.jsx(ge,{size:16,style:{display:"block",opacity:.5}}),placeholder:"File Name",withAsterisk:!0,...t.getInputProps("name")}),e.jsx(k,{label:"File Path",leftSection:e.jsx(ke,{size:16,style:{display:"block",opacity:.5}}),placeholder:"C:/folder/input.csv",withAsterisk:!0,...t.getInputProps("path"),mt:"md"})]})}function se({children:t,label:s="Advanced",rightSection:l,open:a=!1,Icon:n=at,...i}){const[o,{toggle:c}]=te(a);return e.jsxs(P,{children:[e.jsxs(S,{justify:"space-between",grow:!0,children:[e.jsx(Ie,{mt:10,onClick:c,children:e.jsxs(S,{gap:2,children:[e.jsx(w,{...i,children:s}),e.jsx(n,{size:14,style:{transform:o?"rotate(90deg)":"none"}})]})}),l]}),e.jsx(kt,{in:o,children:t})]})}function ut({selectable:t=[],value:s="",onChange:l,createLabel:a}){const n=wt({onDropdownClose:()=>n.resetSelectedOption()}),i=s?[...t,s].filter(function(x,$,N){return N.indexOf(x)==$}):t,[o,c]=j.useState(i),[r,p]=j.useState(s||null),[u,b]=j.useState(s||"");j.useEffect(()=>{b(s)},[s]);const v=o.some(x=>x===u),g=(v?o:o.filter(x=>x.toLowerCase().includes(u.toLowerCase().trim()))).map(x=>e.jsx(J.Option,{value:x,children:x},x));return e.jsxs(J,{store:n,withinPortal:!1,onOptionSubmit:x=>{x==="$create"?(c($=>[...$,u]),p(u),l&&l(u)):(p(x),l&&l(x)),n.closeDropdown()},children:[e.jsx(J.Target,{children:e.jsx(It,{rightSection:e.jsx(J.Chevron,{}),value:u,onChange:x=>{n.openDropdown(),n.updateSelectedOptionIndex(),b(x.currentTarget.value)},onClick:()=>n.openDropdown(),onFocus:()=>n.openDropdown(),onBlur:()=>{n.closeDropdown(),b(s||r||"")},placeholder:"Search value",rightSectionPointerEvents:"none"})}),(o.length>0||u.length>0)&&e.jsx(J.Dropdown,{children:e.jsxs(J.Options,{children:[g,!v&&u.trim().length>0&&e.jsx(J.Option,{value:"$create",children:a?a(u):` + Create ${u}`})]})})]})}const pt=["name","displayName","givenName","SN","description","title","mail","company","department","manager","postalCode","pager","mobile","homephone","telephoneNumber","facsimileTelephoneNumber","wWWHomePage","ipPhone"],Ol=[{label:"== Equal To",value:"=="},{label:"!= Not Equal To",value:"!="},{label:">< Contains",value:"><"},{label:"<> Does Not Contain",value:"<>"},{label:">* Starts With",value:">*"},{label:"*< Ends With",value:"*<"},{label:"// Matches Regex",value:"//"}],Ll=[{label:"== Equal To",value:"==="},{label:"!= Not Equal To",value:"!=="},{label:">  Greater Than",value:">"},{label:"<  Lesser Than",value:"<"},{label:">= Greater Than, Or Equal To",value:">="},{label:"<= Lesser Than, Or Equal To",value:"<="}],Qe=[{label:"String Constraint",id:"string",Icon:$s,color:"blue"},{label:"Math Constraint",id:"math",Icon:As,color:"pink"},{label:"Status",id:"status",connector:"ldap",Icon:Ns,color:"yellow"},{label:"Security Group",id:"group",connector:"ldap",Icon:Ds,color:"cyan"},{label:"Organisational Unit",id:"ou",connector:"ldap",Icon:ke,color:"violet"}],Ul=[{label:"Directory Operations",id:"directory",Icon:Se,color:"blue"},{label:"Document Operations",id:"document",Icon:_t,color:"red"},{label:"File Operations",id:"file",Icon:rt,color:"green"},{label:"Folder Operations",id:"folder",Icon:ke,color:"orange"},{label:"System Operations",id:"system",Icon:Os}],We={"Create User":{id:"Create User",catagory:"directory",Icon:Fs,color:"blue"},"Enable User":{id:"Enable User",catagory:"directory",Icon:_s,color:"green"},"Disable User":{id:"Disable User",catagory:"directory",Icon:Ts,color:"pink"},"Delete User":{id:"Delete User",catagory:"directory",Icon:q,color:"red"},"Update Attributes":{id:"Update Attributes",catagory:"directory",Icon:De,color:"orange"},"Move Organisational Unit":{id:"Move Organisational Unit",catagory:"directory",Icon:Rs,color:"grape"},"Write PDF":{id:"Write PDF",catagory:"document",Icon:_t,color:"red"},"Send To Printer":{id:"Send To Printer",catagory:"document",Icon:Tt,color:"lime"},"Copy File":{id:"Copy File",catagory:"file",Icon:Pe,color:"blue"},"Move File":{id:"Move File",catagory:"file",Icon:jt,color:"orange"},"Delete File":{id:"Delete File",catagory:"file",Icon:q,color:"red"},"Copy Folder":{id:"Copy Folder",catagory:"folder",Icon:Pe,color:"blue"},"Move Folder":{id:"Move Folder",catagory:"folder",Icon:jt,color:"orange"},"Delete Folder":{id:"Delete Folder",catagory:"folder",Icon:q,color:"red"},"Upload Student Passwords":{id:"Upload Student Passwords",catagory:"edustar",Icon:Es,color:"yellow"},Template:{label:"Build Data Template",id:"Template",catagory:"system",Icon:Rt}};function Vl({form:t}){const s=t.values.attributes||[];return e.jsxs(e.Fragment,{children:[s.length===0&&e.jsx(ce,{c:"dimmed",fz:"xs",children:"No attributes configured."}),e.jsx(ae,{onDragEnd:({destination:l,source:a})=>t.reorderListItem("attributes",{from:a.index,to:l?l.index:0}),children:e.jsx(re,{droppableId:"dnd-list",direction:"vertical",children:l=>e.jsxs("div",{...l.droppableProps,style:{top:"auto",left:"auto"},ref:l.innerRef,children:[s.map((a,n)=>e.jsx(ie,{index:n,draggableId:n.toString(),children:i=>e.jsxs(h,{gutter:"xs",align:"center",ref:i.innerRef,mt:"xs",...i.draggableProps,style:{...i.draggableProps.style,left:"auto !important",top:"auto !important"},children:[e.jsx(h.Col,{span:"content",style:{cursor:"grab"},...i.dragHandleProps,children:e.jsx(S,{children:e.jsx(oe,{size:"1.2rem"})})}),e.jsx(h.Col,{span:"auto",children:e.jsx(ut,{selectable:pt,...t.getInputProps(`attributes.${n}`),createLabel:o=>`Add Custom Attribute: ${o}`})}),e.jsx(h.Col,{span:"content",children:e.jsx(S,{gap:0,justify:"flex-end",children:e.jsx(A,{onClick:()=>t.removeListItem("attributes",n),variant:"subtle",color:"red",children:e.jsx(q,{size:"1.2rem",stroke:1.5})})})})]})},n)),l.placeholder]})})})]})}function Ml({form:t,editing:s}){const l=()=>t.setFieldValue("password",""),a=()=>t.insertListItem("attributes","");return e.jsxs(e.Fragment,{children:[e.jsx(k,{label:"Connector Name",leftSection:e.jsx(ge,{size:16,style:{display:"block",opacity:.5}}),placeholder:"Domain Name",withAsterisk:!0,...t.getInputProps("name")}),e.jsx(k,{label:"Target URL",leftSection:e.jsx(Et,{size:16,style:{display:"block",opacity:.5}}),placeholder:"ldaps://10.10.1.1:636",withAsterisk:!0,...t.getInputProps("url"),mt:"md"}),e.jsxs(qe,{mt:"md",cols:{base:1,sm:2},children:[e.jsx(k,{label:"Username",placeholder:"domain\\administrator",withAsterisk:!0,leftSection:e.jsx(Ne,{size:16,style:{display:"block",opacity:.5}}),...t.getInputProps("username")}),typeof t.values.password=="string"||!s?e.jsx(ue,{label:"Password",placeholder:"password",withAsterisk:!0,leftSection:e.jsx(le,{size:16,style:{display:"block",opacity:.5}}),...t.getInputProps("password")}):e.jsx(ue,{label:"Password",readOnly:!0,placeholder:"Password",value:"**************",leftSection:e.jsx(le,{size:16,style:{display:"block",opacity:.5}}),rightSection:e.jsx(A,{variant:"subtle",children:e.jsx(ct,{onClick:()=>l(),size:16,style:{display:"block",opacity:.5}})})})]}),e.jsx(se,{open:!0,label:"Attributes",rightSection:e.jsx(O,{onClick:()=>a(),maw:50,variant:"light",size:"compact-xs",mt:10,children:"Add"}),children:e.jsx(Vl,{form:t})}),e.jsx(se,{children:e.jsx(k,{label:"Base Organizational Unit",description:"All distinguished names will be appended by this path.",placeholder:"ou=child,ou=parent",leftSection:e.jsx(ke,{size:16,style:{display:"block",opacity:.5}}),...t.getInputProps("base"),rightSection:e.jsx(A,{variant:"subtle",children:e.jsx(Ae,{size:16,style:{display:"block",opacity:.5}})})})})]})}function ql({form:t,editing:s}){const l=()=>t.setFieldValue("password","");return e.jsxs(e.Fragment,{children:[e.jsx(k,{label:"Connector Name",leftSection:e.jsx(ge,{size:16,style:{display:"block",opacity:.5}}),placeholder:"Proxy Name",withAsterisk:!0,...t.getInputProps("name")}),e.jsx(k,{label:"Target URL",leftSection:e.jsx(Et,{size:16,style:{display:"block",opacity:.5}}),placeholder:"http://proxy.server:8080",withAsterisk:!0,...t.getInputProps("url"),mt:"md"}),e.jsxs(qe,{mt:"md",cols:{base:1,sm:2},children:[e.jsx(k,{label:"Username",placeholder:"username",...t.getInputProps("username"),leftSection:e.jsx(Ne,{size:16,style:{display:"block",opacity:.5}})}),typeof t.values.password=="string"||!s?e.jsx(ue,{label:"Password",placeholder:"password",leftSection:e.jsx(le,{size:16,style:{display:"block",opacity:.5}}),...t.getInputProps("password")}):e.jsx(ue,{label:"Password",readOnly:!0,placeholder:"Password",value:"**************",leftSection:e.jsx(le,{size:16,style:{display:"block",opacity:.5}}),rightSection:e.jsx(A,{variant:"subtle",children:e.jsx(ct,{onClick:()=>l(),size:16,style:{display:"block",opacity:.5}})})})]})]})}function pe({onChange:t,value:s="",...l}){const{connectors:a,_connectors:n}=j.useContext(V),i=ne(),o=wt({onDropdownClose:()=>o.resetSelectedOption()}),[c,r]=j.useState(s||null);j.useEffect(()=>r(s),[s]);const p=s in n&&me[n[s].id],u=p&&e.jsx(p.icon,{color:i.colors[p.color][6],size:20,stroke:1.5}),b=a||[];l.type&&(l.filter=g=>g.filter(x=>x.id===l.type));const v=(l.filter?l.filter(b):b).map(g=>{const x=me[g.id];return{component:e.jsxs(S,{children:[e.jsx(x.icon,{color:i.colors[x.color][6],size:20,stroke:1.5})," ",g.name]}),value:g.name}}),d=(l.data||v).map(g=>{const x=typeof g=="string";return e.jsx(J.Option,{value:x?g:g.value,children:x?g:g.component},x?g:g.value)});return e.jsx(Le.Wrapper,{...l,children:e.jsxs(J,{store:o,withinPortal:!1,onOptionSubmit:g=>{r(g),t&&t(g),o.closeDropdown()},children:[e.jsx(J.Target,{children:e.jsx(It,{component:"button",type:"button",pointer:!0,leftSection:l.leftSection===!1?void 0:l.leftSection?l.leftSection:u||e.jsx(Nt,{size:16,style:{display:"block",opacity:.5}}),mt:l.label?5:void 0,rightSection:l.clearable&&c!==null?e.jsx(ls,{size:"sm",onMouseDown:g=>g.preventDefault(),onClick:()=>{r(null),t&&t(void 0)},"aria-label":"Clear value"}):e.jsx(J.Chevron,{}),onClick:()=>o.toggleDropdown(),rightSectionPointerEvents:!l.clearable||c===null?"none":"all",children:c||e.jsx(Le.Placeholder,{children:"Select Connector"})})}),e.jsx(J.Dropdown,{children:e.jsx(J.Options,{children:d})})]})})}function Bl({form:t,editing:s}){const l=()=>t.setFieldValue("password","");return e.jsxs(e.Fragment,{children:[e.jsx(k,{label:"Connector Name",leftSection:e.jsx(ge,{size:16,style:{display:"block",opacity:.5}}),placeholder:"School Name",withAsterisk:!0,...t.getInputProps("name")}),e.jsxs(qe,{mt:"md",cols:{base:1,sm:2},children:[e.jsx(k,{label:"Username",placeholder:"ST01235",withAsterisk:!0,leftSection:e.jsx(Ne,{size:16,style:{display:"block",opacity:.5}}),...t.getInputProps("username")}),typeof t.values.password=="string"||!s?e.jsx(ue,{label:"Password",placeholder:"password",withAsterisk:!0,leftSection:e.jsx(le,{size:16,style:{display:"block",opacity:.5}}),...t.getInputProps("password")}):e.jsx(ue,{label:"Password",readOnly:!0,placeholder:"Password",value:"**************",leftSection:e.jsx(le,{size:16,style:{display:"block",opacity:.5}}),rightSection:e.jsx(A,{variant:"subtle",children:e.jsx(ct,{onClick:()=>l(),size:16,style:{display:"block",opacity:.5}})})})]}),e.jsx(k,{label:"School Identification Number",leftSection:e.jsx(Dt,{size:16,style:{display:"block",opacity:.5}}),placeholder:"1234",withAsterisk:!0,...t.getInputProps("school"),mt:"md"}),e.jsxs(se,{children:[e.jsx(ns,{label:"Caching Policy",description:"Minutes until downloaded cache is purged.",leftSection:e.jsx($t,{size:16,style:{display:"block",opacity:.5}}),placeholder:"1440 (1 day)",...t.getInputProps("cache"),mt:"md"}),e.jsx(pe,{label:"Proxy Connector",placeholder:"Corporate Proxy Server",clearable:!0,...t.getInputProps("proxy"),filter:a=>a.filter(n=>n.id==="proxy"),leftSection:e.jsx(Ft,{size:16,style:{display:"block",opacity:.5}}),mt:"md"})]})]})}function Hl({provider:t,form:s,editing:l}){switch(t){case"csv":return e.jsx(El,{form:s});case"ldap":return e.jsx(Ml,{form:s,editing:l});case"proxy":return e.jsx(ql,{form:s,editing:l});case"stmc":return e.jsx(Bl,{form:s,editing:l});default:return e.jsx(e.Fragment,{children:"Invalid Provider."})}}function Wl({editing:t,adding:s,close:l}){const{schema:a,mutate:n}=j.useContext(V),i=s?me[s]:t?me[t.id]:{id:"",name:""},o=Tl[i.id]||{},c=Rl[i.id]||{},r=he({initialValues:o,validate:c});j.useEffect(()=>{r.reset(),t?r.setValues(t):r.setValues(o),r.setInitialValues(o)},[t,s]);const{post:p,loading:u}=_({url:`/schema/${a==null?void 0:a.name}/connector`,data:{...r.values,id:i.id},before:()=>r.validate(),check:()=>!r.isValid(),catch:({validation:x})=>r.setErrors(x),then:({connectors:x,_connectors:$,headers:N})=>{n({connectors:x,_connectors:$,headers:N}),l(),W.show({title:"Success",message:"Connector Added.",color:"lime"})}}),{put:b,loading:v}=_({url:`/schema/${a==null?void 0:a.name}/connector`,data:{...r.values,id:i.id},before:()=>r.validate(),check:()=>!r.isValid(),catch:({validation:x})=>r.setErrors(x),then:({connectors:x,_connectors:$,headers:N})=>{n({connectors:x,_connectors:$,headers:N}),l(),W.show({title:"Success",message:"Connector Saved.",color:"lime"})}}),d=()=>b({append_url:`/${t==null?void 0:t.name}`}),g=u||v;return e.jsxs(xe,{size:"lg",opened:!!t||!!s,onClose:l,title:i.name,children:[e.jsx(Hl,{provider:i.id,form:r,editing:t}),e.jsx(S,{justify:"right",mt:"md",children:e.jsx(O,{loading:g,onClick:t?d:p,variant:"light",type:"submit",children:t?"Save":"Add"})})]})}function Kl(){const{schema:t,connectors:s,mutate:l}=j.useContext(V),a=ne(),[n,{open:i,close:o}]=te(!1),[c,r]=j.useState(void 0),[p,u]=j.useState(void 0),b=I=>{u(void 0),r(I)},v=I=>{o(),r(void 0),u(I)},{del:d,request:g,loading:x}=_({url:`/schema/${t==null?void 0:t.name}/connector`,then:({connectors:I,_connectors:E,headers:K})=>{l({connectors:I,_connectors:E,headers:K}),W.show({title:"Success",message:"Connector Removed.",color:"lime"})}}),$=I=>ot.openConfirmModal({title:"Permanently Delete Connector",centered:!0,children:e.jsxs(w,{size:"sm",children:["Are you sure you want to delete ",I,"? This action is destructive and cannot be reversed."]}),labels:{confirm:"Delete connector",cancel:"No don't delete it"},confirmProps:{color:"red"},onConfirm:()=>d({append_url:`/${I}`,loading:I})}),N=x?g.loading:!1;if(t)return e.jsxs(ye,{label:e.jsx(be,{rightSection:e.jsx(O,{onClick:()=>i(),variant:"light",children:"Add"}),children:"Connectors"}),children:[e.jsx(_l,{add:v,opened:n,close:o}),e.jsx(Wl,{editing:c,adding:p,close:()=>{r(void 0),u(void 0)}}),e.jsxs(ee,{verticalSpacing:"sm",children:[e.jsx(ee.Thead,{children:e.jsxs(ee.Tr,{children:[e.jsx(ee.Th,{children:"Name"}),e.jsx(ee.Th,{children:"Provider"}),e.jsx(ee.Th,{})]})}),e.jsx(ee.Tbody,{children:s.map(I=>{const E=me[I.id];return e.jsxs(ee.Tr,{children:[e.jsx(ee.Td,{children:e.jsxs(S,{miw:100,gap:"sm",children:[e.jsx(E.icon,{color:a.colors[E.color][6],size:20,stroke:1.5}),e.jsx(w,{fz:"sm",children:I.name})]})}),e.jsx(ee.Td,{children:e.jsx(ft,{color:a.colors[E.color][6],variant:"light",children:E.name})}),e.jsx(ee.Td,{miw:80,children:e.jsxs(S,{gap:0,justify:"flex-end",children:[e.jsx(A,{onClick:()=>b(I),variant:"subtle",color:"gray",children:e.jsx(De,{style:{width:T(16),height:T(16)},stroke:1.5})}),e.jsx(A,{onClick:()=>$(I.name),loading:N===I.name,variant:"subtle",color:"red",children:e.jsx(q,{style:{width:T(16),height:T(16)},stroke:1.5})})]})})]},I.name)})})]})]})}const Ke=j.createContext({explorer:e.jsx(e.Fragment,{}),explore:()=>{},close:()=>{}});function Gl({form:t}){const{connectors:s}=j.useContext(V),{explorer:l,explore:a}=j.useContext(Ke),n=s.filter(u=>u.id!=="proxy").length-1,{headers:i}=j.useContext(V),o=()=>t.insertListItem("secondaries",{primary:"",secondaryKey:"",primaryKey:""}),c=u=>t.removeListItem("secondaries",u),r=(t.values.secondaries||[]).map(u=>u.primary),p=()=>u=>t.setFieldValue("display",`${t.values.display||""}{{${u}}}`);return e.jsxs(P,{children:[l,e.jsx(k,{label:"Rule Name",leftSection:e.jsx(ge,{size:16,style:{display:"block",opacity:.5}}),placeholder:"Rule Name",withAsterisk:!0,mb:"xs",...t.getInputProps("name")}),e.jsxs(h,{children:[e.jsx(h.Col,{span:8,children:e.jsx(pe,{label:"Primary Data Source",withAsterisk:!0,description:"Rule conditions will be evaluated for each entry in this connector. For each row, each user, etc.",clearable:!0,...t.getInputProps("primary"),filter:u=>u.filter(b=>b.id!=="proxy")})}),e.jsx(h.Col,{span:4,children:e.jsx(de,{label:"Primary Key",withAsterisk:!0,description:"Unique identifier for each row.",placeholder:"id",data:t.values.primary in i?i[t.values.primary]:[],disabled:!t.values.primary,clearable:!0,searchable:!0,leftSection:e.jsx(le,{size:"1rem"}),...t.getInputProps("primaryKey")})})]}),e.jsxs(S,{grow:!0,justify:"apart",mb:"xs",gap:"xs",children:[e.jsx(w,{size:"sm",children:"Secondary Data Sources"}),e.jsx(S,{justify:"right",gap:"xs",pt:"xs",children:e.jsx(A,{size:"lg",variant:"default",disabled:!t.values.primary||r.length>=n,onClick:o,children:e.jsx(zt,{size:15,stroke:1.5})})})]}),e.jsx(ae,{onDragEnd:({destination:u,source:b})=>t.reorderListItem("secondaries",{from:b.index,to:u?u.index:0}),children:e.jsx(re,{droppableId:"dnd-list",direction:"vertical",children:u=>e.jsx("div",{...u.droppableProps,style:{top:"auto",left:"auto"},ref:u.innerRef,children:(t.values.secondaries||[]).map(({primary:b},v)=>e.jsx(ie,{index:v,draggableId:v.toString(),children:d=>e.jsxs(h,{align:"center",ref:d.innerRef,mt:"xs",...d.draggableProps,gutter:"xs",style:{...d.draggableProps.style,left:"auto !important",top:"auto !important"},children:[e.jsx(h.Col,{span:"content",style:{cursor:"grab"},...d.dragHandleProps,children:e.jsx(S,{children:e.jsx(oe,{size:"1.2rem"})})}),e.jsx(h.Col,{span:"auto",children:e.jsx(pe,{clearable:!0,...t.getInputProps(`secondaries.${v}.primary`),filter:g=>g.filter(x=>x.id!=="proxy"&&x.name!==t.values.primary&&!r.includes(x.name))})}),e.jsx(h.Col,{span:"auto",children:e.jsx(de,{clearable:!0,searchable:!0,placeholder:"Foreign Key",leftSection:e.jsx(le,{size:"1rem"}),disabled:!b,data:b in i?i[b]:[],...t.getInputProps(`secondaries.${v}.secondaryKey`)})}),e.jsx(h.Col,{span:"auto",children:e.jsx(de,{clearable:!0,searchable:!0,placeholder:"Primary Key",leftSection:e.jsx(le,{size:"1rem"}),disabled:!b,data:t.values.primary in i?i[t.values.primary]:[],...t.getInputProps(`secondaries.${v}.primaryKey`)})}),e.jsx(h.Col,{span:"content",children:e.jsx(S,{justify:"right",gap:"xs",children:e.jsx(A,{color:"red",onClick:()=>c(v),variant:"default",size:"lg",children:e.jsx(q,{size:15})})})})]})},v))})})}),e.jsx(k,{label:"Entry Display Name",description:"Displayed on each result row to identify each entry.",leftSection:e.jsx(Ls,{size:16,style:{display:"block",opacity:.5}}),placeholder:"{{username}}",mt:"xs",mb:"xs",rightSection:e.jsx(A,{onClick:()=>a(p),variant:"subtle",children:e.jsx(je,{size:16,style:{display:"block",opacity:.8}})}),...t.getInputProps("display")}),e.jsx(U,{...t.getInputProps("enabled",{type:"checkbox"}),label:"Rule Enabled"}),e.jsx(os,{label:"Rule Description",placeholder:"Describe what this rule does",mt:"xs",...t.getInputProps("description")})]})}const Jl=[{label:"Member of group",value:"member"},{label:"Not member of group",value:"notmember"}],Xl=[{label:"Child of organisational unit",value:"child"},{label:"Not child of organisational unit",value:"notchild"}],Yl=[{label:"Exists on",value:"exists"},{label:"Does not exist on",value:"notexists"},{label:"Enabled on ",value:"enabled"},{label:"Disabled on",value:"disabled"}],Ql=["status"],bt=[];function Zl({form:t,index:s,modifyCondition:l,delimit:a,delimited:n}){const i=n(s,"")?e.jsx(Us,{size:16,style:{display:"block",opacity:.8}}):e.jsx(Vs,{size:16,style:{display:"block",opacity:.8}});return e.jsx(k,{placeholder:"Value",...t.getInputProps(`conditions.${s}.value`),rightSection:e.jsxs(O.Group,{style:{marginRight:30},children:[e.jsxs(R,{position:"bottom-end",children:[e.jsx(R.Target,{children:e.jsx(A,{variant:"subtle",children:i})}),e.jsxs(R.Dropdown,{children:[e.jsx(R.Item,{onClick:a(s,""),disabled:n(s,""),children:"No Delimiter"}),e.jsx(R.Item,{onClick:a(s,","),disabled:n(s,","),children:"Comma ,"}),e.jsx(R.Item,{onClick:a(s,";"),disabled:n(s,";"),children:"Semicolon ;"}),e.jsx(R.Item,{onClick:a(s,"|"),disabled:n(s,"|"),children:"Bar |"}),e.jsx(R.Item,{onClick:a(s,"tab"),disabled:n(s,"tab"),children:"Tab"}),e.jsx(R.Item,{onClick:a(s," "),disabled:n(s," "),children:"Space"})]})]}),e.jsx(A,{variant:"subtle",children:e.jsx(je,{onClick:l("value",s),size:16,style:{display:"block",opacity:.8}})})]})})}function Bt({form:t,label:s}){const l=ne(),{explorer:a,explore:n}=j.useContext(Ke),{_connectors:i}=j.useContext(V),o=(d,g)=>()=>t.insertListItem("conditions",{type:d,key:"",operator:g||(d=="string"||d=="math"?"==":""),value:"",delimiter:""}),c=d=>()=>t.insertListItem("conditions",{...d}),r=d=>()=>t.removeListItem("conditions",d),p=(d,g)=>()=>n(()=>x=>t.setFieldValue(`conditions.${g}.${d}`,`${t.values.conditions[g][d]||""}{{${x}}}`)),u=(d,g)=>()=>t.setFieldValue(`conditions.${d}.delimiter`,g),b=(d,g)=>t.values.conditions[d].delimiter===g,v=t.values.primary in i&&i[t.values.primary].id==="ldap"||(t.values.secondaries||[]).filter(d=>d.primary in i&&i[d.primary].id==="ldap").length>0;return e.jsxs(P,{children:[a,e.jsxs(S,{grow:!0,justify:"apart",mb:"xs",mt:"xs",gap:"xs",children:[e.jsx(w,{c:"dimmed",size:"sm",children:s||"All conditions here will be evaluated and must be true for actions to be executed."}),e.jsx(S,{justify:"right",gap:"xs",children:e.jsxs(R,{position:"bottom-end",children:[e.jsx(R.Target,{children:e.jsx(O,{variant:"light",rightSection:e.jsx(it,{size:"1.05rem",stroke:1.5}),pr:12,children:"Add condition"})}),e.jsxs(R.Dropdown,{children:[e.jsx(R.Label,{children:"Data Sources"}),Qe.filter(d=>!d.connector).map(d=>e.jsx(R.Item,{onClick:o(d.id),leftSection:e.jsx(d.Icon,{color:l.colors[d.color][6],size:"1rem",stroke:1.5}),children:d.label})),v&&e.jsxs(e.Fragment,{children:[e.jsx(R.Label,{children:"Directory"}),Qe.filter(d=>d.connector==="ldap").map(d=>e.jsx(R.Item,{onClick:o(d.id,d.id),leftSection:e.jsx(d.Icon,{color:l.colors[d.color][6],size:"1rem",stroke:1.5}),children:d.label}))]})]})]})})]}),(t.values.conditions||[]).length===0&&e.jsx(w,{c:"lighter",size:"sm",children:"No conditions in effect. Rules must have at least one condition to evaluate."}),e.jsx(ae,{onDragEnd:({destination:d,source:g})=>t.reorderListItem("conditions",{from:g.index,to:d?d.index:0}),children:e.jsx(re,{droppableId:"dnd-list",direction:"vertical",children:d=>e.jsxs("div",{...d.droppableProps,style:{top:"auto",left:"auto"},ref:d.innerRef,children:[(t.values.conditions||[]).map((g,x)=>{const $=Qe.filter(N=>N.id===g.type)[0];return e.jsx(ie,{index:x,draggableId:x.toString(),children:N=>e.jsxs(h,{align:"center",ref:N.innerRef,mt:"xs",...N.draggableProps,gutter:"xs",style:{...N.draggableProps.style,left:"auto !important",top:"auto !important"},children:[e.jsx(h.Col,{span:"content",style:{cursor:"grab"},...N.dragHandleProps,children:e.jsx(S,{children:e.jsx(oe,{size:"1.2rem"})})}),e.jsx(h.Col,{span:"content",children:e.jsx(S,{children:e.jsx(Oe,{label:$.label,children:e.jsx($.Icon,{color:l.colors[$.color][6],size:"1.2rem"})})})}),bt.includes(g.type)&&e.jsx(h.Col,{c:"dimmed",span:"content",children:$.label}),g.type==="string"||g.type==="math"?e.jsx(h.Col,{span:"auto",children:e.jsx(k,{placeholder:"Key",...t.getInputProps(`conditions.${x}.key`),rightSection:e.jsx(A,{onClick:p("key",x),variant:"subtle",children:e.jsx(je,{size:16,style:{display:"block",opacity:.8}})})})}):e.jsx(h.Col,{span:"auto",children:e.jsx(pe,{clearable:!0,...t.getInputProps(`conditions.${x}.key`),filter:I=>I.filter(E=>E.id==="ldap")})}),!bt.includes(g.type)&&e.jsx(h.Col,{span:"content",children:e.jsx(de,{placeholder:"Operator",checkIconPosition:"right",data:{string:Ol,math:Ll,group:Jl,ou:Xl,status:Yl}[g.type],maxDropdownHeight:300,...t.getInputProps(`conditions.${x}.operator`)})}),!Ql.includes(g.type)&&e.jsx(h.Col,{span:"auto",children:e.jsx(Zl,{form:t,index:x,delimit:u,delimited:b,modifyCondition:p})}),e.jsx(h.Col,{span:"content",children:e.jsxs(S,{justify:"right",gap:"xs",children:[e.jsx(A,{onClick:r(x),variant:"default",size:"lg",children:e.jsx(q,{size:15})}),e.jsx(A,{onClick:c(g),variant:"default",size:"lg",children:e.jsx(Pe,{size:15})})]})})]})},x)}),d.placeholder]})})})]})}const en="_control_d0u7x_1",yt={control:en};function tn({form:t,index:s,explorer:l}){return e.jsxs(P,{p:"xs",pt:0,children:[e.jsx(k,{label:"Source File",withAsterisk:!0,description:"Path of file to use as template.",placeholder:"D:/templates/input/user_template.pdf",leftSection:e.jsx(Rt,{size:16,style:{display:"block",opacity:.8}}),...t.getInputProps(`actions.${s}.source`),rightSection:l("source")}),e.jsx(k,{label:"Target File",withAsterisk:!0,description:"Path of file to be written.",placeholder:"D:/templates/ouput/{{username}}.pdf",...t.getInputProps(`actions.${s}.target`),leftSection:e.jsx(Ms,{size:16,style:{display:"block",opacity:.8}}),rightSection:l("target")})]})}function Ze({form:t,index:s,explorer:l}){return e.jsxs(P,{p:"xs",pt:0,children:[e.jsx(pe,{label:"Target Directory",withAsterisk:!0,clearable:!0,leftSection:e.jsx(Se,{size:"1rem"}),...t.getInputProps(`actions.${s}.target`),type:"ldap"}),e.jsx(k,{label:"User Principal Name",withAsterisk:!0,leftSection:e.jsx(Be,{size:16,style:{display:"block",opacity:.8}}),placeholder:"{{username}}@domain.com",...t.getInputProps(`actions.${s}.upn`),rightSection:l("upn")})]})}function sn({form:t,index:s,explorer:l}){const{data:a,loading:n}=_({url:"/printers",fetch:!0,default:[],mutate:r=>r.map(p=>p.name)}),i=t.values.actions[s].target,c=(i?[...a,i]:a).filter((r,p,u)=>p===u.findIndex(b=>b===r));return e.jsxs(P,{p:"xs",pt:0,children:[e.jsx(k,{label:"Source File",withAsterisk:!0,description:"Path of file to print",placeholder:"D:/templates/ouput/{{username}}.pdf",leftSection:e.jsx(rt,{size:16,style:{display:"block",opacity:.8}}),...t.getInputProps(`actions.${s}.source`),rightSection:l("source")}),e.jsx(U,{label:"Validate Source Path",mt:"xs",...t.getInputProps(`actions.${s}.validate`,{type:"checkbox"})}),e.jsx(de,{label:"Target Printer",withAsterisk:!0,clearable:!0,description:"Leave blank to use the systemsdefault printer.",leftSection:n?e.jsx(Ce,{size:"xs"}):e.jsx(Tt,{size:16,style:{display:"block",opacity:.8}}),placeholder:"Select Printer",...t.getInputProps(`actions.${s}.target`),data:c})]})}function ln({form:t,index:s,explore:l}){const a=t.values.actions[s].groups||[],n=o=>()=>l(()=>c=>t.setFieldValue(`actions.${s}.groups.${o}`,`${t.values.actions[s].groups[o]||""}{{${c}}}`)),i=o=>e.jsx(A,{onClick:n(o),variant:"subtle",children:e.jsx(je,{size:16,style:{display:"block",opacity:.8}})});return e.jsxs(e.Fragment,{children:[a.length===0&&e.jsx(ce,{c:"dimmed",fz:"xs",children:"No security groups configured."}),e.jsx(ae,{onDragEnd:({destination:o,source:c})=>t.reorderListItem(`actions.${s}.groups`,{from:c.index,to:o?o.index:0}),children:e.jsx(re,{droppableId:"dnd-list",direction:"vertical",children:o=>e.jsxs("div",{...o.droppableProps,style:{top:"auto",left:"auto"},ref:o.innerRef,children:[a.map((c,r)=>e.jsx(ie,{index:r,draggableId:r.toString(),children:p=>e.jsxs(h,{gutter:"xs",align:"center",ref:p.innerRef,mt:"xs",...p.draggableProps,style:{...p.draggableProps.style,left:"auto !important",top:"auto !important"},children:[e.jsx(h.Col,{span:"content",style:{cursor:"grab"},...p.dragHandleProps,children:e.jsx(S,{children:e.jsx(oe,{size:"1.2rem"})})}),e.jsx(h.Col,{span:"auto",children:e.jsx(k,{placeholder:"CN={{faculty}},OU={{faculty}},OU=Child,OU=Parent",...t.getInputProps(`actions.${s}.groups.${r}`),rightSection:i(r)})}),e.jsx(h.Col,{span:"content",children:e.jsx(S,{gap:0,justify:"flex-end",children:e.jsx(A,{onClick:()=>t.removeListItem(`actions.${s}.groups`,r),variant:"subtle",color:"red",children:e.jsx(q,{size:"1.2rem",stroke:1.5})})})})]})},r)),o.placeholder]})})})]})}function nn({form:t,index:s,explore:l}){const a=t.values.actions[s].attributes||[],n=(o,c)=>()=>l(()=>r=>t.setFieldValue(`actions.${s}.attributes.${c}.${o}`,`${t.values.actions[s].attributes[c][o]||""}{{${r}}}`)),i=(o,c)=>e.jsx(A,{onClick:n(o,c),variant:"subtle",children:e.jsx(je,{size:16,style:{display:"block",opacity:.8}})});return e.jsxs(e.Fragment,{children:[a.length===0&&e.jsx(ce,{c:"dimmed",fz:"xs",children:"No attributes configured."}),e.jsx(ae,{onDragEnd:({destination:o,source:c})=>t.reorderListItem(`actions.${s}.attributes`,{from:c.index,to:o?o.index:0}),children:e.jsx(re,{droppableId:"dnd-list",direction:"vertical",children:o=>e.jsxs("div",{...o.droppableProps,style:{top:"auto",left:"auto"},ref:o.innerRef,children:[a.map((c,r)=>e.jsx(ie,{index:r,draggableId:r.toString(),children:p=>e.jsxs(h,{gutter:"xs",align:"center",ref:p.innerRef,mt:"xs",...p.draggableProps,style:{...p.draggableProps.style,left:"auto !important",top:"auto !important"},children:[e.jsx(h.Col,{span:"content",style:{cursor:"grab"},...p.dragHandleProps,children:e.jsx(S,{children:e.jsx(oe,{size:"1.2rem"})})}),e.jsx(h.Col,{span:"auto",children:e.jsx(ut,{selectable:pt,...t.getInputProps(`actions.${s}.attributes.${r}.name`),createLabel:u=>`Add Custom Attribute: ${u}`})}),e.jsx(h.Col,{span:"auto",children:e.jsx(k,{placeholder:"Value",...t.getInputProps(`actions.${s}.attributes.${r}.value`),rightSection:i("value",r)})}),e.jsx(h.Col,{span:"content",children:e.jsx(S,{gap:0,justify:"flex-end",children:e.jsx(A,{onClick:()=>t.removeListItem(`actions.${s}.attributes`,r),variant:"subtle",color:"red",children:e.jsx(q,{size:"1.2rem",stroke:1.5})})})})]})},r)),o.placeholder]})})})]})}function on({form:t,index:s,explorer:l,explore:a}){t.values.actions[s].attributes||t.setFieldValue(`actions.${s}.attributes`,[]),t.values.actions[s].groups||t.setFieldValue(`actions.${s}.groups`,[]);const n=()=>t.insertListItem(`actions.${s}.attributes`,{name:"",value:""}),i=()=>t.insertListItem(`actions.${s}.groups`,"");return e.jsxs(P,{p:"xs",pt:0,children:[e.jsx(pe,{label:"Target Directory",withAsterisk:!0,clearable:!0,leftSection:e.jsx(Se,{size:"1rem"}),...t.getInputProps(`actions.${s}.target`),type:"ldap"}),e.jsx(k,{label:"Canonical Name",withAsterisk:!0,leftSection:e.jsx(Ne,{size:16,style:{display:"block",opacity:.8}}),placeholder:"{{username}}",...t.getInputProps(`actions.${s}.cn`),rightSection:l("cn")}),e.jsx(k,{label:"User Principal Name",withAsterisk:!0,leftSection:e.jsx(Be,{size:16,style:{display:"block",opacity:.8}}),placeholder:"{{username}}@domain.com",...t.getInputProps(`actions.${s}.upn`),rightSection:l("upn")}),e.jsx(k,{label:"SAM Account Name",withAsterisk:!0,leftSection:e.jsx(qs,{size:16,style:{display:"block",opacity:.8}}),placeholder:"{{username}}",...t.getInputProps(`actions.${s}.sam`),rightSection:l("sam")}),e.jsx(k,{label:"Organizational Unit",withAsterisk:!0,leftSection:e.jsx(ke,{size:16,style:{display:"block",opacity:.8}}),placeholder:"ou={{faculty}},ou=child,ou=parent",...t.getInputProps(`actions.${s}.ou`),rightSection:l("ou")}),e.jsx(k,{label:"Password",leftSection:e.jsx(le,{size:16,style:{display:"block",opacity:.8}}),placeholder:"{{word}}{{rand 1 9}}{{cap (word)}}{{special}}",...t.getInputProps(`actions.${s}.password`),rightSection:l("password")}),e.jsx(U,{label:"User Enabled",disabled:t.values.actions[s].password==="",mt:"xs",...t.getInputProps(`actions.${s}.enable`,{type:"checkbox"})}),e.jsx(se,{open:!0,label:"Attributes",rightSection:e.jsx(O,{onClick:()=>n(),maw:50,variant:"light",size:"compact-xs",mt:10,children:"Add"}),children:e.jsx(nn,{form:t,index:s,explore:a})}),e.jsx(se,{open:!0,label:"Security Groups",rightSection:e.jsx(O,{onClick:()=>i(),maw:50,variant:"light",size:"compact-xs",mt:10,children:"Add"}),children:e.jsx(ln,{form:t,index:s,explore:a})})]})}function an({form:t,index:s,explore:l}){t.values.actions[s].templates||t.setFieldValue(`actions.${s}.templates`,[]);const a=()=>t.insertListItem(`actions.${s}.templates`,{name:"",value:""}),n=t.values.actions[s].templates||[],i=(c,r)=>()=>l(()=>p=>t.setFieldValue(`actions.${s}.templates.${r}.${c}`,`${t.values.actions[s].templates[r][c]||""}{{${p}}}`)),o=(c,r)=>e.jsx(A,{onClick:i(c,r),variant:"subtle",children:e.jsx(je,{size:16,style:{display:"block",opacity:.8}})});return e.jsxs(P,{pt:5,children:[e.jsx(S,{justify:"end",children:e.jsx(O,{onClick:a,variant:"light",size:"compact-xs",children:"Add"})}),e.jsxs(P,{p:"xs",pt:0,children:[n.length===0&&e.jsx(ce,{c:"dimmed",fz:"xs",children:"No templates configured."}),e.jsx(ae,{onDragEnd:({destination:c,source:r})=>t.reorderListItem(`actions.${s}.templates`,{from:r.index,to:c?c.index:0}),children:e.jsx(re,{droppableId:"dnd-list",direction:"vertical",children:c=>e.jsxs("div",{...c.droppableProps,style:{top:"auto",left:"auto"},ref:c.innerRef,children:[n.map((r,p)=>e.jsx(ie,{index:p,draggableId:p.toString(),children:u=>e.jsxs(h,{gutter:"xs",align:"center",ref:u.innerRef,mt:"xs",...u.draggableProps,style:{...u.draggableProps.style,left:"auto !important",top:"auto !important"},children:[e.jsx(h.Col,{span:"content",style:{cursor:"grab"},...u.dragHandleProps,children:e.jsx(S,{children:e.jsx(oe,{size:"1.2rem"})})}),e.jsx(h.Col,{span:"auto",children:e.jsx(k,{placeholder:"Name",...t.getInputProps(`actions.${s}.templates.${p}.name`),rightSection:o("name",p)})}),e.jsx(h.Col,{span:"auto",children:e.jsx(k,{placeholder:"Value",...t.getInputProps(`actions.${s}.templates.${p}.value`),rightSection:o("value",p)})}),e.jsx(h.Col,{span:"content",children:e.jsx(S,{gap:0,justify:"flex-end",children:e.jsx(A,{onClick:()=>t.removeListItem(`actions.${s}.templates`,p),variant:"subtle",color:"red",children:e.jsx(q,{size:"1.2rem",stroke:1.5})})})})]})},p)),c.placeholder]})})})]})]})}function rn({form:t,index:s,explorer:l}){return e.jsxs(P,{p:"xs",pt:0,children:[e.jsx(k,{label:"Target File",withAsterisk:!0,description:"Path of file to be deleted.",placeholder:"D:/templates/ouput/{{username}}.pdf",...t.getInputProps(`actions.${s}.target`),leftSection:e.jsx(Ot,{size:16,style:{display:"block",opacity:.8}}),rightSection:l("target")}),e.jsx(U,{label:"Validate Path",mt:"xs",...t.getInputProps(`actions.${s}.validate`,{type:"checkbox"})})]})}function cn({form:t,index:s,explorer:l}){return e.jsxs(P,{p:"xs",pt:0,children:[e.jsx(k,{label:"Source File",withAsterisk:!0,description:"Path of file to be moved.",placeholder:"D:/source/{{username}}.txt",...t.getInputProps(`actions.${s}.target`),leftSection:e.jsx(Bs,{size:16,style:{display:"block",opacity:.8}}),rightSection:l("source")}),e.jsx(U,{label:"Validate Path",mt:"xs",...t.getInputProps(`actions.${s}.validate`,{type:"checkbox"})}),e.jsx(k,{label:"Target File",withAsterisk:!0,description:"Destination path where file will be placed.",placeholder:"E:/destination/{{username}}.txt",...t.getInputProps(`actions.${s}.target`),leftSection:e.jsx(Lt,{size:16,style:{display:"block",opacity:.8}}),rightSection:l("target")}),e.jsx(U,{label:"Should Overwrite",mt:"xs",...t.getInputProps(`actions.${s}.overwrite`,{type:"checkbox"})})]})}function dn({form:t,index:s,explorer:l}){return e.jsxs(P,{p:"xs",pt:0,children:[e.jsx(k,{label:"Source File",withAsterisk:!0,description:"Path of original file to be copied.",placeholder:"D:/source/{{username}}.txt",...t.getInputProps(`actions.${s}.target`),leftSection:e.jsx(Hs,{size:16,style:{display:"block",opacity:.8}}),rightSection:l("source")}),e.jsx(U,{label:"Validate Path",mt:"xs",...t.getInputProps(`actions.${s}.validate`,{type:"checkbox"})}),e.jsx(k,{label:"Target File",withAsterisk:!0,description:"Destination path where copy will be placed.",placeholder:"E:/destination/{{username}}.txt",...t.getInputProps(`actions.${s}.target`),leftSection:e.jsx(Lt,{size:16,style:{display:"block",opacity:.8}}),rightSection:l("target")}),e.jsx(U,{label:"Should Overwrite",mt:"xs",...t.getInputProps(`actions.${s}.overwrite`,{type:"checkbox"})})]})}function un({form:t,index:s,explorer:l}){return e.jsxs(P,{p:"xs",pt:0,children:[e.jsx(k,{label:"Source Folder",withAsterisk:!0,description:"Path of original folder to be copied.",placeholder:"D:/source/public/",...t.getInputProps(`actions.${s}.target`),leftSection:e.jsx(Ws,{size:16,style:{display:"block",opacity:.8}}),rightSection:l("source")}),e.jsx(U,{label:"Validate Path",mt:"xs",...t.getInputProps(`actions.${s}.validate`,{type:"checkbox"})}),e.jsx(k,{label:"Target Folder",withAsterisk:!0,description:"Destination path where copy will be placed.",placeholder:"E:/destination/{{username}}/",...t.getInputProps(`actions.${s}.target`),leftSection:e.jsx(Ut,{size:16,style:{display:"block",opacity:.8}}),rightSection:l("target")}),e.jsx(U,{label:"Should Overwrite",mt:"xs",...t.getInputProps(`actions.${s}.overwrite`,{type:"checkbox"})})]})}function pn({form:t,index:s,explorer:l}){return e.jsxs(P,{p:"xs",pt:0,children:[e.jsx(k,{label:"Source Folder",withAsterisk:!0,description:"Path of folder to be moved.",placeholder:"D:/source/{{username}}/",...t.getInputProps(`actions.${s}.target`),leftSection:e.jsx(Ks,{size:16,style:{display:"block",opacity:.8}}),rightSection:l("source")}),e.jsx(U,{label:"Validate Path",mt:"xs",...t.getInputProps(`actions.${s}.validate`,{type:"checkbox"})}),e.jsx(k,{label:"Target Folder",withAsterisk:!0,description:"Destination path where copy will be placed.",placeholder:"E:/destination/{{username}}/",...t.getInputProps(`actions.${s}.target`),leftSection:e.jsx(Ut,{size:16,style:{display:"block",opacity:.8}}),rightSection:l("target")}),e.jsx(U,{label:"Should Overwrite",mt:"xs",...t.getInputProps(`actions.${s}.overwrite`,{type:"checkbox"})})]})}function hn({form:t,index:s,explorer:l}){return e.jsxs(P,{p:"xs",pt:0,children:[e.jsx(k,{label:"Target Folder",withAsterisk:!0,description:"Path of folder to be deleted.",placeholder:"D:/temp/{{username}}/",...t.getInputProps(`actions.${s}.target`),leftSection:e.jsx(Ot,{size:16,style:{display:"block",opacity:.8}}),rightSection:l("target")}),e.jsx(U,{label:"Validate Path",mt:"xs",...t.getInputProps(`actions.${s}.validate`,{type:"checkbox"})})]})}function xn({form:t,index:s,explorer:l}){return e.jsxs(P,{p:"xs",pt:0,children:[e.jsx(pe,{label:"Target Directory",withAsterisk:!0,clearable:!0,leftSection:e.jsx(Se,{size:"1rem"}),...t.getInputProps(`actions.${s}.target`),type:"ldap"}),e.jsx(k,{label:"User Principal Name",withAsterisk:!0,leftSection:e.jsx(Be,{size:16,style:{display:"block",opacity:.8}}),placeholder:"{{username}}@domain.com",...t.getInputProps(`actions.${s}.upn`),rightSection:l("upn")}),e.jsx(k,{label:"Organizational Unit",withAsterisk:!0,leftSection:e.jsx(ke,{size:16,style:{display:"block",opacity:.8}}),placeholder:"ou={{faculty}},ou=child,ou=parent",...t.getInputProps(`actions.${s}.ou`),rightSection:l("ou")})]})}function jn({form:t,index:s,explore:l}){const a=t.values.actions[s].attributes||[],n=(o,c)=>()=>l(()=>r=>t.setFieldValue(`actions.${s}.attributes.${c}.${o}`,`${t.values.actions[s].attributes[c][o]||""}{{${r}}}`)),i=(o,c)=>e.jsx(A,{onClick:n(o,c),variant:"subtle",children:e.jsx(je,{size:16,style:{display:"block",opacity:.8}})});return e.jsxs(e.Fragment,{children:[a.length===0&&e.jsx(ce,{c:"dimmed",fz:"xs",children:"No attributes configured."}),e.jsx(ae,{onDragEnd:({destination:o,source:c})=>t.reorderListItem(`actions.${s}.attributes`,{from:c.index,to:o?o.index:0}),children:e.jsx(re,{droppableId:"dnd-list",direction:"vertical",children:o=>e.jsxs("div",{...o.droppableProps,style:{top:"auto",left:"auto"},ref:o.innerRef,children:[a.map((c,r)=>e.jsx(ie,{index:r,draggableId:r.toString(),children:p=>e.jsxs(h,{gutter:"xs",align:"center",ref:p.innerRef,mt:"xs",...p.draggableProps,style:{...p.draggableProps.style,left:"auto !important",top:"auto !important"},children:[e.jsx(h.Col,{span:"content",style:{cursor:"grab"},...p.dragHandleProps,children:e.jsx(S,{children:e.jsx(oe,{size:"1.2rem"})})}),e.jsx(h.Col,{span:2,children:e.jsx(de,{defaultValue:"Replace",data:["Add","Replace","Delete"],...t.getInputProps(`actions.${s}.attributes.${r}.type`)})}),e.jsx(h.Col,{span:"auto",children:e.jsx(ut,{selectable:pt,...t.getInputProps(`actions.${s}.attributes.${r}.name`),createLabel:u=>`Add Custom Attribute: ${u}`})}),t.values.actions[s].attributes[r].type!=="Delete"&&e.jsx(h.Col,{span:"auto",children:e.jsx(k,{placeholder:"Value",...t.getInputProps(`actions.${s}.attributes.${r}.value`),rightSection:i("value",r)})}),e.jsx(h.Col,{span:"content",children:e.jsx(S,{gap:0,justify:"flex-end",children:e.jsx(A,{onClick:()=>t.removeListItem(`actions.${s}.attributes`,r),variant:"subtle",color:"red",children:e.jsx(q,{size:"1.2rem",stroke:1.5})})})})]})},r)),o.placeholder]})})})]})}function mn({form:t,index:s,explore:l,explorer:a}){t.values.actions[s].attributes||t.setFieldValue(`actions.${s}.attributes`,[]),t.values.actions[s].groups||t.setFieldValue(`actions.${s}.groups`,[]);const n=()=>t.insertListItem(`actions.${s}.attributes`,{name:"",value:"",type:"Replace"});return e.jsxs(P,{p:"xs",pt:0,children:[e.jsx(pe,{label:"Target Directory",withAsterisk:!0,clearable:!0,leftSection:e.jsx(Se,{size:"1rem"}),...t.getInputProps(`actions.${s}.target`),type:"ldap"}),e.jsx(k,{label:"User Principal Name",withAsterisk:!0,leftSection:e.jsx(Be,{size:16,style:{display:"block",opacity:.8}}),placeholder:"{{username}}@domain.com",...t.getInputProps(`actions.${s}.upn`),rightSection:a("upn")}),e.jsx(se,{open:!0,label:"Attributes",rightSection:e.jsx(O,{onClick:()=>n(),maw:50,variant:"light",size:"compact-xs",mt:10,children:"Add"}),children:e.jsx(jn,{form:t,index:s,explore:l})})]})}function gn({add:t}){const[s,{close:l,open:a}]=te(!1),n=ne(),i=Object.values(We),o=c=>()=>{t(c),l()};return e.jsx(S,{justify:"right",gap:"xs",children:e.jsxs(Je,{width:300,position:"left-start",shadow:"md",opened:s,children:[e.jsx(Je.Target,{children:e.jsx(O,{variant:"light",onClick:s?l:a,rightSection:e.jsx(it,{size:"1.05rem",stroke:1.5}),pr:12,children:"Add Action"})}),e.jsx(Je.Dropdown,{children:Ul.map(c=>e.jsx(xt,{label:c.label,className:yt.control,leftSection:e.jsx(c.Icon,{color:c.color?n.colors[c.color][6]:void 0,size:"1rem",stroke:1.5}),childrenOffset:28,children:i.filter(r=>r.catagory===c.id).map(r=>e.jsx(xt,{label:r.label||r.id,className:yt.control,onClick:o(r.id),leftSection:e.jsx(r.Icon,{color:r.color?n.colors[r.color][6]:void 0,size:"1rem",stroke:1.5})},r.id))},c.id))})]})})}function bn({form:t,index:s,a:l,explore:a}){const[n,{toggle:i}]=te(!1),o=ne(),{Icon:c,color:r}=We[l.name],p=d=>()=>t.insertListItem("actions",{...d}),u=d=>()=>t.removeListItem("actions",d),b=d=>()=>a(()=>g=>t.setFieldValue(`actions.${s}.${d}`,`${t.values.actions[s][d]||""}{{${g}}}`)),v=d=>e.jsx(A,{onClick:b(d),variant:"subtle",children:e.jsx(je,{size:16,style:{display:"block",opacity:.8}})});return e.jsxs(e.Fragment,{children:[e.jsxs(h.Col,{span:"auto",children:[s+1,". ",e.jsx(c,{color:r?o.colors[r][6]:void 0,size:18,stroke:1.5})," ",l.name]}),e.jsx(h.Col,{span:"content",children:e.jsxs(S,{justify:"right",gap:"xs",children:[e.jsx(A,{onClick:()=>i(),variant:n?"filled":"default",size:"lg",children:e.jsx(De,{size:15})}),e.jsx(A,{onClick:u(s),variant:"default",size:"lg",children:e.jsx(q,{size:15})}),e.jsx(A,{onClick:p(l),variant:"default",size:"lg",children:e.jsx(Pe,{size:15})})]})}),e.jsx(h.Col,{span:12,pt:0,pb:0,children:e.jsx(kt,{in:n,children:{"Send To Printer":e.jsx(sn,{form:t,index:s,explorer:v}),"Write PDF":e.jsx(tn,{form:t,index:s,explorer:v}),"Enable User":e.jsx(Ze,{form:t,index:s,explorer:v}),"Disable User":e.jsx(Ze,{form:t,index:s,explorer:v}),"Delete User":e.jsx(Ze,{form:t,index:s,explorer:v}),"Move Organisational Unit":e.jsx(xn,{form:t,index:s,explorer:v}),"Create User":e.jsx(on,{form:t,index:s,explorer:v,explore:a}),"Update Attributes":e.jsx(mn,{form:t,index:s,explorer:v,explore:a}),"Delete File":e.jsx(rn,{form:t,index:s,explorer:v}),"Move File":e.jsx(cn,{form:t,index:s,explorer:v}),"Copy File":e.jsx(dn,{form:t,index:s,explorer:v}),"Copy Folder":e.jsx(un,{form:t,index:s,explorer:v}),"Move Folder":e.jsx(pn,{form:t,index:s,explorer:v}),"Delete Folder":e.jsx(hn,{form:t,index:s,explorer:v}),Template:e.jsx(an,{form:t,index:s,explore:a})}[l.name]})})]})}function yn({form:t}){const{explorer:s,explore:l}=j.useContext(Ke),a=n=>t.insertListItem("actions",{name:n});return e.jsxs(P,{children:[s,e.jsxs(S,{grow:!0,justify:"apart",mb:"xs",mt:"xs",gap:"xs",children:[e.jsx(w,{c:"dimmed",size:"sm",children:"Actions will be executed sequentially if all conditions evaluated successfully."}),e.jsx(gn,{add:a})]}),(t.values.actions||[]).length===0&&e.jsx(w,{c:"lighter",size:"sm",children:"No actions to perform."}),e.jsx(ae,{onDragEnd:({destination:n,source:i})=>t.reorderListItem("actions",{from:i.index,to:n?n.index:0}),children:e.jsx(re,{droppableId:"dnd-list",direction:"vertical",children:n=>e.jsxs("div",{...n.droppableProps,style:{top:"auto",left:"auto"},ref:n.innerRef,children:[(t.values.actions||[]).map((i,o)=>e.jsx(ie,{index:o,draggableId:o.toString(),children:c=>e.jsxs(h,{align:"center",ref:c.innerRef,mt:"xs",...c.draggableProps,gutter:"xs",style:{...c.draggableProps.style,left:"auto !important",top:"auto !important"},children:[e.jsx(h.Col,{span:"content",style:{cursor:"grab"},...c.dragHandleProps,children:e.jsx(S,{children:e.jsx(oe,{size:"1.2rem"})})}),e.jsx(bn,{form:t,index:o,a:i,explore:l})]})},o)),n.placeholder]})})})]})}function fn({editing:t,close:s}){const{schema:l,mutate:a}=j.useContext(V),[n,i]=j.useState("settings"),o={secondaries:[],conditions:[],actions:[]},c=he({initialValues:o,validate:{}});j.useEffect(()=>{c.reset(),t?c.setValues(t):c.setValues(o),c.setInitialValues(o)},[t]);const{post:r,loading:p}=_({url:`/schema/${l==null?void 0:l.name}/rule`,data:{...c.values},catch:({validation:x})=>c.setErrors(x),then:({rules:x,_rules:$})=>{a({rules:x,_rules:$}),s(),W.show({title:"Success",message:"Rule Added.",color:"lime"})}}),{put:u,loading:b}=_({url:`/schema/${l==null?void 0:l.name}/rule/${t==null?void 0:t.name}`,data:{...c.values},catch:({validation:x})=>c.setErrors(x),then:({rules:x,_rules:$})=>{a({rules:x,_rules:$}),s(),W.show({title:"Success",message:"Rule Saved.",color:"lime"})}}),v=p||b,d=!c.values.primary||!c.values.primaryKey,g=d||(c.values.conditions||[]).length<=0;return e.jsx(P,{children:e.jsx(ye,{label:e.jsxs(be,{rightSection:e.jsx(dt,{loading:v,variant:"light",onClick:t?u:r,options:[{onClick:()=>s(),label:"Cancel",leftSection:e.jsx($e,{size:16})}],children:t?"Save":"Create"}),children:["Rule",t?" - Edit":" - New"]}),children:e.jsxs(L,{value:n,onChange:i,children:[e.jsxs(L.List,{children:[e.jsx(L.Tab,{value:"settings",leftSection:e.jsx(At,{size:"0.8rem"}),children:"Settings"}),e.jsx(L.Tab,{value:"conditions",disabled:d,leftSection:e.jsx(Gs,{size:"0.8rem"}),children:"Conditions"}),e.jsx(L.Tab,{value:"actions",disabled:g,leftSection:e.jsx(ze,{size:"0.8rem"}),children:"Actions"})]}),e.jsx(L.Panel,{value:"settings",p:"xs",children:n==="settings"&&e.jsx(Gl,{form:c})}),e.jsx(L.Panel,{value:"conditions",children:e.jsx(Bt,{form:c})}),e.jsx(L.Panel,{value:"actions",children:e.jsx(yn,{form:c})})]})})})}function vn({action:t,resultant:s}){if(!t.result.data)return e.jsx(e.Fragment,{});const l=t.result.data;return e.jsxs(P,{children:[e.jsxs(w,{fz:"sm",children:["Canonical Name: ",e.jsx(M,{children:l.cn||""})]}),e.jsxs(w,{fz:"sm",children:["User Principal Name: ",e.jsx(M,{children:l.upn||""})]}),e.jsxs(w,{fz:"sm",children:["SAM Account Name: ",e.jsx(M,{children:l.sam||""})]}),e.jsx(P,{className:Z.overflow,children:e.jsxs(w,{fz:"sm",children:["Organizational Unit: ",e.jsxs(M,{children:[l.ou||"",",",l.base||""]})]})}),e.jsx(P,{className:Z.overflow,children:e.jsxs(w,{fz:"sm",children:["Organizational Unit: ",e.jsx(M,{children:l.dn||""})]})}),e.jsxs(w,{fz:"sm",children:[s?"":"Sample ","Password: ",e.jsx(M,{children:l.password||""})]}),e.jsxs(w,{fz:"xs",pt:"xs",children:["Account will be ",l.enable?"enabled":"disabled"," on creation."]}),e.jsx(se,{fz:"sm",label:"Attributes",children:e.jsx(Q,{size:"xs",icon:e.jsx(e.Fragment,{children:"-"}),children:(l.attributes||[]).map(({name:a,value:n})=>e.jsxs(Q.Item,{children:[a,": ",e.jsx(M,{children:n})]},a))})}),e.jsx(se,{fz:"sm",label:"Security Groups",children:e.jsx(Q,{size:"xs",icon:e.jsx(e.Fragment,{children:"-"}),children:(l.groups||[]).map((a,n)=>e.jsx(Q.Item,{className:Z.overflow,children:e.jsx(P,{style:{whiteSpace:"nowrap"},children:a})},n))})})]})}function Cn({action:t}){if(!t.result.data)return e.jsx(e.Fragment,{});const s=t.result.data;return e.jsx(P,{children:e.jsx(Q,{size:"sm",icon:e.jsx(e.Fragment,{children:"-"}),children:Object.keys(s||[]).map((l,a)=>e.jsx(Q.Item,{className:Z.overflow,children:e.jsxs(P,{style:{whiteSpace:"nowrap"},children:[l,": ",e.jsx(M,{children:JSON.stringify(s[l])})]})},a))})})}function Sn({change:t,r:s}){switch(t.type){case"Replace":return e.jsxs(Q.Item,{className:Z.overflow,children:[t.name,": ",e.jsxs(M,{children:["Replace",s&&"d"," ",t.currentValue||"<undefined>"," with '",t.value,"'"]})]},t.name);case"Add":return e.jsxs(Q.Item,{className:Z.overflow,children:[t.name,": ",e.jsxs(M,{children:["Set to '",t.value,"'"]})]},t.name);case"Delete":return e.jsxs(Q.Item,{className:Z.overflow,children:["delete",s&&"d",": ",e.jsx(M,{children:t.name})]},t.name)}}function kn({action:t,resultant:s}){if(!t.result.data)return e.jsx(e.Fragment,{});const l=t.result.data,a=(l.changes||[]).filter(n=>n.error);return e.jsxs(P,{children:[e.jsxs(w,{fz:"sm",children:["Directory: ",e.jsx(M,{children:l.directory||""})]}),e.jsxs(w,{fz:"sm",children:["User Principal Name: ",e.jsx(M,{children:l.upn||""})]}),e.jsx(se,{fz:"sm",label:"Changes",open:!0,children:e.jsx(Q,{size:"xs",icon:e.jsx(e.Fragment,{children:"-"}),children:(l.changes||[]).map(n=>e.jsx(Sn,{change:n,r:s}))})}),a.length>0&&e.jsx(se,{fz:"sm",label:"Errors",open:!0,children:e.jsx(Q,{size:"xs",icon:e.jsx(e.Fragment,{children:"-"}),children:a.map(n=>e.jsxs(Q.Item,{className:Z.overflow,children:[n.name,": ",e.jsx(M,{children:n.error})]},n.name))})})]})}function wn(t,s){return!!(s.id.includes(t)||s.display.includes(t))}function In({match:t,toggle:s,setAction:l,resultant:a=!1,dash:n}){const i=ne();return e.jsxs(h,{align:"center",children:[e.jsx(h.Col,{pl:"lg",span:1,children:!a&&e.jsx(U,{disabled:!t.actionable,onChange:s(t.id),checked:!!t.checked})}),n&&e.jsx(h.Col,{span:1,children:t.schema}),n&&e.jsx(h.Col,{span:1,children:t.rule}),e.jsx(h.Col,{span:2,children:t.id}),e.jsx(h.Col,{span:n?5:7,children:t.display}),e.jsx(h.Col,{span:2,children:t.actions.map((o,c)=>{const{Icon:r,color:p}=We[o.name];return o.result.warning?e.jsx(r,{onClick:()=>l(o),style:{cursor:"pointer"},color:i.colors.gray[8],size:16,stroke:2},c):o.result.error?e.jsx(cs,{size:6,offset:3,color:"red",inline:!0,children:e.jsx(r,{onClick:()=>l(o),style:{cursor:"pointer"},color:p?i.colors[p][6]:void 0,size:16,stroke:2})},c):e.jsx(r,{onClick:()=>l(o),style:{cursor:"pointer"},color:p?i.colors[p][6]:void 0,size:16,stroke:2},c)})})]},t.id)}function Pn({action:t,resultant:s=!1}){switch(t.name){case"Create User":return e.jsx(vn,{action:t,resultant:s});case"Update Attributes":return e.jsx(kn,{action:t,resultant:s});default:return e.jsx(Cn,{action:t,resultant:s})}}function st({id:t,matches:s,loading:l,setData:a,run:n,resultant:i=!1,dash:o=!1}){const[c,r]=j.useState(!0),[p,u]=j.useState(""),[b,v]=j.useState("15"),d=s.filter(m=>c?!0:!!m.actionable),g=m=>()=>a((d||[]).map(D=>D.id!==m?D:{...D,checked:!D.checked})),x=(d||[]).filter(m=>m.checked),$=x.length>0,N=()=>()=>a($?(d||[]).map(m=>({...m,checked:!1})):(d||[]).map(m=>m.actionable?{...m,checked:!0}:m)),[I,E]=j.useState(void 0),K=p===""?d||[]:(d||[]).filter(m=>wn(p,m)),G=Math.ceil(K.length/Number(b)),X=as({total:G,initialPage:1}),F=K.slice((X.active-1)*Number(b),X.active*Number(b));return e.jsxs(P,{pb:"xs",children:[!l&&e.jsxs(e.Fragment,{children:[e.jsx(xe,{title:`${I==null?void 0:I.name} ${i?"Result":"Preview"}`,opened:!!I,onClose:()=>E(void 0),styles:{header:{paddingBottom:0}},children:I&&e.jsxs(e.Fragment,{children:[I.result.warning&&e.jsx(w,{c:"orange",children:I.result.warning}),I.result.error&&e.jsx(w,{c:"red",children:I.result.error}),e.jsx(Pn,{action:I,resultant:i}),e.jsx(se,{fz:"xs",label:"Raw Output",children:e.jsx("pre",{style:{margin:0},children:e.jsx(M,{fz:"xs",children:JSON.stringify(I,null,2)})})})]})}),e.jsxs(h,{justify:"center",children:[e.jsx(h.Col,{span:2,children:e.jsx(k,{mt:"xs",variant:"filled",placeholder:`Search ${(d||[]).length} entries...`,leftSection:e.jsx(Ae,{size:15}),value:p,onChange:m=>u(m.currentTarget.value)})}),!o&&e.jsx(h.Col,{span:2,children:!i&&e.jsx(S,{justify:"right",children:e.jsx(nt,{labelPosition:"left",mt:17,label:"Display Actionless",checked:c,onChange:()=>r(!c)})})}),e.jsx(h.Col,{span:2,children:e.jsx(de,{mt:"xs",variant:"filled",placeholder:"Pick one",onChange:m=>v(m),value:b,data:[{value:"5",label:"5 Per Page"},{value:"15",label:"15 Per Page"},{value:"25",label:"25 Per Page"},{value:"50",label:"50 Per Page"},{value:"100",label:"100 Per Page"}]})}),e.jsx(h.Col,{span:"auto",children:e.jsx(rs,{mt:12,onChange:m=>X.setPage(m),value:X.active,total:G})}),e.jsx(h.Col,{span:2,children:!i&&e.jsxs(O,{onClick:n,leftSection:e.jsx(ze,{}),disabled:!$,mt:"xs",children:["Run ",x.length," Actions"]})})]}),e.jsx(is,{mt:"xs"})]}),l&&e.jsx(S,{justify:"center",children:e.jsx(qt,{resultant:i})}),d&&!l&&e.jsxs(e.Fragment,{children:[e.jsxs(h,{pt:"xs",align:"center",children:[e.jsx(h.Col,{pl:"lg",span:1,children:!i&&e.jsx(U,{onChange:N(),checked:$})}),o&&e.jsx(h.Col,{span:1,fw:"bold",children:"Schema"}),o&&e.jsx(h.Col,{span:1,fw:"bold",children:"Rule"}),e.jsx(h.Col,{span:2,fw:"bold",children:t||"ID"}),e.jsx(h.Col,{span:o?5:7,fw:"bold",children:"Display"}),e.jsx(h.Col,{span:2,fw:"bold",children:"Actions"})]}),F.map(m=>e.jsx(In,{match:m,toggle:g,setAction:D=>E(D),resultant:i,dash:o},m.id))]})]})}function zn({rule:t,close:s}){const{schema:l}=j.useContext(V),[a,n]=j.useState("conditions"),o=he({initialValues:{secondaries:[],conditions:[],actions:[]},validate:{}});j.useEffect(()=>{o.reset(),t&&o.setValues(t)},[t]);const c=o.values.conditions.length>0,{data:r,post:p,loading:u,reset:b,setData:v}=_({url:`/schema/${l==null?void 0:l.name}/rules/match`,data:{...t,conditions:o.values.conditions}}),{data:d,post:g,loading:x,reset:$,setData:N}=_({url:`/schema/${l==null?void 0:l.name}/rules/run`,data:{...t,conditions:o.values.conditions,matches:(r||[]).filter(G=>G.checked).map(G=>G.id)}}),I=()=>{b(),$()},E=()=>{I(),s(),n("conditions")},K=()=>{n("results"),g()};return e.jsx(xe,{withCloseButton:!1,size:"80%",opened:!!t,closeOnClickOutside:!1,onClose:E,styles:{body:{padding:0}},children:t&&e.jsxs(L,{p:0,value:a,onChange:n,children:[e.jsxs(L.List,{children:[e.jsx(L.Tab,{disabled:u,onClick:I,value:"conditions",children:"Conditions"}),e.jsx(L.Tab,{disabled:u||!c,leftSection:u?e.jsx(Ce,{size:15}):e.jsx(Ae,{size:15}),value:"matches",onClick:p,children:"Find Matches"}),e.jsx(L.Tab,{disabled:!0,leftSection:x?e.jsx(Ce,{size:15}):e.jsx(ze,{size:15}),value:"results",children:"Results"}),e.jsx(L.Tab,{ml:"auto",disabled:!0,value:"log",children:"Log"}),e.jsx(L.Tab,{leftSection:e.jsx($e,{size:"0.8rem"}),value:"close","aria-label":"close",onClick:E})]}),e.jsx(L.Panel,{mih:300,p:"xs",pt:0,value:"conditions",children:e.jsx(Bt,{form:o,label:"Add single-run modifications here."})}),e.jsx(L.Panel,{value:"matches",children:e.jsx(st,{id:t==null?void 0:t.primaryKey,matches:r||[],loading:u,setData:v,run:K})}),e.jsx(L.Panel,{value:"results",children:e.jsx(st,{id:t==null?void 0:t.primaryKey,matches:d||[],loading:x,setData:N,resultant:!0})})]})})}function $n(){const{schema:t,rules:s,mutate:l}=j.useContext(V),a=ne(),[n,{open:i,close:o}]=te(!1),[c,r]=j.useState(void 0),[p,u]=j.useState(void 0),b=y=>{u(y),i()},v=y=>{r(y)},{del:d,request:g,loading:x}=_({cleanup:!0,furl:({name:y})=>`/schema/${t==null?void 0:t.name}/rule/${y}`,fdata:({name:y})=>({name:y}),then:({rules:y,_rules:z})=>{l({rules:y,_rules:z}),W.show({title:"Success",message:"Rule Removed.",color:"lime"})}}),{post:$,request:N,loading:I}=_({cleanup:!0,furl:({name:y})=>`/schema/${t==null?void 0:t.name}/rule/${y}/copy`,fdata:({name:y})=>({name:y}),then:({rules:y,_rules:z})=>{l({rules:y,_rules:z}),W.show({title:"Success",message:"Rule Copied.",color:"lime"})}}),{put:E,loading:K}=_({cleanup:!0,furl:({name:y})=>`/schema/${t==null?void 0:t.name}/rule/${y}/toggle`,fdata:({name:y})=>({name:y}),then:({rules:y,_rules:z})=>{l({rules:y,_rules:z})}}),{put:G,loading:X}=_({cleanup:!0,url:`/schema/${t==null?void 0:t.name}/rules/reorder`,then:({rules:y})=>{l({rules:y})}}),F=y=>ot.openConfirmModal({title:"Permanently Delete Rule",centered:!0,children:e.jsxs(w,{size:"sm",children:["Are you sure you want to delete ",y,"? This action is destructive and cannot be reversed."]}),labels:{confirm:"Delete rule",cancel:"No don't delete it"},confirmProps:{color:"red"},onConfirm:()=>d({name:y})}),m=x||I||X||K,[D,B]=Pt(s);j.useEffect(()=>B.setState(s),[s]);const C=(y,z)=>{B.reorder({from:y,to:z}),G({data:{from:y,to:z}})},f=y=>{B.setState(s.map(z=>z.name!==y.name?z:{...z,enabled:!y.enabled})),E({name:y.name})};if(t)return n?e.jsx(fn,{editing:p,close:()=>{o(),u(void 0)}}):e.jsxs(ye,{label:e.jsx(be,{rightSection:e.jsx(O,{onClick:()=>i(),variant:"light",children:"Add"}),children:"Rules"}),children:[e.jsx(zn,{rule:c,close:()=>r(void 0)}),D.length===0&&e.jsx(w,{c:"lighter",size:"sm",children:"No Rules in effect."}),e.jsx(ae,{onDragEnd:({destination:y,source:z})=>C(z.index,(y==null?void 0:y.index)||0),children:e.jsx(re,{droppableId:"dnd-list",direction:"vertical",children:y=>e.jsxs("div",{...y.droppableProps,style:{top:"auto",left:"auto"},ref:y.innerRef,children:[D.map((z,Ge)=>e.jsx(ie,{index:Ge,draggableId:Ge.toString(),children:Fe=>e.jsxs(h,{align:"center",ref:Fe.innerRef,mt:"xs",...Fe.draggableProps,className:Z.item,style:{...Fe.draggableProps.style,left:"auto !important",top:"auto !important"},children:[e.jsx(h.Col,{span:"content",style:{cursor:"grab"},...Fe.dragHandleProps,children:e.jsx(S,{children:e.jsx(oe,{size:"1.2rem"})})}),e.jsx(h.Col,{span:"auto",children:e.jsxs(S,{gap:5,children:[z.name,z.description&&z.description!==""&&e.jsx(Oe,{position:"right",label:z.description,children:e.jsx(Js,{size:16})})]})}),e.jsx(h.Col,{span:"auto",children:e.jsx(S,{children:z.actions.map((ht,Ht)=>{const{Icon:Wt,color:_e}=We[ht.name];return e.jsx(Oe,{fz:"xs",withArrow:!0,color:_e?a.colors[_e][6]:void 0,label:ht.name,children:e.jsx(Wt,{color:_e?a.colors[_e][6]:void 0,size:16,stroke:2})},Ht)})})}),e.jsx(h.Col,{span:"content",children:e.jsxs(S,{justify:"right",gap:"xs",children:[e.jsx(U,{disabled:m,onClick:()=>f(z),checked:z.enabled,color:"teal"}),e.jsx(A,{disabled:m,loading:g.name===z.name,onClick:()=>F(z.name),variant:"subtle",color:"red",children:e.jsx(q,{size:16,stroke:1.5})}),e.jsx(A,{disabled:m,loading:N.name===z.name,onClick:()=>$({name:z.name}),variant:"subtle",color:"indigo",children:e.jsx(Pe,{size:16,stroke:1.5})}),e.jsx(A,{disabled:m,onClick:()=>b(z),variant:"subtle",color:"orange",children:e.jsx(De,{size:16,stroke:1.5})}),e.jsx(A,{disabled:m,onClick:()=>v(z),variant:"subtle",color:"green",children:e.jsx(Xs,{size:16,stroke:1.5})})]})})]})},Ge)),y.placeholder]})})})]})}function An({opened:t,close:s,editing:l,loading:a=!1,add:n,save:i,form:o}){const{data:c=[],loading:r}=_({url:"/schema",default:[],fetch:!0,mutate:N=>N.map(I=>I.name)}),{data:p=[],loading:u,get:b,error:v}=_({url:`/schema/${o.values.schema}/rules/`,default:[],mutate:N=>N.map(I=>I.name)});j.useEffect(()=>{o.values.schema&&b()},[o.values.schema]);const d=tt.toString(o.values.cron,{throwExceptionOnParseError:!1}),g=d.includes("An error occured when generating the expression description"),x=!o.values.schema,$=()=>{if(l)return i({id:l.id});n()};return e.jsxs(xe,{size:"lg",opened:t,onClose:s,title:"Add Schedule",children:[e.jsx(de,{label:"Target Schema",required:!0,placeholder:"Pick schema",data:c,rightSection:r?e.jsx(Ce,{size:"xs"}):void 0,...o.getInputProps("schema")}),o.values.schema&&e.jsxs(e.Fragment,{children:[e.jsx(ds,{label:"Rules",clearable:!0,description:"Specify which rules will be run on the schema. Leave blank to run all.",placeholder:o.values.rules.length<=0?"All rules":"Pick rules",disabled:p.length<=0,data:p,rightSection:u?e.jsx(Ce,{size:"xs"}):void 0,...o.getInputProps("rules"),error:v}),e.jsx(w,{fz:"xs",c:"dimmed",children:"Note: Disabled rules will be skipped regardless."}),e.jsx(St,{mt:5,fullWidth:!0,...o.getInputProps("type"),data:[{label:e.jsxs(ce,{children:[e.jsx(Ys,{size:20,stroke:1.5}),e.jsx(P,{ml:5,children:"Schedule"})]}),value:"Schedule"},{label:e.jsxs(ce,{children:[e.jsx(Qs,{size:20,stroke:1.5}),e.jsx(P,{ml:5,children:"Monitor"})]}),value:"Monitor"}]}),o.values.type==="Schedule"&&e.jsx(k,{label:"CRON Expression",placeholder:"0 * * * MON-FRI",required:!0,description:g?"Invalid Syntax":d,...o.getInputProps("cron"),error:g&&d}),o.values.type==="Monitor"&&e.jsx(k,{label:"File Path",placeholder:"D:/watchme.csv",required:!0,description:"This file path will be monitored, and the schedule run when a file change is detected.",...o.getInputProps("monitor")})]}),e.jsx(S,{justify:"right",mt:"md",children:e.jsx(O,{loading:a,disabled:x,onClick:$,variant:"light",type:"submit",children:l?"Save":"Add"})})]})}function Nn(){const t=C=>C.map(f=>({...f,rules:f.rules?JSON.parse(f.rules):[],type:f.monitor?"Monitor":"Schedule"})).sort((f,y)=>f.index-y.index),[s,l]=Pt([]),{loading:a}=_({url:"/schedule",default:[],preserve:!0,fetch:!0,mutate:t,then:C=>l.setState(C)}),[n,{open:i,close:o}]=te(!1),[c,r]=j.useState(void 0),p={schema:"",type:"",rules:[],cron:"",monitor:""},u=he({initialValues:p,validate:{cron:C=>{if(u.values.type==="Monitor")return!1;const f=tt.toString(C,{throwExceptionOnParseError:!1});return f.includes("An error occured when generating the expression description")?f:null},monitor:C=>u.values.type==="Schedule"?!1:C.trim()===""&&"Path required."}});j.useEffect(()=>{u.reset(),c?u.setValues(c):u.setValues(p),u.setInitialValues(p)},[c]);const{post:b,loading:v}=_({url:"/schedule",data:u.values,before:()=>u.validate(),check:()=>!u.isValid(),catch:({validation:C})=>u.setErrors(C),mutate:t,then:C=>{l.setState(C),o(),W.show({title:"Success",message:"Schedule Added.",color:"lime"})}}),{put:d,loading:g}=_({url:"/schedule/reorder",fdata:({from:C,to:f})=>({from:C,to:f}),mutate:t,then:C=>l.setState(C)}),x=(C,f)=>{l.reorder({from:C,to:f}),d({from:C,to:f})},{put:$,loading:N}=_({url:"/schedule",data:u.values,before:()=>u.validate(),check:()=>!u.isValid(),catch:({validation:C})=>u.setErrors(C),furl:({id:C})=>`/schedule/${C}`,mutate:t,then:C=>{l.setState(C),o(),W.show({title:"Success",message:"Schedule Modified.",color:"lime"})}}),{put:I,loading:E}=_({url:"/schedule",data:u.values,furl:({id:C})=>`/schedule/${C}/toggle`,mutate:t,then:C=>l.setState(C)}),{del:K,request:G,loading:X}=_({cleanup:!0,furl:({id:C})=>`/schedule/${C}`,mutate:t,then:C=>{l.setState(C),W.show({title:"Success",message:"Schedule Removed.",color:"lime"})}}),F=a||v||N||E||X||g,m=C=>{r(C),i()},D=C=>{l.setState(s.map(f=>f.id!==C.id?f:{...f,enabled:!C.enabled})),I({id:C.id})},B=()=>{r(void 0),o()};return e.jsxs(ye,{label:e.jsx(be,{rightSection:e.jsxs(S,{children:[a&&e.jsx(Ce,{size:"sm"}),e.jsx(O,{onClick:i,variant:"light",children:"Add"})]}),children:"Schedules"}),children:[e.jsx(An,{opened:n,close:B,form:u,add:b,save:$,editing:c,loading:F}),s.length===0&&e.jsx(w,{c:"lighter",size:"sm",children:F?"Loading...":"No Schedules in effect."}),e.jsx(ae,{onDragEnd:({destination:C,source:f})=>x(f.index,(C==null?void 0:C.index)||0),children:e.jsx(re,{droppableId:"dnd-list",direction:"vertical",children:C=>e.jsxs("div",{...C.droppableProps,style:{top:"auto",left:"auto"},ref:C.innerRef,children:[s.map(f=>{const y=f.cron?tt.toString(f.cron,{throwExceptionOnParseError:!1}):`Watch: ${f.monitor}`;return e.jsx(ie,{index:f.index,draggableId:f.id,children:z=>e.jsxs(h,{align:"center",ref:z.innerRef,mt:"xs",...z.draggableProps,className:Z.item,style:{...z.draggableProps.style,left:"auto !important",top:"auto !important"},children:[e.jsx(h.Col,{span:"content",style:{cursor:"grab"},...z.dragHandleProps,children:e.jsx(S,{children:e.jsx(oe,{size:"1.2rem"})})}),e.jsx(h.Col,{span:"auto",children:e.jsx(w,{size:"xs",lineClamp:1,children:y})}),e.jsx(h.Col,{span:"auto",children:e.jsxs(w,{size:"xs",lineClamp:1,children:["Schema: ",f.schema," ",f.rules.length>0&&` | Rules: ${f.rules}`]})}),e.jsx(h.Col,{span:"content",children:e.jsxs(S,{justify:"right",gap:"xs",children:[e.jsx(U,{disabled:F,onClick:()=>D(f),checked:f.enabled,color:"teal"}),e.jsx(A,{disabled:F,loading:G.id===f.id,onClick:()=>K({id:f.id}),variant:"subtle",color:"red",children:e.jsx(q,{size:16,stroke:1.5})}),e.jsx(A,{disabled:F,onClick:()=>m(f),variant:"subtle",color:"orange",children:e.jsx(De,{size:16,stroke:1.5})})]})})]})},f.id)}),C.placeholder]})})})]})}function Dn({schema:t,setSchema:s,check:l,loading:a}){const{data:n,loading:i}=_({url:"/schema",default:[{onClick:()=>s("all schemas"),label:"All Schemas"}],fetch:!0,mutate:c=>{const r=c.map(p=>({onClick:()=>s(p.name),label:p.name}));return[{onClick:()=>s("all schemas"),label:"All Schemas"},...r]}}),o=a||i;return e.jsx(e.Fragment,{children:e.jsxs(dt,{loading:o,variant:"light",onClick:l,options:n,children:["Check ",t]})})}function Fn(){const[t,s]=j.useState("all schemas"),{data:l,post:a,loading:n,reset:i,setData:o}=_({url:"/match",data:{schema_name:t},mutate:r=>r.filter(p=>p.actionable)}),c=r=>{s(r),i()};return e.jsxs(ye,{size:"responsive",label:e.jsx(be,{rightSection:e.jsx(Dn,{schema:t,setSchema:c,check:a,loading:n}),children:"Dashboard"}),children:[e.jsx(st,{matches:l||[],loading:n,setData:o,run:()=>{},dash:!0}),!l&&!n&&e.jsxs(w,{fz:"sm",c:"dimmed",children:["Run a ",e.jsx("a",{href:"#",onClick:a,children:"check"})," to find actions to take."]})]})}function _n(){const{nav:t}=j.useContext(He);switch(t){case"Settings":return e.jsx(kl,{});case"Schedules":return e.jsx(Nn,{});case"Schema":return e.jsx(Al,{});case"Connectors":return e.jsx(Kl,{});case"Rules":return e.jsx($n,{});default:return e.jsx(Fn,{})}}function Tn(){const[t,{toggle:s,close:l}]=te(),a=vt(`(max-width: ${Ct(750)})`),{authed:n}=j.useContext(we);return n?e.jsxs(Re,{header:{height:64,collapsed:!a},navbar:{width:300,breakpoint:"sm",collapsed:{mobile:!t}},padding:"md",children:[e.jsx(Re.Header,{children:e.jsx(Vt,{opened:t,toggle:s})}),e.jsx(Re.Navbar,{children:e.jsx(jl,{closeNav:l})}),e.jsx(Re.Main,{children:e.jsx(_n,{})})]}):e.jsx(yl,{})}function Rn({children:t}){const[s,l]=j.useState("Dashboard"),a=n=>l(n);return e.jsx(He.Provider,{value:{nav:s,changeNav:a},children:t})}function En({children:t}){const[s,l,a]=et({key:"auth",defaultValue:"{}"}),n=JSON.parse(s||"{}")||{},i=n.session||void 0,o=()=>{a()};return e.jsx(we.Provider,{value:{authed:i,session:n,logout:o,login:l},children:t})}function On({children:t}){const{changeNav:s}=j.useContext(He),[l,a]=j.useState(void 0),{data:n,setData:i,loading:o,request:c,fetch:r,reset:p}=_({url:`/schema/${l}`,loading:l,preserve:!0,before:()=>s("Dashboard"),then:d=>{s("Schema"),!(!d.errors||d.errors.length<=0)&&W.show({title:"Errors Detected",message:JSON.stringify(d.errors),color:"red",autoClose:!1})}}),u=o?c.loading:!1;j.useEffect(()=>{l?r():(p(),s("Dashboard"))},[l]);const b=d=>a(d),v=(d={})=>i({...n,...d});return e.jsx(V.Provider,{value:{schema:n,loading:u,connectors:n?n.connectors:[],_connectors:n?n._connectors:{},rules:n?n.rules:[],_rules:n?n._rules:{},headers:n?n.headers:{},changeSchema:b,reload:r,mutate:v},children:t})}const Ln="_connector_sxciz_1",Un={connector:Ln};function Vn(t){const s=[];for(const l in t)if(Object.prototype.hasOwnProperty.call(t,l)){const a=t[l];for(const n of a)s.push(`${l}.${n}`)}return s}function Mn({opened:t,close:s,click:l}){const a=ne(),{_connectors:n,headers:i}=j.useContext(V),[o,c]=j.useState(""),r=b=>c(b.target.value),u=Vn(i).filter(b=>b.toLowerCase().includes(o.toLowerCase()));return e.jsxs(us,{position:"right",size:"xs",opened:t,onClose:s,title:"Template Explorer",overlayProps:{opacity:.2},children:[e.jsx(k,{pb:"xs",leftSection:e.jsx(Ae,{size:16,style:{display:"block",opacity:.5}}),placeholder:"Search",onChange:r,value:o}),o===""?Object.keys(i).map(b=>{const{id:v}=n[b],d=me[v];return e.jsx(Ie,{onClick:()=>c(`${b}.`),className:Un.connector,p:"xs",mt:"xs",children:e.jsxs(S,{children:[e.jsx(P,{style:{display:"flex",alignItems:"center"},children:e.jsx(d.icon,{size:17,color:a.colors[d.color][6]})}),e.jsx("div",{style:{flex:1},children:e.jsx(w,{size:"sm",children:b})}),e.jsx(at,{size:17,stroke:1.5})]})},b)}):e.jsx(ps,{style:{justifyContent:"center"},gap:"sm",justify:"flex-start",align:"center",direction:"row",wrap:"wrap",children:u.map(b=>e.jsx(O,{onClick:()=>l(b),variant:"default",radius:"xl",size:"compact-xs",children:b},b))})]})}function qn({children:t}){const[s,{open:l,close:a}]=te(!1),[n,i]=j.useState(()=>r=>{console.log(r)}),o=e.jsx(Mn,{click:n,opened:s,close:a}),c=r=>{l(),i(r)};return e.jsx(Ke.Provider,{value:{explorer:o,explore:c,close:a},children:t})}const Bn=hs({fontFamily:"Roboto, sans-serif",components:{TextInput:k.extend({classNames:{input:Z.input}})}});function Hn({children:t}){return e.jsxs(xs,{defaultColorScheme:"auto",theme:Bn,children:[e.jsx(js,{}),e.jsx(ms,{children:e.jsx(Rn,{children:e.jsx(En,{children:e.jsx(On,{children:e.jsx(qn,{children:t})})})})})]})}Gt.createRoot(document.getElementById("root")).render(e.jsx(Kt.StrictMode,{children:e.jsx(Hn,{children:e.jsx(Tn,{})})}));
