import{j as e,r as j,a as Yt}from"./react-8db41b9c.js";import{c as Qt}from"./react-dom-44ec3eea.js";import{G as v,B as Zt,T as qe,C as B,n as H,u as he,M as xe,a as S,A as es,b as O,P as Ce,c as ts,r as T,d as w,e as ss,f as wt,g as It,h as Pt,i as se,j as ce,k as P,l as Le,m as N,U as ze,R as ns,o as E,p as Y,q as Oe,s as rt,t as pe,v as Be,w as st,x as os,y as ls,I as Ve,S as zt,D as Te,z as le,E as it,F as as,H as He,J as $t,K as At,L as J,N as Nt,O as rs,Q as U,V as m,W as ue,X as Se,Y as is,Z as te,_ as cs,$ as nt,a0 as Ye,a1 as gt,a2 as V,a3 as Q,a4 as ds,a5 as us,a6 as ps,a7 as Dt,a8 as hs,a9 as Ee,aa as xs,ab as ms,ac as js,ad as gs,ae as bs,af as fs}from"./@mantine-e9f8350e.js";import{a as ys}from"./axios-c24e582b.js";import{I as ge,a as vs,b as $e,c as Cs,d as Ft,e as Ae,f as Ne,g as Ss,h as De,i as ct,j as ks,k as ws,l as Is,m as Rt,n as _t,o as Tt,p as Ps,q as zs,r as dt,s as ut,t as $s,u as As,v as W,w as we,x as Ns,y as Et,z as ot,A as Ie,B as We,C as Ds,D as oe,E as ae,F as me,G as Ot,H as Fs,J as Lt,K as Rs,L as Vt,M as _s,N as Ut,O as Ts,P as Mt,Q as Es,R as Os,S as Ls,T as Vs,U as Us,V as Ms,W as qs,X as Bs,Y as Fe,Z as Hs,_ as qt,$ as ke,a0 as bt,a1 as Ws,a2 as Bt,a3 as pt,a4 as Ks,a5 as Gs,a6 as Js,a7 as Xs,a8 as Ys,a9 as Qs,aa as Zs,ab as en,ac as tn}from"./@tabler-0eb5dc53.js";import{l as sn}from"./socket.io-client-651ff694.js";import{D as ee,C as re,P as ie}from"./@hello-pangea-5bc59746.js";import{c as lt}from"./cronstrue-622c2a2f.js";import"./scheduler-765c72db.js";import"./clsx-1229b3e0.js";import"./react-remove-scroll-9afccdf7.js";import"./tslib-89fde298.js";import"./react-remove-scroll-bar-e444174b.js";import"./react-style-singleton-be5d6081.js";import"./get-nonce-1ea010b7.js";import"./use-sidecar-d2c656b2.js";import"./use-callback-ref-7e77d833.js";import"./react-textarea-autosize-2ec0dff4.js";import"./@babel-eb6c5c4b.js";import"./use-latest-7fcc6944.js";import"./use-isomorphic-layout-effect-9b4327c8.js";import"./use-composed-ref-6e052041.js";import"./react-number-format-42d6efe4.js";import"./@floating-ui-4b554218.js";import"./react-transition-group-811f49ec.js";import"./fast-deep-equal-a91537b9.js";import"./klona-192252da.js";import"./react-dropzone-esm-c3e2e9b8.js";import"./prop-types-f78d4ff5.js";import"./engine.io-client-86cec14e.js";import"./engine.io-parser-b13552ae.js";import"./@socket.io-3e1df240.js";import"./socket.io-parser-44417fca.js";import"./redux-118a19e7.js";import"./react-redux-4d05ee04.js";import"./hoist-non-react-statics-5f650e67.js";import"./react-is-e8e5dbb3.js";import"./use-sync-external-store-7a1dc470.js";import"./use-memo-one-4c5b4d08.js";import"./css-box-model-5383974c.js";import"./tiny-invariant-dd7d57d2.js";import"./memoize-one-297ddbcb.js";import"./raf-schd-5404ed65.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))l(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&l(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function l(o){if(o.ep)return;o.ep=!0;const r=n(o);fetch(o.href,r)}})();const nn="_navbar_1yx7j_1",on="_link_1yx7j_33",ln="_links_1yx7j_65",an="_linkIcon_1yx7j_77",rn="_section_1yx7j_87",cn="_header_1yx7j_107",dn="_collectionsHeader_1yx7j_117",un="_user_1yx7j_129",G={navbar:nn,link:on,links:ln,linkIcon:an,section:rn,header:cn,collectionsHeader:dn,user:un};function Ht({opened:t,toggle:s}){return e.jsxs(v,{h:s?"100%":void 0,px:s?"md":void 0,justify:"space-between",children:[s&&e.jsx(Zt,{opened:t,onClick:s,hiddenFrom:"sm",size:"sm"}),e.jsx(qe,{order:3,children:"CDAP Provisioner"}),e.jsx(B,{fw:700,children:"v0.4.0"})]})}const Ke=j.createContext({changeNav:()=>{}}),Pe=j.createContext({authed:void 0,session:void 0,logout:()=>{},login:()=>{}});function Ue(t={}){const[s,n]=j.useState(t.fetch||!1),[l,o]=j.useState(void 0),[r,a]=j.useState(void 0),[i,c]=j.useState(void 0),[p,u]=j.useState(t.default||void 0),[x,k]=j.useState({}),y={baseURL:`http://${new URL(window.location.href).hostname}:2327/api/v1`,method:"get"},h=ys.create(y),I=j.useCallback(()=>{o(void 0),a(void 0),c(void 0),u(t.default||void 0),k({})},[t]),D=j.useCallback((z={})=>{let g={...t,...z};g.url=(t.url||"")+(g.append_url||"");let F,K;const C=new Promise(function(f,b){F=f,K=b});if(g.preserve||I(),g.before&&g.before({...g,promise:C}),g.furl&&(g.url=g.furl(g)),g.fdata&&(g.data=g.fdata(g)),g.modify&&(g={...g,...g.modify({...g,promise:C})}),!(g.check&&g.check({...g,promise:C}))){if(k(g),n(!0),g.require){for(const f in g.require)if(!g.require[f])return}return h(g).then(f=>{c(f);let b=f.data||f;g.mutate&&(b=g.mutate(b)),b&&u(b),g.then&&g.then(b),F(b)}).catch(f=>{let b="Unknown Error",$;f.message&&(b=f.message),f.response&&f.response.data&&f.response.data.error&&(b=f.response.data.error),f.response&&f.response.data&&f.response.data.message&&(b=f.response.data.message),f.response&&f.response.data&&f.response.data.validation&&($=f.response.data.validation),$||o(b),$&&a($),g.catch&&g.catch({error:b,validation:$,status:f.response.status}),K({error:b,validation:$})}).finally(()=>{n(!1),g.finally&&g.finally({...g,promise:C}),g.cleanup&&I()}),C}},[h,t,I]);return j.useEffect(()=>{if(t.require){for(const z in t.require)if(!t.require[z])return}t.fetch&&D()},[]),{fetch:D,post:(z={})=>D({...z,method:"post"}),put:(z={})=>D({...z,method:"put"}),get:(z={})=>D({...z,method:"get"}),del:(z={})=>D({...z,method:"delete"}),reset:I,setData:u,loading:s,request:x,response:i,data:p,error:l,invalid:r}}function ye(t={}){const s=t.validation?Object.values(t.validation):t.error||t.message||JSON.stringify(t);H.show({title:"Error",message:s,color:"red"})}function R({catch:t,modify:s,headers:n={},...l}){const{logout:o}=j.useContext(Pe);return Ue({catch:({status:a,...i})=>{a===401&&o(),t&&t({status:a,...i}),(!i.validation||Object.keys(i.validation).length<=0)&&ye(i)},modify:a=>{const i=s?s(a):a;return{headers:{Authorization:`Bearer ${JSON.parse(JSON.parse(localStorage.getItem("auth")||"")||{}).session}`,...n},...i}},...l})}const M=j.createContext({schema:void 0,loading:!1,connectors:[],rules:[],_rules:{},_connectors:{},headers:{},changeSchema:()=>{},reload:()=>{},mutate:()=>{}});function Wt(t){const s=/[<>:"/\\|?*]/g,n=/^(CON|PRN|AUX|NUL|COM[1-9]|LPT[1-9])$/i;return!s.test(t)&&!n.test(t)&&t.length<=260&&t.length>0}function pn({opened:t,close:s,refresh:n}){const{changeSchema:l}=j.useContext(M),o=he({initialValues:{name:""},validate:{name:c=>Wt(c)?null:"Invalid schema name"}}),{post:r,loading:a,error:i}=R({url:"/schema",data:o.values,before:()=>o.validate(),check:()=>!o.isValid(),catch:({validation:c})=>o.setErrors(c),then:c=>{l(c.name),s(),n()}});return e.jsxs(xe,{opened:t,onClose:s,title:"New Schema",children:[e.jsx(S,{label:"Schema Name",placeholder:"Schema Name",leftSection:e.jsx(ge,{size:16,style:{display:"block",opacity:.5}}),withAsterisk:!0,...o.getInputProps("name")}),i&&e.jsx(es,{mt:"xs",icon:e.jsx(vs,{size:32}),title:"Error",color:"red",children:i}),e.jsx(v,{justify:"right",mt:"md",children:e.jsx(O,{loading:a,onClick:r,type:"submit",children:"Create Schema"})})]})}function Me(t,s={}){const[n,l]=j.useState(s.default);return j.useEffect(()=>{const o=new URL(window.location.href),r=sn(`http://${o.hostname}:2327`);return r.connect(),r.on(t,(a,...i)=>{s.set!==!1&&l(a),s.then&&s.then(a,...i)}),()=>{r.off(t),r.disconnect()}},[]),[n,l]}const hn="_card_11ylv_1",xn="_icon_11ylv_17",mn="_title_11ylv_29",Qe={card:hn,icon:xn,title:mn};function Kt({resultant:t}){const[s]=Me("job_status",{default:"Idle"}),[n]=Me("progress",{default:{eta:"Estimating...",i:0,p:0,m:0}});return e.jsxs(Ce,{radius:"md",withBorder:!0,className:Qe.card,mt:32,mb:32,children:[e.jsx(ts,{className:Qe.icon,size:60,radius:60,children:t?e.jsx($e,{style:{width:T(32),height:T(32)},stroke:1.5}):e.jsx(Cs,{style:{width:T(32),height:T(32)},stroke:1.5})}),e.jsx(w,{ta:"center",fw:700,className:Qe.title,children:t?"Running Actions":"Finding Matches"}),e.jsx(w,{c:"dimmed",ta:"center",fz:"sm",children:s}),e.jsxs(v,{justify:"space-between",mt:"xs",children:[e.jsx(w,{fz:"sm",c:"dimmed",children:"Progress"}),e.jsxs(w,{fz:"sm",c:"dimmed",children:[Math.floor(n.p),"%"]})]}),e.jsx(ss,{mt:5,value:n.p,animated:!0}),e.jsxs(v,{justify:"space-between",mt:"md",children:[e.jsxs(w,{fz:"sm",children:[n.i," / ",n.m]}),e.jsx(wt,{size:"sm",children:n.eta})]})]})}const jn=[{icon:ws,label:"Dashboard"},{icon:Is,label:"Settings"},{icon:Rt,label:"Schedules"}],gn=[{icon:_t,label:"Schema"},{icon:Tt,label:"Connectors"},{icon:Ps,label:"Rules"}];function ft({link:t,active:s,onClick:n}){return e.jsx(O,{"data-active":s||void 0,fullWidth:!0,variant:"subtle",size:"xs",leftSection:e.jsx(t.icon,{size:20,stroke:1.5}),styles:{inner:{justifyContent:"start"},label:{fontWeight:400}},classNames:{root:G.link},onClick:n,children:t.label})}function bn({closeNav:t}){const{nav:s,changeNav:n}=j.useContext(Ke),{logout:l,session:o}=j.useContext(Pe),{schema:r,changeSchema:a,loading:i}=j.useContext(M),c=It(`(max-width: ${Pt(750)})`),[p,{open:u,close:x}]=se(!1),[k,{open:d,close:y}]=se(!1),[h,I]=j.useState(""),{data:D=[],loading:_,fetch:L}=R({url:"/schema",default:[],preserve:!0,fetch:!0,mutate:F=>F.map(K=>({label:K.name}))}),{del:X}=R({url:"/auth"}),q=()=>{X(),l()};j.useEffect(()=>{_||i||(r||L(),r&&h!==r.name&&(L(),I(r.name)))},[r]);const A=F=>{n(F),c&&t()},[z]=Me("global_status",{default:{}}),[g]=Me("progress",{default:{p:0}});return j.useEffect(()=>{z.schema||y()},[z.schema]),e.jsxs("nav",{className:G.navbar,children:[z.schema&&e.jsx(xe,{withCloseButton:!1,size:"xl",opened:k,onClose:y,styles:{body:{padding:0},content:{backgroundColor:"transparent"}},children:e.jsx(ce,{children:e.jsx(Kt,{resultant:!1})})}),p&&e.jsx(pn,{opened:p,close:x,refresh:L}),!c&&e.jsx(P,{className:`${G.section} ${G.header}`,children:e.jsx(Ht,{})}),e.jsx(P,{pt:"xs",className:G.section,children:e.jsx(P,{className:G.links,children:jn.map(F=>e.jsx(ft,{onClick:()=>A(F.label),active:s===F.label,link:F},F.label))})}),r&&e.jsx(P,{pt:"xs",className:G.section,children:e.jsx(P,{className:G.links,children:gn.map(F=>e.jsx(ft,{onClick:()=>A(F.label),active:s===F.label,link:F},F.label))})}),e.jsxs(P,{style:{flex:1},className:G.section,children:[e.jsxs(v,{className:G.collectionsHeader,justify:"space-between",children:[e.jsx(w,{size:"xs",fw:500,c:"dimmed",children:"Schemas"}),e.jsx(Le,{label:"Create schema",withArrow:!0,position:"right",children:e.jsx(N,{onClick:u,loading:_,variant:"default",size:18,children:e.jsx(Ft,{style:{width:T(12),height:T(12)},stroke:1.5})})})]}),e.jsx(P,{className:G.links,children:D.map(F=>{const K=(r&&r.name)===F.label;return e.jsx(O,{fullWidth:!0,variant:"subtle",size:"xs",styles:{inner:{justifyContent:"space-between"},label:{fontWeight:400}},classNames:{root:G.link},onClick:()=>K?void 0:a(F.label),loading:i===F.label,disabled:!!i,rightSection:K?e.jsx(Ae,{onClick:()=>a(void 0),style:{width:T(12),height:T(12),cursor:"pointer"},stroke:1.5}):void 0,"data-active":K?!0:void 0,children:F.label},F.label)})})]}),e.jsx(P,{children:e.jsx(Ce,{withBorder:!0,radius:"md",mb:"xs",pb:0,children:e.jsx(ze,{style:{cursor:z.schema?"pointer":"auto"},disabled:!z.schema,onClick:d,className:G.user,p:"xs",children:e.jsxs(v,{children:[z.schema?e.jsx(ns,{size:50,roundCaps:!0,thickness:3,sections:[{value:g.p,color:"blue"}],label:e.jsx(ce,{children:z.running?e.jsx($e,{style:{width:T(20),height:T(20)},stroke:1.5}):e.jsx(Ne,{style:{width:T(20),height:T(20)},stroke:1.5})})}):e.jsx(Ss,{style:{width:T(50),height:T(50)},stroke:.5}),e.jsxs("div",{children:[e.jsx(w,{size:"sm",tt:"uppercase",children:"Status:"}),z.schema?e.jsxs(e.Fragment,{children:[e.jsx(w,{c:"dimmed",size:"xs",children:z.running?"Running Actions...":"Finding Matches..."}),e.jsxs(w,{c:"dimmed",size:"xs",children:["Schema: ",z.schema]}),e.jsxs(w,{c:"dimmed",size:"xs",children:["Rule: ",z.rule]})]}):e.jsx(w,{c:"dimmed",size:"xs",children:"Idle"})]})]})})})}),e.jsx(P,{children:e.jsx(Ce,{radius:"md",withBorder:!0,p:0,bg:"var(--mantine-color-body)",children:e.jsxs(E,{position:"top-start",width:"target",children:[e.jsx(E.Target,{children:e.jsx(ze,{className:G.user,children:e.jsxs(v,{children:[e.jsx(De,{style:{width:T(20),height:T(20)},stroke:1.5}),e.jsxs("div",{style:{flex:1},children:[e.jsx(w,{size:"sm",fw:500,children:o==null?void 0:o.username}),e.jsx(w,{c:"dimmed",size:"xs",children:"administrator"})]}),e.jsx(ct,{style:{width:T(14),height:T(14)},stroke:1.5})]})})}),e.jsx(E.Dropdown,{children:e.jsx(E.Item,{onClick:q,leftSection:e.jsx(ks,{style:{width:T(14),height:T(14)}}),children:"Logout"})})]})})})]})}const fn="_box_xo72w_1",yn="_input_xo72w_7",ve={box:fn,input:yn};function vn({completeSetup:t}){const{login:s}=j.useContext(Pe),n=he({initialValues:{username:"",password:"",collection:!1},validate:{username:Y("Username can not be empty."),password:Oe({min:5},"Password must be at least 5 characters long.")}}),{post:l,loading:o}=Ue({url:"/setup",data:n.values,then:i=>{t(),s(JSON.stringify(i))},catch:({validation:i})=>n.setErrors(i)}),r=()=>{n.validate(),n.isValid()&&l()},a=i=>i.key==="Enter"&&r();return e.jsxs(rt,{size:420,my:40,children:[e.jsx(qe,{ta:"center",children:"New Installation"}),e.jsx(w,{c:"dimmed",size:"sm",ta:"center",mt:5,children:"Please create the initial administrative user."}),e.jsxs(Ce,{className:ve.box,withBorder:!0,shadow:"md",p:30,mt:30,radius:"md",children:[e.jsx(S,{classNames:{input:ve.input},onKeyUp:a,...n.getInputProps("username"),label:"Username",placeholder:"Your Username",required:!0}),e.jsx(pe,{classNames:{input:ve.input},onKeyUp:a,...n.getInputProps("password"),label:"Password",placeholder:"Your password",required:!0,mt:"md"}),e.jsx(v,{justify:"space-between",mt:"lg",children:e.jsx(Be,{...n.getInputProps("collection",{type:"checkbox"}),label:"Allow collection of anonymous statistics"})}),e.jsx(O,{onClick:()=>r(),loading:o,fullWidth:!0,mt:"xl",children:"Create User"})]})]})}function Cn(){const[t,s,n]=st({key:"setup",defaultValue:"false"}),[l,o,r]=st({key:"lastLogin",defaultValue:""}),a=()=>s("true"),{login:i}=j.useContext(Pe),c=he({initialValues:{username:"",password:"",checked:!1},validate:{username:Y("Username can not be empty."),password:Y("Password can not be empty.")}});j.useEffect(()=>{c.setFieldValue("username",l||""),c.setFieldValue("checked",l!=="")},[l]);const{post:p,loading:u}=Ue({url:"/auth",data:c.values,then:d=>{c.values.checked?o(d.username):r(),i(JSON.stringify(d))},catch:({validation:d})=>c.setErrors(d)});Ue({url:"/setup",fetch:!0,then:({status:d})=>d?a():n()});const x=()=>{c.validate(),c.isValid()&&p()},k=d=>d.key==="Enter"&&x();return!t||t=="false"?e.jsx(vn,{completeSetup:a}):e.jsxs(rt,{size:420,my:40,children:[e.jsx(qe,{ta:"center",children:"CDAPP Login"}),e.jsxs(Ce,{className:ve.box,withBorder:!0,shadow:"md",p:30,mt:30,radius:"md",children:[e.jsx(S,{classNames:{input:ve.input},onKeyUp:k,...c.getInputProps("username"),label:"Username",placeholder:"Your Username",required:!0,rightSection:l&&e.jsx(N,{variant:"subtle",size:"sm",onClick:()=>r(),children:e.jsx(Ae,{size:16,style:{display:"block",opacity:.5}})})}),e.jsx(pe,{classNames:{input:ve.input},onKeyUp:k,...c.getInputProps("password"),label:"Password",placeholder:"Your password",required:!0,mt:"md"}),e.jsxs(v,{justify:"space-between",mt:"lg",children:[e.jsx(Be,{label:"Remember me",...c.getInputProps("checked",{type:"checkbox"})}),e.jsx(os,{component:"button",size:"sm",children:"Forgot password?"})]}),e.jsx(O,{onClick:()=>x(),loading:u,fullWidth:!0,mt:"xl",children:"Sign in"})]})]})}function be({children:t,leftSection:s,rightSection:n,...l}){return e.jsxs(v,{justify:"space-between",mb:"xs",children:[e.jsxs(P,{children:[e.jsx(qe,{order:2,...l,children:t}),s]}),e.jsx(P,{}),e.jsx(P,{children:n})]})}const Sn="_container_1im94_1",kn="_item_1im94_13",wn="_input_1im94_25",In="_overflow_1im94_33",Z={container:Sn,item:kn,input:wn,overflow:In};function fe({children:t,label:s,size:n,...l}){return e.jsxs(rt,{size:n||"lg",children:[typeof s=="string"?e.jsx(be,{...l,children:s}):s,e.jsx(Ce,{className:Z.container,p:"xl",children:t})]})}function Pn(){const{setColorScheme:t,clearColorScheme:s}=ls(),{changeSchema:n}=j.useContext(M),{get:l,loading:o}=R({url:"/fix",then:()=>{n(void 0),H.show({title:"Success",message:"Cache Purged.",color:"lime"}),setTimeout(()=>location.reload(),1e3)}});return e.jsxs(fe,{label:"Application Settings",children:[e.jsx(Ve.Wrapper,{label:"Theme",description:"Change colours of the application",children:e.jsx(zt,{mt:"xs",fullWidth:!0,maw:300,onChange:r=>r==="auto"?s():t(r),data:[{label:"Light",value:"light"},{label:"Dark",value:"dark"},{label:"Auto",value:"auto"}]})}),e.jsx(Ve.Wrapper,{label:"Clear Cache",description:"Purges the server cache to fix schema inconsistencies, etc.",children:e.jsx(O,{loading:!!o,onClick:()=>l(),mt:5,children:"Fix"})})]})}function zn(t){const[s,{close:n,open:l}]=se(!1);return{Modal:({children:r,...a})=>e.jsx(xe,{size:"lg",opened:s,onClose:n,title:t,...a,children:r}),opened:s,open:l,close:n}}function $n({close:t}){const{schema:s,reload:n}=j.useContext(M),{post:l,loading:o,error:r}=R({url:`/schema/${s==null?void 0:s.name}/import`,headers:{"Content-Type":"multipart/form-data"},modify:i=>(console.log(i),i),then:()=>{t(),n()}}),a=i=>{const c=new FormData;c.append("file",i[0]),l({data:c})};return e.jsx(Te,{loading:o,onDrop:a,accept:["application/zip","application/x-zip-compressed"],children:e.jsxs(v,{justify:"center",gap:"xl",mih:200,style:{pointerEvents:"none"},children:[e.jsx(Te.Accept,{children:e.jsx(zs,{size:50,stroke:1.5})}),e.jsx(Te.Reject,{children:e.jsx(Ae,{size:50,stroke:1.5})}),e.jsx(Te.Idle,{children:e.jsx(dt,{size:50,stroke:1.5})}),e.jsxs("div",{children:[e.jsx(w,{size:"xl",inline:!0,children:"Drag schema here or click to select file"}),e.jsx(w,{size:"sm",c:"dimmed",inline:!0,mt:7,children:"Import files must be generated by the schema export function"}),r&&e.jsx(w,{c:"red",inline:!0,mt:7,children:r})]})]})})}const An="_button_1jnqc_1",Nn="_menuControl_1jnqc_11",yt={button:An,menuControl:Nn};function ht({children:t,options:s=[],onClick:n,loading:l,menu:o,...r}){return e.jsxs(v,{wrap:"nowrap",gap:0,children:[e.jsx(O,{loading:l,onClick:n,...r,className:yt.button,children:t}),e.jsxs(E,{disabled:l,transitionProps:{transition:"pop"},position:"bottom-end",...o,withinPortal:!0,children:[e.jsx(E.Target,{children:e.jsx(N,{...r,size:36,className:yt.menuControl,children:e.jsx(ut,{style:{width:T(16),height:T(16)},stroke:1.5})})}),e.jsx(E.Dropdown,{children:s.map(({label:a,onClick:i,...c},p)=>e.jsx(E.Item,{onClick:i?()=>{i(a)}:void 0,...c,children:a},p))})]})]})}function Dn({save:t,saving:s}){const n=le(),{schema:l,changeSchema:o}=j.useContext(M),{Modal:r,opened:a,open:i,close:c}=zn("Import Schema"),{del:p,loading:u}=R({url:`/schema/${l==null?void 0:l.name}`,then:()=>o(void 0)}),x=()=>it.openConfirmModal({title:"Delete Schema",centered:!0,children:e.jsx(w,{size:"sm",children:"Are you sure you want to delete this schema? This action is destructive and cannot be reversed."}),labels:{confirm:"Delete schema",cancel:"No don't delete it"},confirmProps:{color:"red"},onConfirm:()=>p()}),k=JSON.parse(JSON.parse(localStorage.getItem("auth")||"")||{}),d=new URL(window.location.href);return e.jsxs(e.Fragment,{children:[a&&e.jsx(r,{children:e.jsx($n,{close:c})}),e.jsx(ht,{loading:s||u,variant:"light",onClick:t,options:[{component:"a",href:`http://${d.hostname}:2327/api/v1/schema/${l==null?void 0:l.name}/export/${k.session}`,label:"Export",leftSection:e.jsx($s,{size:16,color:n.colors.green[5]})},{onClick:()=>i(),label:"Import",leftSection:e.jsx(As,{size:16,color:n.colors.orange[5]})},{onClick:()=>x(),label:"Delete",leftSection:e.jsx(W,{size:16,color:n.colors.red[5]})}],children:"Save"})]})}function Fn(){const{schema:t,mutate:s}=j.useContext(M),n=he({initialValues:t,validate:{name:r=>Wt(r)?null:"Invalid schema name"}}),{put:l,loading:o}=R({url:`/schema/${t==null?void 0:t.name}`,data:n.values,before:()=>n.validate(),check:()=>!n.isValid(),catch:({validation:r})=>n.setErrors(r),then:()=>{s(n.values),H.show({title:"Success",message:"Settings Saved.",color:"lime"})}});return e.jsx(fe,{label:e.jsx(be,{rightSection:e.jsx(Dn,{saving:o,save:l}),children:"Schema Settings"}),children:e.jsx(S,{label:"Schema Name",placeholder:"Schema Name",leftSection:e.jsx(ge,{size:16,style:{display:"block",opacity:.5}}),withAsterisk:!0,...n.getInputProps("name")})})}const je={ldap:{id:"ldap",name:"Lightweight Directory Access Protocol (LDAP)",icon:we,color:"blue"},csv:{id:"csv",name:"Comma-Separated Values (CSV)",icon:Ns,color:"teal"},stmc:{id:"stmc",name:"eduSTAR Management Centre (STMC)",icon:Et,color:"red"},proxy:{id:"proxy",name:"Corporate Proxy Server",icon:ot,color:"orange"}},Rn="_card_1ybk5_1",_n="_title_1ybk5_9",Tn="_item_1ybk5_19",Ze={card:Rn,title:_n,item:Tn};function En({opened:t,close:s,add:n}){const l=le();return e.jsx(xe,{size:"lg",styles:{content:{backgroundColor:"transparent"},body:{padding:0,margin:0}},opened:t,onClose:s,withCloseButton:!1,children:e.jsxs(as,{mih:300,withBorder:!0,radius:"md",className:Ze.card,children:[e.jsx(v,{justify:"space-between",children:e.jsx(w,{className:Ze.title,children:"Select a provider"})}),e.jsx(He,{cols:2,mt:"md",children:Object.values(je).map(o=>e.jsxs(ze,{onClick:()=>n(o.id),className:Ze.item,children:[e.jsx(o.icon,{color:l.colors[o.color][6],size:"2rem"}),e.jsx(w,{size:"xs",mt:7,children:o.name})]},o.id))})]})})}const On={csv:{name:"MyCSV",path:""},proxy:{name:"ProxyServer",url:"",username:"",password:""},ldap:{name:"ActiveDirectory",url:"",username:"",password:"",base:"",attributes:[]},stmc:{name:"",username:"",password:"",school:"",cache:1440}},Ln={csv:{name:Y("Name can not be empty."),path:Oe({min:2},"Path must be at least 2 characters long.")},proxy:{name:Y("Name can not be empty."),url:Oe({min:3},"URL must be at least 3 characters long.")},ldap:{name:Y("Name can not be empty."),url:Oe({min:3},"URL must be at least 3 characters long."),username:Y("Username can not be empty."),password:Y("Password can not be empty.")},stmc:{name:Y("Name can not be empty."),username:Y("Username can not be empty."),password:Y("Password can not be empty."),school:Y("School ID can not be empty.")}};function Vn({form:t}){return e.jsxs(e.Fragment,{children:[e.jsx(S,{label:"Connector Name",leftSection:e.jsx(ge,{size:16,style:{display:"block",opacity:.5}}),placeholder:"File Name",withAsterisk:!0,...t.getInputProps("name")}),e.jsx(S,{label:"File Path",leftSection:e.jsx(Ie,{size:16,style:{display:"block",opacity:.5}}),placeholder:"C:/folder/input.csv",withAsterisk:!0,...t.getInputProps("path"),mt:"md"})]})}function ne({children:t,label:s="Advanced",rightSection:n,open:l=!1,Icon:o=ct,...r}){const[a,{toggle:i}]=se(l);return e.jsxs(P,{children:[e.jsxs(v,{justify:"space-between",grow:!0,children:[e.jsx(ze,{mt:10,onClick:i,children:e.jsxs(v,{gap:2,children:[e.jsx(w,{...r,children:s}),e.jsx(o,{size:14,style:{transform:a?"rotate(90deg)":"none"}})]})}),n]}),e.jsx($t,{in:a,children:t})]})}function xt({selectable:t=[],value:s="",onChange:n,createLabel:l}){const o=At({onDropdownClose:()=>o.resetSelectedOption()}),r=s?[...t,s].filter(function(h,I,D){return D.indexOf(h)==I}):t,[a,i]=j.useState(r),[c,p]=j.useState(s||null),[u,x]=j.useState(s||"");j.useEffect(()=>{x(s)},[s]);const k=a.some(h=>h===u),y=(k?a:a.filter(h=>h.toLowerCase().includes(u.toLowerCase().trim()))).map(h=>e.jsx(J.Option,{value:h,children:h},h));return e.jsxs(J,{store:o,withinPortal:!1,onOptionSubmit:h=>{h==="$create"?(i(I=>[...I,u]),p(u),n&&n(u)):(p(h),n&&n(h)),o.closeDropdown()},children:[e.jsx(J.Target,{children:e.jsx(Nt,{rightSection:e.jsx(J.Chevron,{}),value:u,onChange:h=>{o.openDropdown(),o.updateSelectedOptionIndex(),x(h.currentTarget.value)},onClick:()=>o.openDropdown(),onFocus:()=>o.openDropdown(),onBlur:()=>{o.closeDropdown(),x(s||c||"")},placeholder:"Search value",rightSectionPointerEvents:"none"})}),(a.length>0||u.length>0)&&e.jsx(J.Dropdown,{children:e.jsxs(J.Options,{children:[y,!k&&u.trim().length>0&&e.jsx(J.Option,{value:"$create",children:l?l(u):` + Create ${u}`})]})})]})}function de({onChange:t,value:s="",placeholder:n,...l}){const{connectors:o,_connectors:r}=j.useContext(M),a=le(),i=At({onDropdownClose:()=>i.resetSelectedOption()}),[c,p]=j.useState(s||null);j.useEffect(()=>p(s),[s]);const u=s in r&&je[r[s].id],x=u&&e.jsx(u.icon,{color:a.colors[u.color][6],size:20,stroke:1.5}),k=o||[];l.type&&(l.filter=h=>h.filter(I=>I.id===l.type));const d=(l.filter?l.filter(k):k).map(h=>{const I=je[h.id];return{component:e.jsxs(v,{children:[e.jsx(I.icon,{color:a.colors[I.color][6],size:20,stroke:1.5})," ",h.name]}),value:h.name}}),y=(l.data||d).map(h=>{const I=typeof h=="string";return e.jsx(J.Option,{value:I?h:h.value,children:I?h:h.component},I?h:h.value)});return e.jsx(Ve.Wrapper,{...l,children:e.jsxs(J,{store:i,withinPortal:!1,onOptionSubmit:h=>{p(h),t&&t(h),i.closeDropdown()},children:[e.jsx(J.Target,{children:e.jsx(Nt,{component:"button",type:"button",pointer:!0,leftSection:l.leftSection===!1?void 0:l.leftSection?l.leftSection:x||e.jsx(Tt,{size:16,style:{display:"block",opacity:.5}}),mt:l.label?5:void 0,rightSection:l.clearable&&c!==null?e.jsx(rs,{size:"sm",onMouseDown:h=>h.preventDefault(),onClick:()=>{p(null),t&&t(void 0)},"aria-label":"Clear value"}):e.jsx(J.Chevron,{}),onClick:()=>i.toggleDropdown(),rightSectionPointerEvents:!l.clearable||c===null?"none":"all",children:c||e.jsx(Ve.Placeholder,{children:n||"Select Connector"})})}),e.jsx(J.Dropdown,{children:e.jsx(J.Options,{children:y})})]})})}function et({form:t,index:s,explorer:n}){return e.jsxs(P,{p:"xs",pt:0,children:[e.jsx(de,{label:"Target Directory",withAsterisk:!0,clearable:!0,leftSection:e.jsx(we,{size:"1rem"}),...t.getInputProps(`actions.${s}.target`),type:"ldap"}),e.jsx(S,{label:"User Principal Name",withAsterisk:!0,leftSection:e.jsx(We,{size:16,style:{display:"block",opacity:.8}}),placeholder:"{{username}}@domain.com",...t.getInputProps(`actions.${s}.upn`),rightSection:n("upn")})]})}function Un({form:t,index:s,explore:n}){const l=t.values.actions[s].groups||[],o=a=>()=>n(()=>i=>t.setFieldValue(`actions.${s}.groups.${a}`,`${t.values.actions[s].groups[a]||""}{{${i}}}`)),r=a=>e.jsx(N,{onClick:o(a),variant:"subtle",children:e.jsx(me,{size:16,style:{display:"block",opacity:.8}})});return e.jsxs(e.Fragment,{children:[l.length===0&&e.jsx(ce,{c:"dimmed",fz:"xs",children:"No security groups configured."}),e.jsx(ee,{onDragEnd:({destination:a,source:i})=>t.reorderListItem(`actions.${s}.groups`,{from:i.index,to:a?a.index:0}),children:e.jsx(re,{droppableId:"dnd-list",direction:"vertical",children:a=>e.jsxs("div",{...a.droppableProps,style:{top:"auto",left:"auto"},ref:a.innerRef,children:[l.map((i,c)=>e.jsx(ie,{index:c,draggableId:c.toString(),children:p=>e.jsxs(m,{gutter:"xs",align:"center",ref:p.innerRef,mt:"xs",...p.draggableProps,style:{...p.draggableProps.style,left:"auto !important",top:"auto !important"},children:[e.jsx(m.Col,{span:"content",style:{cursor:"grab"},...p.dragHandleProps,children:e.jsx(v,{children:e.jsx(ae,{size:"1.2rem"})})}),e.jsx(m.Col,{span:"auto",children:e.jsx(S,{placeholder:"CN={{faculty}},OU={{faculty}},OU=Child,OU=Parent",...t.getInputProps(`actions.${s}.groups.${c}`),rightSection:r(c)})}),e.jsx(m.Col,{span:"content",children:e.jsx(v,{gap:0,justify:"flex-end",children:e.jsx(N,{onClick:()=>t.removeListItem(`actions.${s}.groups`,c),variant:"subtle",color:"red",children:e.jsx(W,{size:"1.2rem",stroke:1.5})})})})]})},c)),a.placeholder]})})})]})}function Mn({form:t,index:s,explore:n}){const l=t.values.actions[s].attributes||[],o=(a,i)=>()=>n(()=>c=>t.setFieldValue(`actions.${s}.attributes.${i}.${a}`,`${t.values.actions[s].attributes[i][a]||""}{{${c}}}`)),r=(a,i)=>e.jsx(N,{onClick:o(a,i),variant:"subtle",children:e.jsx(me,{size:16,style:{display:"block",opacity:.8}})});return e.jsxs(e.Fragment,{children:[l.length===0&&e.jsx(ce,{c:"dimmed",fz:"xs",children:"No attributes configured."}),e.jsx(ee,{onDragEnd:({destination:a,source:i})=>t.reorderListItem(`actions.${s}.attributes`,{from:i.index,to:a?a.index:0}),children:e.jsx(re,{droppableId:"dnd-list",direction:"vertical",children:a=>e.jsxs("div",{...a.droppableProps,style:{top:"auto",left:"auto"},ref:a.innerRef,children:[l.map((i,c)=>e.jsx(ie,{index:c,draggableId:c.toString(),children:p=>e.jsxs(m,{gutter:"xs",align:"center",ref:p.innerRef,mt:"xs",...p.draggableProps,style:{...p.draggableProps.style,left:"auto !important",top:"auto !important"},children:[e.jsx(m.Col,{span:"content",style:{cursor:"grab"},...p.dragHandleProps,children:e.jsx(v,{children:e.jsx(ae,{size:"1.2rem"})})}),e.jsx(m.Col,{span:"auto",children:e.jsx(xt,{selectable:mt,...t.getInputProps(`actions.${s}.attributes.${c}.name`),createLabel:u=>`Add Custom Attribute: ${u}`})}),e.jsx(m.Col,{span:"auto",children:e.jsx(S,{placeholder:"Value",...t.getInputProps(`actions.${s}.attributes.${c}.value`),rightSection:r("value",c)})}),e.jsx(m.Col,{span:"content",children:e.jsx(v,{gap:0,justify:"flex-end",children:e.jsx(N,{onClick:()=>t.removeListItem(`actions.${s}.attributes`,c),variant:"subtle",color:"red",children:e.jsx(W,{size:"1.2rem",stroke:1.5})})})})]})},c)),a.placeholder]})})})]})}function qn({form:t,index:s,explorer:n,explore:l}){t.values.actions[s].attributes||t.setFieldValue(`actions.${s}.attributes`,[]),t.values.actions[s].groups||t.setFieldValue(`actions.${s}.groups`,[]);const o=()=>t.insertListItem(`actions.${s}.attributes`,{name:"",value:""}),r=()=>t.insertListItem(`actions.${s}.groups`,"");return e.jsxs(P,{p:"xs",pt:0,children:[e.jsx(de,{label:"Target Directory",withAsterisk:!0,clearable:!0,leftSection:e.jsx(we,{size:"1rem"}),...t.getInputProps(`actions.${s}.target`),type:"ldap"}),e.jsx(S,{label:"Canonical Name",withAsterisk:!0,leftSection:e.jsx(De,{size:16,style:{display:"block",opacity:.8}}),placeholder:"{{username}}",...t.getInputProps(`actions.${s}.cn`),rightSection:n("cn")}),e.jsx(S,{label:"User Principal Name",withAsterisk:!0,leftSection:e.jsx(We,{size:16,style:{display:"block",opacity:.8}}),placeholder:"{{username}}@domain.com",...t.getInputProps(`actions.${s}.upn`),rightSection:n("upn")}),e.jsx(S,{label:"SAM Account Name",withAsterisk:!0,leftSection:e.jsx(Ds,{size:16,style:{display:"block",opacity:.8}}),placeholder:"{{username}}",...t.getInputProps(`actions.${s}.sam`),rightSection:n("sam")}),e.jsx(S,{label:"Organizational Unit",withAsterisk:!0,leftSection:e.jsx(Ie,{size:16,style:{display:"block",opacity:.8}}),placeholder:"ou={{faculty}},ou=child,ou=parent",...t.getInputProps(`actions.${s}.ou`),rightSection:n("ou")}),e.jsx(S,{label:"Password",leftSection:e.jsx(oe,{size:16,style:{display:"block",opacity:.8}}),placeholder:"{{word}}{{rand 1 9}}{{cap (word)}}{{special}}",...t.getInputProps(`actions.${s}.password`),rightSection:n("password")}),e.jsx(U,{label:"User Enabled",disabled:t.values.actions[s].password==="",mt:"xs",...t.getInputProps(`actions.${s}.enable`,{type:"checkbox"})}),e.jsx(ne,{open:!0,label:"Attributes",rightSection:e.jsx(O,{onClick:()=>o(),maw:50,variant:"light",size:"compact-xs",mt:10,children:"Add"}),children:e.jsx(Mn,{form:t,index:s,explore:l})}),e.jsx(ne,{open:!0,label:"Security Groups",rightSection:e.jsx(O,{onClick:()=>r(),maw:50,variant:"light",size:"compact-xs",mt:10,children:"Add"}),children:e.jsx(Un,{form:t,index:s,explore:l})})]})}function Bn({form:t,index:s,explore:n}){const l=t.values.actions[s].attributes||[],o=(a,i)=>()=>n(()=>c=>t.setFieldValue(`actions.${s}.attributes.${i}.${a}`,`${t.values.actions[s].attributes[i][a]||""}{{${c}}}`)),r=(a,i)=>e.jsx(N,{onClick:o(a,i),variant:"subtle",children:e.jsx(me,{size:16,style:{display:"block",opacity:.8}})});return e.jsxs(e.Fragment,{children:[l.length===0&&e.jsx(ce,{c:"dimmed",fz:"xs",children:"No attributes configured."}),e.jsx(ee,{onDragEnd:({destination:a,source:i})=>t.reorderListItem(`actions.${s}.attributes`,{from:i.index,to:a?a.index:0}),children:e.jsx(re,{droppableId:"dnd-list",direction:"vertical",children:a=>e.jsxs("div",{...a.droppableProps,style:{top:"auto",left:"auto"},ref:a.innerRef,children:[l.map((i,c)=>e.jsx(ie,{index:c,draggableId:c.toString(),children:p=>e.jsxs(m,{gutter:"xs",align:"center",ref:p.innerRef,mt:"xs",...p.draggableProps,style:{...p.draggableProps.style,left:"auto !important",top:"auto !important"},children:[e.jsx(m.Col,{span:"content",style:{cursor:"grab"},...p.dragHandleProps,children:e.jsx(v,{children:e.jsx(ae,{size:"1.2rem"})})}),e.jsx(m.Col,{span:2,children:e.jsx(ue,{defaultValue:"Replace",data:["Add","Replace","Delete"],...t.getInputProps(`actions.${s}.attributes.${c}.type`)})}),e.jsx(m.Col,{span:"auto",children:e.jsx(xt,{selectable:mt,...t.getInputProps(`actions.${s}.attributes.${c}.name`),createLabel:u=>`Add Custom Attribute: ${u}`})}),t.values.actions[s].attributes[c].type!=="Delete"&&e.jsx(m.Col,{span:"auto",children:e.jsx(S,{placeholder:"Value",...t.getInputProps(`actions.${s}.attributes.${c}.value`),rightSection:r("value",c)})}),e.jsx(m.Col,{span:"content",children:e.jsx(v,{gap:0,justify:"flex-end",children:e.jsx(N,{onClick:()=>t.removeListItem(`actions.${s}.attributes`,c),variant:"subtle",color:"red",children:e.jsx(W,{size:"1.2rem",stroke:1.5})})})})]})},c)),a.placeholder]})})})]})}function Hn({form:t,index:s,explore:n,explorer:l}){t.values.actions[s].attributes||t.setFieldValue(`actions.${s}.attributes`,[]),t.values.actions[s].groups||t.setFieldValue(`actions.${s}.groups`,[]);const o=()=>t.insertListItem(`actions.${s}.attributes`,{name:"",value:"",type:"Replace"});return e.jsxs(P,{p:"xs",pt:0,children:[e.jsx(de,{label:"Target Directory",withAsterisk:!0,clearable:!0,leftSection:e.jsx(we,{size:"1rem"}),...t.getInputProps(`actions.${s}.target`),type:"ldap"}),e.jsx(S,{label:"User Principal Name",withAsterisk:!0,leftSection:e.jsx(We,{size:16,style:{display:"block",opacity:.8}}),placeholder:"{{username}}@domain.com",...t.getInputProps(`actions.${s}.upn`),rightSection:l("upn")}),e.jsx(ne,{open:!0,label:"Attributes",rightSection:e.jsx(O,{onClick:()=>o(),maw:50,variant:"light",size:"compact-xs",mt:10,children:"Add"}),children:e.jsx(Bn,{form:t,index:s,explore:n})})]})}function Wn({form:t,index:s,explorer:n}){return e.jsxs(P,{p:"xs",pt:0,children:[e.jsx(de,{label:"Target Directory",withAsterisk:!0,clearable:!0,leftSection:e.jsx(we,{size:"1rem"}),...t.getInputProps(`actions.${s}.target`),type:"ldap"}),e.jsx(S,{label:"User Principal Name",withAsterisk:!0,leftSection:e.jsx(We,{size:16,style:{display:"block",opacity:.8}}),placeholder:"{{username}}@domain.com",...t.getInputProps(`actions.${s}.upn`),rightSection:n("upn")}),e.jsx(S,{label:"Organizational Unit",withAsterisk:!0,leftSection:e.jsx(Ie,{size:16,style:{display:"block",opacity:.8}}),placeholder:"ou={{faculty}},ou=child,ou=parent",...t.getInputProps(`actions.${s}.ou`),rightSection:n("ou")})]})}function Kn({form:t,index:s,explorer:n}){return e.jsxs(P,{p:"xs",pt:0,children:[e.jsx(S,{label:"Source File",withAsterisk:!0,description:"Path of file to use as template.",placeholder:"D:/templates/input/user_template.pdf",leftSection:e.jsx(Ot,{size:16,style:{display:"block",opacity:.8}}),...t.getInputProps(`actions.${s}.source`),rightSection:n("source")}),e.jsx(S,{label:"Target File",withAsterisk:!0,description:"Path of file to be written.",placeholder:"D:/templates/ouput/{{username}}.pdf",...t.getInputProps(`actions.${s}.target`),leftSection:e.jsx(Fs,{size:16,style:{display:"block",opacity:.8}}),rightSection:n("target")})]})}function Gn({form:t,index:s,explorer:n}){const{data:l,loading:o}=R({url:"/printers",fetch:!0,default:[],mutate:c=>c.map(p=>p.name)}),r=t.values.actions[s].target,i=(r?[...l,r]:l).filter((c,p,u)=>p===u.findIndex(x=>x===c));return e.jsxs(P,{p:"xs",pt:0,children:[e.jsx(S,{label:"Source File",withAsterisk:!0,description:"Path of file to print",placeholder:"D:/templates/ouput/{{username}}.pdf",leftSection:e.jsx(dt,{size:16,style:{display:"block",opacity:.8}}),...t.getInputProps(`actions.${s}.source`),rightSection:n("source")}),e.jsx(U,{label:"Validate Source Path",mt:"xs",...t.getInputProps(`actions.${s}.validate`,{type:"checkbox"})}),e.jsx(ue,{label:"Target Printer",withAsterisk:!0,clearable:!0,description:"Leave blank to use the systemsdefault printer.",leftSection:o?e.jsx(Se,{size:"xs"}):e.jsx(Lt,{size:16,style:{display:"block",opacity:.8}}),placeholder:"Select Printer",...t.getInputProps(`actions.${s}.target`),data:i})]})}function Jn({form:t,index:s,explorer:n}){return e.jsxs(P,{p:"xs",pt:0,children:[e.jsx(S,{label:"Source File",withAsterisk:!0,description:"Path of original file to be copied.",placeholder:"D:/source/{{username}}.txt",...t.getInputProps(`actions.${s}.source`),leftSection:e.jsx(Rs,{size:16,style:{display:"block",opacity:.8}}),rightSection:n("source")}),e.jsx(U,{label:"Validate Path",mt:"xs",...t.getInputProps(`actions.${s}.validate`,{type:"checkbox"})}),e.jsx(S,{label:"Target File",withAsterisk:!0,description:"Destination path where copy will be placed.",placeholder:"E:/destination/{{username}}.txt",...t.getInputProps(`actions.${s}.target`),leftSection:e.jsx(Vt,{size:16,style:{display:"block",opacity:.8}}),rightSection:n("target")}),e.jsx(U,{label:"Should Overwrite",mt:"xs",...t.getInputProps(`actions.${s}.overwrite`,{type:"checkbox"})})]})}function Xn({form:t,index:s,explorer:n}){return e.jsxs(P,{p:"xs",pt:0,children:[e.jsx(S,{label:"Source File",withAsterisk:!0,description:"Path of file to be moved.",placeholder:"D:/source/{{username}}.txt",...t.getInputProps(`actions.${s}.source`),leftSection:e.jsx(_s,{size:16,style:{display:"block",opacity:.8}}),rightSection:n("source")}),e.jsx(U,{label:"Validate Path",mt:"xs",...t.getInputProps(`actions.${s}.validate`,{type:"checkbox"})}),e.jsx(S,{label:"Target File",withAsterisk:!0,description:"Destination path where file will be placed.",placeholder:"E:/destination/{{username}}.txt",...t.getInputProps(`actions.${s}.target`),leftSection:e.jsx(Vt,{size:16,style:{display:"block",opacity:.8}}),rightSection:n("target")}),e.jsx(U,{label:"Should Overwrite",mt:"xs",...t.getInputProps(`actions.${s}.overwrite`,{type:"checkbox"})})]})}function Yn({form:t,index:s,explorer:n}){return e.jsxs(P,{p:"xs",pt:0,children:[e.jsx(S,{label:"Target File",withAsterisk:!0,description:"Path of file to be deleted.",placeholder:"D:/templates/ouput/{{username}}.pdf",...t.getInputProps(`actions.${s}.target`),leftSection:e.jsx(Ut,{size:16,style:{display:"block",opacity:.8}}),rightSection:n("target")}),e.jsx(U,{label:"Validate Path",mt:"xs",...t.getInputProps(`actions.${s}.validate`,{type:"checkbox"})})]})}function Qn({form:t,index:s,explorer:n}){return e.jsxs(P,{p:"xs",pt:0,children:[e.jsx(S,{label:"Source Folder",withAsterisk:!0,description:"Path of original folder to be copied.",placeholder:"D:/source/public/",...t.getInputProps(`actions.${s}.source`),leftSection:e.jsx(Ts,{size:16,style:{display:"block",opacity:.8}}),rightSection:n("source")}),e.jsx(U,{label:"Validate Path",mt:"xs",...t.getInputProps(`actions.${s}.validate`,{type:"checkbox"})}),e.jsx(S,{label:"Target Folder",withAsterisk:!0,description:"Destination path where copy will be placed.",placeholder:"E:/destination/{{username}}/",...t.getInputProps(`actions.${s}.target`),leftSection:e.jsx(Mt,{size:16,style:{display:"block",opacity:.8}}),rightSection:n("target")}),e.jsx(U,{label:"Should Overwrite",mt:"xs",...t.getInputProps(`actions.${s}.overwrite`,{type:"checkbox"})})]})}function Zn({form:t,index:s,explorer:n}){return e.jsxs(P,{p:"xs",pt:0,children:[e.jsx(S,{label:"Source Folder",withAsterisk:!0,description:"Path of folder to be moved.",placeholder:"D:/source/{{username}}/",...t.getInputProps(`actions.${s}.source`),leftSection:e.jsx(Es,{size:16,style:{display:"block",opacity:.8}}),rightSection:n("source")}),e.jsx(U,{label:"Validate Path",mt:"xs",...t.getInputProps(`actions.${s}.validate`,{type:"checkbox"})}),e.jsx(S,{label:"Target Folder",withAsterisk:!0,description:"Destination path where copy will be placed.",placeholder:"E:/destination/{{username}}/",...t.getInputProps(`actions.${s}.target`),leftSection:e.jsx(Mt,{size:16,style:{display:"block",opacity:.8}}),rightSection:n("target")}),e.jsx(U,{label:"Should Overwrite",mt:"xs",...t.getInputProps(`actions.${s}.overwrite`,{type:"checkbox"})})]})}function eo({form:t,index:s,explorer:n}){return e.jsxs(P,{p:"xs",pt:0,children:[e.jsx(S,{label:"Target Folder",withAsterisk:!0,description:"Path of folder to be deleted.",placeholder:"D:/temp/{{username}}/",...t.getInputProps(`actions.${s}.target`),leftSection:e.jsx(Ut,{size:16,style:{display:"block",opacity:.8}}),rightSection:n("target")}),e.jsx(U,{label:"Validate Path",mt:"xs",...t.getInputProps(`actions.${s}.validate`,{type:"checkbox"})})]})}function to({form:t,index:s,explore:n}){t.values.actions[s].templates||t.setFieldValue(`actions.${s}.templates`,[]);const l=()=>t.insertListItem(`actions.${s}.templates`,{name:"",value:""}),o=t.values.actions[s].templates||[],r=(i,c)=>()=>n(()=>p=>t.setFieldValue(`actions.${s}.templates.${c}.${i}`,`${t.values.actions[s].templates[c][i]||""}{{${p}}}`)),a=(i,c)=>e.jsx(N,{onClick:r(i,c),variant:"subtle",children:e.jsx(me,{size:16,style:{display:"block",opacity:.8}})});return e.jsxs(P,{pt:5,children:[e.jsx(v,{justify:"end",children:e.jsx(O,{onClick:l,variant:"light",size:"compact-xs",children:"Add"})}),e.jsxs(P,{p:"xs",pt:0,children:[o.length===0&&e.jsx(ce,{c:"dimmed",fz:"xs",children:"No templates configured."}),e.jsx(ee,{onDragEnd:({destination:i,source:c})=>t.reorderListItem(`actions.${s}.templates`,{from:c.index,to:i?i.index:0}),children:e.jsx(re,{droppableId:"dnd-list",direction:"vertical",children:i=>e.jsxs("div",{...i.droppableProps,style:{top:"auto",left:"auto"},ref:i.innerRef,children:[o.map((c,p)=>e.jsx(ie,{index:p,draggableId:p.toString(),children:u=>e.jsxs(m,{gutter:"xs",align:"center",ref:u.innerRef,mt:"xs",...u.draggableProps,style:{...u.draggableProps.style,left:"auto !important",top:"auto !important"},children:[e.jsx(m.Col,{span:"content",style:{cursor:"grab"},...u.dragHandleProps,children:e.jsx(v,{children:e.jsx(ae,{size:"1.2rem"})})}),e.jsx(m.Col,{span:"auto",children:e.jsx(S,{placeholder:"Name",...t.getInputProps(`actions.${s}.templates.${p}.name`),rightSection:a("name",p)})}),e.jsx(m.Col,{span:"auto",children:e.jsx(S,{placeholder:"Value",...t.getInputProps(`actions.${s}.templates.${p}.value`),rightSection:a("value",p)})}),e.jsx(m.Col,{span:"content",children:e.jsx(v,{gap:0,justify:"flex-end",children:e.jsx(N,{onClick:()=>t.removeListItem(`actions.${s}.templates`,p),variant:"subtle",color:"red",children:e.jsx(W,{size:"1.2rem",stroke:1.5})})})})]})},p)),i.placeholder]})})})]})]})}const mt=["name","displayName","givenName","SN","description","title","mail","company","department","manager","postalCode","pager","mobile","homephone","telephoneNumber","facsimileTelephoneNumber","wWWHomePage","ipPhone"],so=[{label:"== Equal To",value:"=="},{label:"!= Not Equal To",value:"!="},{label:">< Contains",value:"><"},{label:"<> Does Not Contain",value:"<>"},{label:">* Starts With",value:">*"},{label:"*< Ends With",value:"*<"},{label:"// Matches Regex",value:"//"}],no=[{label:"== Equal To",value:"==="},{label:"!= Not Equal To",value:"!=="},{label:">  Greater Than",value:">"},{label:"<  Lesser Than",value:"<"},{label:">= Greater Than, Or Equal To",value:">="},{label:"<= Lesser Than, Or Equal To",value:"<="}],tt=[{label:"String Constraint",id:"string",Icon:Os,color:"blue"},{label:"Math Constraint",id:"math",Icon:Ls,color:"pink"},{label:"Status",id:"status",connector:"ldap",Icon:Vs,color:"yellow"},{label:"Security Group",id:"group",connector:"ldap",Icon:Us,color:"cyan"},{label:"Organisational Unit",id:"ou",connector:"ldap",Icon:Ie,color:"violet"}],oo=[{label:"Directory Operations",id:"directory",Icon:we,color:"blue"},{label:"Document Operations",id:"document",Icon:qt,color:"red"},{label:"File Operations",id:"file",Icon:dt,color:"green"},{label:"Folder Operations",id:"folder",Icon:Ie,color:"orange"},{label:"System Operations",id:"system",Icon:Ws}],Ge={"Create User":{id:"Create User",catagory:"directory",Icon:Ms,color:"blue",Component:qn},"Enable User":{id:"Enable User",catagory:"directory",Icon:qs,color:"green",Component:et},"Disable User":{id:"Disable User",catagory:"directory",Icon:Bs,color:"pink",Component:et},"Delete User":{id:"Delete User",catagory:"directory",Icon:W,color:"red",Component:et},"Update Attributes":{id:"Update Attributes",catagory:"directory",Icon:Fe,color:"orange",Component:Hn},"Move Organisational Unit":{id:"Move Organisational Unit",catagory:"directory",Icon:Hs,color:"grape",Component:Wn},"Write PDF":{id:"Write PDF",catagory:"document",Icon:qt,color:"red",Component:Kn},"Send To Printer":{id:"Send To Printer",catagory:"document",Icon:Lt,color:"lime",Component:Gn},"Copy File":{id:"Copy File",catagory:"file",Icon:ke,color:"blue",Component:Jn},"Move File":{id:"Move File",catagory:"file",Icon:bt,color:"orange",Component:Xn},"Delete File":{id:"Delete File",catagory:"file",Icon:W,color:"red",Component:Yn},"Copy Folder":{id:"Copy Folder",catagory:"folder",Icon:ke,color:"blue",Component:Qn},"Move Folder":{id:"Move Folder",catagory:"folder",Icon:bt,color:"orange",Component:Zn},"Delete Folder":{id:"Delete Folder",catagory:"folder",Icon:W,color:"red",Component:eo},Template:{label:"Build Data Template",id:"Template",catagory:"system",Icon:Ot,Component:to,perRule:!1}};function lo({form:t}){const s=t.values.attributes||[];return e.jsxs(e.Fragment,{children:[s.length===0&&e.jsx(ce,{c:"dimmed",fz:"xs",children:"No attributes configured."}),e.jsx(ee,{onDragEnd:({destination:n,source:l})=>t.reorderListItem("attributes",{from:l.index,to:n?n.index:0}),children:e.jsx(re,{droppableId:"dnd-list",direction:"vertical",children:n=>e.jsxs("div",{...n.droppableProps,style:{top:"auto",left:"auto"},ref:n.innerRef,children:[s.map((l,o)=>e.jsx(ie,{index:o,draggableId:o.toString(),children:r=>e.jsxs(m,{gutter:"xs",align:"center",ref:r.innerRef,mt:"xs",...r.draggableProps,style:{...r.draggableProps.style,left:"auto !important",top:"auto !important"},children:[e.jsx(m.Col,{span:"content",style:{cursor:"grab"},...r.dragHandleProps,children:e.jsx(v,{children:e.jsx(ae,{size:"1.2rem"})})}),e.jsx(m.Col,{span:"auto",children:e.jsx(xt,{selectable:mt,...t.getInputProps(`attributes.${o}`),createLabel:a=>`Add Custom Attribute: ${a}`})}),e.jsx(m.Col,{span:"content",children:e.jsx(v,{gap:0,justify:"flex-end",children:e.jsx(N,{onClick:()=>t.removeListItem("attributes",o),variant:"subtle",color:"red",children:e.jsx(W,{size:"1.2rem",stroke:1.5})})})})]})},o)),n.placeholder]})})})]})}function ao({form:t,editing:s}){const n=()=>t.setFieldValue("password",""),l=()=>t.insertListItem("attributes","");return e.jsxs(e.Fragment,{children:[e.jsx(S,{label:"Connector Name",leftSection:e.jsx(ge,{size:16,style:{display:"block",opacity:.5}}),placeholder:"Domain Name",withAsterisk:!0,...t.getInputProps("name")}),e.jsx(S,{label:"Target URL",leftSection:e.jsx(Bt,{size:16,style:{display:"block",opacity:.5}}),placeholder:"ldaps://10.10.1.1:636",withAsterisk:!0,...t.getInputProps("url"),mt:"md"}),e.jsxs(He,{mt:"md",cols:{base:1,sm:2},children:[e.jsx(S,{label:"Username",placeholder:"domain\\administrator",withAsterisk:!0,leftSection:e.jsx(De,{size:16,style:{display:"block",opacity:.5}}),...t.getInputProps("username")}),typeof t.values.password=="string"||!s?e.jsx(pe,{label:"Password",placeholder:"password",withAsterisk:!0,leftSection:e.jsx(oe,{size:16,style:{display:"block",opacity:.5}}),...t.getInputProps("password")}):e.jsx(pe,{label:"Password",readOnly:!0,placeholder:"Password",value:"**************",leftSection:e.jsx(oe,{size:16,style:{display:"block",opacity:.5}}),rightSection:e.jsx(N,{variant:"subtle",children:e.jsx(pt,{onClick:()=>n(),size:16,style:{display:"block",opacity:.5}})})})]}),e.jsx(ne,{open:!0,label:"Attributes",rightSection:e.jsx(O,{onClick:()=>l(),maw:50,variant:"light",size:"compact-xs",mt:10,children:"Add"}),children:e.jsx(lo,{form:t})}),e.jsxs(ne,{children:[e.jsx(Be,{mt:"md",label:"Specify Root DSE",onChange:o=>t.setFieldValue("dse",o.currentTarget.checked?"":void 0),checked:!!t.values.dse||t.values.dse===""}),(t.values.dse||t.values.dse==="")&&e.jsx(S,{label:"Root DSE",description:"All distinguished names, including the Base Organizational Unit, will be appended by this path.",placeholder:"dc=sub,dc=domain,dc=com",withAsterisk:!0,leftSection:e.jsx(Ks,{size:16,style:{display:"block",opacity:.5}}),...t.getInputProps("dse")}),e.jsx(S,{mt:"md",label:"Base Organizational Unit",description:"All distinguished names will be appended by this path.",placeholder:"ou=child,ou=parent",leftSection:e.jsx(Ie,{size:16,style:{display:"block",opacity:.5}}),...t.getInputProps("base"),rightSection:e.jsx(N,{variant:"subtle",children:e.jsx(Ne,{size:16,style:{display:"block",opacity:.5}})})})]})]})}function ro({form:t,editing:s}){const n=()=>t.setFieldValue("password","");return e.jsxs(e.Fragment,{children:[e.jsx(S,{label:"Connector Name",leftSection:e.jsx(ge,{size:16,style:{display:"block",opacity:.5}}),placeholder:"Proxy Name",withAsterisk:!0,...t.getInputProps("name")}),e.jsx(S,{label:"Target URL",leftSection:e.jsx(Bt,{size:16,style:{display:"block",opacity:.5}}),placeholder:"http://proxy.server:8080",withAsterisk:!0,...t.getInputProps("url"),mt:"md"}),e.jsxs(He,{mt:"md",cols:{base:1,sm:2},children:[e.jsx(S,{label:"Username",placeholder:"username",...t.getInputProps("username"),leftSection:e.jsx(De,{size:16,style:{display:"block",opacity:.5}})}),typeof t.values.password=="string"||!s?e.jsx(pe,{label:"Password",placeholder:"password",leftSection:e.jsx(oe,{size:16,style:{display:"block",opacity:.5}}),...t.getInputProps("password")}):e.jsx(pe,{label:"Password",readOnly:!0,placeholder:"Password",value:"**************",leftSection:e.jsx(oe,{size:16,style:{display:"block",opacity:.5}}),rightSection:e.jsx(N,{variant:"subtle",children:e.jsx(pt,{onClick:()=>n(),size:16,style:{display:"block",opacity:.5}})})})]})]})}function io({form:t,editing:s}){const n=()=>t.setFieldValue("password","");return e.jsxs(e.Fragment,{children:[e.jsx(S,{label:"Connector Name",leftSection:e.jsx(ge,{size:16,style:{display:"block",opacity:.5}}),placeholder:"School Name",withAsterisk:!0,...t.getInputProps("name")}),e.jsxs(He,{mt:"md",cols:{base:1,sm:2},children:[e.jsx(S,{label:"Username",placeholder:"ST01235",withAsterisk:!0,leftSection:e.jsx(De,{size:16,style:{display:"block",opacity:.5}}),...t.getInputProps("username")}),typeof t.values.password=="string"||!s?e.jsx(pe,{label:"Password",placeholder:"password",withAsterisk:!0,leftSection:e.jsx(oe,{size:16,style:{display:"block",opacity:.5}}),...t.getInputProps("password")}):e.jsx(pe,{label:"Password",readOnly:!0,placeholder:"Password",value:"**************",leftSection:e.jsx(oe,{size:16,style:{display:"block",opacity:.5}}),rightSection:e.jsx(N,{variant:"subtle",children:e.jsx(pt,{onClick:()=>n(),size:16,style:{display:"block",opacity:.5}})})})]}),e.jsx(S,{label:"School Identification Number",leftSection:e.jsx(Et,{size:16,style:{display:"block",opacity:.5}}),placeholder:"1234",withAsterisk:!0,...t.getInputProps("school"),mt:"md"}),e.jsxs(ne,{children:[e.jsx(is,{label:"Caching Policy",description:"Minutes until downloaded cache is purged.",leftSection:e.jsx(Rt,{size:16,style:{display:"block",opacity:.5}}),placeholder:"1440 (1 day)",...t.getInputProps("cache"),mt:"md"}),e.jsx(de,{label:"Proxy Connector",placeholder:"Corporate Proxy Server",clearable:!0,...t.getInputProps("proxy"),filter:l=>l.filter(o=>o.id==="proxy"),leftSection:e.jsx(ot,{size:16,style:{display:"block",opacity:.5}}),mt:"md"}),e.jsx(de,{label:"eduHUB Connector",description:"Matches eduHUB usernames to eduSTAR usernames.",placeholder:"ST_8827.csv",clearable:!0,...t.getInputProps("eduhub"),filter:l=>l.filter(o=>o.id==="csv"),leftSection:e.jsx(ot,{size:16,style:{display:"block",opacity:.5}}),mt:"md"})]})]})}function co({provider:t,form:s,editing:n}){switch(t){case"csv":return e.jsx(Vn,{form:s});case"ldap":return e.jsx(ao,{form:s,editing:n});case"proxy":return e.jsx(ro,{form:s,editing:n});case"stmc":return e.jsx(io,{form:s,editing:n});default:return e.jsx(e.Fragment,{children:"Invalid Provider."})}}function uo({editing:t,adding:s,close:n}){const{schema:l,mutate:o}=j.useContext(M),r=s?je[s]:t?je[t.id]:{id:"",name:""},a=On[r.id]||{},i=Ln[r.id]||{},c=he({initialValues:a,validate:i});j.useEffect(()=>{c.reset(),t?c.setValues(t):c.setValues(a),c.setInitialValues(a)},[t,s]);const{post:p,loading:u}=R({url:`/schema/${l==null?void 0:l.name}/connector`,data:{...c.values,id:r.id},before:()=>c.validate(),check:()=>!c.isValid(),catch:({validation:h})=>c.setErrors(h),then:({connectors:h,_connectors:I,headers:D})=>{o({connectors:h,_connectors:I,headers:D}),n(),H.show({title:"Success",message:"Connector Added.",color:"lime"})}}),{put:x,loading:k}=R({url:`/schema/${l==null?void 0:l.name}/connector`,data:{...c.values,id:r.id},before:()=>c.validate(),check:()=>!c.isValid(),catch:({validation:h})=>c.setErrors(h),then:({connectors:h,_connectors:I,headers:D})=>{o({connectors:h,_connectors:I,headers:D}),n(),H.show({title:"Success",message:"Connector Saved.",color:"lime"})}}),d=()=>x({append_url:`/${t==null?void 0:t.name}`}),y=u||k;return e.jsxs(xe,{size:"lg",opened:!!t||!!s,onClose:n,title:r.name,children:[e.jsx(co,{provider:r.id,form:c,editing:t}),e.jsx(v,{justify:"right",mt:"md",children:e.jsx(O,{loading:y,onClick:t?d:p,variant:"light",type:"submit",children:t?"Save":"Add"})})]})}function po(){const{schema:t,connectors:s,mutate:n}=j.useContext(M),l=le(),[o,{open:r,close:a}]=se(!1),[i,c]=j.useState(void 0),[p,u]=j.useState(void 0),x=A=>{u(void 0),c(A)},k=A=>{a(),c(void 0),u(A)},{del:d,request:y,loading:h}=R({url:`/schema/${t==null?void 0:t.name}/connector`,catch:A=>ye(A),then:({connectors:A,_connectors:z,headers:g})=>{n({connectors:A,_connectors:z,headers:g}),H.show({title:"Success",message:"Connector Removed.",color:"lime"})}}),{post:I,request:D,loading:_}=R({url:`/schema/${t==null?void 0:t.name}/connector`,catch:A=>ye(A),then:({connectors:A,_connectors:z,headers:g})=>{n({connectors:A,_connectors:z,headers:g}),H.show({title:"Success",message:"Connector Copied.",color:"lime"})}}),L=A=>it.openConfirmModal({title:"Permanently Delete Connector",centered:!0,children:e.jsxs(w,{size:"sm",children:["Are you sure you want to delete ",A,"? This action is destructive and cannot be reversed."]}),labels:{confirm:"Delete connector",cancel:"No don't delete it"},confirmProps:{color:"red"},onConfirm:()=>d({append_url:`/${A}`,loading:A})}),q=h||_?(y||D).loading:!1;if(t)return e.jsxs(fe,{label:e.jsx(be,{rightSection:e.jsx(O,{onClick:()=>r(),variant:"light",children:"Add"}),children:"Connectors"}),children:[e.jsx(En,{add:k,opened:o,close:a}),e.jsx(uo,{editing:i,adding:p,close:()=>{c(void 0),u(void 0)}}),e.jsxs(te,{verticalSpacing:"sm",children:[e.jsx(te.Thead,{children:e.jsxs(te.Tr,{children:[e.jsx(te.Th,{children:"Name"}),e.jsx(te.Th,{children:"Provider"}),e.jsx(te.Th,{})]})}),e.jsx(te.Tbody,{children:s.map(A=>{const z=je[A.id];return e.jsxs(te.Tr,{children:[e.jsx(te.Td,{children:e.jsxs(v,{miw:100,gap:"sm",children:[e.jsx(z.icon,{color:l.colors[z.color][6],size:20,stroke:1.5}),e.jsx(w,{fz:"sm",children:A.name})]})}),e.jsx(te.Td,{children:e.jsx(wt,{color:l.colors[z.color][6],variant:"light",children:z.name})}),e.jsx(te.Td,{miw:80,children:e.jsxs(v,{gap:0,justify:"flex-end",children:[e.jsx(N,{onClick:()=>x(A),variant:"subtle",color:"orange",children:e.jsx(Fe,{style:{width:T(16),height:T(16)},stroke:1.5})}),e.jsx(N,{onClick:()=>I({append_url:`/${A.name}/copy`,loading:A.name}),loading:q===A.name,variant:"subtle",color:"indigo",children:e.jsx(ke,{style:{width:T(16),height:T(16)},stroke:1.5})}),e.jsx(N,{onClick:()=>L(A.name),loading:q===A.name,variant:"subtle",color:"red",children:e.jsx(W,{style:{width:T(16),height:T(16)},stroke:1.5})})]})})]},A.name)})})]})]})}const Je=j.createContext({explorer:e.jsx(e.Fragment,{}),explore:()=>{},close:()=>{}});function ho({form:t}){const{connectors:s}=j.useContext(M),{explorer:n,explore:l}=j.useContext(Je),o=s.filter(u=>u.id!=="proxy").length-1,{headers:r}=j.useContext(M),a=()=>t.insertListItem("secondaries",{primary:"",secondaryKey:"",primaryKey:""}),i=u=>t.removeListItem("secondaries",u),c=(t.values.secondaries||[]).map(u=>u.primary),p=()=>u=>t.setFieldValue("display",`${t.values.display||""}{{${u}}}`);return e.jsxs(P,{children:[n,e.jsx(S,{label:"Rule Name",leftSection:e.jsx(ge,{size:16,style:{display:"block",opacity:.5}}),placeholder:"Rule Name",withAsterisk:!0,mb:"xs",...t.getInputProps("name")}),e.jsxs(m,{children:[e.jsx(m.Col,{span:8,children:e.jsx(de,{label:"Primary Data Source",withAsterisk:!0,description:"Rule conditions will be evaluated for each entry in this connector. For each row, each user, etc.",clearable:!0,...t.getInputProps("primary"),filter:u=>u.filter(x=>x.id!=="proxy")})}),e.jsx(m.Col,{span:4,children:e.jsx(ue,{label:"Primary Key",withAsterisk:!0,description:"Unique identifier for each row.",placeholder:"id",data:t.values.primary in r?r[t.values.primary]:[],disabled:!t.values.primary,clearable:!0,searchable:!0,leftSection:e.jsx(oe,{size:"1rem"}),...t.getInputProps("primaryKey")})})]}),e.jsxs(v,{grow:!0,justify:"apart",mb:"xs",gap:"xs",children:[e.jsx(w,{size:"sm",children:"Secondary Data Sources"}),e.jsx(v,{justify:"right",gap:"xs",pt:"xs",children:e.jsx(N,{size:"lg",variant:"default",disabled:!t.values.primary||c.length>=o,onClick:a,children:e.jsx(Ft,{size:15,stroke:1.5})})})]}),e.jsx(ee,{onDragEnd:({destination:u,source:x})=>t.reorderListItem("secondaries",{from:x.index,to:u?u.index:0}),children:e.jsx(re,{droppableId:"dnd-list",direction:"vertical",children:u=>e.jsx("div",{...u.droppableProps,style:{top:"auto",left:"auto"},ref:u.innerRef,children:(t.values.secondaries||[]).map(({primary:x},k)=>e.jsx(ie,{index:k,draggableId:k.toString(),children:d=>e.jsxs(m,{align:"center",ref:d.innerRef,mt:"xs",...d.draggableProps,gutter:"xs",style:{...d.draggableProps.style,left:"auto !important",top:"auto !important"},children:[e.jsx(m.Col,{span:"content",style:{cursor:"grab"},...d.dragHandleProps,children:e.jsx(v,{children:e.jsx(ae,{size:"1.2rem"})})}),e.jsx(m.Col,{span:"auto",children:e.jsx(de,{clearable:!0,...t.getInputProps(`secondaries.${k}.primary`),filter:y=>y.filter(h=>h.id!=="proxy"&&h.name!==t.values.primary&&!c.includes(h.name))})}),e.jsx(m.Col,{span:"auto",children:e.jsx(ue,{clearable:!0,searchable:!0,placeholder:"Foreign Key",leftSection:e.jsx(oe,{size:"1rem"}),disabled:!x,data:x in r?r[x]:[],...t.getInputProps(`secondaries.${k}.secondaryKey`)})}),e.jsx(m.Col,{span:"auto",children:e.jsx(ue,{clearable:!0,searchable:!0,placeholder:"Primary Key",leftSection:e.jsx(oe,{size:"1rem"}),disabled:!x,data:t.values.primary in r?r[t.values.primary]:[],...t.getInputProps(`secondaries.${k}.primaryKey`)})}),e.jsx(m.Col,{span:"content",children:e.jsx(v,{justify:"right",gap:"xs",children:e.jsx(N,{color:"red",onClick:()=>i(k),variant:"default",size:"lg",children:e.jsx(W,{size:15})})})})]})},k))})})}),e.jsx(S,{label:"Entry Display Name",description:"Displayed on each result row to identify each entry.",leftSection:e.jsx(Gs,{size:16,style:{display:"block",opacity:.5}}),placeholder:"{{username}}",mt:"xs",mb:"xs",rightSection:e.jsx(N,{onClick:()=>l(p),variant:"subtle",children:e.jsx(me,{size:16,style:{display:"block",opacity:.8}})}),...t.getInputProps("display")}),e.jsx(U,{...t.getInputProps("enabled",{type:"checkbox"}),label:"Rule Enabled"}),e.jsx(cs,{label:"Rule Description",placeholder:"Describe what this rule does",mt:"xs",...t.getInputProps("description")})]})}const xo=[{label:"Member of group",value:"member"},{label:"Not member of group",value:"notmember"}],mo=[{label:"Child of organisational unit",value:"child"},{label:"Not child of organisational unit",value:"notchild"}],jo=[{label:"Exists on",value:"exists"},{label:"Does not exist on",value:"notexists"},{label:"Enabled on ",value:"enabled"},{label:"Disabled on",value:"disabled"}],go=["status"],vt=[];function bo({form:t,index:s,modifyCondition:n,delimit:l,delimited:o}){const r=o(s,"")?e.jsx(Js,{size:16,style:{display:"block",opacity:.8}}):e.jsx(Xs,{size:16,style:{display:"block",opacity:.8}});return e.jsx(S,{placeholder:"Value",...t.getInputProps(`conditions.${s}.value`),rightSection:e.jsxs(O.Group,{style:{marginRight:30},children:[e.jsxs(E,{position:"bottom-end",children:[e.jsx(E.Target,{children:e.jsx(N,{variant:"subtle",children:r})}),e.jsxs(E.Dropdown,{children:[e.jsx(E.Item,{onClick:l(s,""),disabled:o(s,""),children:"No Delimiter"}),e.jsx(E.Item,{onClick:l(s,","),disabled:o(s,","),children:"Comma ,"}),e.jsx(E.Item,{onClick:l(s,";"),disabled:o(s,";"),children:"Semicolon ;"}),e.jsx(E.Item,{onClick:l(s,"|"),disabled:o(s,"|"),children:"Bar |"}),e.jsx(E.Item,{onClick:l(s,"tab"),disabled:o(s,"tab"),children:"Tab"}),e.jsx(E.Item,{onClick:l(s," "),disabled:o(s," "),children:"Space"})]})]}),e.jsx(N,{variant:"subtle",children:e.jsx(me,{onClick:n("value",s),size:16,style:{display:"block",opacity:.8}})})]})})}function Gt({form:t,label:s}){const n=le(),{explorer:l,explore:o}=j.useContext(Je),{_connectors:r}=j.useContext(M),a=(d,y)=>()=>t.insertListItem("conditions",{type:d,key:"",operator:y||(d=="string"||d=="math"?"==":""),value:"",delimiter:""}),i=d=>()=>t.insertListItem("conditions",{...d}),c=d=>()=>t.removeListItem("conditions",d),p=(d,y)=>()=>o(()=>h=>t.setFieldValue(`conditions.${y}.${d}`,`${t.values.conditions[y][d]||""}{{${h}}}`)),u=(d,y)=>()=>t.setFieldValue(`conditions.${d}.delimiter`,y),x=(d,y)=>t.values.conditions[d].delimiter===y,k=t.values.primary in r&&r[t.values.primary].id==="ldap"||(t.values.secondaries||[]).filter(d=>d.primary in r&&r[d.primary].id==="ldap").length>0;return e.jsxs(P,{children:[l,e.jsxs(v,{grow:!0,justify:"apart",mb:"xs",mt:"xs",gap:"xs",children:[e.jsx(w,{c:"dimmed",size:"sm",children:s||"All conditions here will be evaluated and must be true for actions to be executed."}),e.jsx(v,{justify:"right",gap:"xs",children:e.jsxs(E,{position:"bottom-end",children:[e.jsx(E.Target,{children:e.jsx(O,{variant:"light",rightSection:e.jsx(ut,{size:"1.05rem",stroke:1.5}),pr:12,children:"Add condition"})}),e.jsxs(E.Dropdown,{children:[e.jsx(E.Label,{children:"Data Sources"}),tt.filter(d=>!d.connector).map(d=>e.jsx(E.Item,{onClick:a(d.id),leftSection:e.jsx(d.Icon,{color:n.colors[d.color][6],size:"1rem",stroke:1.5}),children:d.label},d.id)),k&&e.jsxs(e.Fragment,{children:[e.jsx(E.Label,{children:"Directory"}),tt.filter(d=>d.connector==="ldap").map(d=>e.jsx(E.Item,{onClick:a(d.id,d.id),leftSection:e.jsx(d.Icon,{color:n.colors[d.color][6],size:"1rem",stroke:1.5}),children:d.label},d.id))]})]})]})})]}),(t.values.conditions||[]).length===0&&e.jsx(w,{c:"lighter",size:"sm",children:"No conditions in effect. Rules must have at least one condition to evaluate."}),e.jsx(ee,{onDragEnd:({destination:d,source:y})=>t.reorderListItem("conditions",{from:y.index,to:d?d.index:0}),children:e.jsx(re,{droppableId:"dnd-list",direction:"vertical",children:d=>e.jsxs("div",{...d.droppableProps,style:{top:"auto",left:"auto"},ref:d.innerRef,children:[(t.values.conditions||[]).map((y,h)=>{const I=tt.filter(D=>D.id===y.type)[0];return e.jsx(ie,{index:h,draggableId:h.toString(),children:D=>e.jsxs(m,{align:"center",ref:D.innerRef,mt:"xs",...D.draggableProps,gutter:"xs",style:{...D.draggableProps.style,left:"auto !important",top:"auto !important"},children:[e.jsx(m.Col,{span:"content",style:{cursor:"grab"},...D.dragHandleProps,children:e.jsx(v,{children:e.jsx(ae,{size:"1.2rem"})})}),e.jsx(m.Col,{span:"content",children:e.jsx(v,{children:e.jsx(Le,{label:I.label,children:e.jsx(I.Icon,{color:n.colors[I.color][6],size:"1.2rem"})})})}),vt.includes(y.type)&&e.jsx(m.Col,{c:"dimmed",span:"content",children:I.label}),y.type==="string"||y.type==="math"?e.jsx(m.Col,{span:"auto",children:e.jsx(S,{placeholder:"Key",...t.getInputProps(`conditions.${h}.key`),rightSection:e.jsx(N,{onClick:p("key",h),variant:"subtle",children:e.jsx(me,{size:16,style:{display:"block",opacity:.8}})})})}):e.jsx(m.Col,{span:"auto",children:e.jsx(de,{clearable:!0,...t.getInputProps(`conditions.${h}.key`),filter:_=>_.filter(L=>L.id==="ldap")})}),!vt.includes(y.type)&&e.jsx(m.Col,{span:"content",children:e.jsx(ue,{placeholder:"Operator",checkIconPosition:"right",data:{string:so,math:no,group:xo,ou:mo,status:jo}[y.type],maxDropdownHeight:300,...t.getInputProps(`conditions.${h}.operator`)})}),!go.includes(y.type)&&e.jsx(m.Col,{span:"auto",children:e.jsx(bo,{form:t,index:h,delimit:u,delimited:x,modifyCondition:p})}),e.jsx(m.Col,{span:"content",children:e.jsxs(v,{justify:"right",gap:"xs",children:[e.jsx(N,{onClick:c(h),variant:"default",size:"lg",children:e.jsx(W,{size:15})}),e.jsx(N,{onClick:i(y),variant:"default",size:"lg",children:e.jsx(ke,{size:15})})]})})]})},h)}),d.placeholder]})})})]})}const fo="_control_d0u7x_1",Ct={control:fo};function St({add:t,perRule:s,label:n}){const[l,{close:o,open:r}]=se(!1),a=le(),i=Object.values(Ge),c=p=>()=>{t(p),o()};return e.jsx(v,{justify:"right",gap:"xs",children:e.jsxs(Ye,{width:300,position:"left-start",shadow:"md",opened:l,children:[e.jsx(Ye.Target,{children:e.jsx(O,{variant:"light",onClick:l?o:r,rightSection:e.jsx(ut,{size:"1.05rem",stroke:1.5}),pr:12,children:n})}),e.jsx(Ye.Dropdown,{children:oo.map(p=>{const u=i.filter(x=>s?x.perRule!==!1&&x.catagory===p.id:x.catagory===p.id);if(!(u.length<=0))return e.jsx(gt,{label:p.label,className:Ct.control,leftSection:e.jsx(p.Icon,{color:p.color?a.colors[p.color][6]:void 0,size:"1rem",stroke:1.5}),childrenOffset:28,children:u.map(x=>e.jsx(gt,{label:x.label||x.id,className:Ct.control,onClick:c(x.id),leftSection:e.jsx(x.Icon,{color:x.color?a.colors[x.color][6]:void 0,size:"1rem",stroke:1.5})},x.id))},p.id)})})]})})}function yo({form:t,index:s,a:n,explore:l}){const[o,{toggle:r}]=se(!1),a=le(),{Icon:i,color:c,Component:p}=Ge[n.name],u=y=>()=>t.insertListItem("actions",{...y}),x=y=>()=>t.removeListItem("actions",y),k=y=>()=>l(()=>h=>t.setFieldValue(`actions.${s}.${y}`,`${t.values.actions[s][y]||""}{{${h}}}`)),d=y=>e.jsx(N,{onClick:k(y),variant:"subtle",children:e.jsx(me,{size:16,style:{display:"block",opacity:.8}})});return e.jsxs(e.Fragment,{children:[e.jsxs(m.Col,{span:"auto",children:[s+1,". ",e.jsx(i,{color:c?a.colors[c][6]:void 0,size:18,stroke:1.5})," ",n.name]}),e.jsx(m.Col,{span:"content",children:e.jsxs(v,{justify:"right",gap:"xs",children:[e.jsx(N,{onClick:()=>r(),variant:o?"filled":"default",size:"lg",children:e.jsx(Fe,{size:15})}),e.jsx(N,{onClick:x(s),variant:"default",size:"lg",children:e.jsx(W,{size:15})}),e.jsx(N,{onClick:u(n),variant:"default",size:"lg",children:e.jsx(ke,{size:15})})]})}),e.jsx(m.Col,{span:12,pt:0,pb:0,children:e.jsx($t,{in:o,children:e.jsx(p,{form:t,index:s,explorer:d,explore:l})})})]})}function kt({form:t}){const{explorer:s,explore:n}=j.useContext(Je);return e.jsxs(P,{children:[s,(t.values.actions||[]).length===0&&e.jsx(w,{c:"lighter",size:"sm",children:"No actions configured."}),e.jsx(ee,{onDragEnd:({destination:l,source:o})=>t.reorderListItem("actions",{from:o.index,to:l?l.index:0}),children:e.jsx(re,{droppableId:"dnd-list",direction:"vertical",children:l=>e.jsxs("div",{...l.droppableProps,style:{top:"auto",left:"auto"},ref:l.innerRef,children:[(t.values.actions||[]).map((o,r)=>e.jsx(ie,{index:r,draggableId:r.toString(),children:a=>e.jsxs(m,{align:"center",ref:a.innerRef,mt:"xs",...a.draggableProps,gutter:"xs",style:{...a.draggableProps.style,left:"auto !important",top:"auto !important"},children:[e.jsx(m.Col,{span:"content",style:{cursor:"grab"},...a.dragHandleProps,children:e.jsx(v,{children:e.jsx(ae,{size:"1.2rem"})})}),e.jsx(yo,{form:t,index:r,a:o,explore:n})]})},r)),l.placeholder]})})})]})}function vo({form:t}){const s=n=>t.insertListItem("actions",{name:n});return e.jsxs(P,{children:[e.jsx(w,{c:"dimmed",size:"sm",mt:"xs",children:"Actions on this tab are executed sequentially if all conditions evaluated successfully."}),e.jsx(nt,{my:"xs",variant:"dashed"}),e.jsxs(v,{grow:!0,justify:"apart",mb:"xs",mt:"xs",gap:"xs",children:[e.jsx(w,{c:"dimmed",size:"sm",children:"Performed for each row."}),e.jsx(St,{add:s,label:"Add Row Action"})]}),e.jsx(ee,{onDragEnd:({destination:n,source:l})=>t.reorderListItem("actions",{from:l.index,to:n?n.index:0}),children:e.jsx(kt,{form:t})}),e.jsx(nt,{my:"xs",variant:"dashed"}),e.jsxs(v,{grow:!0,justify:"apart",mb:"xs",mt:"xs",gap:"xs",children:[e.jsx(w,{c:"dimmed",size:"sm",children:"Performed for each rule, after the above per-row actions are completed."}),e.jsx(St,{add:s,label:"Add Rule Action",perRule:!0})]}),e.jsx(ee,{onDragEnd:({destination:n,source:l})=>t.reorderListItem("actions",{from:l.index,to:n?n.index:0}),children:e.jsx(kt,{form:t})})]})}function Co({editing:t,close:s}){const{schema:n,mutate:l}=j.useContext(M),[o,r]=j.useState("settings"),a={secondaries:[],conditions:[],actions:[]},i=he({initialValues:a,validate:{}});j.useEffect(()=>{i.reset(),t?i.setValues(t):i.setValues(a),i.setInitialValues(a)},[t]);const{post:c,loading:p}=R({url:`/schema/${n==null?void 0:n.name}/rule`,data:{...i.values},catch:({validation:h})=>i.setErrors(h),then:({rules:h,_rules:I})=>{l({rules:h,_rules:I}),s(),H.show({title:"Success",message:"Rule Added.",color:"lime"})}}),{put:u,loading:x}=R({url:`/schema/${n==null?void 0:n.name}/rule/${t==null?void 0:t.name}`,data:{...i.values},catch:({validation:h})=>i.setErrors(h),then:({rules:h,_rules:I})=>{l({rules:h,_rules:I}),s(),H.show({title:"Success",message:"Rule Saved.",color:"lime"})}}),k=p||x,d=!i.values.primary||!i.values.primaryKey,y=d||(i.values.conditions||[]).length<=0;return e.jsx(P,{children:e.jsx(fe,{label:e.jsxs(be,{rightSection:e.jsx(ht,{loading:k,variant:"light",onClick:t?u:c,options:[{onClick:()=>s(),label:"Cancel",leftSection:e.jsx(Ae,{size:16})}],children:t?"Save":"Create"}),children:["Rule",t?" - Edit":" - New"]}),children:e.jsxs(V,{value:o,onChange:r,children:[e.jsxs(V.List,{children:[e.jsx(V.Tab,{value:"settings",leftSection:e.jsx(_t,{size:"0.8rem"}),children:"Settings"}),e.jsx(V.Tab,{value:"conditions",disabled:d,leftSection:e.jsx(Ys,{size:"0.8rem"}),children:"Conditions"}),e.jsx(V.Tab,{value:"actions",disabled:y,leftSection:e.jsx($e,{size:"0.8rem"}),children:"Actions"})]}),e.jsx(V.Panel,{value:"settings",p:"xs",children:o==="settings"&&e.jsx(ho,{form:i})}),e.jsx(V.Panel,{value:"conditions",children:e.jsx(Gt,{form:i})}),e.jsx(V.Panel,{value:"actions",children:e.jsx(vo,{form:i})})]})})})}function So({action:t,resultant:s}){if(!t.result.data)return e.jsx(e.Fragment,{});const n=t.result.data;return e.jsxs(P,{children:[e.jsxs(w,{fz:"sm",children:["Canonical Name: ",e.jsx(B,{children:n.cn||""})]}),e.jsxs(w,{fz:"sm",children:["User Principal Name: ",e.jsx(B,{children:n.upn||""})]}),e.jsxs(w,{fz:"sm",children:["SAM Account Name: ",e.jsx(B,{children:n.sam||""})]}),e.jsx(P,{className:Z.overflow,children:e.jsxs(w,{fz:"sm",children:["Organizational Unit: ",e.jsxs(B,{children:[n.ou||"",",",n.base||""]})]})}),e.jsx(P,{className:Z.overflow,children:e.jsxs(w,{fz:"sm",children:["Organizational Unit: ",e.jsx(B,{children:n.dn||""})]})}),e.jsxs(w,{fz:"sm",children:[s?"":"Sample ","Password: ",e.jsx(B,{children:n.password||""})]}),e.jsxs(w,{fz:"xs",pt:"xs",children:["Account will be ",n.enable?"enabled":"disabled"," on creation."]}),e.jsx(ne,{fz:"sm",label:"Attributes",children:e.jsx(Q,{size:"xs",icon:e.jsx(e.Fragment,{children:"-"}),children:(n.attributes||[]).map(({name:l,value:o})=>e.jsxs(Q.Item,{children:[l,": ",e.jsx(B,{children:o})]},l))})}),e.jsx(ne,{fz:"sm",label:"Security Groups",children:e.jsx(Q,{size:"xs",icon:e.jsx(e.Fragment,{children:"-"}),children:(n.groups||[]).map((l,o)=>e.jsx(Q.Item,{className:Z.overflow,children:e.jsx(P,{style:{whiteSpace:"nowrap"},children:l})},o))})})]})}function ko({action:t}){if(!t.result.data)return e.jsx(e.Fragment,{});const s=t.result.data;return e.jsx(P,{children:e.jsx(Q,{size:"sm",icon:e.jsx(e.Fragment,{children:"-"}),children:Object.keys(s||[]).map((n,l)=>e.jsx(Q.Item,{className:Z.overflow,children:e.jsxs(P,{style:{whiteSpace:"nowrap"},children:[n,": ",e.jsx(B,{children:JSON.stringify(s[n])})]})},l))})})}function wo({change:t,r:s}){switch(t.type){case"Replace":return e.jsxs(Q.Item,{className:Z.overflow,children:[t.name,": ",e.jsxs(B,{children:["Replace",s&&"d"," ",t.currentValue||"<undefined>"," with '",t.value,"'"]})]},t.name);case"Add":return e.jsxs(Q.Item,{className:Z.overflow,children:[t.name,": ",e.jsxs(B,{children:["Set to '",t.value,"'"]})]},t.name);case"Delete":return e.jsxs(Q.Item,{className:Z.overflow,children:["delete",s&&"d",": ",e.jsx(B,{children:t.name})]},t.name)}}function Io({action:t,resultant:s}){if(!t.result.data)return e.jsx(e.Fragment,{});const n=t.result.data,l=(n.changes||[]).filter(o=>o.error);return e.jsxs(P,{children:[e.jsxs(w,{fz:"sm",children:["Directory: ",e.jsx(B,{children:n.directory||""})]}),e.jsxs(w,{fz:"sm",children:["User Principal Name: ",e.jsx(B,{children:n.upn||""})]}),e.jsx(ne,{fz:"sm",label:"Changes",open:!0,children:e.jsx(Q,{size:"xs",icon:e.jsx(e.Fragment,{children:"-"}),children:(n.changes||[]).map(o=>e.jsx(wo,{change:o,r:s}))})}),l.length>0&&e.jsx(ne,{fz:"sm",label:"Errors",open:!0,children:e.jsx(Q,{size:"xs",icon:e.jsx(e.Fragment,{children:"-"}),children:l.map(o=>e.jsxs(Q.Item,{className:Z.overflow,children:[o.name,": ",e.jsx(B,{children:o.error})]},o.name))})})]})}function Po(t,s){return!!(s.id.includes(t)||s.display.includes(t))}function zo({match:t,toggle:s,setAction:n,resultant:l=!1,dash:o}){const r=le();return e.jsxs(m,{align:"center",children:[e.jsx(m.Col,{pl:"lg",span:1,children:!l&&e.jsx(U,{disabled:!t.actionable,onChange:s(t.id),checked:!!t.checked})}),o&&e.jsx(m.Col,{span:1,children:t.schema}),o&&e.jsx(m.Col,{span:1,children:t.rule}),e.jsx(m.Col,{span:2,children:t.id}),e.jsx(m.Col,{span:o?5:7,children:t.display}),e.jsx(m.Col,{span:2,children:t.actions.map((a,i)=>{const{Icon:c,color:p}=Ge[a.name];return a.result.warning?e.jsx(c,{onClick:()=>n(a),style:{cursor:"pointer"},color:r.colors.gray[8],size:16,stroke:2},i):a.result.error?e.jsx(ps,{size:6,offset:3,color:"red",inline:!0,children:e.jsx(c,{onClick:()=>n(a),style:{cursor:"pointer"},color:p?r.colors[p][6]:void 0,size:16,stroke:2})},i):e.jsx(c,{onClick:()=>n(a),style:{cursor:"pointer"},color:p?r.colors[p][6]:void 0,size:16,stroke:2},i)})})]},t.id)}function $o({action:t,resultant:s=!1}){switch(t.name){case"Create User":return e.jsx(So,{action:t,resultant:s});case"Update Attributes":return e.jsx(Io,{action:t,resultant:s});default:return e.jsx(ko,{action:t,resultant:s})}}function at({id:t,matches:s,loading:n,setData:l,run:o,resultant:r=!1,dash:a=!1}){const[i,c]=j.useState(!0),[p,u]=j.useState(""),[x,k]=j.useState("15"),d=s.filter(g=>i?!0:!!g.actionable),y=g=>()=>l((d||[]).map(F=>F.id!==g?F:{...F,checked:!F.checked})),h=(d||[]).filter(g=>g.checked),I=h.length>0,D=()=>()=>l(I?(d||[]).map(g=>({...g,checked:!1})):(d||[]).map(g=>g.actionable?{...g,checked:!0}:g)),[_,L]=j.useState(void 0),X=p===""?d||[]:(d||[]).filter(g=>Po(p,g)),q=Math.ceil(X.length/Number(x)),A=ds({total:q,initialPage:1}),z=X.slice((A.active-1)*Number(x),A.active*Number(x));return e.jsxs(P,{pb:"xs",children:[!n&&e.jsxs(e.Fragment,{children:[e.jsx(xe,{title:`${_==null?void 0:_.name} ${r?"Result":"Preview"}`,opened:!!_,onClose:()=>L(void 0),styles:{header:{paddingBottom:0}},children:_&&e.jsxs(e.Fragment,{children:[_.result.warning&&e.jsx(w,{c:"orange",children:_.result.warning}),_.result.error&&e.jsx(w,{c:"red",children:_.result.error}),e.jsx($o,{action:_,resultant:r}),e.jsx(ne,{fz:"xs",label:"Raw Output",children:e.jsx("pre",{style:{margin:0},children:e.jsx(B,{fz:"xs",children:JSON.stringify(_,null,2)})})})]})}),e.jsxs(m,{justify:"center",children:[e.jsx(m.Col,{span:2,children:e.jsx(S,{mt:"xs",variant:"filled",placeholder:`Search ${(d||[]).length} entries...`,leftSection:e.jsx(Ne,{size:15}),value:p,onChange:g=>u(g.currentTarget.value)})}),!a&&e.jsx(m.Col,{span:2,children:!r&&e.jsx(v,{justify:"right",children:e.jsx(Be,{labelPosition:"left",mt:17,label:"Display Actionless",checked:i,onChange:()=>c(!i)})})}),e.jsx(m.Col,{span:2,children:e.jsx(ue,{mt:"xs",variant:"filled",placeholder:"Pick one",onChange:g=>k(g),value:x,data:[{value:"5",label:"5 Per Page"},{value:"15",label:"15 Per Page"},{value:"25",label:"25 Per Page"},{value:"50",label:"50 Per Page"},{value:"100",label:"100 Per Page"}]})}),e.jsx(m.Col,{span:"auto",children:e.jsx(us,{mt:12,onChange:g=>A.setPage(g),value:A.active,total:q})}),e.jsx(m.Col,{span:2,children:!r&&e.jsxs(O,{onClick:o,leftSection:e.jsx($e,{}),disabled:!I,mt:"xs",children:["Run ",h.length," Actions"]})})]}),e.jsx(nt,{mt:"xs"})]}),n&&e.jsx(v,{justify:"center",children:e.jsx(Kt,{resultant:r})}),d&&!n&&e.jsxs(e.Fragment,{children:[e.jsxs(m,{pt:"xs",align:"center",children:[e.jsx(m.Col,{pl:"lg",span:1,children:!r&&e.jsx(U,{onChange:D(),checked:I})}),a&&e.jsx(m.Col,{span:1,fw:"bold",children:"Schema"}),a&&e.jsx(m.Col,{span:1,fw:"bold",children:"Rule"}),e.jsx(m.Col,{span:2,fw:"bold",children:t||"ID"}),e.jsx(m.Col,{span:a?5:7,fw:"bold",children:"Display"}),e.jsx(m.Col,{span:2,fw:"bold",children:"Actions"})]}),z.map(g=>e.jsx(zo,{match:g,toggle:y,setAction:F=>L(F),resultant:r,dash:a},g.id))]})]})}function Ao({rule:t,close:s}){const{schema:n}=j.useContext(M),[l,o]=j.useState("conditions"),a=he({initialValues:{secondaries:[],conditions:[],actions:[]},validate:{}});j.useEffect(()=>{a.reset(),t&&a.setValues(t)},[t]);const i=a.values.conditions.length>0,{data:c,post:p,loading:u,reset:x,setData:k}=R({url:`/schema/${n==null?void 0:n.name}/rules/match`,data:{...t,conditions:a.values.conditions}}),{data:d,post:y,loading:h,reset:I,setData:D}=R({url:`/schema/${n==null?void 0:n.name}/rules/run`,data:{...t,conditions:a.values.conditions,matches:(c||[]).filter(q=>q.checked).map(q=>q.id)}}),_=()=>{x(),I()},L=()=>{_(),s(),o("conditions")},X=()=>{o("results"),y()};return e.jsx(xe,{withCloseButton:!1,size:"80%",opened:!!t,closeOnClickOutside:!1,onClose:L,styles:{body:{padding:0}},children:t&&e.jsxs(V,{p:0,value:l,onChange:o,children:[e.jsxs(V.List,{children:[e.jsx(V.Tab,{disabled:u,onClick:_,value:"conditions",children:"Conditions"}),e.jsx(V.Tab,{disabled:u||!i,leftSection:u?e.jsx(Se,{size:15}):e.jsx(Ne,{size:15}),value:"matches",onClick:p,children:"Find Matches"}),e.jsx(V.Tab,{disabled:!0,leftSection:h?e.jsx(Se,{size:15}):e.jsx($e,{size:15}),value:"results",children:"Results"}),e.jsx(V.Tab,{ml:"auto",disabled:!0,value:"log",children:"Log"}),e.jsx(V.Tab,{leftSection:e.jsx(Ae,{size:"0.8rem"}),value:"close","aria-label":"close",onClick:L})]}),e.jsx(V.Panel,{mih:300,p:"xs",pt:0,value:"conditions",children:e.jsx(Gt,{form:a,label:"Add single-run modifications here."})}),e.jsx(V.Panel,{value:"matches",children:e.jsx(at,{id:t==null?void 0:t.primaryKey,matches:c||[],loading:u,setData:k,run:X})}),e.jsx(V.Panel,{value:"results",children:e.jsx(at,{id:t==null?void 0:t.primaryKey,matches:d||[],loading:h,setData:D,resultant:!0})})]})})}function No(){const{schema:t,rules:s,mutate:n}=j.useContext(M),l=le(),[o,{open:r,close:a}]=se(!1),[i,c]=j.useState(void 0),[p,u]=j.useState(void 0),x=b=>{u(b),r()},k=b=>{c(b)},{del:d,request:y,loading:h}=R({cleanup:!0,furl:({name:b})=>`/schema/${t==null?void 0:t.name}/rule/${b}`,fdata:({name:b})=>({name:b}),catch:b=>ye(b),then:({rules:b,_rules:$})=>{n({rules:b,_rules:$}),H.show({title:"Success",message:"Rule Removed.",color:"lime"})}}),{post:I,request:D,loading:_}=R({cleanup:!0,furl:({name:b})=>`/schema/${t==null?void 0:t.name}/rule/${b}/copy`,fdata:({name:b})=>({name:b}),catch:b=>ye(b),then:({rules:b,_rules:$})=>{n({rules:b,_rules:$}),H.show({title:"Success",message:"Rule Copied.",color:"lime"})}}),{put:L,loading:X}=R({cleanup:!0,furl:({name:b})=>`/schema/${t==null?void 0:t.name}/rule/${b}/toggle`,fdata:({name:b})=>({name:b}),catch:b=>ye(b),then:({rules:b,_rules:$})=>{n({rules:b,_rules:$})}}),{put:q,loading:A}=R({cleanup:!0,url:`/schema/${t==null?void 0:t.name}/rules/reorder`,then:({rules:b})=>{n({rules:b})}}),z=b=>it.openConfirmModal({title:"Permanently Delete Rule",centered:!0,children:e.jsxs(w,{size:"sm",children:["Are you sure you want to delete ",b,"? This action is destructive and cannot be reversed."]}),labels:{confirm:"Delete rule",cancel:"No don't delete it"},confirmProps:{color:"red"},onConfirm:()=>d({name:b})}),g=h||_||A||X,[F,K]=Dt(s);j.useEffect(()=>K.setState(s),[s]);const C=(b,$)=>{K.reorder({from:b,to:$}),q({data:{from:b,to:$}})},f=b=>{K.setState(s.map($=>$.name!==b.name?$:{...$,enabled:!b.enabled})),L({name:b.name})};if(t)return o?e.jsx(Co,{editing:p,close:()=>{a(),u(void 0)}}):e.jsxs(fe,{label:e.jsx(be,{rightSection:e.jsx(O,{onClick:()=>r(),variant:"light",children:"Add"}),children:"Rules"}),children:[e.jsx(Ao,{rule:i,close:()=>c(void 0)}),F.length===0&&e.jsx(w,{c:"lighter",size:"sm",children:"No Rules in effect."}),e.jsx(ee,{onDragEnd:({destination:b,source:$})=>C($.index,(b==null?void 0:b.index)||0),children:e.jsx(re,{droppableId:"dnd-list",direction:"vertical",children:b=>e.jsxs("div",{...b.droppableProps,style:{top:"auto",left:"auto"},ref:b.innerRef,children:[F.map(($,Xe)=>e.jsx(ie,{index:Xe,draggableId:Xe.toString(),children:Re=>e.jsxs(m,{align:"center",ref:Re.innerRef,mt:"xs",...Re.draggableProps,className:Z.item,style:{...Re.draggableProps.style,left:"auto !important",top:"auto !important"},children:[e.jsx(m.Col,{span:"content",style:{cursor:"grab"},...Re.dragHandleProps,children:e.jsx(v,{children:e.jsx(ae,{size:"1.2rem"})})}),e.jsx(m.Col,{span:"auto",children:e.jsxs(v,{gap:5,children:[$.name,$.description&&$.description!==""&&e.jsx(Le,{position:"right",label:$.description,children:e.jsx(Qs,{size:16})})]})}),e.jsx(m.Col,{span:"auto",children:e.jsx(v,{children:$.actions.map((jt,Jt)=>{const{Icon:Xt,color:_e}=Ge[jt.name];return e.jsx(Le,{fz:"xs",withArrow:!0,color:_e?l.colors[_e][6]:void 0,label:jt.name,children:e.jsx(Xt,{color:_e?l.colors[_e][6]:void 0,size:16,stroke:2})},Jt)})})}),e.jsx(m.Col,{span:"content",children:e.jsxs(v,{justify:"right",gap:"xs",children:[e.jsx(U,{disabled:g,onClick:()=>f($),checked:$.enabled,color:"teal"}),e.jsx(N,{disabled:g,loading:y.name===$.name,onClick:()=>z($.name),variant:"subtle",color:"red",children:e.jsx(W,{size:16,stroke:1.5})}),e.jsx(N,{disabled:g,loading:D.name===$.name,onClick:()=>I({name:$.name}),variant:"subtle",color:"indigo",children:e.jsx(ke,{size:16,stroke:1.5})}),e.jsx(N,{disabled:g,onClick:()=>x($),variant:"subtle",color:"orange",children:e.jsx(Fe,{size:16,stroke:1.5})}),e.jsx(N,{disabled:g,onClick:()=>k($),variant:"subtle",color:"green",children:e.jsx(Zs,{size:16,stroke:1.5})})]})})]})},Xe)),b.placeholder]})})})]})}function Do({opened:t,close:s,editing:n,loading:l=!1,add:o,save:r,form:a}){const{data:i=[],loading:c}=R({url:"/schema",default:[],fetch:!0,mutate:D=>D.map(_=>_.name)}),{data:p=[],loading:u,get:x,error:k}=R({url:`/schema/${a.values.schema}/rules/`,default:[],mutate:D=>D.map(_=>_.name)});j.useEffect(()=>{a.values.schema&&x()},[a.values.schema]);const d=lt.toString(a.values.cron,{throwExceptionOnParseError:!1}),y=d.includes("An error occured when generating the expression description"),h=!a.values.schema,I=()=>{if(n)return r({id:n.id});o()};return e.jsxs(xe,{size:"lg",opened:t,onClose:s,title:"Add Schedule",children:[e.jsx(ue,{label:"Target Schema",required:!0,placeholder:"Pick schema",data:i,rightSection:c?e.jsx(Se,{size:"xs"}):void 0,...a.getInputProps("schema")}),a.values.schema&&e.jsxs(e.Fragment,{children:[e.jsx(hs,{label:"Rules",clearable:!0,description:"Specify which rules will be run on the schema. Leave blank to run all.",placeholder:a.values.rules.length<=0?"All rules":"Pick rules",disabled:p.length<=0,data:p,rightSection:u?e.jsx(Se,{size:"xs"}):void 0,...a.getInputProps("rules"),error:k}),e.jsx(w,{fz:"xs",c:"dimmed",children:"Note: Disabled rules will be skipped regardless."}),e.jsx(zt,{mt:5,fullWidth:!0,...a.getInputProps("type"),data:[{label:e.jsxs(ce,{children:[e.jsx(en,{size:20,stroke:1.5}),e.jsx(P,{ml:5,children:"Schedule"})]}),value:"Schedule"},{label:e.jsxs(ce,{children:[e.jsx(tn,{size:20,stroke:1.5}),e.jsx(P,{ml:5,children:"Monitor"})]}),value:"Monitor"}]}),a.values.type==="Schedule"&&e.jsx(S,{label:"CRON Expression",placeholder:"0 * * * MON-FRI",required:!0,description:y?"Invalid Syntax":d,...a.getInputProps("cron"),error:y&&d}),a.values.type==="Monitor"&&e.jsx(S,{label:"File Path",placeholder:"D:/watchme.csv",required:!0,description:"This file path will be monitored, and the schedule run when a file change is detected.",...a.getInputProps("monitor")})]}),e.jsx(v,{justify:"right",mt:"md",children:e.jsx(O,{loading:l,disabled:h,onClick:I,variant:"light",type:"submit",children:n?"Save":"Add"})})]})}function Fo(){const t=C=>C.map(f=>({...f,rules:f.rules?JSON.parse(f.rules):[],type:f.monitor?"Monitor":"Schedule"})).sort((f,b)=>f.index-b.index),[s,n]=Dt([]),{loading:l}=R({url:"/schedule",default:[],preserve:!0,fetch:!0,mutate:t,then:C=>n.setState(C)}),[o,{open:r,close:a}]=se(!1),[i,c]=j.useState(void 0),p={schema:"",type:"",rules:[],cron:"",monitor:""},u=he({initialValues:p,validate:{cron:C=>{if(u.values.type==="Monitor")return!1;const f=lt.toString(C,{throwExceptionOnParseError:!1});return f.includes("An error occured when generating the expression description")?f:null},monitor:C=>u.values.type==="Schedule"?!1:C.trim()===""&&"Path required."}});j.useEffect(()=>{u.reset(),i?u.setValues(i):u.setValues(p),u.setInitialValues(p)},[i]);const{post:x,loading:k}=R({url:"/schedule",data:u.values,before:()=>u.validate(),check:()=>!u.isValid(),catch:({validation:C})=>u.setErrors(C),mutate:t,then:C=>{n.setState(C),a(),H.show({title:"Success",message:"Schedule Added.",color:"lime"})}}),{put:d,loading:y}=R({url:"/schedule/reorder",fdata:({from:C,to:f})=>({from:C,to:f}),mutate:t,then:C=>n.setState(C)}),h=(C,f)=>{n.reorder({from:C,to:f}),d({from:C,to:f})},{put:I,loading:D}=R({url:"/schedule",data:u.values,before:()=>u.validate(),check:()=>!u.isValid(),catch:({validation:C})=>u.setErrors(C),furl:({id:C})=>`/schedule/${C}`,mutate:t,then:C=>{n.setState(C),a(),H.show({title:"Success",message:"Schedule Modified.",color:"lime"})}}),{put:_,loading:L}=R({url:"/schedule",data:u.values,furl:({id:C})=>`/schedule/${C}/toggle`,mutate:t,then:C=>n.setState(C)}),{del:X,request:q,loading:A}=R({cleanup:!0,furl:({id:C})=>`/schedule/${C}`,mutate:t,then:C=>{n.setState(C),H.show({title:"Success",message:"Schedule Removed.",color:"lime"})}}),z=l||k||D||L||A||y,g=C=>{c(C),r()},F=C=>{n.setState(s.map(f=>f.id!==C.id?f:{...f,enabled:!C.enabled})),_({id:C.id})},K=()=>{c(void 0),a()};return e.jsxs(fe,{label:e.jsx(be,{rightSection:e.jsxs(v,{children:[l&&e.jsx(Se,{size:"sm"}),e.jsx(O,{onClick:r,variant:"light",children:"Add"})]}),children:"Schedules"}),children:[e.jsx(Do,{opened:o,close:K,form:u,add:x,save:I,editing:i,loading:z}),s.length===0&&e.jsx(w,{c:"lighter",size:"sm",children:z?"Loading...":"No Schedules in effect."}),e.jsx(ee,{onDragEnd:({destination:C,source:f})=>h(f.index,(C==null?void 0:C.index)||0),children:e.jsx(re,{droppableId:"dnd-list",direction:"vertical",children:C=>e.jsxs("div",{...C.droppableProps,style:{top:"auto",left:"auto"},ref:C.innerRef,children:[s.map(f=>{const b=f.cron?lt.toString(f.cron,{throwExceptionOnParseError:!1}):`Watch: ${f.monitor}`;return e.jsx(ie,{index:f.index,draggableId:f.id,children:$=>e.jsxs(m,{align:"center",ref:$.innerRef,mt:"xs",...$.draggableProps,className:Z.item,style:{...$.draggableProps.style,left:"auto !important",top:"auto !important"},children:[e.jsx(m.Col,{span:"content",style:{cursor:"grab"},...$.dragHandleProps,children:e.jsx(v,{children:e.jsx(ae,{size:"1.2rem"})})}),e.jsx(m.Col,{span:"auto",children:e.jsx(w,{size:"xs",lineClamp:1,children:b})}),e.jsx(m.Col,{span:"auto",children:e.jsxs(w,{size:"xs",lineClamp:1,children:["Schema: ",f.schema," ",f.rules.length>0&&` | Rules: ${f.rules}`]})}),e.jsx(m.Col,{span:"content",children:e.jsxs(v,{justify:"right",gap:"xs",children:[e.jsx(U,{disabled:z,onClick:()=>F(f),checked:f.enabled,color:"teal"}),e.jsx(N,{disabled:z,loading:q.id===f.id,onClick:()=>X({id:f.id}),variant:"subtle",color:"red",children:e.jsx(W,{size:16,stroke:1.5})}),e.jsx(N,{disabled:z,onClick:()=>g(f),variant:"subtle",color:"orange",children:e.jsx(Fe,{size:16,stroke:1.5})})]})})]})},f.id)}),C.placeholder]})})})]})}function Ro({schema:t,schemas:s,check:n,loading:l,getSchemas:o}){return e.jsx(e.Fragment,{children:e.jsxs(ht,{menu:{onOpen:()=>o()},loading:l,variant:"light",onClick:n,options:s,children:["Check ",t]})})}function _o(){const{get:t,data:s,loading:n}=R({url:"/schema",default:[{onClick:()=>k("all schemas"),label:"All Schemas"}],fetch:!0,mutate:d=>{const y=d.map(h=>({onClick:()=>k(h.name),label:h.name}));return[{onClick:()=>k("all schemas"),label:"All Schemas"},...y]}}),[l,o]=j.useState("all schemas"),{data:r,post:a,loading:i,reset:c,setData:p}=R({url:"/match",data:{schema_name:l},mutate:d=>d.filter(y=>y.actionable)}),u=i||n,x=s.length>1,k=d=>{o(d),c()};return e.jsx(fe,{size:"responsive",label:e.jsx(be,{rightSection:x?e.jsx(Ro,{schema:l,schemas:s,setSchema:k,getSchemas:t,check:a,loading:u}):e.jsx(e.Fragment,{}),children:"Dashboard"}),children:x?e.jsxs(e.Fragment,{children:[e.jsx(at,{matches:r||[],loading:i,setData:p,run:()=>{},dash:!0}),!r&&!i&&e.jsxs(w,{fz:"sm",c:"dimmed",children:["Run a ",e.jsx("a",{href:"#",onClick:a,children:"check"})," to find actions to take."]})]}):e.jsx(w,{fz:"sm",c:"dimmed",children:"Create a schema to begin."})})}function To(){const{nav:t}=j.useContext(Ke);switch(t){case"Settings":return e.jsx(Pn,{});case"Schedules":return e.jsx(Fo,{});case"Schema":return e.jsx(Fn,{});case"Connectors":return e.jsx(po,{});case"Rules":return e.jsx(No,{});default:return e.jsx(_o,{})}}function Eo(){const[t,{toggle:s,close:n}]=se(),l=It(`(max-width: ${Pt(750)})`),{authed:o}=j.useContext(Pe);return o?e.jsxs(Ee,{header:{height:64,collapsed:!l},navbar:{width:300,breakpoint:"sm",collapsed:{mobile:!t}},padding:"md",children:[e.jsx(Ee.Header,{children:e.jsx(Ht,{opened:t,toggle:s})}),e.jsx(Ee.Navbar,{children:e.jsx(bn,{closeNav:n})}),e.jsx(Ee.Main,{children:e.jsx(To,{})})]}):e.jsx(Cn,{})}function Oo({children:t}){const[s,n]=j.useState("Dashboard"),l=o=>n(o);return e.jsx(Ke.Provider,{value:{nav:s,changeNav:l},children:t})}function Lo({children:t}){const[s,n,l]=st({key:"auth",defaultValue:"{}"}),o=JSON.parse(s||"{}")||{},r=o.session||void 0,a=()=>{l()};return e.jsx(Pe.Provider,{value:{authed:r,session:o,logout:a,login:n},children:t})}function Vo({children:t}){const{changeNav:s}=j.useContext(Ke),[n,l]=j.useState(void 0),{data:o,setData:r,loading:a,request:i,fetch:c,reset:p}=R({url:`/schema/${n}`,loading:n,preserve:!0,before:()=>s("Dashboard"),then:d=>{s("Schema"),!(!d.errors||d.errors.length<=0)&&H.show({title:"Errors Detected",message:JSON.stringify(d.errors),color:"red",autoClose:!1})}}),u=a?i.loading:!1;j.useEffect(()=>{n?c():(p(),s("Dashboard"))},[n]);const x=d=>l(d),k=(d={})=>r({...o,...d});return e.jsx(M.Provider,{value:{schema:o,loading:u,connectors:o?o.connectors:[],_connectors:o?o._connectors:{},rules:o?o.rules:[],_rules:o?o._rules:{},headers:o?o.headers:{},changeSchema:x,reload:c,mutate:k},children:t})}const Uo="_connector_sxciz_1",Mo={connector:Uo};function qo(t){const s=[];for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){const l=t[n];for(const o of l)s.push(`${n}.${o}`)}return s}function Bo({opened:t,close:s,click:n}){const l=le(),{_connectors:o,headers:r}=j.useContext(M),[a,i]=j.useState(""),c=x=>i(x.target.value),u=qo(r).filter(x=>x.toLowerCase().includes(a.toLowerCase()));return e.jsxs(xs,{position:"right",size:"xs",opened:t,onClose:s,title:"Template Explorer",overlayProps:{opacity:.2},children:[e.jsx(S,{pb:"xs",leftSection:e.jsx(Ne,{size:16,style:{display:"block",opacity:.5}}),placeholder:"Search",onChange:c,value:a}),a===""?Object.keys(r).map(x=>{if(!(x in o))return e.jsxs(e.Fragment,{children:[x," ERROR"]});const{id:k}=o[x],d=je[k];return e.jsx(ze,{onClick:()=>i(`${x}.`),className:Mo.connector,p:"xs",mt:"xs",children:e.jsxs(v,{children:[e.jsx(P,{style:{display:"flex",alignItems:"center"},children:e.jsx(d.icon,{size:17,color:l.colors[d.color][6]})}),e.jsx("div",{style:{flex:1},children:e.jsx(w,{size:"sm",children:x})}),e.jsx(ct,{size:17,stroke:1.5})]})},x)}):e.jsx(ms,{style:{justifyContent:"center"},gap:"sm",justify:"flex-start",align:"center",direction:"row",wrap:"wrap",children:u.map(x=>e.jsx(O,{onClick:()=>n(x),variant:"default",radius:"xl",size:"compact-xs",children:x},x))})]})}function Ho({children:t}){const[s,{open:n,close:l}]=se(!1),[o,r]=j.useState(()=>c=>{console.log(c)}),a=e.jsx(Bo,{click:o,opened:s,close:l}),i=c=>{n(),r(c)};return e.jsx(Je.Provider,{value:{explorer:a,explore:i,close:l},children:t})}const Wo=js({fontFamily:"Roboto, sans-serif",components:{TextInput:S.extend({classNames:{input:Z.input}})}});function Ko({children:t}){return e.jsxs(gs,{defaultColorScheme:"auto",theme:Wo,children:[e.jsx(bs,{}),e.jsx(fs,{children:e.jsx(Oo,{children:e.jsx(Lo,{children:e.jsx(Vo,{children:e.jsx(Ho,{children:t})})})})})]})}Qt.createRoot(document.getElementById("root")).render(e.jsx(Yt.StrictMode,{children:e.jsx(Ko,{children:e.jsx(Eo,{})})}));
